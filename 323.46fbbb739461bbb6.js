"use strict";(self.webpackChunkedgetensor=self.webpackChunkedgetensor||[]).push([[323],{3323:(xe,v,d)=>{d.r(v),d.d(v,{ReportsModule:()=>be});var Z=d(6814),a=d(6223),_=d(707),T=d(6760),y=d(3530),w=d(2160),S=d(5609),b=d(3714),x=d(4055),A=d(8454),D=d(1712),N=d(7680),F=d(9552),m=d(4844),C=d(4104),U=d(3259),q=d(3745),I=d(1967),R=d(3173),h=d(2001),g=d(5219),J=d(9315),e=d(5879),u=d(5878);function M(i,s){1&i&&e._UZ(0,"p-progressSpinner")}function k(i,s){1&i&&(e.TgZ(0,"tr")(1,"th"),e._uU(2,"Scheduler Name"),e.qZA(),e.TgZ(3,"th"),e._uU(4,"Report Sent Time"),e.qZA(),e.TgZ(5,"th"),e._uU(6,"Email Sent?"),e.qZA(),e.TgZ(7,"th",22),e._uU(8,"Details"),e.qZA()())}function H(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"tr")(1,"td",23)(2,"span",24),e._uU(3,"Scheduler Name"),e.qZA(),e._uU(4),e.qZA(),e.TgZ(5,"td",25)(6,"span",24),e._uU(7,"Report Sent Time"),e.qZA(),e._uU(8),e.qZA(),e.TgZ(9,"td",25)(10,"span",24),e._uU(11,"Email Sent"),e.qZA(),e._uU(12),e.qZA(),e.TgZ(13,"td",26)(14,"span",24),e._uU(15,"Details"),e.qZA(),e.TgZ(16,"p-button",27),e.NdJ("click",function(){const n=e.CHM(t).$implicit,r=e.oxw();return e.KtG(r.viewHistory(n))}),e.qZA()()()}if(2&i){const t=s.$implicit,l=e.oxw();e.xp6(4),e.hij(" ",(null==t||null==t.scheduler?null:t.scheduler.name)||"N/A"," "),e.xp6(4),e.hij(" ",l.utilsService.convertToTimezone(null==t?null:t.report_sending_time,null==l.orgSettings?null:l.orgSettings.timezone)," "),e.xp6(4),e.hij(" ",1===(null==t?null:t.email_sent)?"Yes":"No"," ")}}function Q(i,s){1&i&&(e.TgZ(0,"tr")(1,"th"),e._uU(2,"Name"),e.qZA(),e.TgZ(3,"th"),e._uU(4,"Status?"),e.qZA(),e.TgZ(5,"th"),e._uU(6,"Resources"),e.qZA(),e.TgZ(7,"th"),e._uU(8," Fleet "),e.qZA(),e.TgZ(9,"th"),e._uU(10," Report Type "),e.qZA(),e.TgZ(11,"th"),e._uU(12," Frequency "),e.qZA(),e.TgZ(13,"th"),e._uU(14," Schedule Time"),e.qZA(),e.TgZ(15,"th"),e._uU(16," Region"),e.qZA(),e.TgZ(17,"th"),e._uU(18," Last Report Sent"),e.qZA(),e._UZ(19,"th"),e.qZA())}function Y(i,s){1&i&&(e.TgZ(0,"b"),e._uU(1,"...show more"),e.qZA())}function E(i,s){if(1&i&&(e.ynx(0),e.TgZ(1,"span",41),e._uU(2),e._UZ(3,"br"),e.YNc(4,Y,2,0,"b",0),e.qZA(),e.BQk()),2&i){const t=e.oxw().$implicit,l=e.oxw();e.xp6(1),e.s9C("pTooltip",l.getFilteredNamesWidgets(l.widgets,null==t?null:t.sub_resource_ids).tooltipNames),e.xp6(1),e.hij(" ",l.getFilteredNamesWidgets(l.widgets,null==t?null:t.sub_resource_ids).displayedNames,""),e.xp6(2),e.Q6J("ngIf",l.getFilteredNamesWidgets(l.widgets,null==t?null:t.sub_resource_ids).tooltipNames.length>0)}}function j(i,s){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&i){const t=e.oxw().$implicit,l=e.oxw();e.xp6(1),e.Oqu(l.getFilteredNamesWidgets(l.widgets,null==t?null:t.sub_resource_ids).displayedNames)}}function O(i,s){1&i&&(e.TgZ(0,"b"),e._uU(1,"...show more"),e.qZA())}function P(i,s){if(1&i&&(e.ynx(0),e.TgZ(1,"span",41),e._uU(2),e._UZ(3,"br"),e.YNc(4,O,2,0,"b",0),e.qZA(),e.BQk()),2&i){const t=e.oxw().$implicit,l=e.oxw();e.xp6(1),e.s9C("pTooltip",l.getFilteredNames(l.fleets,null==t?null:t.fleet_ids).tooltipNames),e.xp6(1),e.hij(" ",l.getFilteredNames(l.fleets,null==t?null:t.fleet_ids).displayedNames,""),e.xp6(2),e.Q6J("ngIf",l.getFilteredNames(l.fleets,null==t?null:t.fleet_ids).tooltipNames.length>0)}}function $(i,s){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&i){const t=e.oxw().$implicit,l=e.oxw();e.xp6(1),e.Oqu(l.getFilteredNames(l.fleets,null==t?null:t.fleet_ids).displayedNames)}}function W(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"tr")(1,"td",28)(2,"span",24),e._uU(3,"Scheduler Name"),e.qZA(),e._uU(4),e.qZA(),e.TgZ(5,"td",29)(6,"span",24),e._uU(7,"Status?"),e.qZA(),e._UZ(8,"p-inputSwitch",30),e.qZA(),e.TgZ(9,"td",25)(10,"span",24),e._uU(11,"Resources"),e.qZA(),e.YNc(12,E,5,3,"ng-container",31),e.YNc(13,j,2,1,"ng-template",null,32,e.W1O),e.qZA(),e.TgZ(15,"td",25)(16,"span",24),e._uU(17,"Fleet"),e.qZA(),e.YNc(18,P,5,3,"ng-container",31),e.YNc(19,$,2,1,"ng-template",null,33,e.W1O),e.qZA(),e.TgZ(21,"td",34)(22,"span",24),e._uU(23,"Report Type"),e.qZA(),e._uU(24),e.qZA(),e.TgZ(25,"td",34)(26,"span",24),e._uU(27,"Frequency"),e.qZA(),e.TgZ(28,"span",35),e._uU(29),e.qZA()(),e.TgZ(30,"td",36)(31,"span",24),e._uU(32,"Schedule Time"),e.qZA(),e._uU(33),e.qZA(),e.TgZ(34,"td",37)(35,"span",24),e._uU(36,"Region"),e.qZA(),e._uU(37),e.qZA(),e.TgZ(38,"td",38)(39,"span",24),e._uU(40,"Last Report Sent"),e.qZA(),e._uU(41),e.qZA(),e.TgZ(42,"td")(43,"div",5)(44,"button",39),e.NdJ("click",function(){const n=e.CHM(t).$implicit,r=e.oxw();return e.KtG(r.editScheduler(null==n?null:n.id_))}),e.qZA(),e.TgZ(45,"button",40),e.NdJ("click",function(){const n=e.CHM(t).$implicit,r=e.oxw();return e.KtG(r.deleteScheduler(null==n?null:n.id_))}),e.qZA()()()()}if(2&i){const t=s.$implicit,l=e.MAs(14),o=e.MAs(20),n=e.oxw();e.xp6(4),e.hij(" ",null==t?null:t.name," "),e.xp6(4),e.Q6J("ngModel",null==t?null:t.is_enabled)("disabled",!0),e.xp6(4),e.Q6J("ngIf",n.getFilteredNamesWidgets(n.widgets,null==t?null:t.sub_resource_ids).tooltipNames)("ngIfElse",l),e.xp6(6),e.Q6J("ngIf",n.getFilteredNames(n.fleets,null==t?null:t.fleet_ids).tooltipNames)("ngIfElse",o),e.xp6(6),e.hij(" ",null==t?null:t.report_type," "),e.xp6(5),e.hij(" ",null==t?null:t.mode_of_range," "),e.xp6(4),e.hij(" ",n.formatTimeWithoutDate(null==t||null==t.report_schedule_time?null:t.report_schedule_time.time)," "),e.xp6(4),e.hij(" ",null==t?null:t.timezone," "),e.xp6(4),e.hij(" ",null==t?null:t.last_email_sent," ")}}function z(i,s){1&i&&(e.TgZ(0,"div")(1,"div",69),e._uU(2,"Status is required."),e.qZA()())}function L(i,s){1&i&&(e.TgZ(0,"div")(1,"div",69),e._uU(2,"Name is required."),e.qZA()())}function V(i,s){1&i&&(e.TgZ(0,"div")(1,"div",69),e._uU(2,"Report Type is required."),e.qZA()())}function B(i,s){1&i&&e._uU(0),2&i&&e.hij(" ",s.$implicit.label," ")}function G(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"p-tree",74,75),e.NdJ("onNodeSelect",function(o){e.CHM(t);const n=e.oxw(3);return e.KtG(n.nodeSelect(o))})("onNodeUnselect",function(o){e.CHM(t);const n=e.oxw(3);return e.KtG(n.nodeUnSelect(o))})("selectionChange",function(o){e.CHM(t);const n=e.oxw(3);return e.KtG(n.selectedFleetss=o)}),e.YNc(2,B,1,1,"ng-template",58),e.qZA()}if(2&i){const t=e.oxw(3);e.Q6J("value",t.fleets)("propagateSelectionUp",!1)("propagateSelectionDown",t.isFleetSelectionRecursive)("selection",t.selectedFleetss)}}const K=function(){return{standalone:!0}};function X(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"div",70),e.NdJ("click",function(o){e.CHM(t);const n=e.oxw(2);return e.KtG(n.preventOverlayCollapse(o))}),e.TgZ(1,"label",71),e._uU(2,"Select child fleets:"),e.qZA(),e.TgZ(3,"p-inputSwitch",72),e.NdJ("ngModelChange",function(o){e.CHM(t);const n=e.oxw(2);return e.KtG(n.isFleetSelectionRecursive=o)}),e.qZA(),e._UZ(4,"br")(5,"br"),e.YNc(6,G,3,4,"p-tree",73),e.qZA()}if(2&i){const t=e.oxw(2);e.xp6(3),e.Q6J("ngModel",t.isFleetSelectionRecursive)("ngModelOptions",e.DdM(3,K)),e.xp6(3),e.Q6J("ngIf",t.selectedFleetss)}}function ee(i,s){1&i&&(e.TgZ(0,"div")(1,"div",69),e._uU(2,"At least one fleet must be selected. "),e.qZA()())}function te(i,s){1&i&&e._uU(0),2&i&&e.hij(" ",s.$implicit.name," ")}function ie(i,s){1&i&&(e.TgZ(0,"div")(1,"div",69),e._uU(2,"At least one widget is required."),e.qZA()())}function le(i,s){if(1&i&&(e._uU(0),e.TgZ(1,"small",76),e._uU(2),e.qZA()),2&i){const t=s.$implicit;e.AsE(" ",t.first_name," ",t.last_name," "),e.xp6(2),e.hij("(",t.email,")")}}function oe(i,s){1&i&&(e.TgZ(0,"div")(1,"div",69),e._uU(2,"At least one user is required."),e.qZA()())}function ne(i,s){1&i&&(e.TgZ(0,"div")(1,"div",69),e._uU(2,"Frequency is required."),e.qZA()())}function se(i,s){1&i&&(e.TgZ(0,"div")(1,"div",69),e._uU(2,"Daily Time is required."),e.qZA()())}function re(i,s){if(1&i&&(e.ynx(0),e.TgZ(1,"div",64)(2,"div",43)(3,"div",77)(4,"div",78)(5,"label",79),e._uU(6,"Start Time*"),e.qZA(),e._UZ(7,"p-calendar",80),e.YNc(8,se,3,0,"div",0),e.qZA()(),e.TgZ(9,"div",64)(10,"small"),e._uU(11,"The End Time will automatically be 24 hours from the selected Start Time. "),e.qZA()()()(),e.BQk()),2&i){const t=e.oxw(2);e.xp6(7),e.Q6J("showTime",!0)("hourFormat","24")("readonlyInput",!0)("timeOnly",!0),e.xp6(1),e.Q6J("ngIf",t.f.start_time.touched&&t.f.start_time.invalid)}}function ae(i,s){1&i&&(e.TgZ(0,"div")(1,"div",69),e._uU(2,"Weekly Time is required. "),e.qZA()())}function de(i,s){1&i&&(e.TgZ(0,"div")(1,"div",69),e._uU(2,"Daily Time is required."),e.qZA()())}function pe(i,s){if(1&i&&(e.ynx(0),e.TgZ(1,"div",64)(2,"div",43)(3,"div",77)(4,"div",78)(5,"label",81),e._uU(6,"Start day*"),e.qZA(),e._UZ(7,"p-dropdown",82),e.YNc(8,ae,3,0,"div",0),e.qZA()(),e.TgZ(9,"div",77)(10,"div",78)(11,"label",79),e._uU(12,"Start Time*"),e.qZA(),e._UZ(13,"p-calendar",80),e.YNc(14,de,3,0,"div",0),e.qZA()(),e.TgZ(15,"div",64)(16,"small"),e._uU(17,"The end time will be exactly one week later from the selected day and time. "),e.qZA()()()(),e.BQk()),2&i){const t=e.oxw(2);e.xp6(7),e.Q6J("options",t.weekdays),e.xp6(1),e.Q6J("ngIf",t.f.start_day.touched&&t.f.start_day.invalid),e.xp6(5),e.Q6J("showTime",!0)("hourFormat","24")("readonlyInput",!0)("timeOnly",!0),e.xp6(1),e.Q6J("ngIf",t.f.start_time.touched&&t.f.start_time.invalid)}}function ue(i,s){1&i&&(e.TgZ(0,"div")(1,"div",69),e._uU(2,"Report Schedule Time is required. "),e.qZA()())}function ce(i,s){1&i&&(e.TgZ(0,"div")(1,"div",69),e._uU(2,"Region is required."),e.qZA()())}function _e(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"form",42),e.NdJ("ngSubmit",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.saveScheduler())}),e.TgZ(1,"div",43)(2,"div",44)(3,"div",45)(4,"label",46),e._uU(5,"Status*"),e.qZA(),e._UZ(6,"br")(7,"p-inputSwitch",47),e.YNc(8,z,3,0,"div",0),e.qZA()(),e.TgZ(9,"div",44)(10,"div",45)(11,"label",48),e._uU(12,"Name*"),e.qZA(),e._UZ(13,"input",49),e.YNc(14,L,3,0,"div",0),e.qZA()(),e.TgZ(15,"div",44)(16,"div",45)(17,"label",50),e._uU(18,"Report Type*"),e.qZA(),e._UZ(19,"p-dropdown",51),e.YNc(20,V,3,0,"div",0),e.qZA()(),e.TgZ(21,"div",44)(22,"div",45)(23,"label",52),e._uU(24,"Fleet*"),e.qZA(),e.TgZ(25,"button",53),e.NdJ("click",function(o){e.CHM(t);const n=e.MAs(27);return e.KtG(n.toggle(o))}),e.qZA(),e.TgZ(26,"p-overlayPanel",54,55),e.YNc(28,X,7,4,"ng-template",15),e.qZA(),e.YNc(29,ee,3,0,"div",0),e.qZA()(),e.TgZ(30,"div",44)(31,"div",45)(32,"label",56),e._uU(33,"Widgets*"),e.qZA(),e.TgZ(34,"p-multiSelect",57),e.YNc(35,te,1,1,"ng-template",58),e.qZA(),e.YNc(36,ie,3,0,"div",0),e.qZA()(),e.TgZ(37,"div",44)(38,"div",45)(39,"label",59),e._uU(40,"Users*"),e.qZA(),e.TgZ(41,"p-multiSelect",60),e.YNc(42,le,3,3,"ng-template",58),e.qZA(),e.YNc(43,oe,3,0,"div",0),e.qZA()(),e._UZ(44,"div",61),e.TgZ(45,"div",44)(46,"div",45)(47,"label",62),e._uU(48,"Frequency*"),e.qZA(),e._UZ(49,"p-dropdown",63),e.YNc(50,ne,3,0,"div",0),e.qZA()(),e.YNc(51,re,12,5,"ng-container",0),e.YNc(52,pe,18,7,"ng-container",0),e._UZ(53,"div",61),e.TgZ(54,"div",64)(55,"div",43)(56,"div",44)(57,"div",45)(58,"label",65),e._uU(59,"Time at which report should be sent*"),e.qZA(),e._UZ(60,"p-calendar",66),e.YNc(61,ue,3,0,"div",0),e.qZA()(),e.TgZ(62,"div",44)(63,"div",45)(64,"label",67),e._uU(65,"Region*"),e.qZA(),e._UZ(66,"p-dropdown",68),e.YNc(67,ce,3,0,"div",0),e.qZA()()()()()()}if(2&i){const t=e.oxw();e.Q6J("formGroup",t.schedulerForm),e.xp6(8),e.Q6J("ngIf",t.f.is_enabled.touched&&t.f.is_enabled.invalid),e.xp6(6),e.Q6J("ngIf",t.f.name.touched&&t.f.name.invalid),e.xp6(5),e.Q6J("options",t.reportTypes),e.xp6(1),e.Q6J("ngIf",t.f.report_type.touched&&t.f.report_type.invalid),e.xp6(5),e.Q6J("label",t.buttonDisplayName),e.xp6(4),e.Q6J("ngIf",0===t.selectedFleetss.length),e.xp6(5),e.Q6J("options",t.widgets)("showToggleAll",!1)("filter",!0),e.xp6(2),e.Q6J("ngIf",t.f.sub_resource_ids.touched&&t.f.sub_resource_ids.invalid),e.xp6(5),e.Q6J("options",t.users)("showToggleAll",!1)("filter",!0),e.xp6(2),e.Q6J("ngIf",t.f.user_ids.touched&&t.f.user_ids.invalid),e.xp6(6),e.Q6J("options",t.frequencies),e.xp6(1),e.Q6J("ngIf",t.f.mode_of_range.touched&&t.f.mode_of_range.invalid),e.xp6(1),e.Q6J("ngIf","daily"===t.schedulerForm.controls.mode_of_range.value),e.xp6(1),e.Q6J("ngIf","weekly"===t.schedulerForm.controls.mode_of_range.value),e.xp6(8),e.Q6J("showTime",!0)("hourFormat","24")("readonlyInput",!0)("timeOnly",!0),e.xp6(1),e.Q6J("ngIf",t.f.report_schedule_time.touched&&t.f.report_schedule_time.invalid),e.xp6(5),e.Q6J("options",t.timezones)("filter",!0),e.xp6(1),e.Q6J("ngIf",t.f.timezone.touched&&t.f.timezone.invalid)}}function me(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"button",83),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return o.schedulerDialog=!1,e.KtG(o.submitted=!1)}),e.qZA(),e.TgZ(1,"button",84),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.saveScheduler())}),e.qZA()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("disabled",t.schedulerForm.invalid)}}function he(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"button",85),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.deleteSchedulerDialog=!1)}),e.qZA(),e.TgZ(1,"button",86),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.confirmDeleteScheduler())}),e.qZA()}}function ge(i,s){1&i&&(e.TgZ(0,"tr")(1,"th"),e._uU(2,"From Date"),e.qZA(),e.TgZ(3,"th"),e._uU(4,"To Date"),e.qZA(),e.TgZ(5,"th"),e._uU(6,"Widget Name"),e.qZA(),e.TgZ(7,"th",22),e._uU(8,"Download"),e.qZA()())}function fe(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"tr")(1,"td",87)(2,"span",24),e._uU(3,"From Date"),e.qZA(),e._uU(4),e.qZA(),e.TgZ(5,"td",87)(6,"span",24),e._uU(7,"Email Sent"),e.qZA(),e._uU(8),e.qZA(),e.TgZ(9,"td",25)(10,"span",24),e._uU(11,"Widget Name"),e.qZA(),e._uU(12),e.qZA(),e.TgZ(13,"td",88)(14,"span",24),e._uU(15,"Download"),e.qZA(),e.TgZ(16,"p-button",89),e.NdJ("click",function(){const n=e.CHM(t).$implicit,r=e.oxw();return e.KtG(r.downloadReport(n.report_file))}),e.qZA()()()}if(2&i){const t=s.$implicit;e.xp6(4),e.hij(" ",t.from_date," "),e.xp6(4),e.hij(" ",t.to_date," "),e.xp6(4),e.hij(" ",t.widgetName," ")}}const f=function(){return[10,20,30]},ve=function(){return["first_name","last_name","email","readableRoles","contact_no","status"]},Ze=function(){return{width:"50%",minWidth:"500px"}},Te=function(){return{width:"450px"}},ye=function(){return{width:"80%"}};let we=(()=>{class i{reportSchedulerService;usersRolesService;utilsService;messageService;settingsService;isEdit=!1;schedulerForm;submitted=!1;schedulerDialog=!1;schedules=[];schedulerForDelete={};deleteSchedulerDialog=!1;minStartDate=new Date;users=[];reportTypes=[{label:"XLSX",value:"XLSX"},{label:"CSV",value:"CSV"}];frequencies=[{label:"Daily",value:"daily"},{label:"Weekly",value:"weekly"},{label:"Monthly",value:"monthly"}];widgets=[];fleets=[];selectedFleet={};timezones=[];isFleetSelectionRecursive=!0;buttonDisplayName;weekdays=[{label:"Sunday",value:"SUN",end_day:"MON"},{label:"Monday",value:"MON",end_day:"TUE"},{label:"Tuesday",value:"TUE",end_day:"WED"},{label:"Wednesday",value:"WED",end_day:"THU"},{label:"Thursday",value:"THU",end_day:"FRI"},{label:"Friday",value:"FRI",end_day:"SAT"},{label:"Saturday",value:"SAT",end_day:"SUN"}];schedulesForTable=[];scheduledHistory=[];showHistoryDialog=!1;showSpinner=!1;orgSettings={};selectedFleetss=[];constructor(t,l,o,n,r){this.reportSchedulerService=t,this.usersRolesService=l,this.utilsService=o,this.messageService=n,this.settingsService=r}ngOnInit(){this.getSchedulers(),this.getFleets(),this.timezones=h.$F}get f(){return this.schedulerForm.controls}getSchedulers(){this.showSpinner=!0;const t=this.settingsService.getOrgSettings();(0,J.D)([this.reportSchedulerService.getWidgets(),this.usersRolesService.getUsers(),this.reportSchedulerService.getReportSchedulers(),this.reportSchedulerService.getScheduledHistory(),t]).subscribe(([l,o,n,r,p])=>{this.widgets=l,this.users=o,this.schedulesForTable=[...n],this.schedules=[...n],this.scheduledHistory=r,this.processScheduledHistory(),this.showSpinner=!1,this.orgSettings=p})}processScheduledHistory(){this.scheduledHistory=this.scheduledHistory.map(t=>{const l=this.schedules.filter(o=>o.id_===t.report_scheduler_id)[0];return t.scheduler=l,t})}createNewScheduler(){this.isEdit=!1,this.initSchedulerForm(),this.schedulerForm.reset(),this.submitted=!1,this.schedulerDialog=!0}initSchedulerForm(){this.schedulerForm=new a.cw({name:new a.NI("",[a.kI.required,a.kI.maxLength(100)]),is_enabled:new a.NI(!0,a.kI.required),user_ids:new a.NI("",a.kI.required),report_type:new a.NI("",a.kI.required),mode_of_range:new a.NI("",a.kI.required),sub_resource_ids:new a.NI("",a.kI.required),report_schedule_time:new a.NI("",a.kI.required),timezone:new a.NI("",a.kI.required),start_time:new a.NI(new Date),end_time:new a.NI(new Date),start_day:new a.NI(""),end_day:new a.NI(""),fleet_ids:new a.NI(""),id_:new a.NI("")})}getFilteredNames(t,l){const n=h.k2().filter(r=>l.includes(r.id_)).map(r=>r.name);return{displayedNames:n.slice(0,3).join(", "),tooltipNames:n.length>3?n.join(", "):""}}getFilteredNamesWidgets(t,l){const n=t.filter(r=>l.includes(r.id_)).map(r=>r.name);return{displayedNames:n.slice(0,3).join(", "),tooltipNames:n.length>3?n.join(", "):""}}saveScheduler(){if(this.submitted=!0,this.showSpinner=!1,!this.schedulerForm.invalid){if("daily"===this.schedulerForm.value.mode_of_range)this.schedulerForm.value.data_range={},this.schedulerForm.value.data_range.daily={start_time:this.getFormattedTime(this.schedulerForm.value.start_time),end_time:this.getFormattedTime(this.addHours(this.schedulerForm.value.start_time,24))};else if("weekly"===this.schedulerForm.value.mode_of_range){this.schedulerForm.value.data_range={};const t=this.weekdays.filter(n=>n.value===this.schedulerForm.value.start_day)[0].end_day;let l=this.schedulerForm.value.start_time;l.setMinutes(l.getMinutes()-1);let o=this.getFormattedTime(l);this.schedulerForm.value.data_range.weekly={start_day:this.schedulerForm.value.start_day,end_day:t,start_time:this.getFormattedTime(this.schedulerForm.value.start_time),end_time:o}}this.schedulerForm.value.report_schedule_time={day:"SAME",time:this.getFormattedTime(this.schedulerForm.value.report_schedule_time)},this.schedulerForm.value.fleet_ids=this.selectedFleetss.map(t=>t.id_),this.schedulerForm.value.org_id=JSON.parse(localStorage.getItem("user")||"{}").org_id,delete this.schedulerForm.value.start_time,delete this.schedulerForm.value.end_time,delete this.schedulerForm.value.start_day,delete this.schedulerForm.value.end_day,this.isEdit?this.reportSchedulerService.updateScheduler(this.schedulerForm.value).subscribe(t=>{this.schedulerDialog=!1,this.getSchedulers(),this.schedulerForm.reset(),this.submitted=!1,this.messageService.add({severity:"success",summary:"Successful",detail:"Scheduler updated successfully",life:3e3}),this.showSpinner=!1}):(delete this.schedulerForm.value.id_,this.reportSchedulerService.createScheduler(this.schedulerForm.value).subscribe(t=>{this.schedulerDialog=!1,this.getSchedulers(),this.schedulerForm.reset(),this.submitted=!1,this.messageService.add({severity:"success",summary:"Successful",detail:"Scheduler created successfully",life:3e3}),this.showSpinner=!1}))}}editScheduler(t){this.buttonDisplayName="",this.selectedFleetss=[];const l=this.schedules.filter(p=>p.id_===t)[0];this.initSchedulerForm(),this.isEdit=!0,this.schedulerDialog=!0,this.schedulerForm.patchValue(l);let o=[];if(l.fleet_ids?.forEach(p=>{o.push(this.utilsService.filterFleetRecursively(this.fleets,p))}),this.selectedFleetss=o,this.buttonDisplayName=this.selectedFleetss.length+" selected",this.schedulerForm.controls.sub_resource_ids.setValue(l.sub_resource_ids),"daily"===l.mode_of_range){const p=l.data_range.daily.start_time.split(":"),c=l.data_range.daily.end_time.split(":");this.schedulerForm.controls.start_time.setValue(new Date(2021,1,1,parseInt(p[0]),parseInt(p[1]),0)),this.schedulerForm.controls.end_time.setValue(new Date(2021,1,1,parseInt(c[0]),parseInt(c[1]),0))}else if("weekly"===l.mode_of_range){this.schedulerForm.value.data_range={},this.schedulerForm.value.data_range.weekly={start_day:this.schedulerForm.controls.start_day.setValue(l.data_range.weekly.start_day)};const p=l.data_range.weekly.start_time?.split(":"),c=`${p[0].padStart(2,"0")}:${p[1].padStart(2,"0")}`;this.schedulerForm.controls.start_time.setValue(new Date(`2021-01-01T${c}`))}const n=l.report_schedule_time.time.split(":"),r=`${n[0].padStart(2,"0")}:${n[1].padStart(2,"0")}`;this.schedulerForm.controls.report_schedule_time.setValue(new Date(`2021-01-01T${r}`)),this.schedulerForm.controls.user_ids.setValue(l.user_ids)}deleteScheduler(t){this.schedulerForDelete=this.schedules.filter(l=>l.id_===t)[0],this.deleteSchedulerDialog=!0}confirmDeleteScheduler(){this.reportSchedulerService.deleteScheduler(this.schedulerForDelete.id_).subscribe(t=>{this.deleteSchedulerDialog=!1,this.messageService.add({severity:"success",summary:"Successful",detail:"Scheduler deleted successfully",life:3e3}),this.getSchedulers()})}getFleets(){var t=h.k2();this.fleets=[],this.fleets=this.utilsService.convertFlatFleetsJsonToHierarchical(t);var l=this.fleets.filter(o=>o.name.toLowerCase().includes("default"));l.length>0&&(this.fleets=this.fleets.filter(o=>!o.name.toLowerCase().includes("default")),this.fleets.unshift(l[0]))}getFormattedTime(t){const l=new Date(t);return`${l.getHours()}:${l.getMinutes()}`}formatTimeWithoutDate(t){const[l,o]=t.split(":");return`${l.padStart(2,"0")}:${o.padStart(2,"0")}`}addHours(t,l){const o=new Date(t);return o.setHours(o.getHours()+l),o.toISOString()}historyReports=[];viewHistory(t){let l=t.resource_report_ids;this.showHistoryDialog=!0;let o=Object.values(l).join(",");this.historyReports=[],this.reportSchedulerService.getHistoryReports(o).subscribe(n=>{this.historyReports=n,this.historyReports.forEach(r=>{r.widgetName=this.widgets.filter(p=>p.id_===r.sub_resource_id)[0]?.name,r.fleetName=this.fleets.filter(p=>p.id_===r.fleet_id)[0]?.name})})}downloadReport(t){window.open(t)}preventOverlayCollapse(t){t.stopPropagation()}nodeUnSelect(t){this.selectedFleetss.forEach((l,o)=>{l?.id_===t.node.id_&&this.selectedFleetss.splice(o,1)}),this.setDisplayName()}nodeSelect(t){this.setDisplayName()}setDisplayName(){this.buttonDisplayName=0!=this.selectedFleetss.length?this.selectedFleetss.length+" selected":""}static \u0275fac=function(l){return new(l||i)(e.Y36(u.gc),e.Y36(u.Xb),e.Y36(u.FW),e.Y36(g.ez),e.Y36(u.gb))};static \u0275cmp=e.Xpm({type:i,selectors:[["app-reports"]],features:[e._Bn([g.ez])],decls:39,vars:42,consts:[[4,"ngIf"],[1,"card"],["header","Reports Download History"],[1,"flex","align-items-center","justify-content-between","mb-3","mt-2"],[1,"text-xl","font-bold","letter-spacing-01"],[1,"flex"],["pButton","","pRipple","","label","Download Report",1,"ml-3"],["responsiveLayout","scroll","currentPageReportTemplate","Showing {first} to {last} of {totalRecords} entries","dataKey","id",3,"value","rows","paginator","rowsPerPageOptions","showCurrentPageReport","rowHover"],["dt",""],["pTemplate","header"],["pTemplate","body"],["header","Reports Scheduler"],["pButton","","pRipple","","label","Add Scheduler",1,"ml-3",3,"click"],["responsiveLayout","scroll","currentPageReportTemplate","Showing {first} to {last} of {totalRecords} entries","dataKey","id",3,"value","rows","globalFilterFields","paginator","rowsPerPageOptions","showCurrentPageReport","rowHover"],["header","Scheduler Details",1,"p-fluid",3,"visible","modal","visibleChange"],["pTemplate","content"],["pTemplate","footer"],["header","Confirm",3,"visible","modal","visibleChange"],[1,"flex","align-items-center","justify-content-center"],[1,"pi","pi-exclamation-triangle","mr-3",2,"font-size","2rem"],["header","View history",3,"visible","modal","visibleChange"],["responsiveLayout","scroll","currentPageReportTemplate","Showing {first} to {last} of {totalRecords} entries","dataKey","id_",3,"value","rows","paginator","rowsPerPageOptions","showCurrentPageReport","rowHover"],[1,"text-center"],[2,"width","20%","min-width","7rem"],[1,"p-column-title"],[2,"width","20%","min-width","12rem"],[1,"text-center",2,"width","15%","min-width","12rem"],["icon","pi pi-eye","title","Edit driver details","styleClass","w-2rem h-2rem",3,"click"],[2,"width","14%","min-width","7rem"],[2,"width","5%","min-width","5rem"],[3,"ngModel","disabled"],[4,"ngIf","ngIfElse"],["noResourcesTooltip",""],["noFleetTooltip",""],[2,"width","9%","min-width","5rem"],[1,"capitalize"],[2,"width","8%","min-width","5rem"],[2,"width","10%","min-width","8rem"],[2,"width","5%","min-width","6rem"],["pButton","","pRipple","","type","button","icon","pi pi-pencil",1,"p-button-rounded","p-button-text",3,"click"],["pButton","","pRipple","","type","button","icon","pi pi-trash",1,"p-button-rounded","p-button-text",3,"click"],["tooltipPosition","top",3,"pTooltip"],[3,"formGroup","ngSubmit"],[1,"grid"],[1,"col-12","md:col-6"],[1,"field"],["for","is_enabled"],["id","is_enabled","formControlName","is_enabled"],["for","name"],["type","text","formControlName","name","pInputText","","placeholder","Enter Scheduler Name"],["for","report_type"],["id","report_type","appendTo","body","optionLabel","label","formControlName","report_type","placeholder","Select a Report Type","optionValue","value",3,"options"],["for","Fleet","placeholder","Select Fleet",1,"text-600","block","mb-1"],["icon","pi pi-chevron-down","iconPos","right","pButton","","pRipple","","type","button",1,"p-button-outlined","border-500","p-button-secondary","bg-primary-reverse","w-full","vertical-align-middle","text-left",3,"label","click"],["appendTo","body"],["op",""],["for","widgets"],["styleClass","align-items-center w-full","formControlName","sub_resource_ids","optionLabel","name","placeholder","Select Widget(s)","appendTo","body","optionValue","id_",3,"options","showToggleAll","filter"],["pTemplate","default"],["for","users"],["styleClass","align-items-center w-full","formControlName","user_ids","optionLabel","email","optionValue","id_","placeholder","Select User(s)","appendTo","body",3,"options","showToggleAll","filter"],[1,"col-12","border-top-1","border-300"],["for","mode_of_range"],["id","mode_of_range","appendTo","body","optionLabel","label","formControlName","mode_of_range","placeholder","Select a Frequency","optionValue","value",3,"options"],[1,"col-12"],["for","report_schedule_time"],["formControlName","report_schedule_time","appendTo","body","placeholder","Choose Report Scheduler Time",3,"showTime","hourFormat","readonlyInput","timeOnly"],["for","timezone"],["id","timezone","appendTo","body","optionLabel","label","formControlName","timezone","placeholder","Select a Region","optionValue","value",3,"options","filter"],[1,"ng-dirty","ng-invalid","text-red-700","mt-1"],[3,"click"],["for","childs-switch",1,"ml-3","mx-2"],["id","childs-switch","name","childs-switch",1,"vertical-align-middle",3,"ngModel","ngModelOptions","ngModelChange"],["appendTo","body","ngDefaultControl","","selectionMode","checkbox",3,"value","propagateSelectionUp","propagateSelectionDown","selection","onNodeSelect","onNodeUnselect","selectionChange",4,"ngIf"],["appendTo","body","ngDefaultControl","","selectionMode","checkbox",3,"value","propagateSelectionUp","propagateSelectionDown","selection","onNodeSelect","onNodeUnselect","selectionChange"],["tree",""],[1,"ml-3"],[1,"col-12","md:col-3"],[1,"field","mb-0"],["for","start_time"],["formControlName","start_time","appendTo","body","placeholder","Choose Start Time",3,"showTime","hourFormat","readonlyInput","timeOnly"],["for","start_day"],["id","start_day","appendTo","body","optionLabel","label","formControlName","start_day","placeholder","Select a Day","optionValue","value",3,"options"],["pButton","","pRipple","","label","Cancel",1,"p-button-text",3,"click"],["pButton","","pRipple","","label","Save",3,"disabled","click"],["pButton","","pRipple","","label","No",1,"p-button-text",3,"click"],["pButton","","pRipple","","label","Yes",3,"click"],[2,"width","10%","min-width","6rem"],[1,"text-center",2,"width","10%","min-width","6rem"],["icon","pi pi-download","title","Edit driver details","styleClass","w-2rem h-2rem",3,"click"]],template:function(l,o){1&l&&(e._UZ(0,"p-toast"),e.YNc(1,M,1,0,"p-progressSpinner",0),e.TgZ(2,"div",1)(3,"p-tabView")(4,"p-tabPanel",2)(5,"div",3)(6,"div",4),e._uU(7,"Report Download History"),e.qZA(),e.TgZ(8,"div",5),e._UZ(9,"button",6),e.qZA()(),e._UZ(10,"br"),e.TgZ(11,"p-table",7,8),e.YNc(13,k,9,0,"ng-template",9),e.YNc(14,H,17,3,"ng-template",10),e.qZA()(),e.TgZ(15,"p-tabPanel",11)(16,"div",3)(17,"div",4),e._uU(18,"Report Schedulers"),e.qZA(),e.TgZ(19,"div",5)(20,"button",12),e.NdJ("click",function(){return o.createNewScheduler()}),e.qZA()()(),e._UZ(21,"br"),e.TgZ(22,"p-table",13,8),e.YNc(24,Q,20,0,"ng-template",9),e.YNc(25,W,46,12,"ng-template",10),e.qZA()()()(),e.TgZ(26,"p-dialog",14),e.NdJ("visibleChange",function(r){return o.schedulerDialog=r}),e.YNc(27,_e,68,27,"ng-template",15),e.YNc(28,me,2,1,"ng-template",16),e.qZA(),e.TgZ(29,"p-dialog",17),e.NdJ("visibleChange",function(r){return o.deleteSchedulerDialog=r}),e.TgZ(30,"div",18),e._UZ(31,"i",19),e.TgZ(32,"span"),e._uU(33,"Are you sure you want to delete selected Scheduler?"),e.qZA()(),e.YNc(34,he,2,0,"ng-template",16),e.qZA(),e.TgZ(35,"p-dialog",20),e.NdJ("visibleChange",function(r){return o.showHistoryDialog=r}),e.TgZ(36,"p-table",21),e.YNc(37,ge,9,0,"ng-template",9),e.YNc(38,fe,17,3,"ng-template",10),e.qZA()()),2&l&&(e.xp6(1),e.Q6J("ngIf",o.showSpinner),e.xp6(10),e.Q6J("value",o.scheduledHistory)("rows",10)("rows",10)("paginator",!0)("rowsPerPageOptions",e.DdM(35,f))("showCurrentPageReport",!0)("rowHover",!0),e.xp6(11),e.Q6J("value",o.schedulesForTable)("rows",10)("globalFilterFields",e.DdM(36,ve))("rows",10)("paginator",!0)("rowsPerPageOptions",e.DdM(37,f))("showCurrentPageReport",!0)("rowHover",!0),e.xp6(4),e.Akn(e.DdM(38,Ze)),e.Q6J("visible",o.schedulerDialog)("modal",!0),e.xp6(3),e.Akn(e.DdM(39,Te)),e.Q6J("visible",o.deleteSchedulerDialog)("modal",!0),e.xp6(6),e.Akn(e.DdM(40,ye)),e.Q6J("visible",o.showHistoryDialog)("modal",!0),e.xp6(1),e.Q6J("value",o.historyReports)("rows",10)("rows",10)("paginator",!0)("rowsPerPageOptions",e.DdM(41,f))("showCurrentPageReport",!0)("rowHover",!0))},dependencies:[Z.O5,w.Lt,g.jx,a._Y,a.Fj,a.JJ,a.JL,a.On,N.G,C.FN,y.V,F.iA,a.sg,a.u,_.Hq,_.zx,b.o,T.f,x.NU,A.T,q.mp,S.Ql,m.xf,m.x4,U.u],styles:["[_nghost-%COMP%]  p-progressSpinner{position:absolute;top:40%;left:50%;z-index:10}"]})}return i})(),Se=(()=>{class i{static \u0275fac=function(l){return new(l||i)};static \u0275mod=e.oAB({type:i});static \u0275inj=e.cJS({imports:[R.Bz.forChild([{path:"",component:we,data:{breadcrumb:"Reports",route:"reports"}}]),R.Bz]})}return i})(),be=(()=>{class i{static \u0275fac=function(l){return new(l||i)};static \u0275mod=e.oAB({type:i});static \u0275inj=e.cJS({imports:[Z.ez,Se,I.l,D.U,N.L,C.EV,y.S,w.kW,F.U$,a.u5,a.UX,_.hJ,b.j,T._8,x.q4,A.y,q.xc,S.Iu,m.LU,U.z]})}return i})()}}]);