"use strict";(self.webpackChunkedgetensor=self.webpackChunkedgetensor||[]).push([[725],{3725:(Ga,le,g)=>{g.r(le),g.d(le,{DashboardModule:()=>Ba});var ee={};g.r(ee),g.d(ee,{default:()=>Ft});var v=g(6814),D=g(6223),ce=g(3999),L=g(707),R=g(9146),pe=g(8057),te=g(4237),ie=g(3530),ue=g(2160),de=g(9653),_e=g(5609),Ue=g(3714),B=g(1122),Ie=g(4055),P=g(1712),F=g(7680),q=g(4480),M=g(6128),T=g(9552),ke=g(6263),me=g(315),ne=g(4104),Q=g(3259),Me=g(711),Pe=g(146),Je=g(1967),U=g(3173),m=g(2001),Le=g(8645),Re=g(9773),J=g(9315),qe=g(5934),he=g(5985),I=g(5600),x=g(5219),e=g(5879),h=g(5878);let ge=(()=>{class n{labels=[];values=[];backgroundColor;pieOptions={};height="250px";pieData;ngOnInit(){this.initChart()}initChart(){const t=getComputedStyle(document.documentElement);this.pieOptions=this.pieOptions??{plugins:{legend:{display:!1,labels:{usePointStyle:!0,color:"grey"}}}},this.pieData={labels:this.labels,datasets:[{data:this.values,backgroundColor:this.backgroundColor||[t.getPropertyValue("--chart-color-1"),t.getPropertyValue("--chart-color-2"),t.getPropertyValue("--chart-color-3"),t.getPropertyValue("--chart-color-4"),t.getPropertyValue("--chart-color-5"),t.getPropertyValue("--orange-500"),t.getPropertyValue("--teal-100")]}]}}ngOnChanges(t){t.values&&this.initChart()}static \u0275fac=function(i){return new(i||n)};static \u0275cmp=e.Xpm({type:n,selectors:[["app-doughnut-chart"]],inputs:{labels:"labels",values:"values",backgroundColor:"backgroundColor",pieOptions:"pieOptions",height:"height"},features:[e.TTD],decls:1,vars:3,consts:[["type","doughnut",3,"data","options","height"]],template:function(i,a){1&i&&e._UZ(0,"p-chart",0),2&i&&e.Q6J("data",a.pieData)("options",a.pieOptions)("height",a.height)},dependencies:[R.C]})}return n})();const Qe=function(n){return{"background-color":n}};function He(n,r){if(1&n&&(e.ynx(0),e._UZ(1,"div",7),e.TgZ(2,"div",8),e._uU(3),e.qZA(),e.BQk()),2&n){const t=r.$implicit;e.xp6(1),e.Q6J("ngStyle",e.VKq(2,Qe,t.color)),e.xp6(2),e.Oqu(t.name)}}function Ye(n,r){if(1&n&&(e.TgZ(0,"div",5),e.YNc(1,He,4,4,"ng-container",6),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.legends)}}function Ve(n,r){if(1&n&&(e.TgZ(0,"li")(1,"span",22),e._UZ(2,"img",23),e.TgZ(3,"div",24),e._uU(4),e.qZA(),e.TgZ(5,"div",25),e._uU(6),e.qZA()()()),2&n){const t=r.$implicit,i=e.oxw().$implicit,a=e.oxw();e.xp6(1),e.Q6J("title",a.eventLabelMapping[t[0]]),e.xp6(1),e.Q6J("src","assets/demo/images/events/"+t[0]+"-"+(t[1]/i.total_events_count*100>5?t[1]/i.total_events_count*100<=10?"yellow":"red":"green")+".svg",e.LSH),e.xp6(2),e.hij(" ",a.eventLabelMapping[t[0]]," "),e.xp6(2),e.Oqu(t[1])}}function je(n,r){if(1&n&&(e.TgZ(0,"div",9)(1,"div",10)(2,"div",11),e._uU(3),e.qZA(),e._UZ(4,"br"),e.TgZ(5,"div",12)(6,"div",13),e._UZ(7,"app-doughnut-chart",14),e.TgZ(8,"div",15)(9,"div",16),e._uU(10,"Total"),e.qZA(),e.TgZ(11,"div",17)(12,"b"),e._uU(13),e.qZA()(),e._UZ(14,"br"),e.TgZ(15,"div",18),e._uU(16,"Compound"),e.qZA(),e.TgZ(17,"div",17)(18,"b"),e._uU(19),e.qZA()()()(),e.TgZ(20,"div",19)(21,"ul",20)(22,"li")(23,"span",21),e._uU(24," Top 5 Events:"),e.qZA()(),e._UZ(25,"br"),e.YNc(26,Ve,7,4,"li",6),e.qZA()()()()()),2&n){const t=r.$implicit,i=e.oxw();e.xp6(3),e.Oqu(t.fleet_name),e.xp6(4),e.Q6J("labels",t.labels)("values",t.values)("height","140px")("pieOptions",i.pieOptions),e.xp6(6),e.Oqu(t.total_events_count>0?t.total_events_count:0),e.xp6(6),e.Oqu(t.compound_event_total_count>0?t.compound_event_total_count:0),e.xp6(7),e.Q6J("ngForOf",t.events)}}const Be=function(){return[6,12]};let ve=(()=>{class n{utilsService;driversService;spinnerService;paginatedEventData=[];toolbarComponent;selectedFleetForSearch;compoundEventNames=[];eventLabelMapping;fleets=[];driverCoachingAnalytics=[];dataForCharts=[];sortOrder=0;pieOptions;sortField="";totalRecords=0;page=0;rows=6;legends=[];constructor(t,i,a){this.utilsService=t,this.driversService=i,this.spinnerService=a}ngOnInit(){this.initData()}initData(){this.getData(),this.setLegends()}setLegends(){const t=getComputedStyle(document.documentElement);this.legends=[{name:"Unreviewed Events",color:t.getPropertyValue("--chart-color-1")},{name:"Non Coachable Events",color:t.getPropertyValue("--chart-color-2")},{name:"Coaching Complete",color:t.getPropertyValue("--chart-color-3")},{name:"Coaching Overdue",color:t.getPropertyValue("--chart-color-4")},{name:"Coaching Pending",color:t.getPropertyValue("--chart-color-5")}]}getData(){this.paginatedEventData=[],this.dataForCharts=[],this.buildChart(this.driverCoachingAnalytics),this.paginate(),this.totalRecords=this.driverCoachingAnalytics.length}paginate(){const t=this.page*this.rows;this.paginatedEventData=this.dataForCharts.slice(t,t+this.rows)}onPageChange(t){this.page=t.page,this.rows=t.rows,this.paginate()}buildChart(t){for(let i=0;i<t.length;i++)this.dataForCharts[i]=[],this.dataForCharts[i].labels=[],this.dataForCharts[i].values=[],this.dataForCharts[i].fleet_name=t[i].name,this.dataForCharts[i].events=t[i].total_events,this.dataForCharts[i].compound_event_total_count=t[i].compound_event_total_count,this.dataForCharts[i].total_events_count=t[i].total_events_count,this.addCoachableEvents(i,"unreviewed_events",t),this.addCoachableEvents(i,"non_coachable_events",t),this.addCoachableEvents(i,"coaching_complete",t),this.addCoachableEvents(i,"coaching_overdue",t),this.addCoachableEvents(i,"coaching_pending",t);this.pieOptions={plugins:{legend:{display:!1}}}}addCoachableEvents(t,i,a){this.dataForCharts[t].labels.push(this.utilsService.formatLabelForCharts(i)),this.dataForCharts[t].values.push(a[t][i])}ngOnChanges(t){this.paginatedEventData=[],t.driverCoachingAnalytics&&(this.driverCoachingAnalytics=t.driverCoachingAnalytics.currentValue,this.initData())}static \u0275fac=function(i){return new(i||n)(e.Y36(h.FW),e.Y36(h.$H),e.Y36(h.V))};static \u0275cmp=e.Xpm({type:n,selectors:[["app-driver-coaching-report-charts"]],inputs:{toolbarComponent:"toolbarComponent",selectedFleetForSearch:"selectedFleetForSearch",compoundEventNames:"compoundEventNames",eventLabelMapping:"eventLabelMapping",fleets:"fleets",driverCoachingAnalytics:"driverCoachingAnalytics"},features:[e.TTD],decls:5,vars:6,consts:[["layout","list",3,"value"],["dv",""],["pTemplate","header"],["pTemplate","listItem"],["currentPageReportTemplate","Showing {first} to {last} of {totalRecords} fleets",3,"showCurrentPageReport","rows","rowsPerPageOptions","totalRecords","onPageChange"],[1,"legend-container","text-left","mb-1"],[4,"ngFor","ngForOf"],[1,"legend-box",3,"ngStyle"],[1,"inline-block","legend-title"],[1,"md:col-4","px-3","mb-4","border-none"],[1,"p-3","border-1","border-400"],[1,"text-xl"],[1,"grid","align-items-center"],[1,"col-12","md:col-5","text-center"],[3,"labels","values","height","pieOptions"],[1,"text-center"],[1,"mt-3","inline-block","w-5rem"],[1,"inline-block","w-4rem","text-right"],[1,"mt-1","inline-block","w-5rem"],[1,"col-12","md:col-7"],[1,"list-none","pr-0","events-li"],[1,"font-bold"],[3,"title"],[1,"vertical-align-middle",3,"src"],[1,"text-base","ml-1","w-7rem","inline-block"],[1,"inline-block","text-right","w-3rem","font-bold"]],template:function(i,a){1&i&&(e.TgZ(0,"p-dataView",0,1),e.YNc(2,Ye,2,1,"ng-template",2),e.YNc(3,je,27,8,"ng-template",3),e.qZA(),e.TgZ(4,"p-paginator",4),e.NdJ("onPageChange",function(s){return a.onPageChange(s)}),e.qZA()),2&i&&(e.Q6J("value",a.paginatedEventData),e.xp6(4),e.Q6J("showCurrentPageReport",!0)("rows",a.rows)("rowsPerPageOptions",e.DdM(5,Be))("totalRecords",a.totalRecords))},dependencies:[v.sg,v.PC,x.jx,ge,P.D,te.VO],styles:["img[_ngcontent-%COMP%]{max-width:30px}.legend-box[_ngcontent-%COMP%]{height:12px;width:2rem;border:1px solid #ccc;display:inline-block;margin-right:4px}.legend-title[_ngcontent-%COMP%]{font-size:14px;font-weight:500;margin-right:10px}.events-li[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:hover{background-color:#f0f4f8;box-shadow:0 8px 15px #0000001a}"]})}return n})();function $e(n,r){1&n&&(e.TgZ(0,"tr")(1,"th",7),e._uU(2,"Fleet Name "),e._UZ(3,"p-sortIcon",8),e.qZA(),e.TgZ(4,"th",9),e._uU(5,"Events "),e._UZ(6,"p-sortIcon",10),e.qZA(),e.TgZ(7,"th",11),e._uU(8,"Compound Events "),e._UZ(9,"p-sortIcon",12),e.qZA(),e.TgZ(10,"th",13),e._uU(11,"Top 5 Events "),e.qZA(),e.TgZ(12,"th",14),e._uU(13,"Coachable Events "),e._UZ(14,"p-sortIcon",15),e.qZA(),e.TgZ(15,"th",16),e._uU(16,"Completed "),e._UZ(17,"p-sortIcon",17),e.qZA(),e.TgZ(18,"th",18),e._uU(19,"Pending "),e._UZ(20,"p-sortIcon",19),e.qZA(),e.TgZ(21,"th",20),e._uU(22,"Overdue "),e._UZ(23,"p-sortIcon",21),e.qZA(),e._UZ(24,"th"),e.qZA())}function Ge(n,r){if(1&n&&(e.TgZ(0,"span",28),e._UZ(1,"img",29),e.qZA()),2&n){const t=e.oxw().$implicit,i=e.oxw().$implicit,a=e.oxw();e.Q6J("title",a.eventLabelMapping[t[0]]+" : "+t[1]),e.xp6(1),e.Q6J("src",a.getItemIcon(t,i),e.LSH)}}function We(n,r){if(1&n&&(e.ynx(0),e.YNc(1,Ge,2,2,"span",27),e.BQk()),2&n){const t=r.$implicit;e.xp6(1),e.Q6J("ngIf",t[1]&&t[1]>0)}}const ze=function(n){return{"surface-50":n}};function Ke(n,r){if(1&n&&(e.TgZ(0,"tr",22)(1,"td",23),e._uU(2),e.qZA(),e.TgZ(3,"td",24),e._uU(4),e.qZA(),e.TgZ(5,"td",24),e._uU(6),e.qZA(),e.TgZ(7,"td",25),e.YNc(8,We,2,1,"ng-container",26),e.qZA(),e.TgZ(9,"td",24),e._uU(10),e.qZA(),e.TgZ(11,"td",24),e._uU(12),e.qZA(),e.TgZ(13,"td",24),e._uU(14),e.qZA(),e.TgZ(15,"td",24),e._uU(16),e.qZA()()),2&n){const t=r.$implicit;e.Q6J("ngClass",e.VKq(9,ze,r.rowIndex%2==0)),e.xp6(2),e.hij(" ",t.name," "),e.xp6(2),e.hij(" ",t.total_events_count," "),e.xp6(2),e.hij(" ",t.compound_event_total_count," "),e.xp6(2),e.Q6J("ngForOf",t.total_events),e.xp6(2),e.hij(" ",t.coachable_events," "),e.xp6(2),e.hij(" ",t.coaching_complete," "),e.xp6(2),e.hij(" ",t.coaching_pending," "),e.xp6(2),e.hij(" ",t.coaching_overdue," ")}}const Xe=function(){return[5,10,20]};let fe=(()=>{class n{driversService;spinnerService;utilsService;toolbarComponent;selectedFleetForSearch;compoundEventNames=[];eventLabelMapping;fleets=[];driverCoachingAnalytics=[];eventData=[];rowsPerPageOptions=[5,10,20];fleetsWithEventsData=[];showTable=!1;totalRecords=0;page=0;rows=10;paginationObj;compoundEventIcons={};exportableData=[];constructor(t,i,a){this.driversService=t,this.spinnerService=i,this.utilsService=a}ngOnInit(){this.toolbarComponent.allEvents.compound_events.forEach(t=>{null!=t.event_configuration&&(this.compoundEventIcons[t.name]=t.event_configuration.display_icon)}),this.initData()}initData(){this.eventData=this.driverCoachingAnalytics,this.totalRecords=this.driverCoachingAnalytics.length,this.paginate(),this.setExportableData(),this.spinnerService.hideSpinner()}onGlobalFilter(t,i){t.filterGlobal(i.target.value,"contains")}setPagination(){this.paginationObj={sort_order:"asc",items_per_page:this.rows,page_number:this.page+1,sort_field:"reviewed_events"}}paginatedEventData=[];paginate(){const t=this.page*this.rows;this.paginatedEventData=this.eventData.slice(t,t+this.rows)}onPageChange(t){this.page=t.page,this.rows=t.rows,this.paginate()}getCompoundEventCount(t){let i=0;return Object.keys(t).forEach(a=>{this.compoundEventNames.includes(a)&&a in m.uZ&&(i+=t[a][0])}),i}ngOnChanges(t){this.paginatedEventData=[],t.driverCoachingAnalytics&&(this.driverCoachingAnalytics=t.driverCoachingAnalytics.currentValue,this.initData())}getItemIcon(t,i){let a=t[0],o="assets/demo/images/events/"+t[0]+"-"+(t[1]/i.total_events_count*100>5?t[1]/i.total_events_count*100<=10?"yellow":"red":"green")+".svg";return null!=this.compoundEventIcons[a]&&(o=this.compoundEventIcons[a]),o}getFleetName(t){var i=sessionStorage.getItem("totalFleetData");return i=JSON.parse(i),i.filter(a=>a.id_===t)[0]?.name}setExportableData(){this.exportableData=[],this.eventData.forEach(t=>{const i=t.total_events.filter(a=>a[1]>0).sort((a,o)=>o[1]-a[1]).slice(0,5).map(a=>`${this.eventLabelMapping[a[0]]}: ${a[1]}`);this.exportableData.push({"Fleet Name":this.getFleetName(t.fleet_id),"Total Events":t.total_events_count,"Top 5 Events":i.join(", "),"Compound Events":t.compound_event_total_count,"Coaching Complete":t.coaching_complete,"Coaching Overdue":t.coaching_overdue,"Coaching Pending":t.coaching_pending,"Coachable Events":t.coachable_events})})}static \u0275fac=function(i){return new(i||n)(e.Y36(h.$H),e.Y36(h.V),e.Y36(h.FW))};static \u0275cmp=e.Xpm({type:n,selectors:[["app-driver-coaching-report-table"]],inputs:{toolbarComponent:"toolbarComponent",selectedFleetForSearch:"selectedFleetForSearch",compoundEventNames:"compoundEventNames",eventLabelMapping:"eventLabelMapping",fleets:"fleets",driverCoachingAnalytics:"driverCoachingAnalytics"},features:[e._Bn([x.ez,x.YP]),e.TTD],decls:8,vars:9,consts:[[1,"grid"],[1,"col-12"],["responsiveLayout","scroll","scrollHeight","500px","dataKey","id",3,"value","autoLayout","scrollable","rowHover"],["dt",""],["pTemplate","header"],["pTemplate","body"],["currentPageReportTemplate","Showing {first} to {last} of {totalRecords} fleets",3,"showCurrentPageReport","rows","rowsPerPageOptions","totalRecords","onPageChange"],["pSortableColumn","fleet_name",1,"text-left"],["field","fleet_name"],["pSortableColumn","total_events_count",1,"text-center"],["field","total_events_count"],["pSortableColumn","compound_event_total_count",1,"text-center"],["field","compound_event_total_count"],["pSortableColumn","all_events",1,"text-center"],["pSortableColumn","coachable_events",1,"text-center"],["field","coachable_events"],["pSortableColumn","coaching_complete",1,"text-center"],["field","coaching_complete"],["pSortableColumn","coaching_pending",1,"text-center"],["field","coaching_pending"],["pSortableColumn","coaching_overdue",1,"text-center"],["field","coaching_overdue"],[3,"ngClass"],[2,"width","20%","min-width","10rem"],[1,"text-center"],[1,"text-center",2,"width","20%","min-width","10rem"],[4,"ngFor","ngForOf"],[3,"title",4,"ngIf"],[3,"title"],["onerror","this.src='assets/demo/images/other/default.png'",1,"mx-2",2,"width","30px",3,"src"]],template:function(i,a){1&i&&(e.TgZ(0,"div",0)(1,"div",1),e._UZ(2,"p-toast"),e.TgZ(3,"p-table",2,3),e.YNc(5,$e,25,0,"ng-template",4),e.YNc(6,Ke,17,11,"ng-template",5),e.qZA(),e.TgZ(7,"p-paginator",6),e.NdJ("onPageChange",function(s){return a.onPageChange(s)}),e.qZA()()()),2&i&&(e.xp6(3),e.Q6J("value",a.paginatedEventData)("autoLayout",!0)("scrollable",!0)("rowHover",!0),e.xp6(4),e.Q6J("showCurrentPageReport",!0)("rows",a.rows)("rowsPerPageOptions",e.DdM(8,Xe))("totalRecords",a.totalRecords))},dependencies:[v.mk,v.sg,v.O5,x.jx,T.iA,T.lQ,T.fz,ne.FN,P.D],styles:["img[_ngcontent-%COMP%]{max-width:30px}"]})}return n})();function et(n,r){1&n&&e._UZ(0,"p-progressSpinner")}const tt=function(){return{width:"250px"}};function it(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div",10)(1,"p-dropdown",11),e.NdJ("onChange",function(a){e.CHM(t);const o=e.oxw();return e.KtG(o.searchFleet(a))}),e.qZA()()}if(2&n){const t=e.oxw();e.xp6(1),e.Akn(e.DdM(7,tt)),e.Q6J("options",t.fleets)("showClear",!0)("filter",!0)("filterBy","name")("filterMatchMode","contains")}}function nt(n,r){1&n&&e._UZ(0,"i"),2&n&&e.Tol(r.$implicit.icon)}function at(n,r){if(1&n){const t=e.EpF();e.ynx(0),e._UZ(1,"p-menu",12,13),e.TgZ(3,"button",14),e.NdJ("click",function(a){e.CHM(t);const o=e.MAs(2);return e.KtG(o.toggle(a))}),e.qZA(),e.BQk()}if(2&n){const t=e.oxw();e.xp6(1),e.Q6J("popup",!0)("model",t.items)}}function ot(n,r){if(1&n&&e._UZ(0,"app-driver-coaching-report-table",18),2&n){const t=e.oxw(2);e.Q6J("compoundEventNames",t.compoundEventNames)("fleets",t.fleets)("toolbarComponent",t.toolbarComponent)("eventLabelMapping",t.eventLabelMapping)("driverCoachingAnalytics",t.fleetsWithEventsData)}}function rt(n,r){if(1&n&&e._UZ(0,"app-driver-coaching-report-charts",19),2&n){const t=e.oxw(2);e.Q6J("driverCoachingAnalytics",t.fleetsWithEventsData)("compoundEventNames",t.compoundEventNames)("fleets",t.fleets)("eventLabelMapping",t.eventLabelMapping)("toolbarComponent",t.toolbarComponent)}}function st(n,r){if(1&n&&(e.TgZ(0,"div",15),e.YNc(1,ot,1,5,"app-driver-coaching-report-table",16),e.YNc(2,rt,1,5,"app-driver-coaching-report-charts",17),e.qZA()),2&n){const t=e.oxw();e.Q6J("ngSwitch",t.showTable),e.xp6(1),e.Q6J("ngSwitchCase",!0),e.xp6(1),e.Q6J("ngSwitchCase",!1)}}const lt=function(){return{minHeight:"650px"}};let be=(()=>{class n{excelExportService;cdref;driversService;utilsService;tableComponent;chartsComponent;toolbarComponent;compoundEventNames=[];eventLabelMapping;showTable=!1;showSpinner=!0;fleets=[];searchFleetInput="";filteredFleets=[];filteredFleetsForTable=[];selectedFleetForSearch="";defaultView="chart";viewOptions=[{icon:"pi pi-chart-pie",justify:"Center",value:"chart"},{icon:"pi pi-table",justify:"Center",value:"table"}];items;fleetsWithEventsDataActual=[];constructor(t,i,a,o){this.excelExportService=t,this.cdref=i,this.driversService=a,this.utilsService=o,this.items=[{label:"Export to Excel",icon:"pi pi-file-excel",command:()=>{this.exportData("excel")}},{label:"Export to CSV",icon:"pi pi-file-excel",command:()=>{this.exportData("csv")}}]}allFleetsData=[];selectedFleets=[];ngAfterViewInit(){this.selectedFleets=m.dc(),this.selectedFleets&&(this.allFleetsData=sessionStorage.getItem("totalFleetData"),this.allFleetsData=JSON.parse(this.allFleetsData),this.allFleetsData&&(this.fleets=this.allFleetsData.filter(t=>this.selectedFleets.includes(t.id_)),this.filteredFleets=this.fleets,this.filteredFleetsForTable=this.fleets)),this.getDriverCoachingAnalytics(this.selectedFleets)}getDriverCoachingAnalytics(t){const i=m.k2().map(a=>a.id_);this.driversService.getDriverCoachingAnalytics(this.toolbarComponent.fromDateUTC,this.toolbarComponent.toDateUTC,i,{items_per_page:1e5,page_number:1}).subscribe(a=>{this.getProcessedFleetsData(a.data),this.showSpinner=!1})}fleetsWithEventsData=[];eventData=[];getProcessedFleetsData(t){this.eventData=t;let i=[];for(let l=0;l<this.eventData.length;l++){i.push({events:this.utilsService.getCountOfEvents(this.eventData[l].total_events),compound_event_total_count:this.getCompoundEventCount(this.eventData[l].total_events),fleet_id:this.eventData[l].fleet_id,total_events_count:this.eventData[l].total_count[0]-(this.getCompoundEventCount(this.eventData[l].total_events)+this.getAccidenceAvoidance(this.eventData[l].total_events)),unreviewed_events:this.eventData[l].total_count[0]-(this.getCompoundEventCount(this.eventData[l].total_events)+this.getAccidenceAvoidance(this.eventData[l].total_events))-this.utilsService.getCountOfEvents(this.eventData[l].reviewed_events),non_coachable_events:this.utilsService.getCountOfEvents(this.eventData[l].reviewed_events)-this.utilsService.getCountOfEvents(this.eventData[l].coachable_events),coachable_events:this.utilsService.getCountOfEvents(this.eventData[l].coachable_events)-(this.getCompoundEventCount(this.eventData[l].coachable_events)+this.getAccidenceAvoidance(this.eventData[l].coachable_events)),coaching_complete:this.utilsService.getCountOfEvents(this.eventData[l].coaching_complete)-(this.getCompoundEventCount(this.eventData[l].coaching_complete)+this.getAccidenceAvoidance(this.eventData[l].coaching_complete)),coaching_overdue:this.utilsService.getCountOfEvents(this.eventData[l].coaching_overdue)-(this.getCompoundEventCount(this.eventData[l].coaching_overdue)+this.getAccidenceAvoidance(this.eventData[l].coaching_overdue)),coaching_pending:this.utilsService.getCountOfEvents(this.eventData[l].coaching_pending)-(this.getCompoundEventCount(this.eventData[l].coaching_pending)+this.getAccidenceAvoidance(this.eventData[l].coaching_pending)),total_events:this.eventData[l].total_events});for(let c in this.eventData[l].total_events)this.compoundEventNames.includes(c)&&(this.eventData[l].total_count[0]-=this.eventData[l].total_events[c][0],delete this.eventData[l].total_events[c])}let a=this.allFleetsData.map(l=>{const c=i.find(d=>d.fleet_id===l.id_);return{...l,...c}});a=this.utilsService.convertFlatFleetsJsonToHierarchical(a);const o=l=>{const c={total_events_count:l.total_events_count||0,coaching_complete:l.coaching_complete||0,coaching_overdue:l.coaching_overdue||0,coaching_pending:l.coaching_pending||0,coachable_events:l.coachable_events||0,compound_event_total_count:l.compound_event_total_count||0,unreviewed_events:l.unreviewed_events||0,total_events:JSON.parse(JSON.stringify(l.total_events||{}))};return c.total_events||(c.total_events={}),Object.keys(c.total_events).forEach(d=>{c.total_events[d]||(c.total_events[d]=[0,0,0,0,0])}),l.children&&l.children.length>0&&l.children.forEach(d=>{const p=o(d);c.total_events_count+=p.total_events_count,c.coaching_complete+=p.coaching_complete,c.coaching_overdue+=p.coaching_overdue,c.coaching_pending+=p.coaching_pending,c.coachable_events+=p.coachable_events,c.unreviewed_events+=p.unreviewed_events,c.compound_event_total_count+=p.compound_event_total_count,Object.keys(p.total_events).forEach(u=>{c.total_events[u]||(c.total_events[u]=[0,0,0,0,0]);for(let _=0;_<c.total_events[u].length;_++)c.total_events[u][_]+=p.total_events[u][_]})}),l.total_events_count=c.total_events_count,l.coaching_complete=c.coaching_complete,l.coaching_overdue=c.coaching_overdue,l.coaching_pending=c.coaching_pending,l.coachable_events=c.coachable_events,l.unreviewed_events=c.unreviewed_events,l.compound_event_total_count=c.compound_event_total_count,l.total_events=c.total_events,c};a.forEach(l=>{o(l)});let s=this.utilsService.flattenFleetData(a);this.fleetsWithEventsData=s.sort((l,c)=>c.total_events_count-l.total_events_count),this.fleetsWithEventsData=this.fleetsWithEventsData.filter(l=>this.selectedFleets.includes(l.fleet_id));for(let l=0;l<this.fleetsWithEventsData.length;l++){const c=this.utilsService.getCountsOfIndividualEvents(this.fleetsWithEventsData[l].total_events),d=Object.entries(c).sort((p,u)=>u[1]-p[1]);this.fleetsWithEventsData[l].total_events=d.slice(0,5)}this.fleetsWithEventsDataActual=this.fleetsWithEventsData}refreshData(){this.tableComponent?.ngOnInit(),this.chartsComponent?.ngOnInit()}filterFleetData(t){this.filteredFleets=this.fleets,this.filteredFleetsForTable=this.fleets;const a=t.target.value.toLowerCase();this.filteredFleets=this.fleets.filter(o=>o.fleet_name.toLowerCase().includes(a)),this.filteredFleetsForTable=this.fleets.filter(o=>o.fleet_name.toLowerCase().includes(a))}getCompoundEventCount(t){let i=0;return Object.keys(t).forEach(a=>{this.compoundEventNames.includes(a)&&a in m.uZ&&(i+=t[a][0])}),i}getAccidenceAvoidance(t){let i=0;return Object.keys(t).forEach(a=>{a in m.TU&&(i+=t[a][0])}),i}getFleetName(t){var i=sessionStorage.getItem("totalFleetData");return(i=JSON.parse(i)).filter(a=>a.id_===t)[0].name}searchFleet(t){if(t.value){let i=this.fleetsWithEventsDataActual.filter(a=>a.fleet_id===t.value?.id_);this.fleetsWithEventsData=i,this.cdref.detectChanges()}else this.selectedFleetForSearch=void 0,this.fleetsWithEventsData=[...this.fleetsWithEventsDataActual]}exportData(t){const i="Driver Coaching Report - "+(new Date).toLocaleDateString();this.excelExportService.exportData(this.tableComponent.exportableData,i,t)}static \u0275fac=function(i){return new(i||n)(e.Y36(m.U0),e.Y36(e.sBO),e.Y36(h.$H),e.Y36(h.FW))};static \u0275cmp=e.Xpm({type:n,selectors:[["app-driver-coaching-report"]],viewQuery:function(i,a){if(1&i&&(e.Gf(fe,5),e.Gf(ve,5)),2&i){let o;e.iGM(o=e.CRH())&&(a.tableComponent=o.first),e.iGM(o=e.CRH())&&(a.chartsComponent=o.first)}},inputs:{toolbarComponent:"toolbarComponent",compoundEventNames:"compoundEventNames",eventLabelMapping:"eventLabelMapping"},features:[e._Bn([x.ez,x.YP])],decls:12,vars:8,consts:[[4,"ngIf"],[1,"card",3,"ngStyle"],[1,"flex","align-items-center","justify-content-between","mb-2"],[1,"text-900","text-lg","font-semibold"],[1,"flex"],["class","inline-block",4,"ngIf"],[1,"inline-block","ml-4","vertical-align-middle"],["optionLabel","icon","optionValue","value",3,"options","ngModel","onChange","ngModelChange"],["pTemplate",""],[3,"ngSwitch",4,"ngIf"],[1,"inline-block"],["id","fleets","placeholder","Select a fleet","optionLabel","name",1,"ml-2",3,"options","showClear","filter","filterBy","filterMatchMode","onChange"],[3,"popup","model"],["menu",""],["pButton","","pRipple","","type","button","icon","pi pi-ellipsis-v",1,"p-button-rounded","p-button-text","p-button-secondary","p-trigger",3,"click"],[3,"ngSwitch"],[3,"compoundEventNames","fleets","toolbarComponent","eventLabelMapping","driverCoachingAnalytics",4,"ngSwitchCase"],[3,"driverCoachingAnalytics","compoundEventNames","fleets","eventLabelMapping","toolbarComponent",4,"ngSwitchCase"],[3,"compoundEventNames","fleets","toolbarComponent","eventLabelMapping","driverCoachingAnalytics"],[3,"driverCoachingAnalytics","compoundEventNames","fleets","eventLabelMapping","toolbarComponent"]],template:function(i,a){1&i&&(e.YNc(0,et,1,0,"p-progressSpinner",0),e.TgZ(1,"div",1)(2,"div",2)(3,"div",3),e._uU(4,"Driver Coaching"),e.qZA(),e.TgZ(5,"div",4),e.YNc(6,it,2,8,"div",5),e.TgZ(7,"div",6)(8,"p-selectButton",7),e.NdJ("onChange",function(){return a.showTable=!a.showTable})("ngModelChange",function(s){return a.defaultView=s}),e.YNc(9,nt,1,2,"ng-template",8),e.qZA()(),e.YNc(10,at,4,2,"ng-container",0),e.qZA()(),e.YNc(11,st,3,3,"div",9),e.qZA()),2&i&&(e.Q6J("ngIf",a.showSpinner),e.xp6(1),e.Q6J("ngStyle",e.DdM(7,lt)),e.xp6(5),e.Q6J("ngIf",a.fleets.length>0),e.xp6(2),e.Q6J("options",a.viewOptions)("ngModel",a.defaultView),e.xp6(2),e.Q6J("ngIf",a.showTable),e.xp6(1),e.Q6J("ngIf",a.toolbarComponent&&a.eventLabelMapping&&a.fleetsWithEventsData.length>0&&a.compoundEventNames.length>0))},dependencies:[v.O5,v.PC,v.RF,v.n9,L.Hq,x.jx,q.H,D.JJ,D.On,ue.Lt,M.UN,B.v2,F.G,ve,fe],styles:["[_nghost-%COMP%]  p-progressSpinner{position:absolute;top:50%;left:50%;z-index:10}"]})}return n})();var f=g(8137),ae=g(7816),Ce=function(){if(typeof window<"u"){if(window.devicePixelRatio)return window.devicePixelRatio;var n=window.screen;if(n)return(n.deviceXDPI||1)/(n.logicalXDPI||1)}return 1}(),H_textSize=function(n,r,t){var l,i=[].concat(r),a=i.length,o=n.font,s=0;for(n.font=t.string,l=0;l<a;++l)s=Math.max(n.measureText(i[l]).width,s);return n.font=o,{height:a*t.lineHeight,width:s}};function oe(n,r){var t=r.x,i=r.y;if(null===t)return{x:0,y:-1};if(null===i)return{x:1,y:0};var a=n.x-t,o=n.y-i,s=Math.sqrt(a*a+o*o);return{x:s?a/s:0,y:s?o/s:-1}}var pt=0,De=1,xe=2,Te=4,ye=8;function $(n,r,t){var i=pt;return n<t.left?i|=De:n>t.right&&(i|=xe),r<t.top?i|=ye:r>t.bottom&&(i|=Te),i}function G(n,r){var a,o,t=r.anchor,i=n;return r.clamp&&(i=function ut(n,r){for(var c,d,p,t=n.x0,i=n.y0,a=n.x1,o=n.y1,s=$(t,i,r),l=$(a,o,r);s|l&&!(s&l);)(c=s||l)&ye?(d=t+(a-t)*(r.top-i)/(o-i),p=r.top):c&Te?(d=t+(a-t)*(r.bottom-i)/(o-i),p=r.bottom):c&xe?(p=i+(o-i)*(r.right-t)/(a-t),d=r.right):c&De&&(p=i+(o-i)*(r.left-t)/(a-t),d=r.left),c===s?s=$(t=d,i=p,r):l=$(a=d,o=p,r);return{x0:t,x1:a,y0:i,y1:o}}(i,r.area)),"start"===t?(a=i.x0,o=i.y0):"end"===t?(a=i.x1,o=i.y1):(a=(i.x0+i.x1)/2,o=(i.y0+i.y1)/2),function ct(n,r,t,i,a){switch(a){case"center":t=i=0;break;case"bottom":t=0,i=1;break;case"right":t=1,i=0;break;case"left":t=-1,i=0;break;case"top":t=0,i=-1;break;case"start":t=-t,i=-i;break;case"end":break;default:a*=Math.PI/180,t=Math.cos(a),i=Math.sin(a)}return{x:n,y:r,vx:t,vy:i}}(a,o,n.vx,n.vy,r.align)}var W={arc:function(n,r){var t=(n.startAngle+n.endAngle)/2,i=Math.cos(t),a=Math.sin(t),o=n.innerRadius,s=n.outerRadius;return G({x0:n.x+i*o,y0:n.y+a*o,x1:n.x+i*s,y1:n.y+a*s,vx:i,vy:a},r)},point:function(n,r){var t=oe(n,r.origin),i=t.x*n.options.radius,a=t.y*n.options.radius;return G({x0:n.x-i,y0:n.y-a,x1:n.x+i,y1:n.y+a,vx:t.x,vy:t.y},r)},bar:function(n,r){var t=oe(n,r.origin),i=n.x,a=n.y,o=0,s=0;return n.horizontal?(i=Math.min(n.x,n.base),o=Math.abs(n.base-n.x)):(a=Math.min(n.y,n.base),s=Math.abs(n.base-n.y)),G({x0:i,y0:a+s,x1:i+o,y1:a,vx:t.x,vy:t.y},r)},fallback:function(n,r){var t=oe(n,r.origin);return G({x0:n.x,y0:n.y,x1:n.x+(n.width||0),y1:n.y+(n.height||0),vx:t.x,vy:t.y},r)}},O=function(n){return Math.round(n*Ce)/Ce};function _t(n,r){var t=r.chart.getDatasetMeta(r.datasetIndex).vScale;if(!t)return null;if(void 0!==t.xCenter&&void 0!==t.yCenter)return{x:t.xCenter,y:t.yCenter};var i=t.getBasePixel();return n.horizontal?{x:i,y:null}:{x:null,y:i}}function mt(n){return n instanceof ae.qi?W.arc:n instanceof ae.od?W.point:n instanceof ae.ZL?W.bar:W.fallback}function ft(n,r,t){var i=n.shadowBlur,a=t.stroked,o=O(t.x),s=O(t.y),l=O(t.w);a&&n.strokeText(r,o,s,l),t.filled&&(i&&a&&(n.shadowBlur=0),n.fillText(r,o,s,l),i&&a&&(n.shadowBlur=i))}var Se=function(n,r,t,i){var a=this;a._config=n,a._index=i,a._model=null,a._rects=null,a._ctx=r,a._el=t};(0,f.a4)(Se.prototype,{_modelize:function(n,r,t,i){var a=this,o=a._index,s=(0,f.a0)((0,f.a)([t.font,{}],i,o)),l=(0,f.a)([t.color,f.d.color],i,o);return{align:(0,f.a)([t.align,"center"],i,o),anchor:(0,f.a)([t.anchor,"center"],i,o),area:i.chart.chartArea,backgroundColor:(0,f.a)([t.backgroundColor,null],i,o),borderColor:(0,f.a)([t.borderColor,null],i,o),borderRadius:(0,f.a)([t.borderRadius,0],i,o),borderWidth:(0,f.a)([t.borderWidth,0],i,o),clamp:(0,f.a)([t.clamp,!1],i,o),clip:(0,f.a)([t.clip,!1],i,o),color:l,display:n,font:s,lines:r,offset:(0,f.a)([t.offset,4],i,o),opacity:(0,f.a)([t.opacity,1],i,o),origin:_t(a._el,i),padding:(0,f.E)((0,f.a)([t.padding,4],i,o)),positioner:mt(a._el),rotation:(0,f.a)([t.rotation,0],i,o)*(Math.PI/180),size:H_textSize(a._ctx,r,s),textAlign:(0,f.a)([t.textAlign,"start"],i,o),textShadowBlur:(0,f.a)([t.textShadowBlur,0],i,o),textShadowColor:(0,f.a)([t.textShadowColor,l],i,o),textStrokeColor:(0,f.a)([t.textStrokeColor,l],i,o),textStrokeWidth:(0,f.a)([t.textStrokeWidth,0],i,o)}},update:function(n){var s,l,c,r=this,t=null,i=null,a=r._index,o=r._config,d=(0,f.a)([o.display,!0],n,a);d&&(l=(0,f.v)((0,f.Q)(o.formatter,[s=n.dataset.data[a],n]),s),(c=(0,f.k)(l)?[]:function(n){var t,r=[];for(n=[].concat(n);n.length;)"string"==typeof(t=n.pop())?r.unshift.apply(r,t.split("\n")):Array.isArray(t)?n.push.apply(n,t):(0,f.k)(n)||r.unshift(""+t);return r}(l)).length&&(i=function dt(n){var r=n.borderWidth||0,t=n.padding,i=n.size.height,a=n.size.width,o=-a/2,s=-i/2;return{frame:{x:o-t.left-r,y:s-t.top-r,w:a+t.width+2*r,h:i+t.height+2*r},text:{x:o,y:s,w:a,h:i}}}(t=r._modelize(d,c,o,n)))),r._model=t,r._rects=i},geometry:function(){return this._rects?this._rects.frame:{}},rotation:function(){return this._model?this._model.rotation:0},visible:function(){return this._model&&this._model.opacity},model:function(){return this._model},draw:function(n,r){var s,i=n.ctx,a=this._model,o=this._rects;this.visible()&&(i.save(),a.clip&&(s=a.area,i.beginPath(),i.rect(s.left,s.top,s.right-s.left,s.bottom-s.top),i.clip()),i.globalAlpha=function(n,r,t){return Math.max(n,Math.min(r,t))}(0,a.opacity,1),i.translate(O(r.x),O(r.y)),i.rotate(a.rotation),function gt(n,r,t){var i=t.backgroundColor,a=t.borderColor,o=t.borderWidth;!i&&(!a||!o)||(n.beginPath(),function ht(n,r,t,i,a,o){var s=Math.PI/2;if(o){var l=Math.min(o,a/2,i/2),c=r+l,d=t+l,p=r+i-l,u=t+a-l;n.moveTo(r,d),c<p&&d<u?(n.arc(c,d,l,-Math.PI,-s),n.arc(p,d,l,-s,0),n.arc(p,u,l,0,s),n.arc(c,u,l,s,Math.PI)):c<p?(n.moveTo(c,t),n.arc(p,d,l,-s,s),n.arc(c,d,l,s,Math.PI+s)):d<u?(n.arc(c,d,l,-Math.PI,0),n.arc(c,u,l,0,Math.PI)):n.arc(c,d,l,-Math.PI,Math.PI),n.closePath(),n.moveTo(r,t)}else n.rect(r,t,i,a)}(n,O(r.x)+o/2,O(r.y)+o/2,O(r.w)-o,O(r.h)-o,t.borderRadius),n.closePath(),i&&(n.fillStyle=i,n.fill()),a&&o&&(n.strokeStyle=a,n.lineWidth=o,n.lineJoin="miter",n.stroke()))}(i,o.frame,a),function bt(n,r,t,i){var _,a=i.textAlign,o=i.color,s=!!o,l=i.font,c=r.length,d=i.textStrokeColor,p=i.textStrokeWidth,u=d&&p;if(c&&(s||u))for(t=function vt(n,r,t){var i=t.lineHeight,a=n.w,o=n.x;return"center"===r?o+=a/2:("end"===r||"right"===r)&&(o+=a),{h:i,w:a,x:o,y:n.y+i/2}}(t,a,l),n.font=l.string,n.textAlign=a,n.textBaseline="middle",n.shadowBlur=i.textShadowBlur,n.shadowColor=i.textShadowColor,s&&(n.fillStyle=o),u&&(n.lineJoin="round",n.lineWidth=p,n.strokeStyle=d),_=0,c=r.length;_<c;++_)ft(n,r[_],{stroked:u,filled:s,w:t.w,x:t.x,y:t.y+t.h*_})}(i,a.lines,o.text,a),i.restore())}});var Ct=Number.MIN_SAFE_INTEGER||-9007199254740991,Dt=Number.MAX_SAFE_INTEGER||9007199254740991;function Y(n,r,t){var i=Math.cos(t),a=Math.sin(t),o=r.x,s=r.y;return{x:o+i*(n.x-o)-a*(n.y-s),y:s+a*(n.x-o)+i*(n.y-s)}}function we(n,r){var o,s,d,t=Dt,i=Ct,a=r.origin;for(o=0;o<n.length;++o)d=r.vx*((s=n[o]).x-a.x)+r.vy*(s.y-a.y),t=Math.min(t,d),i=Math.max(i,d);return{min:t,max:i}}function z(n,r){var t=r.x-n.x,i=r.y-n.y,a=Math.sqrt(t*t+i*i);return{vx:(r.x-n.x)/a,vy:(r.y-n.y)/a,origin:n,ln:a}}var Ze=function(){this._rotation=0,this._rect={x:0,y:0,w:0,h:0}};function Ae(n,r,t){var i=r.positioner(n,r),a=i.vx,o=i.vy;if(!a&&!o)return{x:i.x,y:i.y};var s=t.w,l=t.h,c=r.rotation,d=Math.abs(s/2*Math.cos(c))+Math.abs(l/2*Math.sin(c)),p=Math.abs(s/2*Math.sin(c))+Math.abs(l/2*Math.cos(c)),u=1/Math.max(Math.abs(a),Math.abs(o));return d*=a*u,p*=o*u,{x:i.x+(d+=r.offset*a),y:i.y+(p+=r.offset*o)}}(0,f.a4)(Ze.prototype,{center:function(){var n=this._rect;return{x:n.x+n.w/2,y:n.y+n.h/2}},update:function(n,r,t){this._rotation=t,this._rect={x:r.x+n.x,y:r.y+n.y,w:r.w,h:r.h}},contains:function(n){var r=this,i=r._rect;return!((n=Y(n,r.center(),-r._rotation)).x<i.x-1||n.y<i.y-1||n.x>i.x+i.w+2||n.y>i.y+i.h+2)},intersects:function(n){var a,o,s,r=this._points(),t=n._points(),i=[z(r[0],r[1]),z(r[0],r[3])];for(this._rotation!==n._rotation&&i.push(z(t[0],t[1]),z(t[0],t[3])),a=0;a<i.length;++a)if(o=we(r,i[a]),s=we(t,i[a]),o.max<s.min||s.max<o.min)return!1;return!0},_points:function(){var n=this,r=n._rect,t=n._rotation,i=n.center();return[Y({x:r.x,y:r.y},i,t),Y({x:r.x+r.w,y:r.y},i,t),Y({x:r.x+r.w,y:r.y+r.h},i,t),Y({x:r.x,y:r.y+r.h},i,t)]}});var V={prepare:function(n){var t,i,a,o,s,r=[];for(t=0,a=n.length;t<a;++t)for(i=0,o=n[t].length;i<o;++i)r.push(s=n[t][i]),s.$layout={_box:new Ze,_hidable:!1,_visible:!0,_set:t,_idx:s._index};return r.sort(function(l,c){var d=l.$layout,p=c.$layout;return d._idx===p._idx?p._set-d._set:p._idx-d._idx}),this.update(r),r},update:function(n){var t,i,a,o,s,r=!1;for(t=0,i=n.length;t<i;++t)o=(a=n[t]).model(),(s=a.$layout)._hidable=o&&"auto"===o.display,s._visible=a.visible(),r|=s._hidable;r&&function Tt(n){var r,t,i,a,o,s,l;for(r=0,t=n.length;r<t;++r)(a=(i=n[r]).$layout)._visible&&(l=new Proxy(i._el,{get:(c,d)=>c.getProps([d],!0)[d]}),o=i.geometry(),s=Ae(l,i.model(),o),a._box.update(s,o,i.rotation()));(function xt(n,r){var t,i,a,o;for(t=n.length-1;t>=0;--t)for(a=n[t].$layout,i=t-1;i>=0&&a._visible;--i)(o=n[i].$layout)._visible&&a._box.intersects(o._box)&&r(a,o)})(n,function(c,d){var p=c._hidable,u=d._hidable;p&&u||u?d._visible=!1:p&&(c._visible=!1)})}(n)},lookup:function(n,r){var t,i;for(t=n.length-1;t>=0;--t)if((i=n[t].$layout)&&i._visible&&i._box.contains(r))return n[t];return null},draw:function(n,r){var t,i,a,o,s,l;for(t=0,i=r.length;t<i;++t)(o=(a=r[t]).$layout)._visible&&(s=a.geometry(),l=Ae(a._el,a.model(),s),o._box.update(l,s,a.rotation()),a.draw(n,l))}},S="$datalabels",Ee="$default";function re(n,r,t,i){if(r){var s,a=t.$context,o=t.$groups;r[o._set]&&(s=r[o._set][o._key])&&!0===(0,f.Q)(s,[a,i])&&(n[S]._dirty=!0,t.update(a))}}var Ft={id:"datalabels",defaults:{align:"center",anchor:"center",backgroundColor:null,borderColor:null,borderRadius:0,borderWidth:0,clamp:!1,clip:!1,color:void 0,display:!0,font:{family:void 0,lineHeight:1.2,size:void 0,style:void 0,weight:null},formatter:function(n){if((0,f.k)(n))return null;var t,i,a,r=n;if((0,f.i)(n))if((0,f.k)(n.label))if((0,f.k)(n.r))for(r="",a=0,i=(t=Object.keys(n)).length;a<i;++a)r+=(0!==a?", ":"")+t[a]+": "+n[t[a]];else r=n.r;else r=n.label;return""+r},labels:void 0,listeners:{},offset:4,opacity:1,padding:{top:4,right:4,bottom:4,left:4},rotation:0,textAlign:"start",textStrokeColor:void 0,textStrokeWidth:0,textShadowBlur:0,textShadowColor:void 0},beforeInit:function(n){n[S]={_actives:[]}},beforeUpdate:function(n){var r=n[S];r._listened=!1,r._listeners={},r._datasets=[],r._labels=[]},afterDatasetUpdate:function(n,r,t){var u,_,b,y,E,k,Z,A,i=r.index,a=n[S],o=a._datasets[i]=[],s=n.isDatasetVisible(i),l=n.data.datasets[i],c=function wt(n,r){var o,s,t=n.datalabels,i={},a=[];return!1===t?null:(!0===t&&(t={}),r=(0,f.a4)({},[r,t]),o=r.labels||{},s=Object.keys(o),delete r.labels,s.length?s.forEach(function(l){o[l]&&a.push((0,f.a4)({},[r,o[l],{_key:l}]))}):a.push(r),i=a.reduce(function(l,c){return(0,f.F)(c.listeners||{},function(d,p){l[p]=l[p]||{},l[p][c._key||Ee]=d}),delete c.listeners,l},{}),{labels:a,listeners:i})}(l,t),d=r.meta.data||[],p=n.ctx;for(p.save(),u=0,b=d.length;u<b;++u)if((Z=d[u])[S]=[],s&&Z&&n.getDataVisibility(u)&&!Z.skip)for(_=0,y=c.labels.length;_<y;++_)k=(E=c.labels[_])._key,(A=new Se(E,p,Z,u)).$groups={_set:i,_key:k||Ee},A.$context={active:!1,chart:n,dataIndex:u,dataset:l,datasetIndex:i},A.update(A.$context),Z[S].push(A),o.push(A);p.restore(),(0,f.a4)(a._listeners,c.listeners,{merger:function(C,w,$a){w[C]=w[C]||{},w[C][r.index]=$a[C],a._listened=!0}})},afterUpdate:function(n){n[S]._labels=V.prepare(n[S]._datasets)},afterDatasetsDraw:function(n){V.draw(n,n[S]._labels)},beforeEvent:function(n,r){if(n[S]._listened){var t=r.event;switch(t.type){case"mousemove":case"mouseout":!function At(n,r){var a,o,t=n[S],i=t._listeners;if(i.enter||i.leave){if("mousemove"===r.type)o=V.lookup(t._labels,r);else if("mouseout"!==r.type)return;a=t._hovered,t._hovered=o,function Zt(n,r,t,i,a){var o,s;!t&&!i||(t?i?t!==i&&(s=o=!0):s=!0:o=!0,s&&re(n,r.leave,t,a),o&&re(n,r.enter,i,a))}(n,i,a,o,r)}}(n,t);break;case"click":!function Et(n,r){var t=n[S],i=t._listeners.click,a=i&&V.lookup(t._labels,r);a&&re(n,i,a,r)}(n,t)}}},afterEvent:function(n){var o,s,l,c,d,p,u,r=n[S],a=function(n,r){var a,o,s,l,t=n.slice(),i=[];for(a=0,s=r.length;a<s;++a)-1===(o=t.indexOf(l=r[a]))?i.push([l,1]):t.splice(o,1);for(a=0,s=t.length;a<s;++a)i.push([t[a],-1]);return i}(r._actives,r._actives=n.getActiveElements());for(o=0,s=a.length;o<s;++o)if((d=a[o])[1])for(l=0,c=(u=d[0].element[S]||[]).length;l<c;++l)(p=u[l]).$context.active=1===d[1],p.update(p.$context);(r._dirty||a.length)&&(V.update(r._labels),n.render()),delete r._dirty}};let se=(()=>{class n{barData;chartType="horizontal";height="900";containerId="";YTitle="";barOptions;emitEventClick=new e.vpe;plugin=ee;constructor(){}ngOnInit(){this.initChart()}initChart(){const t=getComputedStyle(document.documentElement);t.getPropertyValue("--text-color"),t.getPropertyValue("--text-color-secondary"),t.getPropertyValue("--surface-border"),this.barOptions=this.barOptions??{barPercentage:.4,indexAxis:"horizontal"===this.chartType?"y":"x",maintainAspectRatio:!1,plugins:{datalabels:{formatter:(s,l)=>{alert(12);let c=0;l.chart.data.datasets[0].data.map(u=>{c+=u});const p=100*s/c;return 0!==p?p.toFixed(2)+"%":""},color:"#fff"}},scales:{y:{title:{display:!0,text:this.YTitle},ticks:{color:"#000"}}}}}ngOnChanges(t){t.barData&&this.initChart()}onLabelClick(t){this.emitEventClick.emit(t)}static \u0275fac=function(i){return new(i||n)};static \u0275cmp=e.Xpm({type:n,selectors:[["app-bar-chart"]],inputs:{barData:"barData",chartType:"chartType",height:"height",containerId:"containerId",YTitle:"YTitle",barOptions:"barOptions"},outputs:{emitEventClick:"emitEventClick"},features:[e.TTD],decls:1,vars:3,consts:[["type","bar",3,"data","height","options","onDataSelect"]],template:function(i,a){1&i&&(e.TgZ(0,"p-chart",0),e.NdJ("onDataSelect",function(s){return a.onLabelClick(s)}),e.qZA()),2&i&&e.Q6J("data",a.barData)("height",a.height)("options",a.barOptions)},dependencies:[R.C]})}return n})(),Ot=(()=>{class n{barData=[];barOptions;emitEventClick=new e.vpe;ngOnInit(){}navigateDriver(t){this.emitEventClick.emit(t)}static \u0275fac=function(i){return new(i||n)};static \u0275cmp=e.Xpm({type:n,selectors:[["app-scorecard-chart"]],inputs:{barData:"barData",barOptions:"barOptions"},outputs:{emitEventClick:"emitEventClick"},decls:1,vars:5,consts:[[3,"chartType","height","barData","barOptions","containerId","emitEventClick"]],template:function(i,a){1&i&&(e.TgZ(0,"app-bar-chart",0),e.NdJ("emitEventClick",function(s){return a.navigateDriver(s)}),e.qZA()),2&i&&e.Q6J("chartType","horizontal")("height","600")("barData",a.barData)("barOptions",a.barOptions)("containerId","driver-scorecard")},dependencies:[se]})}return n})();const Nt=["dt"];function Ut(n,r){1&n&&(e.TgZ(0,"th",31),e._uU(1,"Obstruction "),e._UZ(2,"p-sortIcon",32),e.qZA())}function It(n,r){1&n&&(e.TgZ(0,"th",33),e._uU(1,"Forward Collision Warning "),e._UZ(2,"p-sortIcon",34),e.qZA())}function kt(n,r){1&n&&(e.TgZ(0,"th",35),e._uU(1,"Pedestrian Collision Warning "),e._UZ(2,"p-sortIcon",36),e.qZA())}function Mt(n,r){1&n&&(e.TgZ(0,"th",37),e._uU(1,"Cornering "),e._UZ(2,"p-sortIcon",38),e.qZA())}function Pt(n,r){1&n&&(e.TgZ(0,"th",39),e._uU(1,"Braking "),e._UZ(2,"p-sortIcon",40),e.qZA())}function Jt(n,r){1&n&&(e.TgZ(0,"th",41),e._uU(1,"Acceleration "),e._UZ(2,"p-sortIcon",42),e.qZA())}function Lt(n,r){1&n&&(e.TgZ(0,"th",43),e._uU(1,"Overspeeding "),e._UZ(2,"p-sortIcon",44),e.qZA())}function Rt(n,r){1&n&&(e.TgZ(0,"th",45),e._uU(1,"Stop Sign "),e._UZ(2,"p-sortIcon",46),e.qZA())}function qt(n,r){1&n&&(e.TgZ(0,"th",47),e._uU(1,"Fatigue "),e._UZ(2,"p-sortIcon",48),e.qZA())}function Qt(n,r){1&n&&(e.TgZ(0,"th",49),e._uU(1,"Inattention "),e._UZ(2,"p-sortIcon",50),e.qZA())}function Ht(n,r){1&n&&(e.TgZ(0,"th",51),e._uU(1," Traffic Light Violation "),e._UZ(2,"p-sortIcon",52),e.qZA())}function Yt(n,r){1&n&&(e.TgZ(0,"th",53),e._uU(1,"Phone Use "),e._UZ(2,"p-sortIcon",54),e.qZA())}function Vt(n,r){if(1&n&&(e.TgZ(0,"tr")(1,"th",7),e._uU(2,"Driver Name "),e._UZ(3,"p-sortIcon",8),e.qZA(),e.TgZ(4,"th",9),e._uU(5,"Driver Score"),e._UZ(6,"p-sortIcon",10),e.qZA(),e.TgZ(7,"th",11),e._uU(8,"Category"),e._UZ(9,"p-sortIcon",12),e.qZA(),e.TgZ(10,"th",13),e._uU(11),e._UZ(12,"p-sortIcon",14),e.qZA(),e.TgZ(13,"th",15),e._uU(14,"Events "),e._UZ(15,"p-sortIcon",16),e.qZA(),e.TgZ(16,"th",17),e._uU(17,"Compound Events "),e._UZ(18,"p-sortIcon",18),e.qZA(),e.YNc(19,Ut,3,0,"th",19),e.YNc(20,It,3,0,"th",20),e.YNc(21,kt,3,0,"th",21),e.YNc(22,Mt,3,0,"th",22),e.YNc(23,Pt,3,0,"th",23),e.YNc(24,Jt,3,0,"th",24),e.YNc(25,Lt,3,0,"th",25),e.YNc(26,Rt,3,0,"th",26),e.YNc(27,qt,3,0,"th",27),e.YNc(28,Qt,3,0,"th",28),e.YNc(29,Ht,3,0,"th",29),e.YNc(30,Yt,3,0,"th",30),e.qZA()),2&n){const t=e.oxw();e.xp6(11),e.hij("Distance(",t.units,")"),e.xp6(8),e.Q6J("ngIf",t.checkIfNonLowRisk("obstruction")),e.xp6(1),e.Q6J("ngIf",t.checkIfNonLowRisk("forward_collision_warning")),e.xp6(1),e.Q6J("ngIf",t.checkIfNonLowRisk("pedestrian_collision_warning")),e.xp6(1),e.Q6J("ngIf",t.checkIfNonLowRisk("cornering")),e.xp6(1),e.Q6J("ngIf",t.checkIfNonLowRisk("braking")),e.xp6(1),e.Q6J("ngIf",t.checkIfNonLowRisk("acceleration")),e.xp6(1),e.Q6J("ngIf",t.checkIfNonLowRisk("speeding")),e.xp6(1),e.Q6J("ngIf",t.checkIfNonLowRisk("stop_sign_violation")),e.xp6(1),e.Q6J("ngIf",t.checkIfNonLowRisk("fatigue")),e.xp6(1),e.Q6J("ngIf",t.checkIfNonLowRisk("inattention")),e.xp6(1),e.Q6J("ngIf",t.checkIfNonLowRisk("traffic_light_violation")),e.xp6(1),e.Q6J("ngIf",t.checkIfNonLowRisk("phone"))}}function jt(n,r){if(1&n&&(e.TgZ(0,"td"),e._uU(1),e.qZA()),2&n){const t=e.oxw(2).$implicit;e.xp6(1),e.hij(" ",null==t||null==t.total_events||null==t.total_events.obstruction?null:t.total_events.obstruction[0]," ")}}function Bt(n,r){if(1&n&&(e.TgZ(0,"td"),e._uU(1),e.qZA()),2&n){const t=e.oxw(2).$implicit;e.xp6(1),e.hij(" ",null==t||null==t.total_events||null==t.total_events.forward_collision_warning?null:t.total_events.forward_collision_warning[0]," ")}}function $t(n,r){if(1&n&&(e.TgZ(0,"td"),e._uU(1),e.qZA()),2&n){const t=e.oxw(2).$implicit;e.xp6(1),e.hij(" ",null==t||null==t.total_events||null==t.total_events.pedestrian_collision_warning?null:t.total_events.pedestrian_collision_warning[0]," ")}}function Gt(n,r){if(1&n&&(e.TgZ(0,"td"),e._uU(1),e.qZA()),2&n){const t=e.oxw(2).$implicit;e.xp6(1),e.hij(" ",null==t||null==t.total_events||null==t.total_events.cornering?null:t.total_events.cornering[0]," ")}}function Wt(n,r){if(1&n&&(e.TgZ(0,"td"),e._uU(1),e.qZA()),2&n){const t=e.oxw(2).$implicit;e.xp6(1),e.hij(" ",null==t||null==t.total_events||null==t.total_events.braking?null:t.total_events.braking[0]," ")}}function zt(n,r){if(1&n&&(e.TgZ(0,"td"),e._uU(1),e.qZA()),2&n){const t=e.oxw(2).$implicit;e.xp6(1),e.hij(" ",null==t||null==t.total_events||null==t.total_events.acceleration?null:t.total_events.acceleration[0]," ")}}function Kt(n,r){if(1&n&&(e.TgZ(0,"td"),e._uU(1),e.qZA()),2&n){const t=e.oxw(2).$implicit;e.xp6(1),e.hij(" ",null==t||null==t.total_events||null==t.total_events.speeding?null:t.total_events.speeding[0]," ")}}function Xt(n,r){if(1&n&&(e.TgZ(0,"td"),e._uU(1),e.qZA()),2&n){const t=e.oxw(2).$implicit;e.xp6(1),e.hij(" ",null==t||null==t.total_events||null==t.total_events.stop_sign_violation?null:t.total_events.stop_sign_violation[0]," ")}}function ei(n,r){if(1&n&&(e.TgZ(0,"td"),e._uU(1),e.qZA()),2&n){const t=e.oxw(2).$implicit;e.xp6(1),e.hij(" ",null==t||null==t.total_events||null==t.total_events.fatigue?null:t.total_events.fatigue[0]," ")}}function ti(n,r){if(1&n&&(e.TgZ(0,"td"),e._uU(1),e.qZA()),2&n){const t=e.oxw(2).$implicit;e.xp6(1),e.hij(" ",null==t||null==t.total_events||null==t.total_events.inattention?null:t.total_events.inattention[0]," ")}}function ii(n,r){if(1&n&&(e.TgZ(0,"td"),e._uU(1),e.qZA()),2&n){const t=e.oxw(2).$implicit;e.xp6(1),e.hij(" ",null==t||null==t.total_events||null==t.total_events.traffic_light_violation?null:t.total_events.traffic_light_violation[0]," ")}}function ni(n,r){if(1&n&&(e.TgZ(0,"td"),e._uU(1),e.qZA()),2&n){const t=e.oxw(2).$implicit;e.xp6(1),e.hij(" ",null==t||null==t.total_events||null==t.total_events.phone?null:t.total_events.phone[0]," ")}}const ai=function(n){return{"surface-50":n}};function oi(n,r){if(1&n&&(e.TgZ(0,"tr",56)(1,"td",57),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.ALo(5,"number"),e.qZA(),e.TgZ(6,"td"),e._uU(7),e.qZA(),e.TgZ(8,"td"),e._uU(9),e.ALo(10,"number"),e.qZA(),e.TgZ(11,"td"),e._uU(12),e.qZA(),e.TgZ(13,"td"),e._uU(14),e.qZA(),e.YNc(15,jt,2,1,"td",58),e.YNc(16,Bt,2,1,"td",58),e.YNc(17,$t,2,1,"td",58),e.YNc(18,Gt,2,1,"td",58),e.YNc(19,Wt,2,1,"td",58),e.YNc(20,zt,2,1,"td",58),e.YNc(21,Kt,2,1,"td",58),e.YNc(22,Xt,2,1,"td",58),e.YNc(23,ei,2,1,"td",58),e.YNc(24,ti,2,1,"td",58),e.YNc(25,ii,2,1,"td",58),e.YNc(26,ni,2,1,"td",58),e.qZA()),2&n){const t=e.oxw(),i=t.rowIndex,a=t.$implicit,o=e.oxw();e.Q6J("ngClass",e.VKq(25,ai,i%2==0)),e.xp6(2),e.hij(" ",null==a?null:a.name," "),e.xp6(2),e.hij(" ",(null==a?null:a.score)>0?e.xi3(5,19,a.score,"1.0-2"):"N/A"," "),e.xp6(3),e.hij(" ",null==a?null:a.category," "),e.xp6(2),e.hij(" ",e.xi3(10,22,null==a?null:a.distance,"1.0-2")," "),e.xp6(3),e.hij(" ",null==a?null:a.total_event_count," "),e.xp6(2),e.hij(" ",null==a?null:a.compound_event_total_count," "),e.xp6(1),e.Q6J("ngIf",o.checkIfNonLowRisk("obstruction")),e.xp6(1),e.Q6J("ngIf",o.checkIfNonLowRisk("forward_collision_warning")),e.xp6(1),e.Q6J("ngIf",o.checkIfNonLowRisk("pedestrian_collision_warning")),e.xp6(1),e.Q6J("ngIf",o.checkIfNonLowRisk("cornering")),e.xp6(1),e.Q6J("ngIf",o.checkIfNonLowRisk("braking")),e.xp6(1),e.Q6J("ngIf",o.checkIfNonLowRisk("acceleration")),e.xp6(1),e.Q6J("ngIf",o.checkIfNonLowRisk("speeding")),e.xp6(1),e.Q6J("ngIf",o.checkIfNonLowRisk("stop_sign_violation")),e.xp6(1),e.Q6J("ngIf",o.checkIfNonLowRisk("fatigue")),e.xp6(1),e.Q6J("ngIf",o.checkIfNonLowRisk("inattention")),e.xp6(1),e.Q6J("ngIf",o.checkIfNonLowRisk("traffic_light_violation")),e.xp6(1),e.Q6J("ngIf",o.checkIfNonLowRisk("phone"))}}function ri(n,r){1&n&&e.YNc(0,oi,27,27,"tr",55),2&n&&e.Q6J("ngIf",r.$implicit)}const si=function(){return["name"]},li=function(){return[10,20,30]};let ci=(()=>{class n{utilservice;tableData=[];totalRecords;rows;units="km";eventsFromToolbar;onPageChangeEvent=new e.vpe;onSortChangeEvent=new e.vpe;dt;nonLowRiskEvents=[];allTableData=[];constructor(t){this.utilservice=t}ngOnInit(){const i=this.eventsFromToolbar?.primary_events?.filter(a=>a.event_configuration?.weightage>0);i.length&&i?.forEach(a=>{this.nonLowRiskEvents.push(a.name)})}checkIfNonLowRisk(t){return this.nonLowRiskEvents?.find(i=>i===t)}onPageChange(t){this.onPageChangeEvent.emit({first:t.first,page:t.page,rows:t.rows})}customSort(t){this.onSortChangeEvent.emit({field:t.sortField,order:t.sortOrder})}onGlobalFilter(t,i){this.tableData=this.allTableData.filter(a=>a.name.toLowerCase().includes(i.target.value.toLowerCase()))}ngOnChanges(t){t.tableData&&t.tableData.currentValue&&(this.tableData=t.tableData.currentValue,this.allTableData=t.tableData.currentValue)}static \u0275fac=function(i){return new(i||n)(e.Y36(h.FW))};static \u0275cmp=e.Xpm({type:n,selectors:[["app-scorecard-table"]],viewQuery:function(i,a){if(1&i&&e.Gf(Nt,5),2&i){let o;e.iGM(o=e.CRH())&&(a.dt=o.first)}},inputs:{tableData:"tableData",totalRecords:"totalRecords",rows:"rows",units:"units",eventsFromToolbar:"eventsFromToolbar"},outputs:{onPageChangeEvent:"onPageChangeEvent",onSortChangeEvent:"onSortChangeEvent"},features:[e.TTD],decls:7,vars:13,consts:[[1,"grid"],[1,"col-12"],["responsiveLayout","scroll","scrollHeight","500px","dataKey","id",3,"value","autoLayout","lazy","scrollable","globalFilterFields","customSort","rowHover","onLazyLoad"],["dt",""],["pTemplate","header"],["pTemplate","body"],["currentPageReportTemplate","{first} to {last} of {totalRecords} drivers",3,"showCurrentPageReport","rows","rowsPerPageOptions","totalRecords","onPageChange"],["pSortableColumn","name",1,"text-left"],["field","name"],["pSortableColumn","score"],["field","score"],["pSortableColumn","category"],["field","category"],["pSortableColumn","distance"],["field","distance"],["pSortableColumn","total_event_count"],["field","total_event_count"],["pSortableColumn","compound_event_total_count"],["field","compound_event_total_count"],["pSortableColumn","obstruction",4,"ngIf"],["pSortableColumn","forward_collision_warning",4,"ngIf"],["pSortableColumn","pedestrian_collision_warning",4,"ngIf"],["pSortableColumn","cornering",4,"ngIf"],["pSortableColumn","braking",4,"ngIf"],["pSortableColumn","acceleration",4,"ngIf"],["pSortableColumn","speeding",4,"ngIf"],["pSortableColumn","stop_sign_violation",4,"ngIf"],["pSortableColumn","fatigue",4,"ngIf"],["pSortableColumn","inattention",4,"ngIf"],["pSortableColumn","traffic_light_violation",4,"ngIf"],["pSortableColumn","phone",4,"ngIf"],["pSortableColumn","obstruction"],["field","obstruction"],["pSortableColumn","forward_collision_warning"],["field","forward_collision_warning"],["pSortableColumn","pedestrian_collision_warning"],["field","pedestrian_collision_warning"],["pSortableColumn","cornering"],["field","cornering"],["pSortableColumn","braking"],["field","braking"],["pSortableColumn","acceleration"],["field","acceleration"],["pSortableColumn","speeding"],["field","speeding"],["pSortableColumn","stop_sign_violation"],["field","stop_sign_violation"],["pSortableColumn","fatigue"],["field","fatigue"],["pSortableColumn","inattention"],["field","inattention"],["pSortableColumn","traffic_light_violation"],["field","traffic_light_violation"],["pSortableColumn","phone"],["field","phone"],[3,"ngClass",4,"ngIf"],[3,"ngClass"],[1,"text-left","text-break",2,"width","10%","min-width","10rem"],[4,"ngIf"]],template:function(i,a){1&i&&(e.TgZ(0,"div",0)(1,"div",1)(2,"p-table",2,3),e.NdJ("onLazyLoad",function(s){return a.customSort(s)}),e.YNc(4,Vt,31,13,"ng-template",4),e.YNc(5,ri,1,1,"ng-template",5),e.qZA(),e.TgZ(6,"p-paginator",6),e.NdJ("onPageChange",function(s){return a.onPageChange(s)}),e.qZA()()()),2&i&&(e.xp6(2),e.Q6J("value",a.tableData)("autoLayout",!0)("lazy",!0)("scrollable",!0)("globalFilterFields",e.DdM(11,si))("customSort",!0)("rowHover",!0),e.xp6(4),e.Q6J("showCurrentPageReport",!0)("rows",a.rows)("rowsPerPageOptions",e.DdM(12,li))("totalRecords",a.totalRecords))},dependencies:[v.mk,v.O5,x.jx,T.iA,T.lQ,T.fz,P.D,v.JJ],styles:["p-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], p-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{text-align:center}"]})}return n})();function pi(n,r){1&n&&e._UZ(0,"i"),2&n&&e.Tol(r.$implicit.icon)}function ui(n,r){if(1&n){const t=e.EpF();e.ynx(0),e._UZ(1,"p-menu",12,13),e.TgZ(3,"button",14),e.NdJ("click",function(a){e.CHM(t);const o=e.MAs(2);return e.KtG(o.toggle(a))}),e.qZA(),e.BQk()}if(2&n){const t=e.oxw();e.xp6(1),e.Q6J("popup",!0)("model",t.items)}}function di(n,r){1&n&&e._UZ(0,"p-progressSpinner",15)}function _i(n,r){1&n&&(e.TgZ(0,"p"),e._uU(1,"No data available."),e.qZA())}function mi(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"app-scorecard-chart",17),e.NdJ("emitEventClick",function(a){e.CHM(t);const o=e.oxw(2);return e.KtG(o.navigateDriver(a))}),e.qZA()}if(2&n){const t=e.oxw(2);e.Q6J("barData",t.barData)("barOptions",t.barOptions)}}function hi(n,r){if(1&n&&(e.ynx(0),e.YNc(1,mi,1,2,"app-scorecard-chart",16),e.BQk()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.driverScorecardsForChartValues&&t.showTable)}}function gi(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"app-scorecard-table",18),e.NdJ("onPageChangeEvent",function(a){e.CHM(t);const o=e.oxw();return e.KtG(o.onPageChange(a))})("onSortChangeEvent",function(a){e.CHM(t);const o=e.oxw();return e.KtG(o.onSortChange(a))}),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("rows",t.rows)("totalRecords",t.allDriverScoreCards.length)("tableData",t.paginatedDrivers)("eventsFromToolbar",t.eventsFromToolbar)("units",t.distance_units)}}let Fe=(()=>{class n{driverService;eventService;excelExportService;router;route;utilservice;driverAnalyticsService;driversService;spinnerService;settingsService;showTable=!0;allDriverScoreCards=[];paginatedDrivers=[];driverScorecardsForChartLabels=[];driverScorecardsForChartColors=[];driverScorecardsForChartValues=[];driverScorecardsIds=[];isSorted=!0;barData;barOptions;timeRange;fromDate;toDate;allDrivers=[];totalRecords=0;first=0;rows=10;sortField="score";sortOrder=0;distance_units="Miles";orgSettings=[];paginationObj={items_per_page:1e8,page_number:1};showSpinner=!0;defaultView="chart";viewOptions=[{icon:"pi pi-chart-pie",justify:"Center",value:"chart"},{icon:"pi pi-table",justify:"Center",value:"table"}];forkJoinSubscription;items;compoundEventNames=[];toolbarComponent;selectedTimeRange;eventsFromToolbar;constructor(t,i,a,o,s,l,c,d,p,u){this.driverService=t,this.eventService=i,this.excelExportService=a,this.router=o,this.route=s,this.utilservice=l,this.driverAnalyticsService=c,this.driversService=d,this.spinnerService=p,this.settingsService=u}ngAfterViewInit(){this.items=[{label:"Export to Excel",icon:"pi pi-file-excel",command:()=>{this.exportData("excel")}},{label:"Export to CSV",icon:"pi pi-file-excel",command:()=>{this.exportData("csv")}}],this.showSpinner=!0,this.settingsService.getOrgSettings().subscribe(t=>{this.orgSettings=t,this.distance_units=t.settings.org_common_configurations.speed_unit==m.J_[0].value?"km":"mi"}),this.getDriverScorecardForChart()}originalDriverScorecards=[];getDriverScorecardForChart(){this.allDriverScoreCards=[];var t=m.dc();const i=this.driverService.getDriverScorecardFetch(this.toolbarComponent.fromDateUTC,this.toolbarComponent.toDateUTC,t,this.paginationObj),a=this.driversService.fetchDrivers(this.toolbarComponent.fromDateUTC,this.toolbarComponent.toDateUTC,t,void 0,this.paginationObj),o=this.driverAnalyticsService.getDriverCoachingReportForDriver(this.toolbarComponent.fromDateUTC,this.toolbarComponent.toDateUTC,t,this.paginationObj),s=this.driverAnalyticsService.getDriverTripReport(this.toolbarComponent.fromDateUTC,this.toolbarComponent.toDateUTC,t,this.paginationObj),l=this.settingsService.getOrgSettings(),c=this.eventService.getEvents();this.forkJoinSubscription=(0,J.D)([i,a,o,s,l,c]).subscribe(d=>{this.showSpinner=!1;let p=d[0].data.sort((_,b)=>_.score>b.score?1:-1);const u=new Map;d[1].data.forEach(_=>{u.set(_.id_,{..._})}),p.forEach(_=>{const b=u.get(_.driver_id);b&&Object.assign(b,_)}),d[2].data.forEach(_=>{const b=u.get(_.driver_id);b&&Object.assign(b,_)}),d[3].data.forEach(_=>{const b=u.get(_.driver_id);b&&Object.assign(b,_)}),this.compoundEventNames=d[5].compound_events.map(_=>_.name),p=Array.from(u.values()),p&&p.length>0&&(this.setDataForChart(p,d[4]),this.setDriverScorecard(p),this.onSortChange({field:"total_event_count",order:-1}))})}setDriverScorecard(t){this.allDriverScoreCards=t,this.allDriverScoreCards.forEach(i=>{i.compound_event_total_count=this.getCompoundEventCount(i.total_events),i.accidance_avoidance_count=this.getAccidanceAvoidanceCount(i.total_events)||0,i.total_count&&(i.total_count[0]=i.total_count[0]-(i.compound_event_total_count+i.accidance_avoidance_count)),i.total_event_count=i.total_count?i.total_count[0]:0,i.distance=i.travel_distance?this.convertDistance(i.travel_distance[0]):0})}setDataForChart(t,i){this.showSpinner=!1;const a=i.settings.org_common_configurations.driver_scorecard.excellent_score,o=i.settings.org_common_configurations.driver_scorecard.fair_score;(t=t.filter(p=>p.score>0)).sort((p,u)=>u.score-p.score),this.barData={},this.driverScorecardsForChartLabels=[],this.driverScorecardsForChartColors=[],this.driverScorecardsForChartValues=[],this.driverScorecardsIds=[];let l=0,c=0,d=0;for(let p=0;p<t.length;p++){let _,u=t[p];if(u.score>=a){if(_="excellent",l>=10)continue;l++}else if(u.score<o){if(_="risky",d>=10)continue;d++}else{if(_="fair",c>=10)continue;c++}const b=u.name&&""!==u.name?u.name.length>20?u.name.substring(0,20)+"...":u.name:u.driver_id;this.driverScorecardsForChartLabels.push(b),this.driverScorecardsForChartValues.push(Math.round(u.score)),this.driverScorecardsIds.push(u.driver_id);let y=this.utilservice.getScoreStyleClass(_);this.driverScorecardsForChartColors.push(y)}this.barData={labels:this.driverScorecardsForChartLabels,datasets:[{label:["Driver Scorecard"],backgroundColor:this.driverScorecardsForChartColors,data:this.driverScorecardsForChartValues}]},this.barOptions={barPercentage:.3,aspectRatio:.75,base:50,indexAxis:"y",categoryPercentage:1,maintainAspectRatio:!1,borderRadius:15,plugins:{datalabels:{anchor:"end",align:"end",formatter:(p,u)=>{alert(12);let _=0;u.chart.data.datasets[0].data.map(E=>{_+=E});const y=100*p/_;return 0!==y?y.toFixed(2)+"%":""},color:"#fff"},legend:{display:!1}},scales:{x:{min:0,max:100,ticks:{color:"black",font:{size:14,weight:500}},grid:{display:!1,drawBorder:!0,offset:!1}}}}}removeDuplicate(t){return[...new Map(t.map(i=>[i.driver_id,i])).values()]}onPageChange(t){this.first=t.first,this.rows=t.rows,this.paginate()}paginate(){this.paginatedDrivers=[],this.paginatedDrivers=this.allDriverScoreCards.slice(this.first,this.first+this.rows)}onSortChange(t){this.sortField=t.field,this.sortOrder=t.order,this.spinnerService.showSpinner(),this.sortDrivers()}sortDrivers(){this.sortField&&this.allDriverScoreCards.sort((t,i)=>{let a,o;"name"===this.sortField||"category"===this.sortField?(a=t[this.sortField]?.toLowerCase(),o=i[this.sortField]?.toLowerCase()):"score"===this.sortField||"distance"===this.sortField||"total_event_count"==this.sortField||"compound_event_total_count"==this.sortField?(a=parseFloat(t[this.sortField]),o=parseFloat(i[this.sortField])):(a=parseFloat(t.total_events?.[this.sortField]?.[0]),o=parseFloat(i.total_events?.[this.sortField]?.[0]));let s=a>o?1:a<o?-1:0;return 1===this.sortOrder?s:-s}),this.paginate()}getCompoundEventCount(t){let i=0;return t&&Object.keys(t).forEach(a=>{this.compoundEventNames.includes(a)&&a in m.uZ&&(i+=t[a][0])}),i}getAccidanceAvoidanceCount(t){let i=0;return t&&Object.keys(t).forEach(a=>{this.compoundEventNames.includes(a)&&a in m.TU&&(i+=t[a][0])}),i}navigateDriver(t){this.router.navigate(["/driver-analytics"],{relativeTo:this.route,queryParams:{driverId:this.driverScorecardsIds[t.element.index]}})}exportData(t){const i=[];this.allDriverScoreCards.forEach(o=>{i.push({"Driver Name":o.name,Score:o.score>0?o.score:"N/A",Category:o.category,[`Distance (${this.distance_units})`]:o.distance,"Total Events":o?.total_event_count,"Compound Events":o?.compound_event_total_count,Obstruction:o?.total_events?.obstruction?.[0],"Forward Collision Warning":o?.total_events?.forward_collision_warning?.[0],"Pedestrian Collision Warning":o?.total_events?.pedestrian_collision_warning?.[0],Cornering:o?.total_events?.cornering?.[0],Braking:o?.total_events?.braking?.[0],Acceleration:o?.total_events?.acceleration?.[0],Speeding:o?.total_events?.speeding?.[0],"Stop Sign Violation":o?.total_events?.stop_sign_violation?.[0],Fatigue:o?.total_events?.fatigue?.[0],Inattention:o?.total_events?.inattention?.[0],"Traffic Light Violation":o?.total_events?.traffic_light_violation?.[0],Phone:o?.total_events?.phone?.[0]})});const a="Driver Scorecard Report"+(new Date).toLocaleDateString();this.excelExportService.exportData(i,a,t)}convertDistance(t){if(null==t||"null"==t||null==t||isNaN(t))return 0;String(t).includes(",")&&(t=t.replace(",",""));let i=Number(String(t));return this.utilservice.convertDistance(i,"mi"==this.distance_units?m.J_[1].value:m.J_[0].value)}ngOnDestroy(){this.forkJoinSubscription&&this.forkJoinSubscription.unsubscribe()}static \u0275fac=function(i){return new(i||n)(e.Y36(h.$H),e.Y36(h.nC),e.Y36(m.U0),e.Y36(U.F0),e.Y36(U.gz),e.Y36(h.FW),e.Y36(h.NZ),e.Y36(h.Ft),e.Y36(h.V),e.Y36(h.gb))};static \u0275cmp=e.Xpm({type:n,selectors:[["app-driver-scorecard"]],inputs:{toolbarComponent:"toolbarComponent",selectedTimeRange:"selectedTimeRange",eventsFromToolbar:"eventsFromToolbar"},features:[e._Bn([x.ez,x.YP])],decls:15,vars:7,consts:[[1,"card",2,"min-height","710px","max-height","710px"],[1,"flex","align-items-center","justify-content-between","mb-2"],[1,"text-900","text-lg","font-semibold"],["pTooltip","We assess driver performance based on event frequency and mileage. Drive responsibly and accumulate a higher score.",1,"pi","pi-info-circle","ml-1","text-lg"],[1,"flex"],[1,"inline-block","ml-4","vertical-align-middle"],["optionLabel","icon","optionValue","value",3,"options","ngModel","onChange","ngModelChange"],["pTemplate",""],[4,"ngIf"],[1,"relative"],["styleClass","mt-5",4,"ngIf"],[3,"rows","totalRecords","tableData","eventsFromToolbar","units","onPageChangeEvent","onSortChangeEvent",4,"ngIf"],[3,"popup","model"],["menu",""],["pButton","","pRipple","","type","button","icon","pi pi-ellipsis-v",1,"p-button-rounded","p-button-text","p-button-secondary","p-trigger",3,"click"],["styleClass","mt-5"],[3,"barData","barOptions","emitEventClick",4,"ngIf"],[3,"barData","barOptions","emitEventClick"],[3,"rows","totalRecords","tableData","eventsFromToolbar","units","onPageChangeEvent","onSortChangeEvent"]],template:function(i,a){1&i&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2),e._uU(3,"Driver Scorecard "),e._UZ(4,"i",3),e.qZA(),e.TgZ(5,"div",4)(6,"div",5)(7,"p-selectButton",6),e.NdJ("onChange",function(){return a.showTable=!a.showTable})("ngModelChange",function(s){return a.defaultView=s}),e.YNc(8,pi,1,2,"ng-template",7),e.qZA()(),e.YNc(9,ui,4,2,"ng-container",8),e.qZA()(),e.TgZ(10,"div",9),e.YNc(11,di,1,0,"p-progressSpinner",10),e.qZA(),e.YNc(12,_i,2,0,"p",8),e.YNc(13,hi,2,1,"ng-container",8),e.YNc(14,gi,1,5,"app-scorecard-table",11),e.qZA()),2&i&&(e.xp6(7),e.Q6J("options",a.viewOptions)("ngModel",a.defaultView),e.xp6(2),e.Q6J("ngIf",!a.showTable&&!a.showSpinner),e.xp6(2),e.Q6J("ngIf",a.showSpinner),e.xp6(1),e.Q6J("ngIf",!a.showSpinner&&0===a.allDriverScoreCards.length),e.xp6(1),e.Q6J("ngIf",a.driverScorecardsForChartValues.length),e.xp6(1),e.Q6J("ngIf",a.paginatedDrivers&&a.paginatedDrivers.length>0&&!a.showTable))},dependencies:[v.O5,L.Hq,x.jx,q.H,Q.u,D.JJ,D.On,M.UN,B.v2,F.G,Ot,ci],styles:["[_nghost-%COMP%]  p-progressSpinner{position:absolute;top:50%;left:50%;z-index:1000}[_nghost-%COMP%]  .spinner-div{margin-top:50%}"]})}return n})();function vi(n,r){if(1&n&&(e.TgZ(0,"li",5)(1,"div",6),e._UZ(2,"img",7),e.qZA(),e.TgZ(3,"div",8),e._uU(4),e.qZA(),e.TgZ(5,"div",9)(6,"b"),e._uU(7),e.qZA()()()),2&n){const t=e.oxw().$implicit,i=e.oxw(2);e.xp6(2),e.Q6J("src",i.getItemIcon(null==t?null:t.key),e.LSH),e.xp6(2),e.hij(" ",i.eventLabelMapping[t.key],": "),e.xp6(3),e.Oqu(t.value)}}function fi(n,r){if(1&n&&(e.ynx(0),e.YNc(1,vi,8,3,"li",4),e.BQk()),2&n){const t=r.$implicit;e.xp6(1),e.Q6J("ngIf",t.value>0)}}function bi(n,r){if(1&n&&(e.TgZ(0,"li",5)(1,"div",6),e._UZ(2,"img",7),e.qZA(),e.TgZ(3,"div",8),e._uU(4),e.qZA(),e.TgZ(5,"div",9)(6,"b"),e._uU(7),e.qZA()()()),2&n){const t=e.oxw().$implicit,i=e.oxw(2);e.xp6(2),e.Q6J("src",i.getItemIcon(null==t?null:t.key),e.LSH),e.xp6(2),e.hij(" ",i.eventLabelMapping[t.key],": "),e.xp6(3),e.Oqu(t.value)}}function Ci(n,r){if(1&n&&(e.ynx(0),e.YNc(1,bi,8,3,"li",4),e.BQk()),2&n){const t=r.$implicit;e.xp6(1),e.Q6J("ngIf",t.value>0)}}function Di(n,r){if(1&n&&(e.TgZ(0,"div",1)(1,"div",2)(2,"ul"),e.YNc(3,fi,2,1,"ng-container",3),e.qZA()(),e.TgZ(4,"div",2)(5,"ul"),e.YNc(6,Ci,2,1,"ng-container",3),e.qZA()()()),2&n){const t=e.oxw();e.xp6(3),e.Q6J("ngForOf",t.allEvents.slice(0,10)),e.xp6(3),e.Q6J("ngForOf",t.allEvents.slice(10,20))}}let xi=(()=>{class n{utilservice;fleetsService;aggregatedFleetsData;toolbarComponent;eventLabelMapping;tempEventsData={};eventsData=[];cols=[];compoundEventIcons={};fromDate;toDate;constructor(t,i){this.utilservice=t,this.fleetsService=i}ngOnInit(){this.fromDate=this.toolbarComponent.fromDateUTC,this.toDate=this.toolbarComponent.toDateUTC,this.toolbarComponent.allEvents.compound_events.forEach(t=>{null!=t.event_configuration&&(this.compoundEventIcons[t.name]=t.event_configuration.display_icon)}),this.getAllEventsForChart()}getAllEventsForChart(){var t=this.utilservice.getEventNamesFromEventsArray(this.toolbarComponent.allEvents);this.getEventsForFleet(t)}getEventsForFleet(t){var i=m.Y5();this.fleetsService.getFleetsAggregation(this.fromDate,this.toDate,i.filter_fleet_ids,t).subscribe(a=>{this.aggregatedFleetsData=a,this.setValuesForAllEvents(a.cumulative.total_events,t,a.prev_cumulative.total_events)})}compoundEventsPrevSummary;labels;values;allEvents;setValuesForAllEvents(t,i,a){this.compoundEventsPrevSummary=[];let o=[];this.labels=[],this.values=[],this.toolbarComponent.allEvents.compound_events.forEach(u=>{o.push(u.name)});let s=[];this.toolbarComponent.allEvents.primary_events.forEach(u=>{s.push(u.name)});let l=[],c=[];i?.forEach(u=>{-1!==s.indexOf(u)?l.push(u):-1!==o.indexOf(u)&&c.push(u)}),this.eventLabelMapping=this.utilservice.getEventDefaultLabelMapping(this.toolbarComponent.allEvents);var d=[];for(var p in this.allEvents=d,t)t.hasOwnProperty(p)&&-1!==l.indexOf(p)?d.push({key:p,value:t[p][0]}):t.hasOwnProperty(p)&&-1!==c.indexOf(p)&&this.compoundEventsPrevSummary.push({key:this.toolbarComponent.allEvents.compound_events.filter(u=>p===u.name)[0].event_configuration.display_label,value:t[p][0],name:p});d.sort(function(u,_){return _.value-u.value});for(let u=0;u<=this.allEvents.length-1;u++)this.allEvents[u]?.value>0&&(this.labels.push(this.eventLabelMapping[this.allEvents[u]?.key]),this.values.push(this.allEvents[u]?.value))}getItemIcon(t){let i="assets/demo/images/events/"+t+"-red.svg";return null!=this.compoundEventIcons[t]&&(i=this.compoundEventIcons[t]),i}static \u0275fac=function(i){return new(i||n)(e.Y36(h.FW),e.Y36(h.VN))};static \u0275cmp=e.Xpm({type:n,selectors:[["app-event-analysis-table"]],inputs:{aggregatedFleetsData:"aggregatedFleetsData",toolbarComponent:"toolbarComponent",eventLabelMapping:"eventLabelMapping"},decls:3,vars:1,consts:[["class","grid","id","top-5events",4,"ngIf"],["id","top-5events",1,"grid"],[1,"col-6"],[4,"ngFor","ngForOf"],["class","mb-2 list-none font-xl",4,"ngIf"],[1,"mb-2","list-none","font-xl"],[1,"inline-block","w-2rem","mb-1"],["onerror","this.src='assets/demo/images/other/default.png'",1,"vertical-align-middle",2,"width","34px",3,"src"],[1,"inline-block","ml-3","w-14rem"],[1,"inline-block"]],template:function(i,a){1&i&&(e.TgZ(0,"p"),e._uU(1,"Data encompasses the cumulative period selected"),e.qZA(),e.YNc(2,Di,7,2,"div",0)),2&i&&(e.xp6(2),e.Q6J("ngIf",a.allEvents))},dependencies:[v.sg,v.O5]})}return n})(),K=(()=>{class n{data;height;YTitle;chartData;chartOptions;constructor(){}ngOnInit(){this.initChart()}initChart(){const t=getComputedStyle(document.documentElement),i=t.getPropertyValue("--text-color"),a=t.getPropertyValue("--text-color-secondary"),o=t.getPropertyValue("--surface-border");this.chartData=this.data||{labels:["January","February","March","April","May","June","July"],datasets:[{label:"Excellent",data:[6500,5900,8e3,8100,5600,5500,4e3],fill:!0,tension:.4,borderColor:t.getPropertyValue("--green-500"),borderWidth:1},{label:"Fiar",data:[1200,5100,6200,3300,2100,6200,4500],fill:!0,borderColor:"#6366f1",tension:.4,backgroundColor:"rgba(99,102,220,0.2)",borderWidth:1},{label:"Risky",data:[6369,5100,5560,3300,9565,2356,1e3],fill:!0,borderColor:"#000658",tension:.4,backgroundColor:"rgba(000,102,220,0.2)",borderWidth:1}]},this.chartOptions={animation:{duration:0},elements:{point:{radius:2,borderWidth:1}},plugins:[{legend:{labels:{color:i}},tooltip:{callbacks:{label:function(s){let l=s.dataset.label||"";return l&&(l+=": "),null!==s.parsed.y&&(l+=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(s.parsed.y)),l}}},beforeInit:function(s){s.data.labels.forEach(function(l,c,d){/\n/.test(l)&&(d[c]=l.split(/\n/))})}}],scales:{x:{ticks:{color:a},grid:{color:o}},y:{title:{display:!0,text:this.YTitle},ticks:{color:a},grid:{color:o}}}}}ngOnChanges(t){t.data&&this.initChart()}static \u0275fac=function(i){return new(i||n)};static \u0275cmp=e.Xpm({type:n,selectors:[["app-line-chart"]],inputs:{data:"data",height:"height",YTitle:"YTitle"},features:[e.TTD],decls:1,vars:4,consts:[["type","line",3,"height","data","plugins","options"]],template:function(i,a){1&i&&e._UZ(0,"p-chart",0),2&i&&e.Q6J("height",a.height)("data",a.chartData)("plugins",a.chartOptions.plugins)("options",a.chartOptions)},dependencies:[R.C]})}return n})();function Ti(n,r){if(1&n&&e._UZ(0,"app-line-chart",1),2&n){const t=e.oxw();e.Q6J("data",t.chartData)("height",600)("YTitle","Event Count")}}let yi=(()=>{class n{chartData;static \u0275fac=function(i){return new(i||n)};static \u0275cmp=e.Xpm({type:n,selectors:[["app-event-analysis-chart"]],inputs:{chartData:"chartData"},decls:1,vars:1,consts:[[3,"data","height","YTitle",4,"ngIf"],[3,"data","height","YTitle"]],template:function(i,a){1&i&&e.YNc(0,Ti,1,3,"app-line-chart",0),2&i&&e.Q6J("ngIf",a.chartData)},dependencies:[v.O5,K]})}return n})();function Si(n,r){1&n&&e._UZ(0,"i"),2&n&&e.Tol(r.$implicit.icon)}function wi(n,r){1&n&&e._UZ(0,"p-progressSpinner")}function Zi(n,r){if(1&n&&e._UZ(0,"app-event-analysis-chart",12),2&n){const t=e.oxw();e.Q6J("chartData",t.chartData)}}function Ai(n,r){if(1&n&&e._UZ(0,"app-event-analysis-table",13),2&n){const t=e.oxw();e.Q6J("eventLabelMapping",t.eventLabelMapping)("toolbarComponent",t.toolbarComponent)("aggregatedFleetsData",t.aggregatedFleetsData)}}let Oe=(()=>{class n{utilservice;fleetsService;eventsService;cdref;showTable=!0;allDriverScoreCards=[];driverScorecardsForChartLabels=[];driverScorecardsForChartColors=[];driverScorecardsForChartValues=[];chartData;unit;showAll=!1;eventLabelMapping;defaultView="chart";viewOptions=[{icon:"pi pi-chart-pie",justify:"Center",value:"chart"},{icon:"pi pi-table",justify:"Center",value:"table"}];displayNameMapping={};toolbarComponent;aggregatedFleetsData;showSpinner=!0;constructor(t,i,a,o){this.utilservice=t,this.fleetsService=i,this.eventsService=a,this.cdref=o}ngAfterViewInit(){this.getEventsDailyReport()}getEventsDailyReport(){this.showSpinner=!0,this.eventsService.getEvents().subscribe(t=>{t.compound_events.forEach(i=>{null!=i.event_configuration&&(this.displayNameMapping[i.name]=i.event_configuration.display_label)}),this.eventLabelMapping=this.utilservice.getEventDefaultLabelMapping(t),this.getSnapshotsForFleets(this.utilservice.getEventNamesFromEventsArray(t))})}getSnapshotsForFleets(t){var i=m.Y5();const a=new Date(this.toolbarComponent.fromDateUTC);a.setUTCDate(a.getUTCDate()-1);const o=a.toISOString().split("T")[0];let s=this.utilservice.get_31_days_of_date_range(new Date(o),new Date(this.toolbarComponent.toDateUTC),31);this.aggregatedFleetsData=[];let l=!1;for(;s.length;){let c=s.shift()||"",d=this.toolbarComponent.toDateUTC;if(s.length){let p=new Date(c);p.setUTCDate(p.getUTCDate()+30),d=p.toISOString().split("T")[0]}else l=!0;this.fleetsService.getSnapshotsForFleets(c,d,i.filter_fleet_ids,t).subscribe(p=>{this.aggregatedFleetsData=[...this.aggregatedFleetsData,...p.data],l&&(this.aggregatedFleetsData.sort((u,_)=>new Date(u.date).getTime()-new Date(_.date).getTime()),this.setEventAnalysis(t))})}}setEventAnalysis(t){const i=this.aggregatedFleetsData;let a=[],o=[];t=Array.from(new Set(t)),(this.showAll?t:["inattention","phone","seat_belt","forward_collision_warning","pedestrian_collision_warning","stop_sign_violation","traffic_light_violation"]).forEach((l,c)=>{let d=[];i.forEach((u,_)=>{let b;b=_>0?i[_].total_events[l]?i[_].total_events?.[l]?.[0]-i[_-1].total_events?.[l]?.[0]:0:u.total_events[l]?u.total_events[l][0]:0,d.push(b)}),o.push({label:this.eventLabelMapping[l],backgroundColor:this.utilservice.hexToRgba(m.mH[c+1],"0.1"),borderColor:m.mH[c+1],borderWidth:1,data:d.slice(1),fill:!0,tension:.4})}),i.forEach(l=>{a.push(l.date)}),a=a.slice(1),this.chartData={labels:a,datasets:o},this.showSpinner=!1,this.cdref.detectChanges()}toggleAllEvents(){this.showSpinner=!0,this.showAll=!this.showAll,this.ngAfterViewInit()}ngOnChanges(t){t.aggregatedFleetsData&&this.getEventsDailyReport()}static \u0275fac=function(i){return new(i||n)(e.Y36(h.FW),e.Y36(h.VN),e.Y36(h.nC),e.Y36(e.sBO))};static \u0275cmp=e.Xpm({type:n,selectors:[["app-event-analysis-report"]],inputs:{toolbarComponent:"toolbarComponent"},features:[e.TTD],decls:16,vars:8,consts:[[1,"card","relative","h-full",2,"min-height","400px"],[1,"flex","align-items-center","justify-content-between","mb-3"],[1,"text-900","text-lg","font-semibold","mb-3"],[1,"inline-block"],["for","filter-switch",1,"mr-2","switch-label"],["id","filter-switch","name","filter-switch",1,"vertical-align-middle",3,"onChange"],[1,"inline-block","ml-4","vertical-align-middle"],["optionLabel","icon","optionValue","value",3,"options","ngModel","onChange","ngModelChange"],["pTemplate",""],[4,"ngIf"],[3,"chartData",4,"ngIf"],[3,"eventLabelMapping","toolbarComponent","aggregatedFleetsData",4,"ngIf"],[3,"chartData"],[3,"eventLabelMapping","toolbarComponent","aggregatedFleetsData"]],template:function(i,a){1&i&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2),e._uU(3),e.ALo(4,"translate"),e.qZA(),e.TgZ(5,"div")(6,"div",3)(7,"label",4),e._uU(8,"Show All Events"),e.qZA(),e.TgZ(9,"p-inputSwitch",5),e.NdJ("onChange",function(){return a.toggleAllEvents()}),e.qZA()(),e.TgZ(10,"div",6)(11,"p-selectButton",7),e.NdJ("onChange",function(){return a.showTable=!a.showTable})("ngModelChange",function(s){return a.defaultView=s}),e.YNc(12,Si,1,2,"ng-template",8),e.qZA()()()(),e.YNc(13,wi,1,0,"p-progressSpinner",9),e.YNc(14,Zi,1,1,"app-event-analysis-chart",10),e.YNc(15,Ai,1,3,"app-event-analysis-table",11),e.qZA()),2&i&&(e.xp6(3),e.Oqu(e.lcZ(4,6,"dashboard.event_analysis_report")),e.xp6(8),e.Q6J("options",a.viewOptions)("ngModel",a.defaultView),e.xp6(2),e.Q6J("ngIf",a.showSpinner),e.xp6(1),e.Q6J("ngIf",a.showTable),e.xp6(1),e.Q6J("ngIf",!a.showTable))},dependencies:[v.O5,x.jx,D.JJ,D.On,_e.Ql,M.UN,F.G,xi,yi,ce.X$],styles:["[_nghost-%COMP%]  p-progressSpinner{position:absolute;top:50%;left:50%;z-index:1000}"]})}return n})(),Ei=(()=>{class n{data;radarOptions;chartOptions;radarData;constructor(){}ngOnInit(){const t=getComputedStyle(document.documentElement);t.getPropertyValue("--text-color"),t.getPropertyValue("--text-color-secondary"),t.getPropertyValue("--surface-border"),this.radarData=this.data}ngOnChanges(t){t.data&&this.ngOnInit()}static \u0275fac=function(i){return new(i||n)};static \u0275cmp=e.Xpm({type:n,selectors:[["app-radar-chart"]],inputs:{data:"data",radarOptions:"radarOptions"},features:[e.TTD],decls:1,vars:3,consts:[["type","radar",3,"data","options","height"]],template:function(i,a){1&i&&e._UZ(0,"p-chart",0),2&i&&e.Q6J("data",a.radarData)("options",a.radarOptions)("height","550px")},dependencies:[R.C]})}return n})();function Fi(n,r){if(1&n&&e._UZ(0,"app-radar-chart",1),2&n){const t=e.oxw();e.Q6J("data",t.chartData)("radarOptions",t.radarOptions)}}let Oi=(()=>{class n{chartData;radarOptions;ngOnInit(){const t=getComputedStyle(document.documentElement),i=t.getPropertyValue("--text-color"),a=t.getPropertyValue("--text-color-secondary");t.getPropertyValue("--surface-border"),this.radarOptions=this.radarOptions??{plugins:{legend:{labels:{color:i,font:{size:13}}}},scales:{r:{pointLabels:{font:{size:14}},ticks:{color:a,backdropColor:"transparent",afterBuildTicks:s=>{const l={Trips:1e6,"Travel Duration":1e4,"Travel Distance":5e3,"Accidents Avoided":100,"Risky Drivers":1e3,"Fair Drivers":1e3,"Excellent Drivers":1e3,"Vehicle Utilisation Loss":500,"Idling Loss":500,"Idling Duration":200,"Idling Duration Trip":200,"Idling Duration Outside Trip":200};s.ticks=s.ticks.map((c,d)=>{const u=l[s.chart.data.labels[d]];return c<=u?c:u})}},grid:{color:"#ebedef"},angleLines:{color:"#ebedef"}}}}}static \u0275fac=function(i){return new(i||n)};static \u0275cmp=e.Xpm({type:n,selectors:[["app-performance-summ-chart"]],inputs:{chartData:"chartData"},decls:1,vars:1,consts:[[3,"data","radarOptions",4,"ngIf"],[3,"data","radarOptions"]],template:function(i,a){1&i&&e.YNc(0,Fi,1,2,"app-radar-chart",0),2&i&&e.Q6J("ngIf",a.chartData)},dependencies:[v.O5,Ei]})}return n})();function Ni(n,r){if(1&n&&(e.TgZ(0,"div",10),e._UZ(1,"span",11),e.TgZ(2,"span",12),e._uU(3),e.qZA()()),2&n){const t=r.$implicit;e.xp6(1),e.Q6J("ngClass",t.icon),e.xp6(2),e.Oqu(t.name)}}function Ui(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div")(1,"div",6)(2,"span",7),e._uU(3),e.qZA(),e.TgZ(4,"p-selectButton",8),e.NdJ("ngModelChange",function(a){e.CHM(t);const o=e.oxw();return e.KtG(o.selected_indicators=a)})("onChange",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.toggleAllIndicators())}),e.YNc(5,Ni,4,2,"ng-template",9),e.qZA()()()}if(2&n){const t=r.$implicit,i=e.oxw();e.xp6(3),e.hij("",t.label,": "),e.xp6(1),e.Q6J("options",t.items)("ngModel",i.selected_indicators)("multiple",!0)}}function Ii(n,r){if(1&n&&e._UZ(0,"app-performance-summ-chart",13),2&n){const t=e.oxw();e.Q6J("chartData",t.chartData)}}let ki=(()=>{class n{utilservice;toolbarComponent;aggregatedFleetsData;ytdAggregatedFleetsData;showTable=!0;allDriverScoreCards=[];driverScorecardsForChartLabels=[];driverScorecardsForChartColors=[];driverScorecardsForChartValues=[];chartData;radarOptions;unit;chart;selected_indicators=[];indicators;defaultView="chart";viewOptions=[{icon:"pi pi-chart-pie",justify:"Center",value:"chart"},{icon:"pi pi-table",justify:"Center",value:"table"}];ngOnInit(){this.indicators=[{label:"Travel",items:[{name:"Trips",value:"trips",icon:"pi pi-car"},{name:"Travel Duration",value:"travel_duration",icon:"pi pi-clock"},{name:"Travel Distance",value:"travel_distance",icon:"pi pi-map-marker"},{name:"Accidents Avoided",value:"accidents_avoided",icon:"pi pi-exclamation-circle"}]},{label:"Drivers",items:[{name:"Risky Drivers",value:"risky_drivers",icon:"pi pi-exclamation-triangle"},{name:"Fair Drivers",value:"fair_drivers",icon:"pi pi-exclamation-circle"},{name:"Excellent Drivers",value:"excellent_drivers",icon:"pi pi-check-circle"}]},{label:"Loss",items:[{name:"Vehicle Utilisation Loss",value:"vehicle_utilisation_loss",icon:"pi pi-ban"},{name:"Idling Loss",value:"idling_loss",icon:"pi pi-pause"}]},{label:"Idling",items:[{name:"Idling Duration",value:"idling_duration",icon:"pi pi-pause"},{name:"Idling Duration Trip",value:"idling_duration_trip",icon:"pi pi-pause"},{name:"Idling Duration Outside Trip",value:"idling_duration_outside_trip",icon:"pi pi-pause"}]}],this.selected_indicators=["trips","travel_duration","idling_loss","idling_duration_outside_trip","risky_drivers"]}constructor(t){this.utilservice=t}ngAfterViewInit(){this.setPerformanceSummary()}setPerformanceSummary(){let t=this.aggregatedFleetsData,i=this.ytdAggregatedFleetsData;const a=this.utilservice.getCalculatedTimeRange(this.toolbarComponent);this.unit=a.unitName;const o=t,s=i;this.chartData={labels:this.getFormattedLabels(this.selected_indicators),datasets:[{label:"This "+this.unit,borderColor:m.mH[1],borderWidth:1,backgroundColor:this.utilservice.hexToRgba(m.mH[1],"0.1"),pointBackgroundColor:m.mH[1],pointBorderColor:m.mH[1],pointHoverBackgroundColor:m.mH[1],pointHoverBorderColor:m.mH[1],data:Object.values(this.getPerformanceValues(o))},{label:"Year To Date ",borderColor:m.mH[5],backgroundColor:this.utilservice.hexToRgba(m.mH[5],"0.1"),borderWidth:1,pointBackgroundColor:m.mH[5],pointBorderColor:m.mH[5],pointHoverBackgroundColor:m.mH[5],pointHoverBorderColor:m.mH[5],data:Object.values(this.getPerformanceValues(s))}]},this.radarOptions={}}getPerformanceObjects(t){const{travel_distance:i,travel_duration:a,phone_braking_count:o,distraction_braking_count:s,idling_duration:l,idling_loss:c}=t;return{travel_distance:i,travel_duration:a,phone_braking_count:o,distraction_braking_count:s,idling_duration:l,idling_loss:c}}getPerformanceValues(t){var i=[];return this.selected_indicators.forEach(a=>{"number"==typeof t[a]?i.push(t[a]):t[a]instanceof Array&&i.push(t[a][0])}),i}getFormattedLabels(t){let i=[];return t.forEach((a,o)=>{i.push(this.utilservice.formatLabelForCharts(a))}),i}linechart;initChart(){}toggleAllIndicators(){this.setPerformanceSummary()}static \u0275fac=function(i){return new(i||n)(e.Y36(h.FW))};static \u0275cmp=e.Xpm({type:n,selectors:[["app-performance-summary"]],inputs:{toolbarComponent:"toolbarComponent",aggregatedFleetsData:"aggregatedFleetsData",ytdAggregatedFleetsData:"ytdAggregatedFleetsData"},decls:8,vars:3,consts:[[1,"flex","align-items-center","justify-content-between","mb-3"],[1,"text-900","text-lg","font-semibold"],[1,"mt-3","mb-4"],["id","summar",1,"inline-block","ml-4","vertical-align-middle"],[4,"ngFor","ngForOf"],[3,"chartData",4,"ngIf"],[1,"flex","align-items-center","mt-1","mb-1","events"],[1,"group-label"],["optionValue","value","optionLabel","name",3,"options","ngModel","multiple","ngModelChange","onChange"],["pTemplate","item"],[1,"option-item"],[1,"p-button-icon","p-button-icon-left",3,"ngClass"],[1,"p-button-label-c"],[3,"chartData"]],template:function(i,a){1&i&&(e.TgZ(0,"div",0)(1,"div",1),e._uU(2),e.qZA(),e._UZ(3,"div"),e.qZA(),e.TgZ(4,"div",2)(5,"div",3),e.YNc(6,Ui,6,4,"div",4),e.qZA()(),e.YNc(7,Ii,1,1,"app-performance-summ-chart",5)),2&i&&(e.xp6(2),e.hij("Performance Summary (This ",a.unit," vs Year to Date)"),e.xp6(4),e.Q6J("ngForOf",a.indicators),e.xp6(1),e.Q6J("ngIf",a.chartData&&a.showTable))},dependencies:[v.mk,v.sg,v.O5,x.jx,D.JJ,D.On,M.UN,Oi],styles:["[_nghost-%COMP%]     #summar p-selectbutton .p-selectbutton .p-button{padding:5px 10px;margin:7px 5px 0;font-size:13px}.button-row[_ngcontent-%COMP%]{display:flex;justify-content:start;margin-bottom:10px}.group-label[_ngcontent-%COMP%]{min-width:40px;font-size:12px;margin-right:4px}"]})}return n})();function Mi(n,r){1&n&&e._UZ(0,"p-progressSpinner")}const Pi=function(n){return{"cursor-pointer":n}},Ji=function(n){return{"background-color":n}};function Li(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"li",18),e.NdJ("click",function(){const o=e.CHM(t).index,s=e.oxw().$implicit,l=e.oxw(3);return e.KtG(l.openDataHealthDevices(s.fleet_id,s.categories[o].title))}),e.TgZ(1,"span",19),e._UZ(2,"div",20),e.TgZ(3,"span",21),e._uU(4),e.qZA(),e.TgZ(5,"span",22),e._uU(6),e.qZA()()()}if(2&n){const t=r.$implicit,i=r.index,a=e.oxw().$implicit;e.Q6J("ngClass",e.VKq(5,Pi,t>0)),e.xp6(1),e.s9C("title",a.categories[i].title+": "+t),e.xp6(1),e.Q6J("ngStyle",e.VKq(7,Ji,null==a.categories[i]?null:a.categories[i].color)),e.xp6(2),e.hij("",null==a.categories[i]?null:a.categories[i].title," "),e.xp6(2),e.hij(" ",t," ")}}function Ri(n,r){if(1&n&&(e.TgZ(0,"div",6)(1,"div",7)(2,"div",8),e._uU(3),e.qZA(),e._UZ(4,"br"),e.TgZ(5,"div",9)(6,"div",10),e._UZ(7,"app-doughnut-chart",11),e.TgZ(8,"div",12)(9,"div",13),e._uU(10,"Total Devices: "),e.TgZ(11,"b"),e._uU(12),e.qZA()()()(),e.TgZ(13,"div",14)(14,"span",15),e._uU(15," Categories"),e.qZA(),e.TgZ(16,"ul",16),e.YNc(17,Li,7,9,"li",17),e.qZA()()()()()),2&n){const t=r.$implicit,i=e.oxw(3);e.xp6(3),e.Oqu(t.fleet_name),e.xp6(4),e.Q6J("labels",t.labels)("values",t.values)("height","140px")("pieOptions",i.pieOptions)("backgroundColor",i.backgroundColor),e.xp6(5),e.hij(" ",t.total_devices>0?t.total_devices:0,""),e.xp6(5),e.Q6J("ngForOf",t.values)}}function qi(n,r){if(1&n&&(e.TgZ(0,"p-dataView",3,4),e.YNc(2,Ri,18,8,"ng-template",5),e.qZA()),2&n){const t=e.oxw(2);e.Q6J("value",t.filteredDataForCharts)}}const Qi=function(){return[6,12]};function Hi(n,r){if(1&n){const t=e.EpF();e.ynx(0),e.YNc(1,qi,3,1,"p-dataView",1),e.TgZ(2,"p-paginator",2),e.NdJ("onPageChange",function(a){e.CHM(t);const o=e.oxw();return e.KtG(o.onPageChange(a))}),e.qZA(),e.BQk()}if(2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.filteredDataForCharts.length),e.xp6(1),e.Q6J("showCurrentPageReport",!0)("rows",t.rows)("rowsPerPageOptions",e.DdM(5,Qi))("totalRecords",t.totalRecords)}}let Yi=(()=>{class n{spinnerService;utilsService;toolbarComponent;dataHealth=[];filteredFleets=[];showCharts=!1;emitCategory=new e.vpe;constructor(t,i){this.spinnerService=t,this.utilsService=i}dataForCharts=[];filteredDataForCharts;legends=[{name:"Healthy",color:getComputedStyle(document.documentElement).getPropertyValue("--chart-color-2")},{name:"Obstruction",color:getComputedStyle(document.documentElement).getPropertyValue("--chart-color-5")},{name:"Blank Video",color:getComputedStyle(document.documentElement).getPropertyValue("--chart-color-1")},{name:"Low Quality Video",color:getComputedStyle(document.documentElement).getPropertyValue("--chart-color-4")},{name:"Excessive Duration",color:getComputedStyle(document.documentElement).getPropertyValue("--chart-color-3")}];pieOptions={plugins:{legend:{display:!1}}};backgroundColor=[getComputedStyle(document.documentElement).getPropertyValue("--chart-color-2"),getComputedStyle(document.documentElement).getPropertyValue("--chart-color-4"),getComputedStyle(document.documentElement).getPropertyValue("--chart-color-1"),getComputedStyle(document.documentElement).getPropertyValue("--chart-color-5"),getComputedStyle(document.documentElement).getPropertyValue("--chart-color-3")];page=0;rows=6;totalRecords=0;ngOnDestroy(){this.showCharts=!1,this.dataHealth=[],this.dataForCharts=[],this.filteredDataForCharts=[]}categoryBuckets={valid:[],obstruction:[],invalid:[],low_fps:[],long_video:[],unknown:[]};generateDataForChart(){this.dataForCharts=[],this.filteredDataForCharts=[],this.filteredFleets.forEach(i=>{let a=this.dataHealth.filter(p=>p.fleet_id===i.id_),o=a.filter(p=>!!(p.hasOwnProperty("driver_camera_status")&&"OBSTRUCTION"===p.driver_camera_status||p.hasOwnProperty("road_front_camera_status")&&"OBSTRUCTION"===p.road_front_camera_status)).length,s=a.filter(p=>!!(p.hasOwnProperty("driver_camera_status")&&"INVALID_VIDEO"===p.driver_camera_status||p.hasOwnProperty("road_front_camera_status")&&"INVALID_VIDEO"===p.road_front_camera_status)).length,l=a.filter(p=>!!(p.hasOwnProperty("driver_camera_status")&&"LOW_FPS"===p.driver_camera_status||p.hasOwnProperty("road_front_camera_status")&&"LOW_FPS"===p.road_front_camera_status)).length,c=a.filter(p=>!!(p.hasOwnProperty("driver_camera_status")&&"DURATION_ABOVE_120_SECONDS"===p.driver_camera_status||p.hasOwnProperty("road_front_camera_status")&&"DURATION_ABOVE_120_SECONDS"===p.road_front_camera_status)).length,d=a.length-o-s-l-c;this.dataForCharts.push({fleet_id:i.id_,fleet_name:i.name,total_devices:a.length,labels:["Healthy","Obstruction","Blank Video","Low Quality Video","Excessive Duration"],values:[d,o,s,l,c],categories:[{id_:"VALID_VIDEO",title:"Healthy",value:d,color:getComputedStyle(document.documentElement).getPropertyValue("--chart-color-2")},{id_:"OBSTRUCTION",title:"Obstruction",value:o,color:getComputedStyle(document.documentElement).getPropertyValue("--chart-color-4")},{id_:"INVALID_VIDEO",title:"Blank Video",value:s,color:getComputedStyle(document.documentElement).getPropertyValue("--chart-color-1")},{id_:"LOW_FPS",title:"Low Quality Video",value:l,color:getComputedStyle(document.documentElement).getPropertyValue("--chart-color-5")},{id_:"DURATION_ABOVE_120_SECONDS",title:"Excessive Duration",value:c,color:getComputedStyle(document.documentElement).getPropertyValue("--chart-color-3")}]})});let t=this.filteredFleets.map(i=>{const a=this.dataForCharts.find(o=>o.fleet_id===i.id_);return{...i,...a}});t=this.utilsService.convertFlatFleetsJsonToHierarchical(t),t.forEach(i=>this.accumulateFleetData(i)),t=this.utilsService.flattenFleetData(t),t.sort((i,a)=>a.total_devices-i.total_devices),this.removeUnselectedFleetsData(t),this.totalRecords=this.dataForCharts.length,this.onPageChange({page:this.page,rows:this.rows})}accumulateFleetData(t){return t.valid_video_count=t.valid_video_count||0,t.obstruction_count=t.obstruction_count||0,t.invalid_video_count=t.invalid_video_count||0,t.low_fps_count=t.low_fps_count||0,t.long_video_count=t.long_video_count||0,t.total_devices=t.total_devices||0,t.values||(t.values=[0,0,0,0,0]),t.categories.forEach(i=>{switch(i.id){case"VALID_VIDEO":t.valid_video_count+=i.value,t.values[0]+=i.value;break;case"OBSTRUCTION":t.obstruction_count+=i.value,t.values[1]+=i.value;break;case"INVALID_VIDEO":t.invalid_video_count+=i.value,t.values[2]+=i.value;break;case"LOW_FPS":t.low_fps_count+=i.value,t.values[3]+=i.value;break;case"DURATION_ABOVE_120_SECONDS":t.long_video_count+=i.value,t.values[4]+=i.value}}),t.children.forEach(i=>{const a=this.accumulateFleetData(i);t.valid_video_count+=a.valid_video_count,t.obstruction_count+=a.obstruction_count,t.invalid_video_count+=a.invalid_video_count,t.low_fps_count+=a.low_fps_count,t.long_video_count+=a.long_video_count,t.total_devices+=a.total_devices,t.values=t.values.map((o,s)=>o+a.values[s])}),t}removeUnselectedFleetsData(t){let i=m.dc();i&&(this.dataForCharts=t.filter(a=>i.includes(a.fleet_id)))}onPageChange(t){this.page=t.page,this.rows=t.rows;const i=this.page*this.rows;this.filteredDataForCharts=this.dataForCharts.slice(i,i+this.rows)}openDataHealthDevices(t,i){Number(i.value)<=0||this.emitCategory.emit({fleet_id:t,category_id:i})}ngOnChanges(t){t.dataHealth&&t.dataHealth.currentValue&&this.generateDataForChart()}static \u0275fac=function(i){return new(i||n)(e.Y36(h.V),e.Y36(h.FW))};static \u0275cmp=e.Xpm({type:n,selectors:[["app-data-health-report-chart"]],inputs:{toolbarComponent:"toolbarComponent",dataHealth:"dataHealth",filteredFleets:"filteredFleets",showCharts:"showCharts"},outputs:{emitCategory:"emitCategory"},features:[e.TTD],decls:2,vars:2,consts:[[4,"ngIf"],["layout","list",3,"value",4,"ngIf"],["currentPageReportTemplate","Showing {first} to {last} of {totalRecords} fleets",3,"showCurrentPageReport","rows","rowsPerPageOptions","totalRecords","onPageChange"],["layout","list",3,"value"],["dv",""],["pTemplate","listItem"],[1,"md:col-4","px-3","mb-4","border-none"],[1,"p-3","border-1","border-400"],[1,"text-xl"],[1,"grid","align-items-center"],[1,"col-12","md:col-5","text-center"],[3,"labels","values","height","pieOptions","backgroundColor"],[1,"text-center"],[1,"mt-3"],[1,"col-12","md:col-7"],[1,"font-bold"],[1,"list-none","px-0"],["class","my-2",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"my-2",3,"ngClass","click"],[3,"title"],[1,"legend-box",3,"ngStyle"],[1,"text-base","ml-1","w-10rem","inline-block"],[1,"text-base","ml-1","font-bold","inline-block","text-right","w-1rem"]],template:function(i,a){1&i&&(e.YNc(0,Mi,1,0,"p-progressSpinner",0),e.YNc(1,Hi,3,6,"ng-container",0)),2&i&&(e.Q6J("ngIf",!a.showCharts),e.xp6(1),e.Q6J("ngIf",a.showCharts))},dependencies:[v.mk,v.sg,v.O5,v.PC,x.jx,ge,P.D,te.VO,F.G],styles:["img[_ngcontent-%COMP%]{max-width:30px}.legend-box[_ngcontent-%COMP%]{height:12px;width:2rem;border:1px solid #ccc;display:inline-block;margin-right:4px}.legend-title[_ngcontent-%COMP%]{font-size:14px;font-weight:500;margin-right:10px}"]})}return n})();function Vi(n,r){1&n&&e._UZ(0,"p-progressSpinner")}function ji(n,r){1&n&&(e.TgZ(0,"tr")(1,"th",9),e._uU(2,"Fleet Name "),e._UZ(3,"p-sortIcon",10),e.qZA(),e.TgZ(4,"th",11),e._uU(5,"Total Devices "),e._UZ(6,"p-sortIcon",12),e.qZA(),e.TgZ(7,"th",13),e._uU(8,"Healthy "),e._UZ(9,"p-sortIcon",14),e.qZA(),e.TgZ(10,"th",15),e._uU(11,"Obstruction "),e._UZ(12,"p-sortIcon",16),e.qZA(),e.TgZ(13,"th",17),e._uU(14,"Blank Video "),e._UZ(15,"p-sortIcon",18),e.qZA(),e.TgZ(16,"th",19),e._uU(17,"Low Quality Video "),e._UZ(18,"p-sortIcon",20),e.qZA(),e.TgZ(19,"th",21),e._uU(20,"Excessive Duration "),e._UZ(21,"p-sortIcon",22),e.qZA(),e._UZ(22,"th"),e.qZA())}const Bi=function(n){return{"surface-50":n}},j=function(n){return{"cursor-pointer":n}};function $i(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"tr",23)(1,"td",24),e._uU(2),e.qZA(),e.TgZ(3,"td",25),e._uU(4),e.qZA(),e.TgZ(5,"td",26),e.NdJ("click",function(){const o=e.CHM(t).$implicit,s=e.oxw(2);return e.KtG(s.openDataHealthDevices(o.fleet_id,{id_:"VALID_VIDEO",value:o.valid_video_count}))}),e.TgZ(6,"p",23),e._uU(7),e.qZA()(),e.TgZ(8,"td",26),e.NdJ("click",function(){const o=e.CHM(t).$implicit,s=e.oxw(2);return e.KtG(s.openDataHealthDevices(o.fleet_id,{id_:"OBSTRUCTION",value:o.obstruction_count}))}),e.TgZ(9,"p",23),e._uU(10),e.qZA()(),e.TgZ(11,"td",26),e.NdJ("click",function(){const o=e.CHM(t).$implicit,s=e.oxw(2);return e.KtG(s.openDataHealthDevices(o.fleet_id,{id_:"INVALID_VIDEO",value:o.invalid_video_count}))}),e.TgZ(12,"p",23),e._uU(13),e.qZA()(),e.TgZ(14,"td",26),e.NdJ("click",function(){const o=e.CHM(t).$implicit,s=e.oxw(2);return e.KtG(s.openDataHealthDevices(o.fleet_id,{id_:"LOW_FPS",value:o.low_fps_count}))}),e.TgZ(15,"p",23),e._uU(16),e.qZA()(),e.TgZ(17,"td",26),e.NdJ("click",function(){const o=e.CHM(t).$implicit,s=e.oxw(2);return e.KtG(s.openDataHealthDevices(o.fleet_id,{id_:"DURATION_ABOVE_120_SECONDS",value:o.long_video_count}))}),e.TgZ(18,"p",23),e._uU(19),e.qZA()()()}if(2&n){const t=r.$implicit;e.Q6J("ngClass",e.VKq(13,Bi,r.rowIndex%2==0)),e.xp6(2),e.hij(" ",t.fleet_name," "),e.xp6(2),e.hij(" ",t.total_devices," "),e.xp6(2),e.Q6J("ngClass",e.VKq(15,j,t.valid_video_count>0)),e.xp6(1),e.hij(" ",t.valid_video_count,""),e.xp6(2),e.Q6J("ngClass",e.VKq(17,j,t.obstruction_count>0)),e.xp6(1),e.hij(" ",t.obstruction_count,""),e.xp6(2),e.Q6J("ngClass",e.VKq(19,j,t.invalid_video_count>0)),e.xp6(1),e.hij(" ",t.invalid_video_count,""),e.xp6(2),e.Q6J("ngClass",e.VKq(21,j,t.low_fps_count>0)),e.xp6(1),e.hij(" ",t.low_fps_count,""),e.xp6(2),e.Q6J("ngClass",e.VKq(23,j,t.long_video_count>0)),e.xp6(1),e.hij(" ",t.long_video_count,"")}}const Gi=function(){return{"min-height":"300px"}},Wi=function(){return[10,20]};function zi(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div",2)(1,"div",3),e._UZ(2,"p-toast"),e.TgZ(3,"p-table",4,5),e.YNc(5,ji,23,0,"ng-template",6),e.YNc(6,$i,20,25,"ng-template",7),e.qZA(),e.TgZ(7,"p-paginator",8),e.NdJ("onPageChange",function(a){e.CHM(t);const o=e.oxw();return e.KtG(o.onPageChange(a))}),e.qZA()()()}if(2&n){const t=e.oxw();e.xp6(3),e.Akn(e.DdM(11,Gi)),e.Q6J("value",t.filteredDataForTable)("autoLayout",!0)("scrollable",!0)("rowHover",!0)("lazy",!0),e.xp6(4),e.Q6J("showCurrentPageReport",!0)("rows",t.rows)("rowsPerPageOptions",e.DdM(12,Wi))("totalRecords",t.totalRecords)}}let Ki=(()=>{class n{spinnerService;utilsService;toolbarComponent;dataHealth=[];filteredFleets=[];showTable=!1;emitCategory=new e.vpe;constructor(t,i){this.spinnerService=t,this.utilsService=i}page=0;rows=10;totalRecords=0;dataForTable=[];filteredDataForTable=[];ngOnDestroy(){this.showTable=!1,this.dataHealth=[],this.dataForTable=[],this.filteredDataForTable=[]}generateDataForTable(){this.dataForTable=[],this.filteredFleets.forEach(a=>{let o=this.dataHealth.filter(u=>u.fleet_id===a.id_),s=o.filter(u=>"OBSTRUCTION"===u.driver_camera_status||"OBSTRUCTION"===u.road_front_camera_status).length,l=o.filter(u=>"INVALID_VIDEO"===u.driver_camera_status||"INVALID_VIDEO"===u.road_front_camera_status).length,c=o.filter(u=>"LOW_FPS"===u.driver_camera_status||"LOW_FPS"===u.road_front_camera_status).length,d=o.filter(u=>"DURATION_ABOVE_120_SECONDS"===u.driver_camera_status||"DURATION_ABOVE_120_SECONDS"===u.road_front_camera_status).length;this.dataForTable.push({fleet_id:a.id_,fleet_name:a.name,total_devices:o.length,valid_video_count:o.length-s-l-c-d,obstruction_count:s,invalid_video_count:l,low_fps_count:c,long_video_count:d})});let t=this.filteredFleets.map(a=>{const o=this.dataForTable.find(s=>s.fleet_id===a.id_);return{...a,...o}});t=this.utilsService.convertFlatFleetsJsonToHierarchical(t);const i=a=>{let o={total_devices:a.total_devices||0,valid_video_count:a.valid_video_count||0,obstruction_count:a.obstruction_count||0,invalid_video_count:a.invalid_video_count||0,low_fps_count:a.low_fps_count||0,long_video_count:a.long_video_count||0};return a.children&&a.children.length>0&&a.children.forEach(s=>{const l=i(s);o.total_devices+=l.total_devices,o.valid_video_count+=l.valid_video_count,o.obstruction_count+=l.obstruction_count,o.invalid_video_count+=l.invalid_video_count,o.low_fps_count+=l.low_fps_count,o.long_video_count+=l.long_video_count}),a.total_devices=o.total_devices,a.valid_video_count=o.valid_video_count,a.obstruction_count=o.obstruction_count,a.invalid_video_count=o.invalid_video_count,a.low_fps_count=o.low_fps_count,a.long_video_count=o.long_video_count,o};t.forEach(a=>{i(a)}),t=this.utilsService.flattenFleetData(t),t.sort((a,o)=>o.total_devices-a.total_devices),this.removeUnselectedFleetsData(t),this.totalRecords=this.dataForTable.length,this.onPageChange({page:this.page,rows:this.rows})}removeUnselectedFleetsData(t){let i=m.dc();i&&(this.dataForTable=t.filter(a=>i.includes(a.fleet_id)))}onPageChange(t){this.page=t.page,this.rows=t.rows;const i=this.page*this.rows;this.filteredDataForTable=this.dataForTable.slice(i,i+this.rows)}openDataHealthDevices(t,i){Number(i.value)<=0||this.emitCategory.emit({fleet_id:t,category_id:i.id_})}ngOnChanges(t){t.dataHealth&&t.dataHealth.currentValue&&this.generateDataForTable()}static \u0275fac=function(i){return new(i||n)(e.Y36(h.V),e.Y36(h.FW))};static \u0275cmp=e.Xpm({type:n,selectors:[["app-data-health-report-table"]],inputs:{toolbarComponent:"toolbarComponent",dataHealth:"dataHealth",filteredFleets:"filteredFleets",showTable:"showTable"},outputs:{emitCategory:"emitCategory"},features:[e._Bn([x.ez,x.YP]),e.TTD],decls:2,vars:2,consts:[[4,"ngIf"],["class","grid",4,"ngIf"],[1,"grid"],[1,"col-12"],["responsiveLayout","scroll","scrollHeight","500px","dataKey","id",3,"value","autoLayout","scrollable","rowHover","lazy"],["dt",""],["pTemplate","header"],["pTemplate","body"],["currentPageReportTemplate","Showing {first} to {last} of {totalRecords} fleets",3,"showCurrentPageReport","rows","rowsPerPageOptions","totalRecords","onPageChange"],["pSortableColumn","fleet_name"],["field","fleet_name"],["pSortableColumn","total_devices",1,"text-center"],["field","total_devices"],["pSortableColumn","valid_video_count",1,"text-center"],["field","valid_video_count"],["pSortableColumn","obstruction_count",1,"text-center"],["field","obstruction_count"],["pSortableColumn","invalid_video_count",1,"text-center"],["field","invalid_video_count"],["pSortableColumn","low_fps_count",1,"text-center"],["field","low_fps_count"],["pSortableColumn","long_video_count",1,"text-center"],["field","long_video_count"],[3,"ngClass"],[2,"width","20%","min-width","10rem"],[1,"text-center"],[1,"text-center",3,"click"]],template:function(i,a){1&i&&(e.YNc(0,Vi,1,0,"p-progressSpinner",0),e.YNc(1,zi,8,13,"div",1)),2&i&&(e.Q6J("ngIf",!a.showTable),e.xp6(1),e.Q6J("ngIf",a.showTable))},dependencies:[v.mk,v.O5,x.jx,T.iA,T.lQ,T.fz,ne.FN,P.D,F.G]})}return n})();function Xi(n,r){1&n&&e._UZ(0,"i"),2&n&&e.Tol(r.$implicit.icon)}function en(n,r){1&n&&e._UZ(0,"p-progressSpinner",13)}function tn(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"app-data-health-report-chart",16),e.NdJ("emitCategory",function(a){e.CHM(t);const o=e.oxw(2);return e.KtG(o.openDataHealthDevices(a))}),e.qZA()}if(2&n){const t=e.oxw(2);e.Q6J("toolbarComponent",t.toolbarComponent)("dataHealth",t.dataHealth)("filteredFleets",t.allFleetsData)("showCharts",!t.isLoading)}}function nn(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"app-data-health-report-table",17),e.NdJ("emitCategory",function(a){e.CHM(t);const o=e.oxw(2);return e.KtG(o.openDataHealthDevices(a))}),e.qZA()}if(2&n){const t=e.oxw(2);e.Q6J("toolbarComponent",t.toolbarComponent)("dataHealth",t.dataHealth)("filteredFleets",t.allFleetsData)("showTable",!t.isLoading)}}function an(n,r){if(1&n&&(e.ynx(0),e.YNc(1,tn,1,4,"app-data-health-report-chart",14),e.YNc(2,nn,1,4,"app-data-health-report-table",15),e.BQk()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",!t.showTable),e.xp6(1),e.Q6J("ngIf",t.showTable)}}function on(n,r){1&n&&(e.TgZ(0,"div",18),e._uU(1," No data available. "),e.qZA())}function rn(n,r){1&n&&(e.TgZ(0,"tr")(1,"th"),e._uU(2,"Device ID"),e.qZA(),e.TgZ(3,"th"),e._uU(4,"Last Reported"),e.qZA(),e.TgZ(5,"th"),e._uU(6,"Camera Type"),e.qZA()())}function sn(n,r){if(1&n&&(e.TgZ(0,"tr")(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td"),e._uU(6),e.qZA()()),2&n){const t=r.$implicit;e.xp6(2),e.hij("",t.client_device_id||t.device_id," "),e.xp6(2),e.hij("",t.last_snapshot_timestamp," "),e.xp6(2),e.Oqu(t.camera_type)}}function ln(n,r){if(1&n&&(e.TgZ(0,"div",19)(1,"div",20)(2,"p-table",21,22),e.YNc(4,rn,7,0,"ng-template",23),e.YNc(5,sn,7,3,"ng-template",24),e.qZA()()()),2&n){const t=e.oxw();e.xp6(2),e.Q6J("value",t.dialogData.devices)("autoLayout",!0)("scrollable",!0)("rowHover",!0)("virtualScroll",!0)("virtualScrollItemSize",40)("lazy",!0)}}const cn=function(n){return{"min-height":"300px",minHeight:n}},pn=function(){return{width:"980px"}};let Ne=(()=>{class n{eventService;deviceServices;utilsService;toolbarComponent;dataHealth=[];showTable=!1;isLoading=!0;defaultView="chart";viewOptions=[{icon:"pi pi-chart-pie",justify:"Center",value:"chart"},{icon:"pi pi-table",justify:"Center",value:"table"}];devices=[];fleets=[];searchFleetInput="";filteredFleets=[];filteredFleetsForTable=[];selectedFleetForSearch="";dataHealthSubs;deviceSubs;showDataHealthDevices=!1;allFleetsData=[];dialogData={name:"",devices:[]};categoryMapping={VALID_VIDEO:"Healthy",OBSTRUCTION:"Obstruction",INVALID_VIDEO:"Blank Video",LOW_FPS:"Low Quality Video",DURATION_ABOVE_120_SECONDS:"Excessive Duration"};constructor(t,i,a){this.eventService=t,this.deviceServices=i,this.utilsService=a}ngOnInit(){this.isLoading=!0,m.dc()&&(this.allFleetsData=sessionStorage.getItem("totalFleetData"),this.allFleetsData=JSON.parse(this.allFleetsData))}ngAfterViewInit(){this.getDevices()}getDevices(){this.isLoading=!0,this.deviceSubs&&this.deviceSubs.unsubscribe(),this.deviceSubs=this.deviceServices.getDevices().subscribe(t=>{this.devices=t,this.getDataHealth()},t=>{console.log(t),this.getDataHealth()})}getDataHealth(){this.dataHealthSubs&&this.dataHealthSubs.unsubscribe();let t=[],i=m.dc();for(let a=0;a<i.length;a++)t.push(i[a]),t=t.concat(this.utilsService.getChildFleets(i[a],this.utilsService.convertFlatFleetsJsonToHierarchical(this.allFleetsData)));t=t.filter((a,o,s)=>s.indexOf(a)===o),this.dataHealthSubs=this.eventService.getDataHealth(t).subscribe(a=>{this.dataHealth=a,this.dataHealth.forEach(o=>{o.client_device_id=this.devices.find(s=>s.id_===o.device_id)?.client_provided_id}),this.isLoading=!1},a=>{console.log(a),this.isLoading=!1},()=>{this.isLoading=!1})}ngOnDestroy(){this.deviceSubs&&this.deviceSubs.unsubscribe(),this.dataHealthSubs&&this.dataHealthSubs.unsubscribe()}searchFleet(t){this.selectedFleetForSearch=t.value?t.value.id_:void 0}changeView(){this.showTable="chart"!==this.defaultView}openDataHealthDevices(t){this.dialogData.devices=[],this.dialogData.name="";let i=this.utilsService.convertFlatFleetsJsonToHierarchical(this.allFleetsData),a=this.utilsService.getChildFleets(t.fleet_id,i),o=Object.keys(this.categoryMapping).find(s=>this.categoryMapping[s]===t.category_id);[t.fleet_id,...a].forEach(s=>{const l=this.dataHealth.filter(c=>c.fleet_id===s&&(c?.driver_camera_status===o||c?.road_front_camera_status===o));this.dialogData.devices.push(...l)}),this.dialogData.name=t.category_id,this.showDataHealthDevices=this.dialogData.devices.length>0,this.dialogData.devices.forEach(s=>{s.camera_type=s.hasOwnProperty("driver_camera_status")&&s.hasOwnProperty("road_front_camera_status")?"Driver, Road":s.hasOwnProperty("driver_camera_status")?"Driver":"Road"})}static \u0275fac=function(i){return new(i||n)(e.Y36(h.nC),e.Y36(h.Ih),e.Y36(h.FW))};static \u0275cmp=e.Xpm({type:n,selectors:[["app-data-health-report"]],inputs:{toolbarComponent:"toolbarComponent"},decls:16,vars:14,consts:[[1,"card",3,"ngStyle"],[1,"flex","align-items-center","justify-content-between","mb-2"],[1,"text-900","text-lg","font-semibold"],[1,"flex"],[1,"inline-block","ml-4","vertical-align-middle"],["optionLabel","icon","optionValue","value",3,"options","ngModel","onChange","ngModelChange"],["pTemplate",""],[1,"relative","pt-5"],["styleClass","mt-5",4,"ngIf"],[4,"ngIf","ngIfElse"],["emptyMessage",""],[1,"p-fluid","add-compound-modal",3,"visible","header","modal","visibleChange","onHide"],["pTemplate","content"],["styleClass","mt-5"],[3,"toolbarComponent","dataHealth","filteredFleets","showCharts","emitCategory",4,"ngIf"],[3,"toolbarComponent","dataHealth","filteredFleets","showTable","emitCategory",4,"ngIf"],[3,"toolbarComponent","dataHealth","filteredFleets","showCharts","emitCategory"],[3,"toolbarComponent","dataHealth","filteredFleets","showTable","emitCategory"],[1,"empty-message"],[1,"grid"],[1,"col-12"],["responsiveLayout","scroll","scrollHeight","500px","dataKey","id",3,"value","autoLayout","scrollable","rowHover","virtualScroll","virtualScrollItemSize","lazy"],["dt",""],["pTemplate","header"],["pTemplate","body"]],template:function(i,a){if(1&i&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2),e._uU(3,"Video Quality"),e.qZA(),e.TgZ(4,"div",3)(5,"div",4)(6,"p-selectButton",5),e.NdJ("onChange",function(){return a.changeView()})("ngModelChange",function(s){return a.defaultView=s}),e.YNc(7,Xi,1,2,"ng-template",6),e.qZA()()()(),e.TgZ(8,"div",7),e.YNc(9,en,1,0,"p-progressSpinner",8),e.qZA(),e.YNc(10,an,3,2,"ng-container",9),e.YNc(11,on,2,0,"ng-template",null,10,e.W1O),e.qZA(),e.TgZ(13,"p-dialog",11),e.NdJ("visibleChange",function(s){return a.showDataHealthDevices=s})("onHide",function(){return a.showDataHealthDevices=!1}),e._UZ(14,"br"),e.YNc(15,ln,6,7,"ng-template",12),e.qZA()),2&i){const o=e.MAs(12);e.Q6J("ngStyle",e.VKq(11,cn,a.filteredFleets.length>3?"650px":"auto")),e.xp6(6),e.Q6J("options",a.viewOptions)("ngModel",a.defaultView),e.xp6(3),e.Q6J("ngIf",a.isLoading),e.xp6(1),e.Q6J("ngIf",a.dataHealth.length)("ngIfElse",o),e.xp6(3),e.Akn(e.DdM(13,pn)),e.Q6J("visible",a.showDataHealthDevices)("header",a.dialogData.name)("modal",!0)}},dependencies:[v.O5,v.PC,x.jx,T.iA,ie.V,D.JJ,D.On,M.UN,F.G,Yi,Ki],styles:["[_nghost-%COMP%]  p-progressSpinner{position:absolute;top:50%;left:50%;z-index:1000}[_nghost-%COMP%]  .spinner-div{margin-top:50%}"]})}return n})();var un=g(3859),dn=g(676),_n=g(5700),X=g(8093);function mn(n,r){if(1&n&&(e.TgZ(0,"div",10),e._UZ(1,"p-checkbox",11),e.qZA()),2&n){const t=r.$implicit;e.xp6(1),e.Q6J("label",t)("value",t)}}function hn(n,r){if(1&n&&(e.TgZ(0,"div",12),e._UZ(1,"p-checkbox",13),e.qZA()),2&n){const t=r.$implicit;e.xp6(1),e.Q6J("label",t)("value",t)}}let gn=(()=>{class n{fb;messageService;exportForm;formats=["CSV","PDF"];reports=["Performance Summary","Driver Scorecard","Event Summary","Driver Coaching Report"];constructor(t,i){this.fb=t,this.messageService=i,this.exportForm=this.fb.group({format:["",D.kI.required],report:["",[D.kI.required]]})}exportData(){}startDownload(){}static \u0275fac=function(i){return new(i||n)(e.Y36(D.qu),e.Y36(x.ez))};static \u0275cmp=e.Xpm({type:n,selectors:[["app-export-data"]],features:[e._Bn([x.ez])],decls:12,vars:3,consts:[[1,"mt-1",3,"formGroup","ngSubmit"],[1,"p-4"],[1,"field"],["htmlFor","format",1,"text-900","text-l","font-semibold","mb-3","block"],["class","inline-block mr-4",4,"ngFor","ngForOf"],[1,"field","mt-4"],["htmlFor","report",1,"text-900","text-l","font-semibold","mb-3","block"],["class","my-3",4,"ngFor","ngForOf"],[1,"flex","mt-5"],["pButton","","pRipple","","label","Download",1,"mx-auto",3,"click"],[1,"inline-block","mr-4"],["name","format","formControlName","format",3,"label","value"],[1,"my-3"],["name","format","formControlName","report",3,"label","value"]],template:function(i,a){1&i&&(e.TgZ(0,"form",0),e.NdJ("ngSubmit",function(){return a.exportData()}),e.TgZ(1,"div",1)(2,"div",2)(3,"label",3),e._uU(4,"Select Format"),e.qZA(),e.YNc(5,mn,2,2,"div",4),e.qZA(),e.TgZ(6,"div",5)(7,"label",6),e._uU(8,"Select Report"),e.qZA(),e.YNc(9,hn,2,2,"div",7),e.qZA(),e.TgZ(10,"div",8)(11,"button",9),e.NdJ("click",function(){return a.startDownload()}),e.qZA()()()()),2&i&&(e.Q6J("formGroup",a.exportForm),e.xp6(5),e.Q6J("ngForOf",a.formats),e.xp6(4),e.Q6J("ngForOf",a.reports))},dependencies:[v.sg,L.Hq,q.H,D._Y,D.JJ,D.JL,D.sg,D.u,pe.XZ]})}return n})();function vn(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div",15)(1,"app-big-metrics-card",16),e.NdJ("click",function(){e.CHM(t);const a=e.oxw(2);return e.KtG(a.showDetails("opef"))}),e.ALo(2,"number"),e.ALo(3,"number"),e.qZA()()}if(2&n){const t=e.oxw(2);e.xp6(1),e.Q6J("metricsName","Opportunity Assessment")("showSpinner",t.aggregatedFleetsDataSpinner)("isPositiveChange",(null==t.aggregatedFleetsData?null:t.aggregatedFleetsData.oe_loss)>(null==t.prevAggregatedFleetsData?null:t.prevAggregatedFleetsData.oe_loss))("metricsNumber",t.orgCurrency+(t.aggregatedFleetsData.oe_loss<0?e.xi3(2,4,-t.aggregatedFleetsData.oe_loss,"1.0-0"):e.xi3(3,7,null==t.aggregatedFleetsData?null:t.aggregatedFleetsData.oe_loss,"1.0-0")))}}function fn(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div",15)(1,"app-big-metrics-card",17),e.NdJ("click",function(){e.CHM(t);const a=e.oxw(2);return e.KtG(a.showDetails("opli"))}),e.ALo(2,"number"),e.ALo(3,"number"),e.qZA()()}if(2&n){const t=e.oxw(2);e.xp6(1),e.Q6J("metricsName","Liability Assessment")("showSpinner",t.liabilityAssessmentDataSpinner)("isPositiveChange",(null==t.liabilityAssessmentData?null:t.liabilityAssessmentData.cumulative.liability_loss)>(null==t.liabilityAssessmentData?null:t.liabilityAssessmentData.prev_cumulative.liability_loss))("metricsNumber",t.orgCurrency+((null==t.liabilityAssessmentData||null==t.liabilityAssessmentData.cumulative?null:t.liabilityAssessmentData.cumulative.liability_loss)<0?e.xi3(2,4,-(null==t.liabilityAssessmentData.cumulative?null:t.liabilityAssessmentData.cumulative.liability_loss),"1.0-0"):e.xi3(3,7,null==t.liabilityAssessmentData||null==t.liabilityAssessmentData.cumulative?null:t.liabilityAssessmentData.cumulative.liability_loss,"1.0-0")))}}function bn(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div",18)(1,"app-big-metrics-card",19),e.NdJ("click",function(){e.CHM(t);const a=e.oxw(2);return e.KtG(a.showDetails("oppe"))}),e.ALo(2,"number"),e.qZA()()}if(2&n){const t=e.oxw(2);e.xp6(1),e.Q6J("metricsName","Driver Assessment Score")("showSpinner",t.driverScoreCardSpinner)("metricsNumber",t.driverAssessmentData?e.xi3(2,3,100*t.driverAssessmentData,"1.0-0")+"%":"N/A")}}function Cn(n,r){if(1&n&&(e.ynx(0),e.YNc(1,vn,4,10,"div",4),e.YNc(2,fn,4,10,"div",4),e.YNc(3,bn,3,6,"div",14),e.BQk()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.has1005Perm),e.xp6(1),e.Q6J("ngIf",t.has1010Perm),e.xp6(1),e.Q6J("ngIf",t.has1015Perm)}}function Dn(n,r){if(1&n){const t=e.EpF();e.ynx(0),e.TgZ(1,"div",20)(2,"app-small-metrics-card",21),e.NdJ("click",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.showDetails("fleets"))}),e.ALo(3,"number"),e.qZA()(),e.TgZ(4,"div",20)(5,"app-small-metrics-card",22),e.NdJ("click",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.showDetails("devices"))}),e.ALo(6,"number"),e.qZA()(),e.TgZ(7,"div",20)(8,"app-small-metrics-card",23),e.NdJ("click",function(){e.CHM(t);const a=e.oxw();return e.KtG((a.has1005Perm||a.has1010Perm||a.has1015Perm||a.has1025Perm||a.has1020Perm||a.has1030Perm)&&a.showDetails("drivers"))}),e.ALo(9,"number"),e.qZA()(),e.BQk()}if(2&n){const t=e.oxw();e.xp6(2),e.Q6J("metricsName","Fleets")("metricsNumber",e.lcZ(3,9,null==t.fleetSummary?null:t.fleetSummary.fleets))("showSpinner",t.fleetSummarySpinner),e.xp6(3),e.Q6J("metricsName","Devices")("metricsNumber",e.lcZ(6,11,null==t.fleetSummary||null==t.fleetSummary.devices?null:t.fleetSummary.devices[0]))("showSpinner",t.fleetSummarySpinner),e.xp6(3),e.Q6J("metricsName","Drivers")("metricsNumber",e.lcZ(9,13,null==t.fleetSummary?null:t.fleetSummary.drivers))("showSpinner",t.fleetSummarySpinner)}}function xn(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div",15)(1,"app-big-metrics-card",24),e.NdJ("click",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.gotoEvents("dms"))}),e.ALo(2,"number"),e.qZA()()}if(2&n){const t=e.oxw();e.xp6(1),e.Q6J("metricsName","Driver Facing Camera Events")("showSpinner",t.videosCountSpinner)("metricsNumber",t.videosCount.dmsCount?e.lcZ(2,3,t.videosCount.dmsCount):"0")}}function Tn(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div",15)(1,"app-big-metrics-card",25),e.NdJ("click",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.gotoEvents("adas"))}),e.ALo(2,"number"),e.qZA()()}if(2&n){const t=e.oxw();e.xp6(1),e.Q6J("metricsName","Road Facing Camera Events")("showSpinner",t.videosCountSpinner)("metricsNumber",t.videosCount.adasCount?e.lcZ(2,3,t.videosCount.adasCount):"0")}}function yn(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div",15)(1,"app-big-metrics-card",26),e.NdJ("click",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.gotoEvents("compound"))}),e.ALo(2,"number"),e.qZA()()}if(2&n){const t=e.oxw();e.xp6(1),e.Q6J("metricsName","Compound Events")("showSpinner",t.videosCountSpinner)("metricsNumber",t.videosCount.compoundCount?e.lcZ(2,3,t.videosCount.compoundCount):"0")}}function Sn(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div",27),e.NdJ("click",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.gotoDrivers("risky"))}),e._UZ(1,"app-big-metrics-card",28),e.qZA()}if(2&n){const t=e.oxw();e.xp6(1),e.Q6J("metricsName","Risky Drivers")("metricsNumber",t.riskyDrivers.length)("showSpinner",t.driverCoachingSpinner)}}function wn(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div",27),e.NdJ("click",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.gotoDrivers("fair"))}),e._UZ(1,"app-big-metrics-card",29),e.qZA()}if(2&n){const t=e.oxw();e.xp6(1),e.Q6J("metricsName","Fair Drivers")("metricsNumber",t.fairDrivers.length)("showSpinner",t.driverCoachingSpinner)}}function Zn(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div",27),e.NdJ("click",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.gotoDrivers("excellent"))}),e._UZ(1,"app-big-metrics-card",30),e.qZA()}if(2&n){const t=e.oxw();e.xp6(1),e.Q6J("metricsName","Excellent Drivers")("metricsNumber",t.excellentDrivers.length)("showSpinner",t.driverCoachingSpinner)}}function An(n,r){if(1&n&&e._UZ(0,"app-driver-coaching-report",33),2&n){const t=e.oxw(2);e.Q6J("toolbarComponent",t.toolbarComponent)("compoundEventNames",t.compoundEventNames)("eventLabelMapping",t.eventLabelMapping)}}function En(n,r){if(1&n&&(e.TgZ(0,"div",31),e.YNc(1,An,1,3,"app-driver-coaching-report",32),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.toolbarComponent)}}function Fn(n,r){if(1&n&&e._UZ(0,"app-driver-scorecard",36),2&n){const t=e.oxw(2);e.Q6J("toolbarComponent",t.toolbarComponent)("eventsFromToolbar",t.eventsFromToolbar)}}function On(n,r){if(1&n&&(e.TgZ(0,"div",34),e.YNc(1,Fn,1,2,"app-driver-scorecard",35),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.toolbarComponent)}}function Nn(n,r){if(1&n&&e._UZ(0,"app-event-analysis-report",38),2&n){const t=e.oxw(2);e.Q6J("toolbarComponent",t.toolbarComponent)}}function Un(n,r){if(1&n&&(e.TgZ(0,"div",37),e.YNc(1,Nn,1,1,"app-event-analysis-report",11),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.toolbarComponent)}}function In(n,r){if(1&n&&e._UZ(0,"app-data-health-report",38),2&n){const t=e.oxw();e.Q6J("toolbarComponent",t.toolbarComponent)}}let kn=(()=>{class n{utilservice;driverService;fleetsService;layoutService;router;route;store;driverAnalyticsService;driversService;rolesService;authenticationService;toolbarComponent;driverCoachingComponent;driverScorecardComponent;eventAnalysisReport;performanceSummary;dataHealthReport;unsubscribe$=new Le.x;fromDate;toDate;selectedTimeRange;thisSummary;detailsDialogVisible=!1;fleetSummary;aggregatedFleetsData;prevAggregatedFleetsData;ytdAggregatedFleetsData;liabilityAssessmentData;driverAssessmentData={};exportDialogVisible=!1;fleets=[];subscription;orgSettings$;orgSettingsObj;paginationObj={items_per_page:1e8,page_number:1};orgCurrency;has1005Perm=!1;has1010Perm=!1;has1015Perm=!1;has1025Perm=!1;has1020Perm=!1;has1030Perm=!1;has1040Perm=!1;forkJoinSubscription;constructor(t,i,a,o,s,l,c,d,p,u,_){this.utilservice=t,this.driverService=i,this.fleetsService=a,this.layoutService=o,this.router=s,this.route=l,this.store=c,this.driverAnalyticsService=d,this.driversService=p,this.rolesService=u,this.authenticationService=_,this.subscription=this.layoutService.configUpdate$.subscribe(()=>{})}afterToolLoaded(){this.has1005Perm=this.rolesService.hasAccess(["1005"]),this.has1010Perm=this.rolesService.hasAccess(["1010"]),this.has1015Perm=this.rolesService.hasAccess(["1015"]),this.has1025Perm=this.rolesService.hasAccess(["1025"]),this.has1020Perm=this.rolesService.hasAccess(["1020"]),this.has1030Perm=this.rolesService.hasAccess(["1030"]),this.has1040Perm=this.rolesService.hasAccess(["1040"]),this.store.dispatch((0,qe.J$)()),this.checkRole(),this.store.select(he.pn).pipe((0,Re.R)(this.unsubscribe$)).subscribe(t=>{this.orgSettingsObj=t,this.initDates(),this.getFleetsCount(),(this.has1005Perm||this.has1010Perm||this.has1015Perm||this.has1025Perm||this.has1020Perm||this.has1030Perm)&&(this.getFleetsAggregation(),this.getDriverScorecard(),this.getEventsSummary())}),this.orgCurrency=this.utilservice.getOrgCurrency()}aggregatedFleetsDataSpinner=!1;liabilityAssessmentDataSpinner=!1;getFleetsAggregation(){this.aggregatedFleetsDataSpinner=!0,this.liabilityAssessmentDataSpinner=!0;var t=m.Y5();this.fleetsService.getFleetsPerformance(this.toolbarComponent?.fromDateUTC,this.toolbarComponent?.toDateUTC,t.filter_fleet_ids).subscribe(i=>{this.aggregatedFleetsData=i.cumulative,this.prevAggregatedFleetsData=i.prev_cumulative,this.ytdAggregatedFleetsData=i.ytd,this.aggregatedFleetsDataSpinner=!1},i=>{console.log(i),this.aggregatedFleetsDataSpinner=!1}),this.fleetsService.getLiabilityAssessment(this.toolbarComponent?.fromDateUTC,this.toolbarComponent?.toDateUTC,t.filter_fleet_ids).subscribe(i=>{this.liabilityAssessmentData=i,this.liabilityAssessmentDataSpinner=!1},i=>{console.log(i),this.liabilityAssessmentDataSpinner=!1})}updateConvertedValues(){this.aggregatedFleetsDataSpinner=!0,this.liabilityAssessmentDataSpinner=!0,this.store.select(he.bA).subscribe(t=>{const i=localStorage.getItem("conversionRateFactor");if(i){const a=parseFloat(i);this.aggregatedFleetsData&&(this.aggregatedFleetsData.oe_loss*=a),this.prevAggregatedFleetsData&&(this.prevAggregatedFleetsData.oe_loss*=a),this.ytdAggregatedFleetsData&&(this.ytdAggregatedFleetsData.oe_loss*=a),this.liabilityAssessmentData&&(this.liabilityAssessmentData.cumulative&&(this.liabilityAssessmentData.cumulative.liability_loss*=a),this.liabilityAssessmentData.prev_cumulative&&(this.liabilityAssessmentData.prev_cumulative.liability_loss*=a),this.liabilityAssessmentData.ytd&&(this.liabilityAssessmentData.ytd.liability_loss*=a))}this.aggregatedFleetsDataSpinner=!1,this.liabilityAssessmentDataSpinner=!1},t=>{console.log(t),this.aggregatedFleetsDataSpinner=!1,this.liabilityAssessmentDataSpinner=!1})}showDetails(t){switch(t){case"opef":this.router.navigate(["operational-efficiency"],{relativeTo:this.route});break;case"opli":this.router.navigate(["operational-liability"],{relativeTo:this.route});break;case"oppe":this.router.navigate(["operational-performance"],{relativeTo:this.route});break;case"fleets":this.router.navigate(["../admin"],{relativeTo:this.route});break;case"devices":this.router.navigate(["../admin/devices"],{relativeTo:this.route});break;case"drivers":this.router.navigate(["../driver-analytics"],{relativeTo:this.route})}this.detailsDialogVisible=!0}goToDriverAnalytics(){this.router.navigate(["../driver-analytics"],{relativeTo:this.route})}fleetSummarySpinner=!1;getFleetsCount(){this.fleetSummarySpinner=!0,this.fleetsService.getFleetSummary(m.dc()).subscribe(t=>{this.fleetSummary=t,this.fleetSummarySpinner=!1},t=>{console.log(t),this.fleetSummarySpinner=!1})}setSummaryDetails(t){const a=this.utilservice.getCalculatedTimeRange(this.toolbarComponent).actualTimeRangeToDisplay;this.thisSummary=this.utilservice.getFilteredFleetsForSelectedFleet(t,a).thisTimeRangeData}showExportDialog(){this.exportDialogVisible=!0}adasEvents=[];dmsEvents=[];compoundEvents=[];videosCount=[];videosCountSpinner=!1;compoundEventNames=[];eventLabelMapping;eventsFromToolbar=[];getEventsSummary(){var t=m.Y5();this.compoundEventNames=this.toolbarComponent?.allEvents.compound_events.map(a=>a.name),this.eventLabelMapping=this.utilservice.getEventDefaultLabelMapping(this.toolbarComponent?.allEvents);const i=this.utilservice.getEventNamesFromEventsArray(this.toolbarComponent?.allEvents);this.eventsFromToolbar=this.toolbarComponent?.allEvents,this.videosCountSpinner=!0,this.fleetsService.getFleetsAggregation(this.toolbarComponent?.fromDateUTC,this.toolbarComponent.toDateUTC,t.filter_fleet_ids,i).subscribe(a=>{this.calculateAdasAndDms(a.cumulative.total_events),this.videosCountSpinner=!1},a=>{console.log(a),this.videosCountSpinner=!1})}calculateAdasAndDms(t){const i=this.toolbarComponent.events,a=this.toolbarComponent.selectedEvents;this.adasEvents=[],this.dmsEvents=[],this.compoundEvents=[],i?.forEach(o=>{"adas"===o.label?o.items.forEach(s=>{a.indexOf(s.value)>-1&&this.adasEvents.push(s.value)}):"dms"===o.label?o.items.forEach(s=>{a.indexOf(s.value)>-1&&this.dmsEvents.push(s.value)}):"compound"===o.label&&o.items.forEach(s=>{a.indexOf(s.value)>-1&&s.value in m.uZ&&this.compoundEvents.push(s.value)})}),this.videosCount.adasCount=0,this.videosCount.dmsCount=0,this.videosCount.compoundCount=0,Object.keys(t).forEach(o=>{this.adasEvents.includes(o)&&(this.videosCount.adasCount=this.videosCount.adasCount+t[o][0]),this.dmsEvents.includes(o)&&(this.videosCount.dmsCount=this.videosCount.dmsCount+t[o][0]),this.compoundEvents.includes(o)&&(this.videosCount.compoundCount=this.videosCount.compoundCount+t[o][0])})}drivers=[];riskyDrivers=[];fairDrivers=[];excellentDrivers=[];driverCoachingSpinner=!1;driverScoreCardSpinner=!1;getDriverScorecard(){this.driverScoreCardSpinner=!0,this.driverCoachingSpinner=!0;var t=m.dc();const i=this.driverService.getDriverScorecardFetch(this.toolbarComponent.fromDateUTC,this.toolbarComponent.toDateUTC,t,this.paginationObj),a=this.driversService.fetchDrivers(this.toolbarComponent.fromDateUTC,this.toolbarComponent.toDateUTC,t,void 0,this.paginationObj),o=this.driverAnalyticsService.getDriverCoachingReportForDriver(this.toolbarComponent.fromDateUTC,this.toolbarComponent.toDateUTC,t,this.paginationObj),s=this.driverAnalyticsService.getDriverTripReport(this.toolbarComponent.fromDateUTC,this.toolbarComponent.toDateUTC,t,this.paginationObj);this.forkJoinSubscription=(0,J.D)([i,a,o,s]).subscribe(l=>{let c=l[0].data.sort((p,u)=>p.score>u.score?1:-1);const d=new Map;l[1].data.forEach(p=>{d.set(p.id_,{...p})}),c.forEach(p=>{const u=d.get(p.driver_id);u&&Object.assign(u,p)}),l[2].data.forEach(p=>{const u=d.get(p.driver_id);u&&Object.assign(u,p)}),l[3].data.forEach(p=>{const u=d.get(p.driver_id);u&&Object.assign(u,p)}),c=Array.from(d.values()),this.riskyDrivers=[],this.fairDrivers=[],this.excellentDrivers=[],c.filter(p=>{"risky"===p.category?.toLowerCase()&&this.riskyDrivers.push(p),"fair"===p.category?.toLowerCase()&&this.fairDrivers.push(p),"excellent"===p.category?.toLowerCase()&&this.excellentDrivers.push(p)}),this.driverAssessmentData=(this.fairDrivers.length+this.excellentDrivers.length)/(this.fairDrivers.length+this.excellentDrivers.length+this.riskyDrivers.length),this.driverScoreCardSpinner=!1,this.driverCoachingSpinner=!1},l=>{this.driverScoreCardSpinner=!1,this.driverCoachingSpinner=!1})}gotoEvents(t){const i=window.location.origin+"/#/event-report?filter="+t;window.open(i,"_blank")}gotoDrivers(t){const i=window.location.origin+"/#/driver-analytics?category="+t;window.open(i,"_blank")}initDates(){this.fromDate=this.toolbarComponent?.fromDateUTC,this.toDate=this.toolbarComponent?.toDateUTC,this.selectedTimeRange=this.toolbarComponent?.selectedTimeRange}filterData(){this.afterToolLoaded(),this.driverCoachingComponent?.ngAfterViewInit(),this.driverScorecardComponent?.ngAfterViewInit(),this.eventAnalysisReport?.ngAfterViewInit(),this.dataHealthReport?.ngAfterViewInit()}checkRole(){let i=["ET_SUPER_ADMIN","CLIENT_SUPER_ADMIN","CLIENT_ADMIN","FLEET_MANAGER","VIEWER","DEVICE_OPS"];this.authenticationService.userValue.roles.some(o=>!i.includes(o))&&this.router.navigate(["/event-report"])}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe(),this.unsubscribe$.next(),this.unsubscribe$.complete(),this.forkJoinSubscription&&this.forkJoinSubscription.unsubscribe()}static \u0275fac=function(i){return new(i||n)(e.Y36(h.FW),e.Y36(h.$H),e.Y36(h.VN),e.Y36(un.P),e.Y36(U.F0),e.Y36(U.gz),e.Y36(dn.yh),e.Y36(h.NZ),e.Y36(h.Ft),e.Y36(h.Nj),e.Y36(h.$h))};static \u0275cmp=e.Xpm({type:n,selectors:[["ng-component"]],viewQuery:function(i,a){if(1&i&&(e.Gf(I.n,5),e.Gf(be,5),e.Gf(Fe,5),e.Gf(Oe,5),e.Gf(ki,5),e.Gf(Ne,5)),2&i){let o;e.iGM(o=e.CRH())&&(a.toolbarComponent=o.first),e.iGM(o=e.CRH())&&(a.driverCoachingComponent=o.first),e.iGM(o=e.CRH())&&(a.driverScorecardComponent=o.first),e.iGM(o=e.CRH())&&(a.eventAnalysisReport=o.first),e.iGM(o=e.CRH())&&(a.performanceSummary=o.first),e.iGM(o=e.CRH())&&(a.dataHealthReport=o.first)}},decls:22,vars:16,consts:[[3,"showEvents","export","filterData","loaded"],[1,"grid","mt-2"],[1,"col-12"],[4,"ngIf"],["class","cursor-pointer inline-block",4,"ngIf"],["class","cursor-pointer inline-block",3,"click",4,"ngIf"],[1,"grid"],["class","col-12 mt-2",4,"ngIf"],["class","col-12 md:col-5 xl:col-5 mt-1",4,"ngIf"],["class","col-12 md:col-7 mt-1",4,"ngIf"],[1,"col-12","md:col-12","mt-1"],[3,"toolbarComponent",4,"ngIf"],[1,"mb-5"],["header","Export","styleClass","mx-3 sm:mx-0 sm:w-full md:w-2 lg:w-2","contentStyleClass","border-round-bottom border-top-1 surface-border p-0",3,"visible","closable","modal","visibleChange","onHide"],["class","cursor-pointer inline-block relative",4,"ngIf"],[1,"cursor-pointer","inline-block"],["title","Navigate to Opportunity Assessment Report",3,"metricsName","showSpinner","isPositiveChange","metricsNumber","click"],["title","Navigate to Liability Assessment Report",3,"metricsName","showSpinner","isPositiveChange","metricsNumber","click"],[1,"cursor-pointer","inline-block","relative"],["title","Navigate to Driver Assessment Report",3,"metricsName","showSpinner","metricsNumber","click"],[1,"inline-block","cursor-pointer"],["title","Navigate to Fleets",3,"metricsName","metricsNumber","showSpinner","click"],["title","Navigate to Devices",3,"metricsName","metricsNumber","showSpinner","click"],["title","Navigate to Drivers",3,"metricsName","metricsNumber","showSpinner","click"],["title","Navigate to Driver Facing Camera Events",3,"metricsName","showSpinner","metricsNumber","click"],["title","Navigate to Road Facing Camera Events",3,"metricsName","showSpinner","metricsNumber","click"],["title","Navigate to Compound Events",3,"metricsName","showSpinner","metricsNumber","click"],[1,"cursor-pointer","inline-block",3,"click"],["title","Navigate to Risky Drivers",3,"metricsName","metricsNumber","showSpinner"],["title","Navigate to Fair Drivers",3,"metricsName","metricsNumber","showSpinner"],["title","Navigate to Excellent Drivers",3,"metricsName","metricsNumber","showSpinner"],[1,"col-12","mt-2"],[3,"toolbarComponent","compoundEventNames","eventLabelMapping",4,"ngIf"],[3,"toolbarComponent","compoundEventNames","eventLabelMapping"],[1,"col-12","md:col-5","xl:col-5","mt-1"],[3,"toolbarComponent","eventsFromToolbar",4,"ngIf"],[3,"toolbarComponent","eventsFromToolbar"],[1,"col-12","md:col-7","mt-1"],[3,"toolbarComponent"]],template:function(i,a){1&i&&(e.TgZ(0,"app-toolbar",0),e.NdJ("export",function(){return a.showExportDialog()})("filterData",function(){return a.filterData()})("loaded",function(){return a.afterToolLoaded()}),e.qZA(),e.TgZ(1,"div",1)(2,"div",2),e.YNc(3,Cn,4,3,"ng-container",3),e.YNc(4,Dn,10,15,"ng-container",3),e.qZA(),e.TgZ(5,"div",2),e.YNc(6,xn,3,5,"div",4),e.YNc(7,Tn,3,5,"div",4),e.YNc(8,yn,3,5,"div",4),e.YNc(9,Sn,2,3,"div",5),e.YNc(10,wn,2,3,"div",5),e.YNc(11,Zn,2,3,"div",5),e.qZA()(),e.TgZ(12,"div",6),e.YNc(13,En,2,1,"div",7),e.YNc(14,On,2,1,"div",8),e.YNc(15,Un,2,1,"div",9),e.TgZ(16,"div",10),e.YNc(17,In,1,1,"app-data-health-report",11),e.qZA(),e.TgZ(18,"div",12),e._uU(19,"\xa0"),e.qZA()(),e.TgZ(20,"p-dialog",13),e.NdJ("visibleChange",function(s){return a.exportDialogVisible=s})("onHide",function(){return a.exportDialogVisible=!1}),e._UZ(21,"app-export-data"),e.qZA()),2&i&&(e.Q6J("showEvents",!1),e.xp6(3),e.Q6J("ngIf",a.aggregatedFleetsData&&a.prevAggregatedFleetsData),e.xp6(1),e.Q6J("ngIf",a.has1040Perm),e.xp6(2),e.Q6J("ngIf",a.has1005Perm),e.xp6(1),e.Q6J("ngIf",a.has1010Perm),e.xp6(1),e.Q6J("ngIf",a.has1010Perm),e.xp6(1),e.Q6J("ngIf",a.has1015Perm),e.xp6(1),e.Q6J("ngIf",a.has1015Perm),e.xp6(1),e.Q6J("ngIf",a.has1015Perm),e.xp6(2),e.Q6J("ngIf",a.has1025Perm),e.xp6(1),e.Q6J("ngIf",a.has1020Perm),e.xp6(1),e.Q6J("ngIf",a.has1030Perm),e.xp6(2),e.Q6J("ngIf",a.toolbarComponent),e.xp6(3),e.Q6J("visible",a.exportDialogVisible)("closable",!0)("modal",!0))},dependencies:[v.O5,_n.E,X.c,ie.V,I.n,be,gn,Fe,Oe,Ne,v.JJ],styles:["[_nghost-%COMP%]     app-big-metrics-card .card{min-width:180px!important}"]})}return n})();var Mn=g(2572);let Pn=(()=>{class n{el;constructor(t){this.el=t}onKeyDown(t){"-"===t.key&&0===this.el.nativeElement.selectionStart&&-1===this.el.nativeElement.value.indexOf("-")&&setTimeout(()=>{this.el.nativeElement.setSelectionRange(1,1)})}onPaste(t){const a=(t.clipboardData||window.clipboardData).getData("text"),o=this.el.nativeElement.selectionStart;a.startsWith("-")&&0===o&&-1===this.el.nativeElement.value.indexOf("-")&&setTimeout(()=>{this.el.nativeElement.setSelectionRange(1,1)})}static \u0275fac=function(i){return new(i||n)(e.Y36(e.SBq))};static \u0275dir=e.lG2({type:n,selectors:[["","numberSuffix",""]],hostBindings:function(i,a){1&i&&e.NdJ("keydown",function(s){return a.onKeyDown(s)})("paste",function(s){return a.onPaste(s)})}})}return n})();function Jn(n,r){if(1&n&&(e.TgZ(0,"div",3),e._UZ(1,"app-big-metrics-card",31),e.ALo(2,"number"),e.ALo(3,"number"),e._UZ(4,"app-big-metrics-card",32),e.ALo(5,"number"),e.ALo(6,"number"),e._UZ(7,"app-big-metrics-card",32),e.ALo(8,"number"),e.ALo(9,"number"),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("metricsName","Current Period Selected")("isPositiveChange",t.aggregatedFleetData.oe_loss>t.prevAggregatedFleetData.oe_loss)("metricsNumber",t.orgCurrency+(t.aggregatedFleetData.oe_loss<0?"("+e.xi3(2,7,-t.aggregatedFleetData.oe_loss,"1.0-0")+")":e.xi3(3,10,t.aggregatedFleetData.oe_loss,"1.0-0"))),e.xp6(3),e.Q6J("metricsName","Same Time Last Period")("metricsNumber",t.orgCurrency+(t.prevAggregatedFleetData.oe_loss<0?"("+e.xi3(5,13,-t.prevAggregatedFleetData.oe_loss,"1.0-0")+")":e.xi3(6,16,t.prevAggregatedFleetData.oe_loss,"1.0-0"))),e.xp6(3),e.Q6J("metricsName","Year To Date Value")("metricsNumber",t.orgCurrency+(t.ytdAggregatedFleetData.oe_loss<0?"("+e.xi3(8,19,-t.ytdAggregatedFleetData.oe_loss,"1.0-0")+")":e.xi3(9,22,t.ytdAggregatedFleetData.oe_loss,"1.0-0")))}}function Ln(n,r){1&n&&e._UZ(0,"p-progressSpinner",33)}function Rn(n,r){if(1&n&&e._UZ(0,"app-line-chart",34),2&n){const t=e.oxw();e.Q6J("data",t.barData)("height",500)("YTitle",t.y_title)}}function qn(n,r){1&n&&e._UZ(0,"p-progressSpinner",33)}function Qn(n,r){if(1&n&&(e.TgZ(0,"tr"),e._UZ(1,"th",38),e.TgZ(2,"th",39),e._uU(3),e.qZA(),e.TgZ(4,"th",40),e._uU(5),e.qZA(),e.TgZ(6,"th",41),e._uU(7,"Baseline"),e.qZA()(),e.TgZ(8,"tr")(9,"th",42),e._uU(10,"Vehicle Type"),e.qZA(),e.TgZ(11,"th",43),e._uU(12," Count"),e.qZA(),e.TgZ(13,"th",44),e._uU(14),e.qZA(),e.TgZ(15,"th",44),e._uU(16),e.qZA(),e.TgZ(17,"th",45),e._uU(18," Count"),e.qZA(),e.TgZ(19,"th",46),e._uU(20),e.qZA(),e.TgZ(21,"th",46),e._uU(22),e.qZA(),e.TgZ(23,"th",38),e._uU(24),e.qZA(),e.TgZ(25,"th",38),e._uU(26),e.qZA()()),2&n){const t=e.oxw(2);e.xp6(3),e.hij(" Current Period ",t.eventData[0]?"("+t.eventData[0].day+" days)":""," "),e.xp6(2),e.hij(" Previous Period ",t.eventData[0]?"("+t.eventData[0].past_day+" days)":"",""),e.xp6(9),e.hij("Distance (",t.distance_units,")"),e.xp6(2),e.hij("Avg Utilization (",t.distance_units,")"),e.xp6(4),e.hij("Distance (",t.distance_units,")"),e.xp6(2),e.hij("Avg Utilization (",t.distance_units,")"),e.xp6(2),e.hij("Revenue per ",t.distance_units," "),e.xp6(2),e.hij("Optimum Utilization (",t.distance_units,") ")}}const N=function(n){return{"font-bold text-lg":n}};function Hn(n,r){if(1&n&&(e.TgZ(0,"span",47),e._uU(1),e.ALo(2,"number"),e.qZA()),2&n){const t=e.oxw(2).$implicit;e.Q6J("ngClass",e.VKq(6,N,""!==t.unit)),e.xp6(1),e.AsE(" ",t.unit,"",e.xi3(2,3,t.currentTimePeriodUT,"1.0-1")," ")}}function Yn(n,r){if(1&n&&(e.TgZ(0,"span",47),e._uU(1),e.ALo(2,"number"),e.qZA()),2&n){const t=e.oxw(2).$implicit;e.Q6J("ngClass",e.VKq(6,N,""!==t.unit)),e.xp6(1),e.AsE(" ",t.unit,"",e.xi3(2,3,t.previousTimePeriodUT,"1.0-1")," ")}}function Vn(n,r){if(1&n&&(e.ynx(0),e.TgZ(1,"td",44)(2,"span",47),e._uU(3),e.ALo(4,"number"),e.qZA()(),e.TgZ(5,"td",44),e.YNc(6,Hn,3,8,"span",54),e.qZA(),e.TgZ(7,"td",46),e._uU(8),e.qZA(),e.TgZ(9,"td",46)(10,"span",47),e._uU(11),e.ALo(12,"number"),e.qZA()(),e.TgZ(13,"td",46),e.YNc(14,Yn,3,8,"span",54),e.qZA(),e.BQk()),2&n){const t=e.oxw().$implicit;e.xp6(2),e.Q6J("ngClass",e.VKq(15,N,""!==t.unit)),e.xp6(1),e.AsE(" ",t.unit,"",e.xi3(4,9,t.currentTimePeriod,"1.0-0")," "),e.xp6(3),e.Q6J("ngIf",t.currentTimePeriodUT),e.xp6(2),e.hij(" ",t.lastCount," "),e.xp6(2),e.Q6J("ngClass",e.VKq(17,N,""!==t.unit)),e.xp6(1),e.AsE(" ",t.unit,"",e.xi3(12,12,t.previousTimePeriod,"1.0-0")," "),e.xp6(3),e.Q6J("ngIf",t.previousTimePeriodUT)}}function jn(n,r){1&n&&(e.TgZ(0,"span"),e._uU(1," Potential Revenue Gain "),e.qZA())}function Bn(n,r){1&n&&e._uU(0," Potential Revenue Loss ")}function $n(n,r){if(1&n&&(e.TgZ(0,"span",47),e._uU(1),e.ALo(2,"number"),e.qZA()),2&n){const t=e.oxw(2).$implicit;e.Q6J("ngClass",e.VKq(6,N,""!==t.unit)),e.xp6(1),e.AsE(" ",t.unit," ",e.xi3(2,3,t.currentTimePeriodUT,"1.0-0")," ")}}function Gn(n,r){if(1&n&&(e.TgZ(0,"td",55)(1,"div",56),e.YNc(2,jn,2,0,"span",57),e.YNc(3,Bn,1,0,"ng-template",null,58,e.W1O),e.qZA(),e.TgZ(5,"span",47),e._uU(6),e.ALo(7,"number"),e.ALo(8,"number"),e.qZA(),e.YNc(9,$n,3,8,"span",54),e.qZA()),2&n){const t=e.MAs(4),i=e.oxw().$implicit;e.xp6(2),e.Q6J("ngIf",i.currentTimePeriod<0)("ngIfElse",t),e.xp6(3),e.Q6J("ngClass",e.VKq(12,N,""!==i.unit)),e.xp6(1),e.AsE(" ",i.unit," ",i.currentTimePeriod<0?e.xi3(7,6,-i.currentTimePeriod,"1.0-0"):e.xi3(8,9,i.currentTimePeriod,"1.0-0")," "),e.xp6(3),e.Q6J("ngIf",i.currentTimePeriodUT)}}function Wn(n,r){1&n&&(e.TgZ(0,"span"),e._uU(1," Potential Revenue Gain "),e.qZA())}function zn(n,r){1&n&&e._uU(0," Potential Revenue Loss ")}function Kn(n,r){if(1&n&&(e.TgZ(0,"span",47),e._uU(1),e.ALo(2,"number"),e.qZA()),2&n){const t=e.oxw(2).$implicit;e.Q6J("ngClass",e.VKq(6,N,""!==t.unit)),e.xp6(1),e.AsE(" ",t.unit," ",e.xi3(2,3,t.previousTimePeriodUT,"1.0-0")," ")}}function Xn(n,r){if(1&n&&(e.TgZ(0,"td",40)(1,"div",56),e.YNc(2,Wn,2,0,"span",57),e.YNc(3,zn,1,0,"ng-template",null,58,e.W1O),e.qZA(),e.TgZ(5,"span",47),e._uU(6),e.ALo(7,"number"),e.ALo(8,"number"),e.qZA(),e.YNc(9,Kn,3,8,"span",54),e.qZA()),2&n){const t=e.MAs(4),i=e.oxw().$implicit;e.xp6(2),e.Q6J("ngIf",i.previousTimePeriod<0)("ngIfElse",t),e.xp6(3),e.Q6J("ngClass",e.VKq(12,N,""!==i.unit)),e.xp6(1),e.AsE(" ",i.unit," ",i.previousTimePeriod<0?e.xi3(7,6,-i.previousTimePeriod,"1.0-0"):e.xi3(8,9,i.previousTimePeriod,"1.0-0")," "),e.xp6(3),e.Q6J("ngIf",i.previousTimePeriodUT)}}function ea(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"td",38)(1,"p-inputNumber",59),e.NdJ("ngModelChange",function(a){e.CHM(t);const o=e.oxw().$implicit;return e.KtG(o.costPerMile=a)})("ngModelChange",function(){e.CHM(t);const a=e.oxw(3);return e.KtG(a.onchangeUtilizationPerDay())}),e.qZA()()}if(2&n){const t=e.oxw().$implicit,i=e.oxw(2);e.xp6(1),e.Q6J("ngModel",t.costPerMile)("prefix",i.orgCurrency)("showButtons",!0)("minFractionDigits",1)("min",0)("max",999)("maxFractionDigits",2)("minFractionDigits",2)}}function ta(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"td",60)(1,"p-inputNumber",61),e.NdJ("ngModelChange",function(a){e.CHM(t);const o=e.oxw().$implicit;return e.KtG(o.optimizedUtilization=a)})("ngModelChange",function(){e.CHM(t);const a=e.oxw(3);return e.KtG(a.onchangeUtilizationPerDay())}),e.qZA()()}if(2&n){const t=e.oxw().$implicit,i=e.oxw(2);e.xp6(1),e.MGl("suffix"," ",i.distance_units,""),e.Q6J("ngModel",t.optimizedUtilization)("showButtons",!0)("min",0)("max",999)("maxFractionDigits",2)}}const ia=function(n,r){return{"surface-50":n,"font-bold":r}};function na(n,r){if(1&n&&(e.TgZ(0,"tr",47)(1,"td",42),e._UZ(2,"div",48),e.qZA(),e.TgZ(3,"td",44),e._uU(4),e.qZA(),e.YNc(5,Vn,15,19,"ng-container",49),e.YNc(6,Gn,10,14,"td",50),e.YNc(7,Xn,10,14,"td",51),e.YNc(8,ea,2,8,"td",52),e.YNc(9,ta,2,6,"td",53),e.qZA()),2&n){const t=r.$implicit,i=r.rowIndex;e.Q6J("ngClass",e.WLB(9,ia,3===i,3===i)),e.xp6(2),e.Q6J("ngClass",e.VKq(12,N,""!==t.unit))("innerHTML",t.vehicleType,e.oJD),e.xp6(2),e.hij(" ",t.count," "),e.xp6(1),e.Q6J("ngIf",4!==i),e.xp6(1),e.Q6J("ngIf",4===i),e.xp6(1),e.Q6J("ngIf",4===i),e.xp6(1),e.Q6J("ngIf",i<3),e.xp6(1),e.Q6J("ngIf",i<3)}}function aa(n,r){if(1&n&&(e.TgZ(0,"div",35)(1,"h5",10),e._uU(2,"Opportunity Calculator (Vehicle Utilization) "),e._UZ(3,"i",36),e.qZA(),e.TgZ(4,"p-table",37,28),e.YNc(6,Qn,27,8,"ng-template",29),e.YNc(7,na,10,14,"ng-template",30),e.qZA()()),2&n){const t=e.oxw();e.xp6(4),e.Q6J("value",t.eventData)("autoLayout",!0)("rowHover",!0)}}function oa(n,r){if(1&n&&(e.TgZ(0,"tr"),e._UZ(1,"th",38),e.TgZ(2,"th",39),e._uU(3,"Due to Idling"),e.qZA(),e.TgZ(4,"th",40),e._uU(5,"Due to Unoptimized Route"),e.qZA(),e.TgZ(6,"th",62),e._uU(7,"Carbon Emission"),e.qZA(),e.TgZ(8,"th",63),e._uU(9,"Potential Revenue Loss"),e.qZA()(),e.TgZ(10,"tr"),e._UZ(11,"th"),e.TgZ(12,"th",64),e._UZ(13,"i",65),e._uU(14," Idling per Vehicle per Day "),e.qZA(),e.TgZ(15,"th",64),e._UZ(16,"i",66),e._uU(17," Fuel Lost "),e.qZA(),e.TgZ(18,"th",64),e._uU(19),e.qZA(),e.TgZ(20,"th",67),e._UZ(21,"i",68),e._uU(22,"Excess Distance "),e.qZA(),e.TgZ(23,"th",67),e._UZ(24,"i",66),e._uU(25,"Fuel Lost "),e.qZA(),e.TgZ(26,"th",67),e._uU(27),e.qZA(),e.TgZ(28,"th",62),e._uU(29,"Emissions "),e.qZA(),e._UZ(30,"th"),e.qZA()),2&n){const t=e.oxw();e.xp6(19),e.hij(" ",t.orgCurrency," Lost "),e.xp6(8),e.hij(" ",t.orgCurrency," Lost ")}}const ra=function(n){return{"surface-50":n}};function sa(n,r){if(1&n&&(e.TgZ(0,"tr",47)(1,"td",69)(2,"b"),e._UZ(3,"span",70),e.qZA()(),e.TgZ(4,"td",64),e._uU(5),e.ALo(6,"number"),e.qZA(),e.TgZ(7,"td",64),e._uU(8),e.ALo(9,"number"),e.qZA(),e.TgZ(10,"td",64),e._uU(11),e.ALo(12,"number"),e.qZA(),e.TgZ(13,"td",67),e._uU(14," Coming Soon... "),e.qZA(),e.TgZ(15,"td",67),e._uU(16," Coming Soon... "),e.qZA(),e.TgZ(17,"td",67),e._uU(18," Coming Soon... "),e.qZA(),e.TgZ(19,"td",62),e._uU(20),e.ALo(21,"number"),e.qZA(),e.TgZ(22,"td",63)(23,"b"),e._uU(24),e.ALo(25,"number"),e.ALo(26,"number"),e.qZA()()()),2&n){const t=r.$implicit,i=r.rowIndex,a=e.oxw();e.Q6J("ngClass",e.VKq(29,ra,i%2==0)),e.xp6(3),e.Q6J("innerHTML",t.event,e.oJD),e.xp6(2),e.hij(" ",e.xi3(6,11,t.idlingTime,"1.0-1")," min/vehicle "),e.xp6(3),e.lnq(" ",e.xi3(9,14,t.fuelLost,"1.0-0")," ",a.fuel_unit,"",1===t.fuelLost?"":"s"," "),e.xp6(3),e.AsE(" ",a.orgCurrency,"",e.xi3(12,17,t.amountLost,"1.0-0")," "),e.xp6(9),e.hij(" ",e.xi3(21,20,t.co2,"1.0-2")," KT "),e.xp6(4),e.AsE(" ",a.orgCurrency,"",t.totalAmount<0?"("+e.xi3(25,23,-t.totalAmount,"1.0-0")+")":e.xi3(26,26,t.totalAmount,"1.0-0"),"")}}let la=(()=>{class n{utilservice;fleetsService;spinnerService;settingsService;toolbarComponent;dt;barData;reduceByNumber=25;reduceFuelLost=1;reduceFuelCost=3.5;reduceCarbonEmissions=1;aggregatedFleetData;prevAggregatedFleetData;ytdAggregatedFleetData;unit;thisRangeData;defaultSettings;eventData=[];fuelEfficiencyData=[];thisTimeRangeData;previousTimeRangeData;targetLoss=0;distance_units="mi";orgSettings;y_title;unit_header="Mile";fuel_unit="Litre";Math=Math;showProgressSpinner=!0;orgCurrency;constructor(t,i,a,o){this.utilservice=t,this.fleetsService=i,this.spinnerService=a,this.settingsService=o}ngAfterViewInit(){this.initDates(),this.orgCurrency=this.utilservice.getOrgCurrency()}initDates(){this.showProgressSpinner=!0;var t=m.Y5();let i=this.settingsService.getOrgSettings();i.subscribe(a=>{this.orgSettings=a,a.settings.org_common_configurations.speed_unit==m.J_[0].value?(this.distance_units="km",this.y_title="Distance (km)",this.unit_header="km"):(this.distance_units="mi",this.y_title="Distance (mi)",this.unit_header="mi"),this.fuel_unit="Litre",this.fuel_unit=a.settings.org_common_configurations.fuel_unit==m.xN[0].value?"Litre":"Gallon";let o=this.fleetsService.getFleetsPerformance(this.toolbarComponent.fromDateUTC,this.toolbarComponent.toDateUTC,t.filter_fleet_ids);(0,Mn.a)(o,i).subscribe(([u,_])=>{this.defaultSettings=_,this.fillDefaultsettings(_),this.getOperationalEfficiencyData(u.cumulative,_,u.prev_cumulative),this.setDataForPage(u.cumulative,u.prev_cumulative,u.ytd)});const s=new Date(this.toolbarComponent.fromDateUTC);s.setDate(s.getDate()-1);const l=s.toISOString().split("T")[0];let c=this.utilservice.get_31_days_of_date_range(new Date(l),new Date(this.toolbarComponent.toDateUTC),31),d={data:[]},p=!1;for(;c.length;){let u=c.shift()||"",_=this.toolbarComponent.toDateUTC;if(c.length){let b=new Date(u);b.setUTCDate(b.getUTCDate()+30),_=b.toISOString().split("T")[0]}else p=!0;this.fleetsService.getFleetUtilizationDaily(u,_,t.filter_fleet_ids).subscribe(b=>{d.data=[...d.data,...b.data],p&&(d.data.sort((y,E)=>new Date(y.date).getTime()-new Date(E.date).getTime()),this.setDataForChart(d))})}})}fillDefaultsettings(t){this.reduceFuelLost=t.settings.org_kpi_configurations.fuel_efficiency.fuel_lost_per_idling_hr,this.reduceFuelCost=t.settings.org_kpi_configurations.fuel_efficiency.fuel_cost,this.reduceCarbonEmissions=t.settings.org_kpi_configurations.fuel_efficiency.carbon_emission_per_hr}getOperationalEfficiencyData(t,i,a){this.setOpportunityCalculatorTable(t,a,i),this.setFuelEfficiencyData(t),this.thisTimeRangeData=t}setDataForPage(t,i,a){this.aggregatedFleetData=t,this.prevAggregatedFleetData=i,this.ytdAggregatedFleetData=a}setOpportunityCalculatorTable(t,i,a){const o=t.vehicles,s=t.travel_distance.map(p=>this.convertDistance(p)),l=i.vehicles,c=i.travel_distance.map(p=>this.convertDistance(p)),d=a.settings.org_kpi_configurations.vehicle_utilization;this.eventData=[{vehicleType:'<div class="w-5rem text-right inline-block"><img class="mr-3 vertical-align-middle large" src="assets/demo/images/other/large_vehicle.png"></div><div class="inline-block ml-2 text-left"><p class="mb-1 text-left"><b>Heavy Duty</b><small>&nbsp;(Class 7 to 8)</small></p> <span class="text-sm">from 26,001 pounds</span></div>',count:o[4],lastCount:l[4],currentTimePeriod:s[4],currentTimePeriodUT:s[4]/(o[4]*t.day_count),previousTimePeriod:c[4],previousTimePeriodUT:c[4]/(l[4]*i.day_count),optimizedUtilization:d.large_vehicle.utilisation_per_mile,costPerMile:d.large_vehicle.cost_per_mile,unit:"",day:t.day_count,past_day:i.day_count},{vehicleType:'<div class="w-5rem text-right inline-block"><img class="mr-3 vertical-align-middle medium" src="assets/demo/images/other/medium_vehicle.png"></div><div class="inline-block ml-2 text-left"><p class="mb-1 text-left"><b>Medium Duty</b><small>&nbsp;(Class 3 to 6)</small></p> <span class="text-sm">from 14,001 to 26,000 pounds</span></div>',count:o[3],lastCount:l[3],currentTimePeriod:s[3],currentTimePeriodUT:s[3]/(o[3]*t.day_count),previousTimePeriod:c[3],previousTimePeriodUT:c[3]/(l[3]*i.day_count),optimizedUtilization:d.medium_vehicle.utilisation_per_mile,costPerMile:d.medium_vehicle.cost_per_mile,unit:"",day:t.day_count,past_day:i.day_count},{vehicleType:'<div class="w-5rem text-right inline-block"><img class="mr-3 vertical-align-middle small" src="assets/demo/images/other/small_vehicle.png"></div><div class="inline-block ml-2 text-left"><p class="mb-1 text-left"><b>Light Duty</b><small>&nbsp;(Class 1 to 2)</small></p> <span class="text-sm">from 6,001 to 14,000 pounds</span></div>',count:o[2],lastCount:l[2],currentTimePeriod:s[2],currentTimePeriodUT:s[2]/(o[2]*t.day_count),previousTimePeriod:c[2],previousTimePeriodUT:c[2]/(l[2]*i.day_count),optimizedUtilization:d.small_vehicle.utilisation_per_mile,costPerMile:d.small_vehicle.cost_per_mile,unit:"",day:t.day_count,past_day:i.day_count},{vehicleType:'<div class="w-5rem inline-block"></div><p class="ml-2">Total</p>',count:o[4]+o[3]+o[2],lastCount:l[4]+l[3]+l[2],currentTimePeriod:Number(s[4])+Number(s[3])+Number(s[2]),previousTimePeriod:Number(c[4])+Number(c[3])+Number(c[2]),currentTimePeriodUT:(Number(s[4])/(o[4]*t.day_count)*Number(s[4])+Number(s[3])/(o[3]*t.day_count)*Number(s[3])+Number(s[2])/(o[2]*t.day_count)*Number(s[2]))/(Number(s[4])+Number(s[3])+Number(s[2])),previousTimePeriodUT:(Number(c[4])/(l[4]*i.day_count)*Number(c[4])+Number(c[3])/(l[3]*i.day_count)*Number(c[3])+Number(c[2])/(l[2]*i.day_count)*Number(c[2]))/(Number(c[4])+Number(c[3])+Number(c[2])),unit:""},{vehicleType:"",currentTimePeriod:t.vehicle_utilisation_loss,previousTimePeriod:i.vehicle_utilisation_loss,unit:this.orgCurrency}]}setFuelEfficiencyData(t){const i=this.reduceFuelLost*t.idling_duration[0];this.fuelEfficiencyData=[{event:"Current Usage",idlingTime:t.idling_duration[0]/(t.vehicles[0]*t.day_count*60),fuelLost:i/3600,amountLost:i/3600*this.reduceFuelCost,excessDistance:void 0,fuelLosts:void 0,amounLosts:void 0,co2:i/3600*.264172*this.reduceCarbonEmissions*.001,totalAmount:i/3600*this.reduceFuelCost}],this.onchangeFuelEfficiency(t)}onchangeFuelEfficiency(t){this.fuelEfficiencyData[1]={event:"Projected Usage",idlingTime:this.fuelEfficiencyData[0].idlingTime*((100-this.reduceByNumber)/100),fuelLost:this.fuelEfficiencyData[0].fuelLost*((100-this.reduceByNumber)/100),amountLost:this.fuelEfficiencyData[0].amountLost*((100-this.reduceByNumber)/100),excessDistance:this.convertDistance(this.fuelEfficiencyData[0].excessDistance*((100-this.reduceByNumber)/100)),fuelLosts:this.fuelEfficiencyData[0].fuelLosts*((100-this.reduceByNumber)/100),amounLosts:this.fuelEfficiencyData[0].amounLosts*((100-this.reduceByNumber)/100),co2:this.fuelEfficiencyData[0].co2*((100-this.reduceByNumber)/100),totalAmount:this.fuelEfficiencyData[0].totalAmount*((100-this.reduceByNumber)/100)}}convertDistance(t){if(String(t).includes(",")&&(t=t.replaceAll(",","")),null==t||"null"==t||null==t||isNaN(t))return 0;let i=Number(String(t));return this.utilservice.convertDistance(i,this.orgSettings.settings.org_common_configurations.speed_unit)}onchangeUtilizationPerDay(){let t=this.eventData,i=0,a=0;this.eventData.forEach((o,s)=>{if(s<3){const l=t[s].day,c=t[s].optimizedUtilization,d=t[s].count,p=t[s].costPerMile;i+=(c*d*l-t[s].currentTimePeriod)*p,a+=(c*d*l-t[s].previousTimePeriod)*p}}),this.eventData[4].currentTimePeriod=Math.floor(i),this.eventData[4].previousTimePeriod=Math.floor(a)}setDataForChart(t){this.showProgressSpinner=!1,this.barData={};const i=[],a=[],o=[],s=[],l=[];let c=t.data;c.forEach((d,p)=>{i.push(d.date),a.push(this.convertDistance(p>0?c[p].distance_00_06_hrs[0]-c[p-1].distance_00_06_hrs[0]:c[p].distance_00_06_hrs[0])),o.push(this.convertDistance(p>0?c[p].distance_06_12_hrs[0]-c[p-1].distance_06_12_hrs[0]:c[p].distance_06_12_hrs[0])),s.push(this.convertDistance(p>0?c[p].distance_12_18_hrs[0]-c[p-1].distance_12_18_hrs[0]:c[p].distance_12_18_hrs[0])),l.push(this.convertDistance(p>0?c[p].distance_18_24_hrs[0]-c[p-1].distance_18_24_hrs[0]:c[p].distance_18_24_hrs[0]))}),this.barData={labels:i.slice(1),datasets:[{label:"00hrs to 06hrs",backgroundColor:this.utilservice.hexToRgba(m.mH[1],"0.1"),borderColor:m.mH[1],borderWidth:1,data:a.slice(1),fill:!0,tension:.4},{label:"06hrs to 12hrs",backgroundColor:this.utilservice.hexToRgba(m.mH[2],"0.1"),borderColor:m.mH[2],borderWidth:1,data:o.slice(1),fill:!0,tension:.4},{label:"12hrs to 18hrs",backgroundColor:this.utilservice.hexToRgba(m.mH[0],"0.1"),borderColor:m.mH[0],borderWidth:1,data:s.slice(1),fill:!0,tension:.4},{label:"18hrs to 24hrs",backgroundColor:this.utilservice.hexToRgba(m.mH[9],"0.1"),borderColor:m.mH[6],borderWidth:1,data:l.slice(1),fill:!0,tension:.4}]}}static \u0275fac=function(i){return new(i||n)(e.Y36(h.FW),e.Y36(h.VN),e.Y36(h.V),e.Y36(h.gb))};static \u0275cmp=e.Xpm({type:n,selectors:[["app-metric-detail-op-efficiency"]],viewQuery:function(i,a){if(1&i&&(e.Gf(I.n,5),e.Gf(T.iA,5)),2&i){let o;e.iGM(o=e.CRH())&&(a.toolbarComponent=o.first),e.iGM(o=e.CRH())&&(a.dt=o.first)}},decls:50,vars:33,consts:[[3,"showEvents","filterData"],["toolbarComponent",""],[1,"grid","mt-3"],[1,"col-12","md:col-12","xl:col-12"],[1,"card","py-3","shadow-2","border-1","border-blue-500"],[1,"mb-2"],[1,"text-l"],["class","col-12 md:col-12 xl:col-12",4,"ngIf"],[1,"col-12"],[1,"card","chart"],[1,"text-lg"],["pTooltip","Trend of distance travelled by vehicles for different periods of the day.",1,"pi","pi-info-circle","ml-1","text-lg"],["styleClass","w-5rem h-5rem",4,"ngIf"],[3,"data","height","YTitle",4,"ngIf"],["class","card h-full",4,"ngIf"],[1,"col-12","mt-2","mb-5"],[1,"card"],[1,"grid"],["pTooltip","Calculate potential revenue loss for the selected timeframe based on fuel wasted due to\n                        idling and unoptimized route. research link to default values.",1,"pi","pi-info-circle","ml-1","text-lg"],[1,"text-center","justify-content-center","grid"],[1,"col-12","md:col-2","sm:col-3","text-left"],[1,"mb-1","text-left"],["locale","en-US","mode","decimal","suffix"," %","inputStyleClass","w-full max-w-8rem\t","numberSuffix","",1,"my-2",3,"ngModel","maxFractionDigits","showButtons","min","max","ngModelChange"],[1,"mb-1"],["locale","en-US","mode","decimal","inputStyleClass","w-full max-w-8rem\t","numberSuffix","",1,"my-2",3,"ngModel","maxFractionDigits","showButtons","prefix","min","max","ngModelChange"],["locale","en-US","mode","decimal","inputStyleClass","w-full max-w-8rem\t","numberSuffix","",1,"my-2",3,"ngModel","maxFractionDigits","showButtons","minFractionDigits","suffix","min","max","ngModelChange"],["locale","en-US","mode","decimal","suffix"," KT","inputStyleClass","w-full max-w-8rem\t","numberSuffix","",1,"my-2",3,"ngModel","maxFractionDigits","showButtons","min","max","ngModelChange"],["responsiveLayout","scroll",3,"value","autoLayout"],["dt",""],["pTemplate","header"],["pTemplate","body"],[3,"metricsName","isPositiveChange","metricsNumber"],[3,"metricsName","metricsNumber"],["styleClass","w-5rem h-5rem"],[3,"data","height","YTitle"],[1,"card","h-full"],["pTooltip","Calculate potential revenue loss for the selected timeframe based on optimum distance\n                    travelled by different type of vehicles.Please refresh page to restore default values. research link to\n                    default values identifed.",1,"pi","pi-info-circle","ml-1","text-lg"],["responsiveLayout","scroll",3,"value","autoLayout","rowHover"],[1,"text-center"],["colspan","3",1,"text-center","bg-green-50"],["colspan","3",1,"text-center","bg-yellow-50"],["colspan","2",1,"text-center"],[1,"text-center",2,"min-width","14rem"],[1,"text-center","bg-green-50"],[1,"text-right","bg-green-50"],[1,"text-center","bg-yellow-50"],[1,"text-right","bg-yellow-50"],[3,"ngClass"],[1,"flex","align-items-center",3,"ngClass","innerHTML"],[4,"ngIf"],["class","text-center bg-green-50 py-4","colspan","2",4,"ngIf"],["class","text-center bg-yellow-50","colspan","3",4,"ngIf"],["class","text-center",4,"ngIf"],["class","align-items-center text-center",4,"ngIf"],[3,"ngClass",4,"ngIf"],["colspan","2",1,"text-center","bg-green-50","py-4"],[1,"font-bold","text-base","mb-2"],[4,"ngIf","ngIfElse"],["positiveLabel",""],["inputStyleClass","w-6rem text-right","mode","decimal",1,"text-right",3,"ngModel","prefix","showButtons","minFractionDigits","min","max","maxFractionDigits","ngModelChange"],[1,"align-items-center","text-center"],["type","number","inputStyleClass","w-6rem text-right","mode","decimal",3,"ngModel","showButtons","suffix","min","max","maxFractionDigits","ngModelChange"],[1,"bg-cyan-50","text-right"],[1,"text-right"],[1,"bg-green-50","text-right"],[1,"pi","pi-lock","mr-1","text-xl","vertical-align-middle"],[1,"pi","pi-money-bill","mr-1","text-xl","vertical-align-middle"],[1,"bg-yellow-50","text-right"],[1,"pi","pi-car","mr-1","text-xl","vertical-align-middle"],[1,"py-2","text-right"],[3,"innerHTML"]],template:function(i,a){if(1&i&&(e.TgZ(0,"app-toolbar",0,1),e.NdJ("filterData",function(){return a.initDates()}),e.qZA(),e.TgZ(2,"div",2)(3,"div",3)(4,"div",4)(5,"h5",5),e._uU(6,"What is this report?"),e.qZA(),e.TgZ(7,"p",6),e._uU(8,"Opportunity Assessment Report gives us the sum of lost potential revenue due to unoptimized vehicle utilization, and inefficient fuel consumption. Lesser the value, better the operational performance is. "),e.qZA()()(),e.YNc(9,Jn,10,25,"div",7),e.TgZ(10,"div",8)(11,"div",9)(12,"h5",10),e._uU(13,"Vehicle Utilization "),e._UZ(14,"i",11),e.qZA(),e.TgZ(15,"div"),e.YNc(16,Ln,1,0,"p-progressSpinner",12),e.qZA(),e.YNc(17,Rn,1,3,"app-line-chart",13),e.YNc(18,qn,1,0,"p-progressSpinner",12),e.qZA()(),e.TgZ(19,"div",8),e.YNc(20,aa,8,3,"div",14),e.qZA(),e.TgZ(21,"div",15)(22,"div",16)(23,"div",17)(24,"div",8)(25,"h5",10),e._uU(26,"Opportunity Calculator (Fuel Management Insights) "),e._UZ(27,"i",18),e.qZA()()(),e.TgZ(28,"div",19)(29,"div",20)(30,"p",21),e._uU(31,"Reduce Idling By"),e.qZA(),e.TgZ(32,"p-inputNumber",22),e.NdJ("ngModelChange",function(s){return a.reduceByNumber=s})("ngModelChange",function(){return a.setFuelEfficiencyData(a.thisTimeRangeData)}),e.qZA()(),e.TgZ(33,"div",20)(34,"p",23),e._uU(35),e.qZA(),e.TgZ(36,"p-inputNumber",24),e.NdJ("ngModelChange",function(s){return a.reduceFuelCost=s})("ngModelChange",function(){return a.setFuelEfficiencyData(a.thisTimeRangeData)}),e.qZA()(),e.TgZ(37,"div",20)(38,"p",23),e._uU(39,"Fuel Lost/Idling Hour"),e.qZA(),e.TgZ(40,"p-inputNumber",25),e.NdJ("ngModelChange",function(s){return a.reduceFuelLost=s})("ngModelChange",function(){return a.setFuelEfficiencyData(a.thisTimeRangeData)}),e.qZA()(),e.TgZ(41,"div",20)(42,"p",23),e._uU(43),e.qZA(),e.TgZ(44,"p-inputNumber",26),e.NdJ("ngModelChange",function(s){return a.reduceCarbonEmissions=s})("ngModelChange",function(){return a.setFuelEfficiencyData(a.thisTimeRangeData)}),e.qZA()(),e.TgZ(45,"div",8)(46,"p-table",27,28),e.YNc(48,oa,31,2,"ng-template",29),e.YNc(49,sa,27,31,"ng-template",30),e.qZA()()()()()()),2&i){const o=e.MAs(1);e.Q6J("showEvents",!1),e.xp6(9),e.Q6J("ngIf",a.aggregatedFleetData&&a.prevAggregatedFleetData&&a.ytdAggregatedFleetData),e.xp6(7),e.Q6J("ngIf",!a.barData),e.xp6(1),e.Q6J("ngIf",a.barData),e.xp6(1),e.Q6J("ngIf",!a.barData),e.xp6(2),e.Q6J("ngIf",o),e.xp6(12),e.Q6J("ngModel",a.reduceByNumber)("maxFractionDigits",2)("showButtons",!0)("min",0)("max",100),e.xp6(3),e.hij("Fuel Cost/",a.fuel_unit,""),e.xp6(1),e.Q6J("ngModel",a.reduceFuelCost)("maxFractionDigits",2)("showButtons",!0)("prefix",a.orgCurrency)("min",0)("max",999),e.xp6(4),e.MGl("suffix"," ",a.fuel_unit,"(s)"),e.Q6J("ngModel",a.reduceFuelLost)("maxFractionDigits",2)("showButtons",!0)("minFractionDigits",1)("min",0)("max",999),e.xp6(3),e.hij("Carbon Emissions/",a.fuel_unit,""),e.xp6(1),e.Q6J("ngModel",a.reduceCarbonEmissions)("maxFractionDigits",2)("showButtons",!0)("min",0)("max",999),e.xp6(2),e.Q6J("value",a.fuelEfficiencyData)("autoLayout",!0)}},dependencies:[v.mk,v.O5,x.jx,Q.u,T.iA,de.Rn,X.c,Pn,K,D.JJ,D.On,I.n,F.G,v.JJ],styles:["[_nghost-%COMP%]     .p-button.p-button-icon-only{padding:.175rem 0}[_nghost-%COMP%]     img{max-width:60px;display:inline-block;max-height:25px}[_nghost-%COMP%]     .small{max-height:20px}[_nghost-%COMP%]     p-progressSpinner{position:absolute;top:50%;left:50%;z-index:1000}.card.chart[_ngcontent-%COMP%]{min-height:20rem}"]})}return n})();function ca(n,r){if(1&n&&(e._UZ(0,"app-big-metrics-card",45),e.ALo(1,"number")),2&n){const t=e.oxw(2);e.Q6J("metricsName","No. of Accidents Avoided")("metricsNumber",e.lcZ(1,2,null==t.liabilitySummaryData.cumulative?null:t.liabilitySummaryData.cumulative.total_events.accident_avoidance_default_compound_event[0]))}}function pa(n,r){if(1&n&&(e.TgZ(0,"div",3),e._UZ(1,"app-big-metrics-card",44),e.ALo(2,"number"),e.ALo(3,"number"),e._UZ(4,"app-big-metrics-card",45),e.ALo(5,"number"),e.ALo(6,"number"),e._UZ(7,"app-big-metrics-card",45),e.ALo(8,"number"),e.ALo(9,"number"),e.YNc(10,ca,2,4,"app-big-metrics-card",46),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("metricsName","Current Period Selected")("isPositiveChange",t.liabilitySummaryData.cumulative.liability_loss>t.liabilitySummaryData.prev_cumulative.liability_loss)("metricsNumber",t.orgCurrency+(t.liabilitySummaryData.cumulative.liability_loss<0?"("+e.xi3(2,8,-t.liabilitySummaryData.cumulative.liability_loss,"1.0-0")+")":e.xi3(3,11,t.liabilitySummaryData.cumulative.liability_loss,"1.0-0"))),e.xp6(3),e.Q6J("metricsName","Same Time Last Period")("metricsNumber",t.orgCurrency+(t.liabilitySummaryData.prev_cumulative.liability_loss<0?"("+e.xi3(5,14,-t.liabilitySummaryData.prev_cumulative.liability_loss,"1.0-0")+")":e.xi3(6,17,t.liabilitySummaryData.prev_cumulative.liability_loss,"1.0-0"))),e.xp6(3),e.Q6J("metricsName","Year to Date Liability")("metricsNumber",t.orgCurrency+(t.liabilitySummaryData.ytd.liability_loss<0?"("+e.xi3(8,20,-t.liabilitySummaryData.ytd.liability_loss,"1.0-0")+")":e.xi3(9,23,t.liabilitySummaryData.ytd.liability_loss,"1.0-0"))),e.xp6(3),e.Q6J("ngIf",t.liabilitySummaryData&&(null==t.liabilitySummaryData.cumulative?null:t.liabilitySummaryData.cumulative.total_events.accident_avoidance_default_compound_event))}}function ua(n,r){1&n&&(e.TgZ(0,"div",47),e._UZ(1,"p-progressSpinner",48),e.qZA())}function da(n,r){1&n&&(e.TgZ(0,"h5"),e._uU(1," Top 5 Events "),e._UZ(2,"i",49),e.qZA())}function _a(n,r){1&n&&(e.TgZ(0,"h5"),e._uU(1," All Events "),e.qZA())}function ma(n,r){1&n&&e._UZ(0,"i"),2&n&&e.Tol(r.$implicit.icon)}function ha(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div",19),e._UZ(1,"p-menu",50,51),e.TgZ(3,"button",52),e.NdJ("click",function(a){e.CHM(t);const o=e.MAs(2);return e.KtG(o.toggle(a))}),e.qZA()()}if(2&n){const t=e.oxw();e.xp6(1),e.Q6J("popup",!0)("model",t.exportOptionsForTopEvents)}}function ga(n,r){if(1&n&&(e.TgZ(0,"li",56)(1,"div",57),e._UZ(2,"img",58),e.qZA(),e.TgZ(3,"div",59)(4,"div",60),e._uU(5),e.qZA(),e.TgZ(6,"div",19)(7,"b"),e._uU(8),e.qZA()()()()),2&n){const t=e.oxw(),i=t.$implicit,a=t.index,o=e.oxw(2);e.xp6(2),e.s9C("title",o.utilservice.formatLabelForCharts(null==i?null:i.key)),e.Q6J("src","assets/demo/images/events/"+(null==i?null:i.key)+"-red.svg",e.LSH),e.xp6(3),e.hij(" ",o.labels[a],":"),e.xp6(3),e.Oqu(o.values[a])}}function va(n,r){if(1&n&&(e.ynx(0),e.YNc(1,ga,9,4,"li",55),e.BQk()),2&n){const t=r.index,i=e.oxw(2);e.xp6(1),e.Q6J("ngIf",i.values[t]>0)}}function fa(n,r){if(1&n&&(e.TgZ(0,"li",56)(1,"div",57),e._UZ(2,"img",61),e.qZA(),e.TgZ(3,"div",59),e._uU(4),e.TgZ(5,"b"),e._uU(6),e.qZA()()()),2&n){const t=e.oxw(),i=t.$implicit,a=t.index,o=e.oxw(2);e.xp6(2),e.Q6J("src","assets/demo/images/events/"+(null==i?null:i.key)+"-red.svg",e.LSH),e.xp6(2),e.hij("",o.labels[a+10],": "),e.xp6(2),e.Oqu(o.values[a+10])}}function ba(n,r){if(1&n&&(e.ynx(0),e.YNc(1,fa,7,3,"li",55),e.BQk()),2&n){const t=r.index,i=e.oxw(2);e.xp6(1),e.Q6J("ngIf",i.values[t+10]>0)}}function Ca(n,r){if(1&n&&(e.TgZ(0,"div",53)(1,"div",54)(2,"ul"),e.YNc(3,va,2,1,"ng-container",42),e.qZA()(),e.TgZ(4,"div",54)(5,"ul"),e.YNc(6,ba,2,1,"ng-container",42),e.qZA()()()),2&n){const t=e.oxw();e.xp6(3),e.Q6J("ngForOf",t.top5Events.slice(0,10)),e.xp6(3),e.Q6J("ngForOf",t.top5Events.slice(10))}}function Da(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"app-bar-chart",62),e.NdJ("emitEventClick",function(a){e.CHM(t);const o=e.oxw();return e.KtG(o.navigateToEventsReport(a))}),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("chartType","horizontal")("height","350")("barData",t.barDataForEvents)("containerId","driver-scorecard")("barOptions",t.driverChartOptions)}}function xa(n,r){1&n&&e._UZ(0,"i"),2&n&&e.Tol(r.$implicit.icon)}function Ta(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div",19),e._UZ(1,"p-menu",50,51),e.TgZ(3,"button",52),e.NdJ("click",function(a){e.CHM(t);const o=e.MAs(2);return e.KtG(o.toggle(a))}),e.qZA()()}if(2&n){const t=e.oxw();e.xp6(1),e.Q6J("popup",!0)("model",t.exportOptionsForLeastDrivers)}}function ya(n,r){1&n&&e._UZ(0,"p-progressSpinner",63)}function Sa(n,r){if(1&n&&(e.TgZ(0,"tr")(1,"th",71),e._uU(2," Driver Name "),e._UZ(3,"p-sortIcon",72),e.qZA(),e.TgZ(4,"th",73),e._uU(5),e.qZA(),e.TgZ(6,"th",74),e._uU(7," Driver Score"),e._UZ(8,"p-sortIcon",75),e.qZA(),e.TgZ(9,"th",76),e._uU(10," Events"),e._UZ(11,"p-sortIcon",77),e.qZA(),e.TgZ(12,"th",78),e._uU(13," Compound Events"),e._UZ(14,"p-sortIcon",79),e.qZA()()),2&n){const t=e.oxw(3);e.xp6(5),e.hij("Distance (",t.unit_header,") ")}}const wa=function(n){return{"surface-50":n}};function Za(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"tr",80),e.NdJ("click",function(){const o=e.CHM(t).$implicit,s=e.oxw(3);return e.KtG(s.navigateDriverWithId(o.driver_id))}),e.TgZ(1,"td",81),e._uU(2),e.qZA(),e.TgZ(3,"td",82),e._uU(4),e.qZA(),e.TgZ(5,"td",83),e._uU(6),e.ALo(7,"number"),e.qZA(),e.TgZ(8,"td",83),e._uU(9),e.qZA(),e.TgZ(10,"td",83),e._uU(11),e.qZA()()}if(2&n){const t=r.$implicit,i=r.rowIndex,a=e.oxw(3);e.Q6J("ngClass",e.VKq(9,wa,i%2==0)),e.xp6(2),e.hij(" ",t.name," "),e.xp6(2),e.hij(" ",a.convertDistance(null==t.travel_distance?null:t.travel_distance[0])," "),e.xp6(2),e.hij(" ",e.xi3(7,6,t.score,"1.0-2")," "),e.xp6(3),e.hij(" ",t.coaching_total_count?t.coaching_total_count:0," "),e.xp6(2),e.hij(" ",t.compound_event_total_count?t.compound_event_total_count:0," ")}}const Aa=function(){return["name"]},Ea=function(){return[10,20,30]};function Fa(n,r){if(1&n&&(e.TgZ(0,"p-table",67,68),e.YNc(2,Sa,15,1,"ng-template",69),e.YNc(3,Za,12,11,"ng-template",70),e.qZA()),2&n){const t=e.oxw(2);e.Q6J("value",t.driverScoreCard.slice(0,5))("autoLayout",!0)("rows",10)("globalFilterFields",e.DdM(9,Aa))("rows",10)("paginator",!1)("rowsPerPageOptions",e.DdM(10,Ea))("showCurrentPageReport",!0)("rowHover",!0)}}function Oa(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"app-bar-chart",84),e.NdJ("emitEventClick",function(a){e.CHM(t);const o=e.oxw(2);return e.KtG(o.navigateDriver(a))}),e.qZA()}if(2&n){const t=e.oxw(2);e.Q6J("height","350")("barData",t.barData)("barOptions",t.driverChartOptions)("containerId","driver-scorecard")}}function Na(n,r){if(1&n&&(e.TgZ(0,"div",64),e.YNc(1,Fa,4,11,"p-table",65),e.YNc(2,Oa,1,4,"app-bar-chart",66),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.showTop5RiskyDriversTable),e.xp6(1),e.Q6J("ngIf",!t.showTop5RiskyDriversTable)}}function Ua(n,r){1&n&&(e.TgZ(0,"div",86)(1,"p"),e._uU(2,"No least performing drivers currently."),e.qZA()())}function Ia(n,r){if(1&n&&e.YNc(0,Ua,3,0,"div",85),2&n){const t=e.oxw();e.Q6J("ngIf",t.driverScoreCard&&0===t.driverScoreCard.length)}}function ka(n,r){1&n&&e._UZ(0,"p-progressSpinner")}function Ma(n,r){if(1&n){const t=e.EpF();e.ynx(0),e.TgZ(1,"app-big-metrics-card",87),e.NdJ("click",function(){const o=e.CHM(t).$implicit,s=e.oxw();return e.KtG(s.navigateToEventsReport(o.name))}),e.qZA(),e.BQk()}if(2&n){const t=r.$implicit;e.xp6(1),e.Q6J("metricsName",t.key||"\xa0")("metricsNumber",t.value)}}function Pa(n,r){if(1&n&&e._UZ(0,"app-line-chart",88),2&n){const t=e.oxw();e.Q6J("data",t.customAlertsChartData)("height",500)}}let Ja=(()=>{class n{utilservice;driverEventAnalyticsService;eventsService;driverService;driversService;excelExportService;fleetsService;router;route;settingsService;toolbarComponent;fromDate;toDate;timeRange;unit;thisTimeRangeData;thisCustomAlerts;customAlertsChartData={labels:[],datasets:[]};customAlertsChartDataEnable=!1;cusotmAlertsChartOptions;barData;top5Events;barDataForEvents;driverChartOptions;thisEventsData;previousEventsData;aggregatedFleetsData;liabilitySummaryData;fleetPerformance;allDrivers=[];driverScoreCard=[];paginationObj={items_per_page:1e8,page_number:1};viewOptions=[{icon:"pi pi-chart-pie",justify:"Center",value:"chart"},{icon:"pi pi-table",justify:"Center",value:"table"}];showDriverScorecardSpinner=!0;exportOptionsForTopEvents;exportOptionsForLeastDrivers;orgCurrency;constructor(t,i,a,o,s,l,c,d,p,u){this.utilservice=t,this.driverEventAnalyticsService=i,this.eventsService=a,this.driverService=o,this.driversService=s,this.excelExportService=l,this.fleetsService=c,this.router=d,this.route=p,this.settingsService=u}thisMetricNumber=0;targetLoss=0;showTop5EventsTable=!1;showTop5RiskyDriversTable=!1;compoundEventsSummary=[];compoundEventsPrevSummary=[];labels=[];values=[];distance_units="mi";orgSettings;unit_header="mi";defaultView="chart";defaultViewEvents="chart";afterToolLoaded(){this.initDates(),this.orgCurrency=this.utilservice.getOrgCurrency()}initDates(){this.fromDate=this.toolbarComponent.fromDateUTC,this.toDate=this.toolbarComponent.toDateUTC,this.timeRange=this.toolbarComponent.selectedTimeRange,this.settingsService.getOrgSettings().subscribe(t=>{this.orgSettings=t,t.settings.org_common_configurations.speed_unit==m.J_[0].value?(this.distance_units="km",this.unit_header="km"):(this.distance_units="mi",this.unit_header="mi")}),this.getFleetPerformance(),this.getTop5EventsForChart(),this.getDriverScorecard(),this.getSummaryData(),this.initDefaults()}getSummaryData(){var t=m.Y5();this.fleetsService.getLiabilityAssessment(this.toolbarComponent.fromDateUTC,this.toolbarComponent.toDateUTC,t.filter_fleet_ids).subscribe(i=>{this.liabilitySummaryData=i})}getDriverScorecard(){this.processDriverScorecards()}getTop5EventsForChart(){var t=this.utilservice.getEventNamesFromEventsArray(this.toolbarComponent.allEvents);this.getEventsForFleet(t),this.getFleetEventSummary(t)}getEventsForFleet(t){var i=m.Y5();this.fleetsService.getFleetsAggregation(this.fromDate,this.toDate,i.filter_fleet_ids,t).subscribe(a=>{this.aggregatedFleetsData=a,this.setValuesForTop5Events(a.cumulative.total_events,t,a.prev_cumulative.total_events)})}getFleetPerformance(){var t=m.Y5();this.fleetsService.getFleetsPerformance(this.toolbarComponent.fromDateUTC,this.toolbarComponent.toDateUTC,t.filter_fleet_ids).subscribe(i=>{this.fleetPerformance=i})}eventLabelMapping=[];setValuesForTop5Events(t,i,a){this.compoundEventsPrevSummary=[];let o=[];this.labels=[],this.values=[],this.toolbarComponent.allEvents.compound_events.forEach(u=>{o.push(u.name)});let s=[];this.toolbarComponent.allEvents.primary_events.forEach(u=>{s.push(u.name)});let l=[],c=[];i?.forEach(u=>{-1!==s.indexOf(u)?l.push(u):-1!==o.indexOf(u)&&c.push(u)}),this.eventLabelMapping=this.utilservice.getEventDefaultLabelMapping(this.toolbarComponent.allEvents);var d=[];for(var p in this.top5Events=d,t)t.hasOwnProperty(p)&&-1!==l.indexOf(p)?d.push({key:p,value:t[p][0]}):t.hasOwnProperty(p)&&-1!==c.indexOf(p)&&this.compoundEventsPrevSummary.push({key:this.toolbarComponent.allEvents.compound_events.filter(u=>p===u.name)[0].event_configuration.display_label,value:t[p][0],name:p});d.sort(function(u,_){return _.value-u.value});for(let u=0;u<=this.top5Events.length-1;u++)this.top5Events[u]?.value>0&&(this.labels.push(this.eventLabelMapping[this.top5Events[u]?.key]),this.values.push(this.top5Events[u]?.value));this.barDataForEvents={labels:this.labels.slice(0,5),datasets:[{label:"Events",backgroundColor:this.utilservice.hexToRgba(m.mH[5]),data:this.values.slice(0,5)}]}}getFleetEventSummary(t){this.customAlertsChartDataEnable=!1;var i=m.Y5();let a=[];this.toolbarComponent.allEvents.compound_events?.forEach(u=>{a.push(u.name)});let o=[];t.forEach(u=>{-1!==a.indexOf(u)&&o.push(u)});const s=new Date(this.toolbarComponent.fromDateUTC);s.setDate(s.getDate()-1);const l=s.toISOString().split("T")[0];let c=this.utilservice.get_31_days_of_date_range(new Date(l),new Date(this.toolbarComponent.toDateUTC),31),d=[],p=!1;for(;c.length;){let u=c.shift()||"",_=this.toolbarComponent.toDateUTC;if(c.length){let b=new Date(u);b.setUTCDate(b.getUTCDate()+30),_=b.toISOString().split("T")[0]}else p=!0;this.fleetsService.getSnapshotsForFleets(u,_,i.filter_fleet_ids,o).subscribe(b=>{d=[...d,...b.data],p&&(d.sort((y,E)=>new Date(y.date).getTime()-new Date(E.date).getTime()),this.setCustomAlertChart(o,d))})}}setCustomAlertChart(t,i){const a=[],o=[];t.forEach(s=>{let l=[];i.forEach((c,d)=>{l.push(i[d+1]?.total_events[s]?.[0]-c.total_events[s]?.[0])}),o.push({label:this.utilservice.formatLabelForCharts(this.getFilteredNameForCompoundEvent(s)),backgroundColor:this.utilservice.hexToRgba(m.mH[o.length%m.mH.length],"0.1"),borderColor:m.mH[o.length%m.mH.length],borderWidth:1,fill:!0,tension:.4,data:l})}),i?.forEach(s=>{a.push(s.date)}),this.customAlertsChartData.labels=a.slice(1),this.customAlertsChartData.datasets=o,this.customAlertsChartData=JSON.parse(JSON.stringify(this.customAlertsChartData)),this.customAlertsChartDataEnable=!0}getFilteredNameForCompoundEvent(t){return this.toolbarComponent.allEvents.compound_events.filter(a=>a.name===t)[0]?.event_configuration.display_label}processDriverScorecards(){var t=m.dc();const i=this.driverService.getDriverScorecardFetch(this.toolbarComponent.fromDateUTC,this.toolbarComponent.toDateUTC,t,this.paginationObj),a=this.driversService.fetchDrivers(this.toolbarComponent.fromDateUTC,this.toolbarComponent.toDateUTC,t,void 0,this.paginationObj),o=this.driverEventAnalyticsService.getDriverCoachingReportForDriver(this.toolbarComponent.fromDateUTC,this.toolbarComponent.toDateUTC,t,this.paginationObj),s=this.driverEventAnalyticsService.getDriverTripReport(this.toolbarComponent.fromDateUTC,this.toolbarComponent.toDateUTC,t,this.paginationObj),l=this.settingsService.getOrgSettings();(0,J.D)([i,a,o,s,l]).subscribe(c=>{let d=c[0].data.sort((u,_)=>u.score>_.score?1:-1);const p=new Map;c[1].data.forEach(u=>{p.set(u.id_,{...u})}),d.forEach(u=>{const _=p.get(u.driver_id);_&&Object.assign(_,u)}),c[2].data.forEach(u=>{const _=p.get(u.driver_id);_&&Object.assign(_,u)}),c[3].data.forEach(u=>{const _=p.get(u.driver_id);_&&Object.assign(_,u)}),d=Array.from(p.values()),d&&d.length&&this.setDataForDriversChart(d)})}removeDefaultCompoundEvents(){this.driverScoreCard.forEach(t=>{t&&((void 0===t.name||""===t.name)&&(t.name=t.driver_id),t.total_events&&(t.compound_event_total_count=0,t.accidance_avoidance_total_count=0,Object.keys(t.total_events).forEach(i=>{i in m.uZ&&(t.compound_event_total_count+=t.total_events[i][0]),i in m.TU&&(t.accidance_avoidance_total_count+=t.total_events[i][0])}),t.total_count[0]=t.total_count[0]-(t.compound_event_total_count+t.accidance_avoidance_total_count),t.coaching_total_count=t.total_count[0]))})}setDataForDriversChart(t){let i=[];this.toolbarComponent.allEvents.compound_events.forEach(s=>{i.push(s.name)}),t=(t=t.filter(s=>"risky"===s?.category?.toLowerCase())).sort((s,l)=>s.score<l.score?1:-1),this.showDriverScorecardSpinner=!1,this.driverScoreCard=t.slice(0,5),this.removeDefaultCompoundEvents();const a=[],o=[];for(let s=0;s<this.driverScoreCard.length;s++)a.push(this.driverScoreCard[s].name),o.push(this.driverScoreCard[s].score);this.barData={labels:a,datasets:[{label:"Driver Score",backgroundColor:this.utilservice.hexToRgba(m.mH[3]),data:o}]},this.driverChartOptions={barPercentage:.4,indexAxis:"y",maintainAspectRatio:!1,scales:{y:{title:{display:!0},ticks:{color:"#000"}}},plugins:{legend:{display:!1}}}}getAllDrivers(t){const i=[];t.forEach(s=>{i.push(s.driver_id)});var o=m.dc();this.driverEventAnalyticsService.getAllDriversForFleets(o,i,{items_per_page:1e8,page_number:1}).subscribe(s=>{this.allDrivers=s.data,this.mergeDriverScoreAndDriverResp(t)})}mergeDriverScoreAndDriverResp(t){for(let i=0;i<t.length;i++)for(let a=0;a<this.allDrivers.length;a++)if(t[i].driver_id===this.allDrivers[a].id_){t[i]={...t[i],...this.allDrivers[a]};break}(t=this.utilservice.getUniqueDriverAnalytics(t)).forEach(i=>{i.name=i.name||"NA"}),this.setDataForDriversChart(t)}navigateToCompundAlerts(){this.router.navigate(["/settings/event-settings"],{relativeTo:this.route.firstChild})}checkIfEventIsNumber(t){return!isNaN(t.value)&&t.value>0&&"events"!==t.key&&"score"!==t.key&&"distance"!==t.key}getImageSrc(t,i){const a=this.aggregatedFleetsData.cumulative.total_events;return"assets/demo/images/events/"+t.key+"-"+(t.value/a*100>50?t.value/a*100<=10?"yellow":"red":"green")+".svg"}navigateToEventsReport(t){if(void 0!==t?.element?.index&&(t=this.top5Events[t.element.index]?.key),t){let i=location.origin+"/#/event-report?event="+t;window.open(i,"_blank")}}navigateDriver(t){this.navigateDriverWithId(this.driverScoreCard[t.element.index].driver_id)}navigateDriverWithId(t){let i=location.origin+"/#/driver-analytics?driverId="+t;window.open(i,"_blank")}convertDistance(t){if(null==t||"null"==t||null==t||isNaN(t))return 0;String(t).includes(",")&&(t=t.replace(",",""));let i=Number(String(t));return this.utilservice.convertDistance(i,this.orgSettings.settings.org_common_configurations.speed_unit)}initDefaults(){this.exportOptionsForTopEvents=[{label:"Export to Excel",icon:"pi pi-file-excel",command:()=>{this.exportDataForTopEvents("excel")}},{label:"Export to CSV",icon:"pi pi-file-excel",command:()=>{this.exportDataForTopEvents("csv")}}],this.exportOptionsForLeastDrivers=[{label:"Export to Excel",icon:"pi pi-file-excel",command:()=>{this.exportDataForLeastDrivers("excel")}},{label:"Export to CSV",icon:"pi pi-file-excel",command:()=>{this.exportDataForLeastDrivers("csv")}}]}exportDataForTopEvents(t){const i=[];this.top5Events.forEach((o,s)=>{i.push({Event:this.labels[s],Count:this.values[s]})});const a="Top events list - "+(new Date).toLocaleDateString();this.excelExportService.exportData(i,a,t)}exportDataForLeastDrivers(t){const i=[];this.driverScoreCard.forEach(o=>{i.push({Name:o.name,Score:o.score,[`Distance (${this.unit_header})`]:this.convertDistance(o.travel_distance?.[0]),Events:o.total_count?o.total_count[0]:0,"Compound Events":o.compound_event_total_count})});const a="Least performing drivers - "+(new Date).toLocaleDateString();this.excelExportService.exportData(i,a,t)}static \u0275fac=function(i){return new(i||n)(e.Y36(h.FW),e.Y36(h.NZ),e.Y36(h.nC),e.Y36(h.$H),e.Y36(h.Ft),e.Y36(m.U0),e.Y36(h.VN),e.Y36(U.F0),e.Y36(U.gz),e.Y36(h.gb))};static \u0275cmp=e.Xpm({type:n,selectors:[["app-metric-detail-op-liability"]],viewQuery:function(i,a){if(1&i&&e.Gf(I.n,5),2&i){let o;e.iGM(o=e.CRH())&&(a.toolbarComponent=o.first)}},decls:66,vars:19,consts:[[3,"showEvents","filterData","loaded"],["toolbarComponent",""],[1,"grid","mt-3"],[1,"col-12","md:col-12","xl:col-12"],[1,"card","py-3","shadow-2","border-1","border-blue-500"],[1,"mb-2"],[1,"pi","pi-info-circle","mr-2","text-xl"],[1,"text-l","mt-2"],["class","col-12 md:col-12 xl:col-12",4,"ngIf"],[1,"grid","mt-1","top-events"],[1,"col-12","md:col-6"],[1,"card","h-full","py-3"],[1,"grid"],[1,"col-12"],["class","relative mt-5",4,"ngIf"],[1,"text-lg","letter-spacing-01"],[4,"ngIf"],[1,"col-12","md:col-6","md:text-right"],[1,"ml-4","vertical-align-middle"],[1,"inline-block"],["optionLabel","icon","optionValue","value",3,"options","ngModel","onChange","ngModelChange"],["pTemplate",""],["class","inline-block",4,"ngIf"],["class","grid","id","top-5events",4,"ngIf"],[3,"chartType","height","barData","containerId","barOptions","emitEventClick",4,"ngIf"],[1,"card","h-full"],[1,"grid","align-items-center"],[1,"text-xl","letter-spacing-01"],[1,"mb-0"],["pTooltip","Top 5 risky drivers based on the timeframe and fleet selected. Click on driver to view\n                                    more details.",1,"pi","pi-info-circle","ml-1","text-lg"],[1,"inline-block","ml-4"],[1,"relative"],["styleClass","w-5rem h-5rem mt-5",4,"ngIf"],["class","mt-3 cursor-pointer",4,"ngIf","ngIfElse"],["elseBlock",""],[1,"card"],["pTooltip","Custom alerts are generated when 2 or more alerts identifed in same video. These can be\n                configured thorugh the portal.",1,"pi","pi-info-circle","ml-1","text-lg"],[1,"col-12","md:col-6","text-right"],[1,"cursor-pointer",3,"click"],[1,"pi","pi-cog","text-2xl","vertical-align-middle"],[1,"grid","relative"],[1,"col-12","cursor-pointer"],[4,"ngFor","ngForOf"],[3,"data","height",4,"ngIf"],[3,"metricsName","isPositiveChange","metricsNumber"],[3,"metricsName","metricsNumber"],[3,"metricsName","metricsNumber",4,"ngIf"],[1,"relative","mt-5"],["styleClass","w-5rem h-5rem"],["pTooltip","Top Events generated by the fleet in time frame selected.",1,"pi","pi-info-circle","ml-1","text-lg"],[3,"popup","model"],["menu",""],["pButton","","pRipple","","type","button","icon","pi pi-ellipsis-v",1,"p-button-rounded","p-button-text","p-button-secondary","p-trigger",3,"click"],["id","top-5events",1,"grid"],[1,"col-6"],["class","mb-1 list-none font-xl",4,"ngIf"],[1,"mb-1","list-none","font-xl"],[1,"inline-block","w-2rem","mb-1"],[1,"vertical-align-middle",2,"width","30px",3,"title","src"],[1,"inline-block","ml-2"],[1,"inline-block","w-12rem"],[1,"mr-3","vertical-align-middle",2,"width","30px",3,"src"],[3,"chartType","height","barData","containerId","barOptions","emitEventClick"],["styleClass","w-5rem h-5rem mt-5"],[1,"mt-3","cursor-pointer"],["responsiveLayout","scroll","dataKey","id",3,"value","autoLayout","rows","globalFilterFields","paginator","rowsPerPageOptions","showCurrentPageReport","rowHover",4,"ngIf"],[3,"height","barData","barOptions","containerId","emitEventClick",4,"ngIf"],["responsiveLayout","scroll","dataKey","id",3,"value","autoLayout","rows","globalFilterFields","paginator","rowsPerPageOptions","showCurrentPageReport","rowHover"],["dt",""],["pTemplate","header"],["pTemplate","body"],["pSortableColumn","name",1,"text-left"],["field","name"],["pSortableColumn","travel_distance",1,"text-left"],["pSortableColumn","score",1,"text-center"],["field","score"],["pSortableColumn","coaching_total_count",1,"text-center"],["field","coaching_total_count"],["pSortableColumn","compound_event_total_count",1,"text-center"],["field","compound_event_total_count"],[3,"ngClass","click"],[1,"text-left",2,"width","20%","min-width","10rem"],[1,"text-left",2,"width","12%","min-width","6rem"],[1,"text-center",2,"width","10%","min-width","6rem"],[3,"height","barData","barOptions","containerId","emitEventClick"],["class","text-center mt-3",4,"ngIf"],[1,"text-center","mt-3"],[3,"metricsName","metricsNumber","click"],[3,"data","height"]],template:function(i,a){if(1&i&&(e.TgZ(0,"app-toolbar",0,1),e.NdJ("filterData",function(){return a.initDates()})("loaded",function(){return a.afterToolLoaded()}),e.qZA(),e.TgZ(2,"div",2)(3,"div",3)(4,"div",4)(5,"h5",5),e._UZ(6,"i",6),e._uU(7,"What is this report?"),e.qZA(),e.TgZ(8,"p",7),e._uU(9,"Includes liabilities due to accidents that can be attributed to driver activities, and which could have been prevented using Driver Monitoring AI. "),e.qZA()()(),e.YNc(10,pa,11,26,"div",8),e.qZA(),e.TgZ(11,"div",9)(12,"div",10)(13,"div",11)(14,"div",12)(15,"div",13),e.YNc(16,ua,2,0,"div",14),e.TgZ(17,"div",12)(18,"div",10)(19,"div",15),e.YNc(20,da,3,0,"h5",16),e.YNc(21,_a,2,0,"h5",16),e.qZA()(),e.TgZ(22,"div",17)(23,"div",18)(24,"div",19)(25,"p-selectButton",20),e.NdJ("onChange",function(){return a.showTop5EventsTable=!a.showTop5EventsTable})("ngModelChange",function(s){return a.defaultViewEvents=s}),e.YNc(26,ma,1,2,"ng-template",21),e.qZA()(),e.YNc(27,ha,4,2,"div",22),e.qZA()()(),e.YNc(28,Ca,7,2,"div",23),e.YNc(29,Da,1,5,"app-bar-chart",24),e.qZA()()()(),e.TgZ(30,"div",10)(31,"div",25)(32,"div",26)(33,"div",10)(34,"div",27)(35,"h5",28),e._uU(36," Least Performing Drivers "),e._UZ(37,"i",29),e.qZA()()(),e.TgZ(38,"div",17)(39,"div",30)(40,"p-selectButton",20),e.NdJ("onChange",function(){return a.showTop5RiskyDriversTable=!a.showTop5RiskyDriversTable})("ngModelChange",function(s){return a.defaultView=s}),e.YNc(41,xa,1,2,"ng-template",21),e.qZA()(),e.YNc(42,Ta,4,2,"div",22),e.qZA()(),e.TgZ(43,"div",31),e.YNc(44,ya,1,0,"p-progressSpinner",32),e.qZA(),e.YNc(45,Na,3,2,"div",33),e.YNc(46,Ia,1,1,"ng-template",null,34,e.W1O),e.qZA()(),e.TgZ(48,"div",13)(49,"div",35)(50,"div",12)(51,"div",10)(52,"h5"),e._uU(53,"Your Custom Alerts "),e._UZ(54,"i",36),e.qZA()(),e.TgZ(55,"div",37)(56,"span",38),e.NdJ("click",function(){return a.navigateToCompundAlerts()}),e._uU(57," Configure "),e._UZ(58,"i",39),e.qZA()()(),e.TgZ(59,"div",40)(60,"div",40),e.YNc(61,ka,1,0,"p-progressSpinner",16),e.TgZ(62,"div",41),e.YNc(63,Ma,2,2,"ng-container",42),e.qZA(),e.TgZ(64,"div",13),e.YNc(65,Pa,1,2,"app-line-chart",43),e.qZA()()()()()()),2&i){const o=e.MAs(47);e.Q6J("showEvents",!1),e.xp6(10),e.Q6J("ngIf",a.liabilitySummaryData),e.xp6(6),e.Q6J("ngIf",!a.top5Events),e.xp6(4),e.Q6J("ngIf",!a.showTop5EventsTable),e.xp6(1),e.Q6J("ngIf",a.showTop5EventsTable),e.xp6(4),e.Q6J("options",a.viewOptions)("ngModel",a.defaultViewEvents),e.xp6(2),e.Q6J("ngIf",a.showTop5EventsTable),e.xp6(1),e.Q6J("ngIf",a.showTop5EventsTable),e.xp6(1),e.Q6J("ngIf",!a.showTop5EventsTable),e.xp6(11),e.Q6J("options",a.viewOptions)("ngModel",a.defaultView),e.xp6(2),e.Q6J("ngIf",a.showTop5RiskyDriversTable&&a.driverScoreCard.length),e.xp6(2),e.Q6J("ngIf",a.showDriverScorecardSpinner),e.xp6(1),e.Q6J("ngIf",a.driverScoreCard&&a.driverScoreCard.length)("ngIfElse",o),e.xp6(16),e.Q6J("ngIf",!a.customAlertsChartDataEnable),e.xp6(2),e.Q6J("ngForOf",a.compoundEventsPrevSummary),e.xp6(2),e.Q6J("ngIf",a.customAlertsChartDataEnable)}},dependencies:[v.mk,v.sg,v.O5,L.Hq,x.jx,q.H,Q.u,T.iA,T.lQ,T.fz,X.c,K,se,D.JJ,D.On,I.n,M.UN,B.v2,F.G,v.JJ],styles:["#top-5events app-big-metrics-card .card{min-width:180px}  app-big-metrics-card .card{max-height:90px!important}[_nghost-%COMP%]  p-progressSpinner{position:absolute;top:50%;left:50%;z-index:10}[_nghost-%COMP%]  app-big-metrics-card .card{min-width:220px}"]})}return n})();function La(n,r){1&n&&e._UZ(0,"div",3)}function Ra(n,r){1&n&&e._UZ(0,"p-progressSpinner",31)}function qa(n,r){1&n&&e._UZ(0,"p-progressSpinner",31)}function Qa(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div",20)(1,"div",27)(2,"div",11)(3,"h6",32),e._uU(4,"Event Information"),e.qZA()(),e.TgZ(5,"div",33)(6,"app-big-metrics-card",34),e.NdJ("click",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.navigateToEvents())}),e.ALo(7,"number"),e.qZA(),e.TgZ(8,"app-big-metrics-card",34),e.NdJ("click",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.navigateToEvents("compound"))}),e.ALo(9,"number"),e.qZA()()(),e.TgZ(10,"div",27)(11,"div",35)(12,"h6",32),e._uU(13,"Coaching Information"),e.qZA()(),e.TgZ(14,"div",33)(15,"app-big-metrics-card",34),e.NdJ("click",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.navigateToDrivers())}),e.ALo(16,"number"),e.qZA(),e._UZ(17,"br"),e.TgZ(18,"app-big-metrics-card",34),e.NdJ("click",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.navigateToDrivers("completed"))}),e.ALo(19,"number"),e.qZA(),e.TgZ(20,"app-big-metrics-card",34),e.NdJ("click",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.navigateToDrivers("pending"))}),e.ALo(21,"number"),e.qZA(),e.TgZ(22,"app-big-metrics-card",34),e.NdJ("click",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.navigateToDrivers("overdue"))}),e.ALo(23,"number"),e.qZA()()()()}if(2&n){const t=e.oxw();e.xp6(6),e.Q6J("metricsName","Events")("isPositiveChange",t.aggregatedFleetsData.cumulative.primary_events_count>t.aggregatedFleetsData.prev_cumulative.primary_events_count)("metricsNumber",e.lcZ(7,18,t.aggregatedFleetsData.cumulative.primary_events_count)),e.xp6(2),e.Q6J("metricsName","Compound Events")("isPositiveChange",t.compoundEventsCount>t.prevCompoundEventsCount)("metricsNumber",e.lcZ(9,20,t.compoundEventsCount)),e.xp6(7),e.Q6J("metricsName","Coachable Events")("isPositiveChange",t.utilservice.getCountOfEvents(t.aggregatedFleetsData.cumulative.coachable_events)>t.utilservice.getCountOfEvents(t.aggregatedFleetsData.prev_cumulative.coachable_events))("metricsNumber",e.lcZ(16,22,t.utilservice.getCountOfEvents(t.aggregatedFleetsData.cumulative.coachable_events))),e.xp6(3),e.Q6J("metricsName","Coaching Completed")("isPositiveChange",t.utilservice.getCountOfEvents(t.aggregatedFleetsData.cumulative.coaching_complete)>t.utilservice.getCountOfEvents(t.aggregatedFleetsData.prev_cumulative.coaching_complete))("metricsNumber",e.lcZ(19,24,t.utilservice.getCountOfEvents(t.aggregatedFleetsData.cumulative.coaching_complete))),e.xp6(2),e.Q6J("metricsName","Coaching Pending")("isPositiveChange",t.utilservice.getCountOfEvents(t.aggregatedFleetsData.cumulative.coaching_pending)>t.utilservice.getCountOfEvents(t.aggregatedFleetsData.prev_cumulative.coaching_pending))("metricsNumber",e.lcZ(21,26,t.utilservice.getCountOfEvents(t.aggregatedFleetsData.cumulative.coaching_pending))),e.xp6(2),e.Q6J("metricsName","Coaching Overdue")("isPositiveChange",t.utilservice.getCountOfEvents(t.aggregatedFleetsData.cumulative.coaching_overdue)>t.utilservice.getCountOfEvents(t.aggregatedFleetsData.prev_cumulative.coaching_overdue))("metricsNumber",e.lcZ(23,28,t.utilservice.getCountOfEvents(t.aggregatedFleetsData.cumulative.coaching_overdue)))}}function Ha(n,r){1&n&&e._UZ(0,"p-progressSpinner",31)}function Ya(n,r){if(1&n&&e._UZ(0,"app-line-chart",36),2&n){const t=e.oxw();e.Q6J("data",t.coachingTrendChartData)("height",400)}}let Va=(()=>{class n{driversService;settingsService;fleetsService;driverService;driverAnalyticsService;utilservice;eventsService;toolbarComponent;unit;thisTimeRangeScorecardData;previousTimeRangeScorecardData;thisDriverCoachingTrend;previousDriverCoachingTrend;scorecardChartData;prevScorecardChartData;coachingTrendChartData;aggregatedFleetsData;executiveSummary={};paginationObj={items_per_page:1e8,page_number:1};forkJoinSubscription;showChartSpinner=!0;prevScorecardSpinner=!0;currentScoreCardSpinner=!0;constructor(t,i,a,o,s,l,c){this.driversService=t,this.settingsService=i,this.fleetsService=a,this.driverService=o,this.driverAnalyticsService=s,this.utilservice=l,this.eventsService=c}afterToolLoaded(){this.getFleetAggregation(),this.unit=this.utilservice.getLabelForTimeValue(this.toolbarComponent.selectedTimeRange),this.getCoachingTrendChart(),this.getDriverScorecard(),this.getPreviousDriverScorecard()}riskyDrivers=[];fairDrivers=[];excellentDrivers=[];getDriverScorecard(){this.currentScoreCardSpinner=!0,this.riskyDrivers=[],this.fairDrivers=[],this.excellentDrivers=[];var t=m.dc();const i=this.driverService.getDriverScorecardFetch(this.toolbarComponent.fromDateUTC,this.toolbarComponent.toDateUTC,t,this.paginationObj),a=this.driversService.fetchDrivers(this.toolbarComponent.fromDateUTC,this.toolbarComponent.toDateUTC,t,void 0,this.paginationObj),o=this.driverAnalyticsService.getDriverCoachingReportForDriver(this.toolbarComponent.fromDateUTC,this.toolbarComponent.toDateUTC,t,this.paginationObj),s=this.driverAnalyticsService.getDriverTripReport(this.toolbarComponent.fromDateUTC,this.toolbarComponent.toDateUTC,t,this.paginationObj),l=this.settingsService.getOrgSettings();this.forkJoinSubscription=(0,J.D)([i,a,o,s,l]).subscribe(c=>{let d=c[0].data.sort((u,_)=>u.score>_.score?1:-1);const p=new Map;c[1].data.forEach(u=>{p.set(u.id_,{...u})}),d.forEach(u=>{const _=p.get(u.driver_id);_&&Object.assign(_,u)}),c[2].data.forEach(u=>{const _=p.get(u.driver_id);_&&Object.assign(_,u)}),c[3].data.forEach(u=>{const _=p.get(u.driver_id);_&&Object.assign(_,u)}),d=Array.from(p.values()),d&&d.length>0&&d.filter(u=>{"risky"===u.category?.toLowerCase()&&this.riskyDrivers.push(u),"fair"===u.category?.toLowerCase()&&this.fairDrivers.push(u),"excellent"===u.category?.toLowerCase()&&this.excellentDrivers.push(u)}),this.setDailyScorecard(d,c[4])})}prevRiskyDrivers=[];prevFairDrivers=[];prevExcellentDrivers=[];getPreviousDriverScorecard(){this.prevScorecardSpinner=!0,this.prevRiskyDrivers=[],this.prevFairDrivers=[],this.prevExcellentDrivers=[];var t=new Date(this.toolbarComponent.fromDateUTC),i=new Date(this.toolbarComponent.toDateUTC),o=(i.getTime()-t.getTime())/864e5,s=new Date(t);s.setDate(s.getDate()-o);var l=new Date(i);l.setDate(l.getDate()-o);var c=s.toISOString().split("T")[0],d=l.toISOString().split("T")[0],p=m.dc();const u=this.driverService.getDriverScorecardFetch(c,d,p,this.paginationObj),_=this.driversService.fetchDrivers(c,d,p,void 0,this.paginationObj),b=this.driverAnalyticsService.getDriverCoachingReportForDriver(c,d,p,this.paginationObj),y=this.driverAnalyticsService.getDriverTripReport(c,d,p,this.paginationObj),E=this.settingsService.getOrgSettings();(0,J.D)([u,_,b,y,E]).subscribe(k=>{let Z=k[0].data.sort((C,w)=>C.score>w.score?1:-1);const A=new Map;k[1].data.forEach(C=>{A.set(C.id_,{...C})}),Z.forEach(C=>{const w=A.get(C.driver_id);w&&Object.assign(w,C)}),k[2].data.forEach(C=>{const w=A.get(C.driver_id);w&&Object.assign(w,C)}),k[3].data.forEach(C=>{const w=A.get(C.driver_id);w&&Object.assign(w,C)}),Z=Array.from(A.values()),Z&&Z.length>0&&Z.filter(C=>{"risky"===C.category?.toLowerCase()&&this.prevRiskyDrivers.push(C),"fair"===C.category?.toLowerCase()&&this.prevFairDrivers.push(C),"excellent"===C.category?.toLowerCase()&&this.prevExcellentDrivers.push(C)}),this.setPrevDailyScorecard(Z,k[4])})}getFleetAggregation(){this.getEventsForFleet(this.toolbarComponent.selectedEvents)}gotoDrivers(t){const i=window.location.origin+"/#/driver-analytics?category="+t;window.open(i,"_blank")}compoundEventsCount=0;prevCompoundEventsCount=0;getEventsForFleet(t){this.compoundEventsCount=0,this.prevCompoundEventsCount=0;var i=m.Y5();const a=this.eventsService.getEvents(),o=this.fleetsService.getFleetsAggregation(this.toolbarComponent.fromDateUTC,this.toolbarComponent.toDateUTC,i.filter_fleet_ids,t);(0,J.D)([a,o]).subscribe(s=>{let l=s[0],c=[];l?.compound_events.forEach(d=>{c.push(d.name)}),this.aggregatedFleetsData=s[1],Object.keys(this.aggregatedFleetsData.cumulative.total_events).forEach(d=>{c.includes(d)&&(this.compoundEventsCount=this.compoundEventsCount+this.aggregatedFleetsData.cumulative.total_events[d][0])}),this.aggregatedFleetsData.cumulative.primary_events_count=this.aggregatedFleetsData.cumulative.total_count[0]-this.compoundEventsCount,Object.keys(this.aggregatedFleetsData.prev_cumulative.total_events).forEach(d=>{c.includes(d)&&(this.prevCompoundEventsCount=this.prevCompoundEventsCount+this.aggregatedFleetsData.prev_cumulative.total_events[d][0])}),this.aggregatedFleetsData.prev_cumulative.primary_events_count=this.aggregatedFleetsData.prev_cumulative.total_count[0]-this.prevCompoundEventsCount})}setScorecardChart(t,i){this.setDailyScorecard(t,i),this.setPrevDailyScorecard(t,i)}scorecardChartOptions;setDailyScorecard(t,i){this.currentScoreCardSpinner=!1;const a=Array.from({length:21},(d,p)=>5*p),o=Array(21).fill(0),s=[],l=i.settings.org_common_configurations.driver_scorecard.excellent_score,c=i.settings.org_common_configurations.driver_scorecard.fair_score;t.forEach(d=>{if(d.score>=0&&d.score<=100){const p=Math.floor(d.score/5);o[p]++}}),a.forEach(d=>{s.push(d>=l?m.mH[1]:d>=c?m.mH[5]:m.mH[3])}),this.scorecardChartData={labels:a,datasets:[{label:"",backgroundColor:s,borderColor:s,borderWidth:1,data:o}]},this.scorecardChartOptions={scales:{x:{stacked:!0,title:{display:!0,text:"Scores"}},y:{stacked:!0,title:{display:!0,text:"Number of Drivers"},ticks:{stepSize:1,callback:function(d){return Number.isInteger(d)?d:null}}}},plugins:{legend:{display:!1}}}}setPrevDailyScorecard(t,i){this.prevScorecardSpinner=!1;const a=Array.from({length:21},(d,p)=>5*p),o=Array(21).fill(0),s=[],l=i.settings.org_common_configurations.driver_scorecard.excellent_score,c=i.settings.org_common_configurations.driver_scorecard.fair_score;t.forEach(d=>{if(d.score>=0&&d.score<=100){const p=Math.floor(d.score/5);o[p]++}}),a.forEach(d=>{s.push(d>=l?m.mH[1]:d>=c?m.mH[5]:m.mH[3])}),this.prevScorecardChartData={labels:a,datasets:[{label:"",backgroundColor:s,borderColor:s,borderWidth:1,data:o}]},this.scorecardChartOptions={scales:{x:{stacked:!0,title:{display:!0,text:"Scores"}},y:{stacked:!0,title:{display:!0,text:"Number of Drivers"},ticks:{stepSize:1,callback:function(d){return Number.isInteger(d)?d:null}}}},plugins:{legend:{display:!1}}}}getCoachingTrendChart(){this.showChartSpinner=!0,this.getFleetCoachReport(this.toolbarComponent.selectedEvents)}getFleetCoachReport(t){var i=m.Y5();const a=new Date(this.toolbarComponent.fromDateUTC);a.setDate(a.getDate()-1);const o=a.toISOString().split("T")[0];let s=this.utilservice.get_31_days_of_date_range(new Date(o),new Date(this.toolbarComponent.toDateUTC),31),l=[],c=!1;for(;s.length;){let d=s.shift()||"",p=this.toolbarComponent.toDateUTC;if(s.length){let u=new Date(d);u.setUTCDate(u.getUTCDate()+30),p=u.toISOString().split("T")[0]}else c=!0;this.fleetsService.getFleetCoachingReportDaily(d,p,i.filter_fleet_ids,t).subscribe(u=>{l=[...l,...u.data],c&&(l.sort((_,b)=>new Date(_.date).getTime()-new Date(b.date).getTime()),this.setCoachingTrendChart(l))})}}setCoachingTrendChart(t){this.showChartSpinner=!1;const i=[],a=[],o=[],s=[];t.forEach((l,c)=>{i.push(l.date),a.push(c>0?l.coaching_complete_count[0]-t[c-1].coaching_complete_count[0]:l.coaching_complete_count[0]),o.push(c>0?l.coaching_pending_count[0]-t[c-1].coaching_pending_count[0]:l.coaching_pending_count[0]),s.push(c>0?l.coaching_overdue_count[0]-t[c-1].coaching_overdue_count[0]:l.coaching_overdue_count[0])}),this.coachingTrendChartData={labels:i?.slice(1),datasets:[{label:"Coaching Complete",backgroundColor:this.utilservice.hexToRgba(m.mH[0],"0.1"),borderColor:m.mH[0],borderWidth:1,data:a?.slice(1),fill:!0,tension:.4},{label:"Coaching Pending",backgroundColor:this.utilservice.hexToRgba(m.mH[8],"0.1"),borderColor:m.mH[8],borderWidth:1,data:o?.slice(1),fill:!0,tension:.4},{label:"Coaching Overdue",backgroundColor:this.utilservice.hexToRgba(m.mH[12],"0.1"),borderColor:m.mH[12],borderWidth:1,data:s?.slice(1),fill:!0,tension:.4}]}}navigateToEvents(t){let i="";i=t?window.location.origin+"/#/event-report?filter="+t:window.location.origin+"/#/event-report",window.open(i,"_blank")}navigateToDrivers(t){let i="";i=t?window.location.origin+"/#/driver-analytics?category="+t:window.location.origin+"/#/driver-analytics",window.open(i,"_blank")}ngOnDestroy(){this.forkJoinSubscription&&this.forkJoinSubscription.unsubscribe()}static \u0275fac=function(i){return new(i||n)(e.Y36(h.Ft),e.Y36(h.gb),e.Y36(h.VN),e.Y36(h.$H),e.Y36(h.NZ),e.Y36(h.FW),e.Y36(h.nC))};static \u0275cmp=e.Xpm({type:n,selectors:[["app-metric-detail-op-performance"]],viewQuery:function(i,a){if(1&i&&e.Gf(I.n,5),2&i){let o;e.iGM(o=e.CRH())&&(a.toolbarComponent=o.first)}},decls:67,vars:40,consts:[[3,"filterData","loaded"],["toolbarComponent",""],[1,"grid","mt-3"],[1,"col-12","md:col-12","xl:col-12"],[1,"card","py-3","shadow-2","border-1","border-blue-500"],[1,"mb-2"],[1,"pi","pi-info-circle","mr-2","text-xl"],[1,"text-l","mt-2"],["class","col-12 md:col-12 xl:col-12",4,"ngIf"],[1,"card","py-3","mt-2"],[1,"grid","align-items-center"],[1,"col-12"],[1,"mt-3","text-lg"],["pTooltip","We assess driver performance based on event frequency and mileage. Drive responsibly and accumulate a higher score.",1,"pi","pi-info-circle","ml-1","text-lg"],[1,"col-5","cursor-pointer"],[1,"mb-1"],[3,"metricsName","metricsNumber","click"],[1,"col-12","md:col-7","relative"],["styleClass","w-5rem h-5rem",4,"ngIf"],[3,"chartType","height","barData","barOptions","containerId"],[1,"col-12","md:col-5"],[3,"metricsName","metricsNumber"],[1,"card","py-3","mt-3"],[1,"col-12","mt-2"],["pTooltip","Trend of various coaching KPIs like reviewed, coachable, coaching pending, coaching overdue and coaching completed.",1,"pi","pi-info-circle","ml-1","text-lg"],["class","col-12 md:col-5",4,"ngIf"],[3,"data","height",4,"ngIf"],[1,"grid"],[1,"map-container"],["src","../../../../../assets/demo/images/maps.png","alt","Map image",1,"w-full"],[1,"text"],["styleClass","w-5rem h-5rem"],[1,"mb-0"],[1,"col-12","cursor-pointer"],[3,"metricsName","isPositiveChange","metricsNumber","click"],[1,"col-12","mt-3"],[3,"data","height"]],template:function(i,a){1&i&&(e.TgZ(0,"app-toolbar",0,1),e.NdJ("filterData",function(){return a.afterToolLoaded()})("loaded",function(){return a.afterToolLoaded()}),e.qZA(),e.TgZ(2,"div",2)(3,"div",3)(4,"div",4)(5,"h5",5),e._UZ(6,"i",6),e._uU(7,"What is this report?"),e.qZA(),e.TgZ(8,"p",7),e._uU(9,"Includes improvements in driver activities and road-side alerts and improvement due to driver coaching. "),e.qZA()()(),e.YNc(10,La,1,0,"div",8),e.qZA(),e.TgZ(11,"div",9)(12,"div",10)(13,"div",11)(14,"h5",12),e._uU(15,"Driver Scorecard "),e._UZ(16,"i",13),e.qZA()(),e.TgZ(17,"div",11)(18,"div",10)(19,"div",14)(20,"h6",15),e._uU(21,"Current Period"),e.qZA(),e.TgZ(22,"app-big-metrics-card",16),e.NdJ("click",function(){return a.gotoDrivers("risky")}),e.ALo(23,"number"),e.qZA(),e.TgZ(24,"app-big-metrics-card",16),e.NdJ("click",function(){return a.gotoDrivers("fair")}),e.ALo(25,"number"),e.qZA(),e.TgZ(26,"app-big-metrics-card",16),e.NdJ("click",function(){return a.gotoDrivers("excellent")}),e.ALo(27,"number"),e.qZA()(),e.TgZ(28,"div",17)(29,"div"),e.YNc(30,Ra,1,0,"p-progressSpinner",18),e.qZA(),e._UZ(31,"app-bar-chart",19),e.qZA()(),e.TgZ(32,"div",10)(33,"div",20)(34,"h6",15),e._uU(35,"Previous Period"),e.qZA(),e._UZ(36,"app-big-metrics-card",21),e.ALo(37,"number"),e._UZ(38,"app-big-metrics-card",21),e.ALo(39,"number"),e._UZ(40,"app-big-metrics-card",21),e.ALo(41,"number"),e.qZA(),e.TgZ(42,"div",17)(43,"div"),e.YNc(44,qa,1,0,"p-progressSpinner",18),e.qZA(),e._UZ(45,"app-bar-chart",19),e.qZA()()()()(),e.TgZ(46,"div",22)(47,"div",10)(48,"div",23)(49,"h5"),e._uU(50,"Driver Coaching Trend "),e._UZ(51,"i",24),e.qZA()(),e.YNc(52,Qa,24,30,"div",25),e.TgZ(53,"div",17)(54,"div"),e.YNc(55,Ha,1,0,"p-progressSpinner",18),e.qZA(),e.YNc(56,Ya,1,2,"app-line-chart",26),e.qZA()()(),e.TgZ(57,"div",22)(58,"div",27)(59,"div",11)(60,"h5"),e._uU(61,"Delivery Optimization"),e.qZA()(),e.TgZ(62,"div",11)(63,"div",28),e._UZ(64,"img",29),e.TgZ(65,"h6",30),e._uU(66,"Coming Soon..."),e.qZA()()()()()),2&i&&(e.xp6(10),e.Q6J("ngIf",a.executiveSummary),e.xp6(12),e.Q6J("metricsName","Risky Drivers")("metricsNumber",e.lcZ(23,28,a.riskyDrivers.length)),e.xp6(2),e.Q6J("metricsName","Fair Drivers")("metricsNumber",e.lcZ(25,30,a.fairDrivers.length)),e.xp6(2),e.Q6J("metricsName","Excellent Drivers")("metricsNumber",e.lcZ(27,32,a.excellentDrivers.length)),e.xp6(4),e.Q6J("ngIf",a.currentScoreCardSpinner),e.xp6(1),e.Q6J("chartType","vertical")("height","300")("barData",a.scorecardChartData)("barOptions",a.scorecardChartOptions)("containerId","driver-scorecard"),e.xp6(5),e.Q6J("metricsName","Risky Drivers")("metricsNumber",e.lcZ(37,34,a.prevRiskyDrivers.length)),e.xp6(2),e.Q6J("metricsName","Fair Drivers")("metricsNumber",e.lcZ(39,36,a.prevFairDrivers.length)),e.xp6(2),e.Q6J("metricsName","Excellent Drivers")("metricsNumber",e.lcZ(41,38,a.prevExcellentDrivers.length)),e.xp6(4),e.Q6J("ngIf",a.prevScorecardSpinner),e.xp6(1),e.Q6J("chartType","vertical")("height","300")("barData",a.prevScorecardChartData)("barOptions",a.scorecardChartOptions)("containerId","driver-scorecard"),e.xp6(7),e.Q6J("ngIf",a.aggregatedFleetsData),e.xp6(3),e.Q6J("ngIf",a.showChartSpinner),e.xp6(1),e.Q6J("ngIf",a.coachingTrendChartData))},dependencies:[v.O5,Q.u,X.c,K,se,I.n,F.G,v.JJ],styles:[".map-container[_ngcontent-%COMP%]{position:relative}.map-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{filter:blur(2px);-webkit-filter:blur(2px);-moz-filter:blur(2px);-o-filter:blur(2px);-ms-filter:blur(2px);max-height:600px}.text[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:24px;font-weight:700;text-align:center}[_nghost-%COMP%]     app-big-metrics-card .card, [_nghost-%COMP%]     app-small-metrics-card .card{min-width:180px;max-height:90px!important}[_nghost-%COMP%]     app-small-metrics-card .card{display:inline-block}[_nghost-%COMP%]     p-progressSpinner{position:absolute;top:50%;left:50%;z-index:1000}"]})}return n})(),ja=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[U.Bz.forChild([{path:"",component:kn},{path:"operational-performance",data:{breadcrumb:"Driver Assessment Report",route:"dashboard"},component:Va},{path:"operational-liability",data:{breadcrumb:"Liability Assessment Report",route:"dashboard"},component:Ja},{path:"operational-efficiency",data:{breadcrumb:"Opportunity Assessment Report",route:"dashboard"},component:la}]),U.Bz]})}return n})(),Ba=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({providers:[v.JJ],imports:[v.ez,L.hJ,q.T,ke.W,Q.z,T.U$,Ie.q4,de.L$,ce.aw,Ue.j,R.S,ja,Pe.m,Me.m,me.QK,ne.EV,ie.S,D.u5,D.UX,pe.nD,Je.l,ue.kW,_e.Iu,P.U,M.Qy,me.QK,te.FI,B.$9,F.L]})}return n})()}}]);