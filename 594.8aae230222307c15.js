"use strict";(self.webpackChunkedgetensor=self.webpackChunkedgetensor||[]).push([[594],{5594:(ue,q,d)=>{d.r(q),d.d(q,{DriverAnalyticsModule:()=>en});var i=d(6814),E=d(6223),D=d(5219),k=d(707),R=d(6760),e=d(5879);let m=(()=>{class n{static \u0275fac=function(a){return new(a||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[i.ez,D.m8]})}return n})();var v=d(3658),u=d(8057),f=d(8468);let Ze=(()=>{class n{static \u0275fac=function(a){return new(a||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[i.ez,f.x,D.m8,D.m8]})}return n})();var ce=d(4237),de=d(3530),Me=d(5359),_e=d(2160),fe=d(5609),Ie=d(3714),Ce=d(6218),xe=d(4055),De=d(1712),pe=d(7680),ve=d(4713),ne=d(2332);let we=(()=>{class n extends ve.s{pathId;ngOnInit(){this.pathId="url(#"+(0,ne.Th)()+")"}static \u0275fac=function(){let t;return function(o){return(t||(t=e.n5z(n)))(o||n)}}();static \u0275cmp=e.Xpm({type:n,selectors:[["BanIcon"]],standalone:!0,features:[e.qOj,e.jDz],decls:6,vars:7,consts:[["width","14","height","14","viewBox","0 0 14 14","fill","none","xmlns","http://www.w3.org/2000/svg"],["d","M7 0C5.61553 0 4.26215 0.410543 3.11101 1.17971C1.95987 1.94888 1.06266 3.04213 0.532846 4.32122C0.00303296 5.6003 -0.13559 7.00776 0.134506 8.36563C0.404603 9.7235 1.07129 10.9708 2.05026 11.9497C3.02922 12.9287 4.2765 13.5954 5.63437 13.8655C6.99224 14.1356 8.3997 13.997 9.67879 13.4672C10.9579 12.9373 12.0511 12.0401 12.8203 10.889C13.5895 9.73785 14 8.38447 14 7C14 5.14348 13.2625 3.36301 11.9497 2.05025C10.637 0.737498 8.85652 0 7 0ZM1.16667 7C1.16549 5.65478 1.63303 4.35118 2.48889 3.31333L10.6867 11.5111C9.83309 12.2112 8.79816 12.6544 7.70243 12.789C6.60669 12.9236 5.49527 12.744 4.49764 12.2713C3.50001 11.7986 2.65724 11.0521 2.06751 10.1188C1.47778 9.18558 1.16537 8.10397 1.16667 7ZM11.5111 10.6867L3.31334 2.48889C4.43144 1.57388 5.84966 1.10701 7.29265 1.1789C8.73565 1.2508 10.1004 1.85633 11.1221 2.87795C12.1437 3.89956 12.7492 5.26435 12.8211 6.70735C12.893 8.15034 12.4261 9.56856 11.5111 10.6867Z","fill","currentColor"],[3,"id"],["width","14","height","14","fill","white"]],template:function(a,o){1&a&&(e.O4$(),e.TgZ(0,"svg",0)(1,"g"),e._UZ(2,"path",1),e.qZA(),e.TgZ(3,"defs")(4,"clipPath",2),e._UZ(5,"rect",3),e.qZA()()()),2&a&&(e.Tol(o.getClassNames()),e.uIk("aria-label",o.ariaLabel)("aria-hidden",o.ariaHidden)("role",o.role),e.xp6(1),e.uIk("clip-path",o.pathId),e.xp6(3),e.Q6J("id",o.pathId))},encapsulation:2})}return n})(),_=(()=>{class n extends ve.s{pathId;ngOnInit(){this.pathId="url(#"+(0,ne.Th)()+")"}static \u0275fac=function(){let t;return function(o){return(t||(t=e.n5z(n)))(o||n)}}();static \u0275cmp=e.Xpm({type:n,selectors:[["StarIcon"]],standalone:!0,features:[e.qOj,e.jDz],decls:6,vars:7,consts:[["width","14","height","14","viewBox","0 0 14 14","fill","none","xmlns","http://www.w3.org/2000/svg"],["d","M10.9741 13.6721C10.8806 13.6719 10.7886 13.6483 10.7066 13.6033L7.00002 11.6545L3.29345 13.6033C3.19926 13.6539 3.09281 13.6771 2.98612 13.6703C2.87943 13.6636 2.77676 13.6271 2.6897 13.5651C2.60277 13.5014 2.53529 13.4147 2.4948 13.3148C2.45431 13.215 2.44241 13.1058 2.46042 12.9995L3.17881 8.87264L0.167699 5.95324C0.0922333 5.8777 0.039368 5.78258 0.0150625 5.67861C-0.00924303 5.57463 -0.00402231 5.46594 0.030136 5.36477C0.0621323 5.26323 0.122141 5.17278 0.203259 5.10383C0.284377 5.03488 0.383311 4.99023 0.488681 4.97501L4.63087 4.37126L6.48797 0.618832C6.54083 0.530159 6.61581 0.456732 6.70556 0.405741C6.79532 0.35475 6.89678 0.327942 7.00002 0.327942C7.10325 0.327942 7.20471 0.35475 7.29447 0.405741C7.38422 0.456732 7.4592 0.530159 7.51206 0.618832L9.36916 4.37126L13.5114 4.97501C13.6167 4.99023 13.7157 5.03488 13.7968 5.10383C13.8779 5.17278 13.9379 5.26323 13.9699 5.36477C14.0041 5.46594 14.0093 5.57463 13.985 5.67861C13.9607 5.78258 13.9078 5.8777 13.8323 5.95324L10.8212 8.87264L11.532 12.9995C11.55 13.1058 11.5381 13.215 11.4976 13.3148C11.4571 13.4147 11.3896 13.5014 11.3027 13.5651C11.2059 13.632 11.0917 13.6692 10.9741 13.6721ZM7.00002 10.4393C7.09251 10.4404 7.18371 10.4613 7.2675 10.5005L10.2098 12.029L9.65193 8.75036C9.6368 8.6584 9.64343 8.56418 9.6713 8.47526C9.69918 8.38633 9.74751 8.30518 9.81242 8.23832L12.1969 5.94559L8.90298 5.45648C8.81188 5.44198 8.72555 5.406 8.65113 5.35152C8.57671 5.29703 8.51633 5.2256 8.475 5.14314L7.00002 2.1626L5.52503 5.15078C5.4837 5.23324 5.42332 5.30467 5.3489 5.35916C5.27448 5.41365 5.18815 5.44963 5.09705 5.46412L1.80318 5.94559L4.18761 8.23832C4.25252 8.30518 4.30085 8.38633 4.32873 8.47526C4.3566 8.56418 4.36323 8.6584 4.3481 8.75036L3.7902 12.0519L6.73253 10.5234C6.81451 10.4762 6.9058 10.4475 7.00002 10.4393Z","fill","currentColor"],[3,"id"],["width","14","height","14","fill","white"]],template:function(a,o){1&a&&(e.O4$(),e.TgZ(0,"svg",0)(1,"g"),e._UZ(2,"path",1),e.qZA(),e.TgZ(3,"defs")(4,"clipPath",2),e._UZ(5,"rect",3),e.qZA()()()),2&a&&(e.Tol(o.getClassNames()),e.uIk("aria-label",o.ariaLabel)("aria-hidden",o.ariaHidden)("role",o.role),e.xp6(1),e.uIk("clip-path",o.pathId),e.xp6(3),e.Q6J("id",o.pathId))},encapsulation:2})}return n})(),x=(()=>{class n extends ve.s{pathId;ngOnInit(){this.pathId="url(#"+(0,ne.Th)()+")"}static \u0275fac=function(){let t;return function(o){return(t||(t=e.n5z(n)))(o||n)}}();static \u0275cmp=e.Xpm({type:n,selectors:[["StarFillIcon"]],standalone:!0,features:[e.qOj,e.jDz],decls:6,vars:7,consts:[["width","14","height","14","viewBox","0 0 14 14","fill","none","xmlns","http://www.w3.org/2000/svg"],["d","M13.9718 5.36453C13.9398 5.26298 13.8798 5.17252 13.7986 5.10356C13.7175 5.0346 13.6186 4.98994 13.5132 4.97472L9.37043 4.37088L7.51307 0.617955C7.46021 0.529271 7.38522 0.455834 7.29545 0.404836C7.20568 0.353838 7.1042 0.327026 7.00096 0.327026C6.89771 0.327026 6.79624 0.353838 6.70647 0.404836C6.6167 0.455834 6.54171 0.529271 6.48885 0.617955L4.63149 4.37088L0.488746 4.97472C0.383363 4.98994 0.284416 5.0346 0.203286 5.10356C0.122157 5.17252 0.0621407 5.26298 0.03014 5.36453C-0.00402286 5.46571 -0.00924428 5.57442 0.0150645 5.67841C0.0393733 5.7824 0.0922457 5.87753 0.167722 5.95308L3.17924 8.87287L2.4684 13.0003C2.45038 13.1066 2.46229 13.2158 2.50278 13.3157C2.54328 13.4156 2.61077 13.5022 2.6977 13.5659C2.78477 13.628 2.88746 13.6644 2.99416 13.6712C3.10087 13.678 3.20733 13.6547 3.30153 13.6042L7.00096 11.6551L10.708 13.6042C10.79 13.6491 10.882 13.6728 10.9755 13.673C11.0958 13.6716 11.2129 13.6343 11.3119 13.5659C11.3988 13.5022 11.4663 13.4156 11.5068 13.3157C11.5473 13.2158 11.5592 13.1066 11.5412 13.0003L10.8227 8.87287L13.8266 5.95308C13.9033 5.87835 13.9577 5.7836 13.9833 5.67957C14.009 5.57554 14.005 5.4664 13.9718 5.36453Z","fill","currentColor"],[3,"id"],["width","14","height","14","fill","white"]],template:function(a,o){1&a&&(e.O4$(),e.TgZ(0,"svg",0)(1,"g"),e._UZ(2,"path",1),e.qZA(),e.TgZ(3,"defs")(4,"clipPath",2),e._UZ(5,"rect",3),e.qZA()()()),2&a&&(e.Tol(o.getClassNames()),e.uIk("aria-label",o.ariaLabel)("aria-hidden",o.ariaHidden)("role",o.role),e.xp6(1),e.uIk("clip-path",o.pathId),e.xp6(3),e.Q6J("id",o.pathId))},encapsulation:2})}return n})();var s=d(2076);function g(n,l){if(1&n&&e._UZ(0,"span",10),2&n){const t=e.oxw(3);e.Q6J("ngClass",t.iconCancelClass)("ngStyle",t.iconCancelStyle)}}function p(n,l){if(1&n&&e._UZ(0,"BanIcon",11),2&n){const t=e.oxw(3);e.Q6J("styleClass","p-rating-icon p-rating-cancel")("ngStyle",t.iconCancelStyle),e.uIk("data-pc-section","cancelIcon")}}const h=function(n){return{"p-focus":n}};function F(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"div",5),e.NdJ("click",function(o){e.CHM(t);const r=e.oxw(2);return e.KtG(r.onOptionClick(o,0))}),e.TgZ(1,"span",6)(2,"input",7),e.NdJ("focus",function(o){e.CHM(t);const r=e.oxw(2);return e.KtG(r.onInputFocus(o,0))})("blur",function(o){e.CHM(t);const r=e.oxw(2);return e.KtG(r.onInputBlur(o))})("change",function(o){e.CHM(t);const r=e.oxw(2);return e.KtG(r.onChange(o,0))}),e.qZA()(),e.YNc(3,g,1,2,"span",8),e.YNc(4,p,1,3,"BanIcon",9),e.qZA()}if(2&n){const t=e.oxw(2);e.Q6J("ngClass",e.VKq(10,h,0===t.focusedOptionIndex()&&t.isFocusVisible)),e.uIk("data-pc-section","cancelItem"),e.xp6(1),e.uIk("data-p-hidden-accessible",!0),e.xp6(1),e.Q6J("name",t.name)("checked",0===t.value)("disabled",t.disabled)("readonly",t.readonly),e.uIk("aria-label",t.cancelAriaLabel()),e.xp6(1),e.Q6J("ngIf",t.iconCancelClass),e.xp6(1),e.Q6J("ngIf",!t.iconCancelClass)}}function oe(n,l){if(1&n&&e._UZ(0,"span",16),2&n){const t=e.oxw(4);e.Q6J("ngStyle",t.iconOffStyle)("ngClass",t.iconOffClass),e.uIk("data-pc-section","offIcon")}}function ge(n,l){if(1&n&&e._UZ(0,"StarIcon",17),2&n){const t=e.oxw(4);e.Q6J("ngStyle",t.iconOffStyle)("styleClass","p-rating-icon"),e.uIk("data-pc-section","offIcon")}}function P(n,l){if(1&n&&(e.ynx(0),e.YNc(1,oe,1,3,"span",14),e.YNc(2,ge,1,3,"StarIcon",15),e.BQk()),2&n){const t=e.oxw(3);e.xp6(1),e.Q6J("ngIf",t.iconOffClass),e.xp6(1),e.Q6J("ngIf",!t.iconOffClass)}}function L(n,l){if(1&n&&e._UZ(0,"span",19),2&n){const t=e.oxw(4);e.Q6J("ngStyle",t.iconOnStyle)("ngClass",t.iconOnClass),e.uIk("data-pc-section","onIcon")}}function Z(n,l){if(1&n&&e._UZ(0,"StarFillIcon",17),2&n){const t=e.oxw(4);e.Q6J("ngStyle",t.iconOnStyle)("styleClass","p-rating-icon p-rating-icon-active"),e.uIk("data-pc-section","onIcon")}}function me(n,l){if(1&n&&(e.ynx(0),e.YNc(1,L,1,3,"span",18),e.YNc(2,Z,1,3,"StarFillIcon",15),e.BQk()),2&n){const t=e.oxw(3);e.xp6(1),e.Q6J("ngIf",t.iconOnClass),e.xp6(1),e.Q6J("ngIf",!t.iconOnClass)}}const Ge=function(n,l){return{"p-rating-item-active":n,"p-focus":l}};function je(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"div",12),e.NdJ("click",function(o){const c=e.CHM(t).$implicit,C=e.oxw(2);return e.KtG(C.onOptionClick(o,c+1))}),e.TgZ(1,"span",6)(2,"input",7),e.NdJ("focus",function(o){const c=e.CHM(t).$implicit,C=e.oxw(2);return e.KtG(C.onInputFocus(o,c+1))})("blur",function(o){e.CHM(t);const r=e.oxw(2);return e.KtG(r.onInputBlur(o))})("change",function(o){const c=e.CHM(t).$implicit,C=e.oxw(2);return e.KtG(C.onChange(o,c+1))}),e.qZA()(),e.YNc(3,P,3,2,"ng-container",13),e.YNc(4,me,3,2,"ng-container",13),e.qZA()}if(2&n){const t=l.$implicit,a=l.index,o=e.oxw(2);e.Q6J("ngClass",e.WLB(9,Ge,t+1<=o.value,t+1===o.focusedOptionIndex()&&o.isFocusVisible)),e.xp6(1),e.uIk("data-p-hidden-accessible",!0),e.xp6(1),e.Q6J("name",o.name)("checked",0===o.value)("disabled",o.disabled)("readonly",o.readonly),e.uIk("aria-label",o.starAriaLabel(t+1)),e.xp6(1),e.Q6J("ngIf",!o.value||a>=o.value),e.xp6(1),e.Q6J("ngIf",o.value&&a<o.value)}}function ze(n,l){if(1&n&&(e.ynx(0),e.YNc(1,F,5,12,"div",3),e.YNc(2,je,5,12,"ng-template",4),e.BQk()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.cancel),e.xp6(1),e.Q6J("ngForOf",t.starsArray)}}function We(n,l){1&n&&e.GkF(0)}function $e(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"span",22),e.NdJ("click",function(o){e.CHM(t);const r=e.oxw(2);return e.KtG(r.onOptionClick(o,0))}),e.YNc(1,We,1,0,"ng-container",23),e.qZA()}if(2&n){const t=e.oxw(2);e.Q6J("ngStyle",t.iconCancelStyle),e.uIk("data-pc-section","cancelIcon"),e.xp6(1),e.Q6J("ngTemplateOutlet",t.cancelIconTemplate)}}function Xe(n,l){1&n&&e.GkF(0)}function et(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"span",24),e.NdJ("click",function(o){const c=e.CHM(t).$implicit,C=e.oxw(2);return e.KtG(C.onOptionClick(o,c+1))}),e.YNc(1,Xe,1,0,"ng-container",23),e.qZA()}if(2&n){const t=l.index,a=e.oxw(2);e.uIk("data-pc-section","onIcon"),e.xp6(1),e.Q6J("ngTemplateOutlet",a.getIconTemplate(t))}}function tt(n,l){if(1&n&&(e.YNc(0,$e,2,3,"span",20),e.YNc(1,et,2,2,"span",21)),2&n){const t=e.oxw();e.Q6J("ngIf",t.cancel),e.xp6(1),e.Q6J("ngForOf",t.starsArray)}}const it=function(n,l){return{"p-readonly":n,"p-disabled":l}},nt={provide:E.JU,useExisting:(0,e.Gpc)(()=>ot),multi:!0};let ot=(()=>{class n{cd;config;disabled;readonly;stars=5;cancel=!0;iconOnClass;iconOnStyle;iconOffClass;iconOffStyle;iconCancelClass;iconCancelStyle;onRate=new e.vpe;onCancel=new e.vpe;onFocus=new e.vpe;onBlur=new e.vpe;templates;onIconTemplate;offIconTemplate;cancelIconTemplate;value;onModelChange=()=>{};onModelTouched=()=>{};starsArray;isFocusVisibleItem=!0;focusedOptionIndex=(0,e.tdS)(-1);name;constructor(t,a){this.cd=t,this.config=a}ngOnInit(){this.name=this.name||(0,ne.Th)(),this.starsArray=[];for(let t=0;t<this.stars;t++)this.starsArray[t]=t}ngAfterContentInit(){this.templates.forEach(t=>{switch(t.getType()){case"onicon":this.onIconTemplate=t.template;break;case"officon":this.offIconTemplate=t.template;break;case"cancelicon":this.cancelIconTemplate=t.template}})}onOptionClick(t,a){if(!this.readonly&&!this.disabled){this.onOptionSelect(t,a),this.isFocusVisibleItem=!1;const o=s.p.getFirstFocusableElement(t.currentTarget,"");o&&s.p.focus(o)}}onOptionSelect(t,a){this.focusedOptionIndex.set(a),this.updateModel(t,a||null)}onChange(t,a){this.onOptionSelect(t,a),this.isFocusVisibleItem=!0}onInputBlur(t){this.focusedOptionIndex.set(-1),this.onBlur.emit(t)}onInputFocus(t,a){this.focusedOptionIndex.set(a),this.onFocus.emit(t)}updateModel(t,a){this.value=a,this.onModelChange(this.value),this.onModelTouched(),a?this.onRate.emit({originalEvent:t,value:a}):this.onCancel.emit()}cancelAriaLabel(){return this.config.translation.clear}starAriaLabel(t){return 1===t?this.config.translation.aria.star:this.config.translation.aria.stars.replace(/{star}/g,t)}getIconTemplate(t){return!this.value||t>=this.value?this.offIconTemplate:this.onIconTemplate}writeValue(t){this.value=t,this.cd.detectChanges()}registerOnChange(t){this.onModelChange=t}registerOnTouched(t){this.onModelTouched=t}setDisabledState(t){this.disabled=t,this.cd.markForCheck()}get isCustomIcon(){return this.templates&&this.templates.length>0}static \u0275fac=function(a){return new(a||n)(e.Y36(e.sBO),e.Y36(D.b4))};static \u0275cmp=e.Xpm({type:n,selectors:[["p-rating"]],contentQueries:function(a,o,r){if(1&a&&e.Suo(r,D.jx,4),2&a){let c;e.iGM(c=e.CRH())&&(o.templates=c)}},hostAttrs:[1,"p-element"],inputs:{disabled:"disabled",readonly:"readonly",stars:"stars",cancel:"cancel",iconOnClass:"iconOnClass",iconOnStyle:"iconOnStyle",iconOffClass:"iconOffClass",iconOffStyle:"iconOffStyle",iconCancelClass:"iconCancelClass",iconCancelStyle:"iconCancelStyle"},outputs:{onRate:"onRate",onCancel:"onCancel",onFocus:"onFocus",onBlur:"onBlur"},features:[e._Bn([nt])],decls:4,vars:8,consts:[[1,"p-rating",3,"ngClass"],[4,"ngIf","ngIfElse"],["customTemplate",""],["class","p-rating-item p-rating-cancel-item",3,"ngClass","click",4,"ngIf"],["ngFor","",3,"ngForOf"],[1,"p-rating-item","p-rating-cancel-item",3,"ngClass","click"],[1,"p-hidden-accessible"],["type","radio","value","0",3,"name","checked","disabled","readonly","focus","blur","change"],["class","p-rating-icon p-rating-cancel",3,"ngClass","ngStyle",4,"ngIf"],[3,"styleClass","ngStyle",4,"ngIf"],[1,"p-rating-icon","p-rating-cancel",3,"ngClass","ngStyle"],[3,"styleClass","ngStyle"],[1,"p-rating-item",3,"ngClass","click"],[4,"ngIf"],["class","p-rating-icon",3,"ngStyle","ngClass",4,"ngIf"],[3,"ngStyle","styleClass",4,"ngIf"],[1,"p-rating-icon",3,"ngStyle","ngClass"],[3,"ngStyle","styleClass"],["class","p-rating-icon p-rating-icon-active",3,"ngStyle","ngClass",4,"ngIf"],[1,"p-rating-icon","p-rating-icon-active",3,"ngStyle","ngClass"],["class","p-rating-icon p-rating-cancel",3,"ngStyle","click",4,"ngIf"],["class","p-rating-icon",3,"click",4,"ngFor","ngForOf"],[1,"p-rating-icon","p-rating-cancel",3,"ngStyle","click"],[4,"ngTemplateOutlet"],[1,"p-rating-icon",3,"click"]],template:function(a,o){if(1&a&&(e.TgZ(0,"div",0),e.YNc(1,ze,3,2,"ng-container",1),e.YNc(2,tt,2,2,"ng-template",null,2,e.W1O),e.qZA()),2&a){const r=e.MAs(3);e.Q6J("ngClass",e.WLB(5,it,o.readonly,o.disabled)),e.uIk("data-pc-name","rating")("data-pc-section","root"),e.xp6(1),e.Q6J("ngIf",!o.isCustomIcon)("ngIfElse",r)}},dependencies:function(){return[i.mk,i.sg,i.O5,i.tP,i.PC,x,_,we]},styles:["@layer primeng{.p-rating{display:inline-flex}.p-rating-icon{cursor:pointer}.p-rating.p-rating-readonly .p-rating-icon{cursor:default}}\n"],encapsulation:2,changeDetection:0})}return n})(),Je=(()=>{class n{static \u0275fac=function(a){return new(a||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[i.ez,x,_,we,D.m8]})}return n})();var qe=d(4480),Qe=d(6128),Le=d(9552),Oe=d(4844),Be=d(6263),ye=d(4104),Ne=d(3259),at=d(711),rt=d(146),st=d(1967),W=d(3173),B=d(2001),Ye=d(2096),He=d(9315),Ke=d(5600),b=d(5878),lt=d(5700),ct=d(8093);function dt(n,l){if(1&n&&(e.TgZ(0,"div",20)(1,"p",21),e._uU(2),e.qZA(),e._UZ(3,"img",22),e.qZA()),2&n){const t=e.oxw(2);let a;e.xp6(2),e.Oqu(t.driverDetails.name?t.driverDetails.name:"NA"),e.xp6(1),e.Q6J("src",null!==(a=null==t.driverDetails.images?null:t.driverDetails.images[0])&&void 0!==a?a:"assets/demo/images/settings/person_placeholder.svg",e.LSH)("alt",t.driverDetails.name)}}function _t(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"div")(1,"div",2)(2,"div",3),e._UZ(3,"img",4),e.YNc(4,dt,4,3,"ng-template",null,5,e.W1O),e.qZA(),e.TgZ(6,"div",6)(7,"div",7),e._uU(8),e.qZA()(),e.TgZ(9,"div",8)(10,"div",9)(11,"div",10),e._UZ(12,"i",11),e._uU(13,"Trips Completed: "),e.qZA(),e.TgZ(14,"span",12),e._uU(15),e.qZA(),e.TgZ(16,"i",13),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.openDriverTrips())}),e.qZA()(),e.TgZ(17,"div",14)(18,"div",15),e._UZ(19,"i",16),e._uU(20,"Hours Driven: "),e.qZA(),e.TgZ(21,"span",12),e._uU(22),e.qZA()()(),e.TgZ(23,"div",8)(24,"div",14)(25,"div",17),e._UZ(26,"i",18),e._uU(27,"Vehicle Idling Hours: "),e.qZA(),e.TgZ(28,"span",12),e._uU(29),e.qZA()(),e.TgZ(30,"div",14)(31,"div",17),e._UZ(32,"i",19),e._uU(33,"Accidents Avoided: "),e.qZA(),e.TgZ(34,"span",12),e._uU(35),e.qZA()()()()()}if(2&n){const t=e.MAs(5),a=e.oxw();let o;e.xp6(3),e.Q6J("src",null!==(o=null==a.driverDetails.images?null:a.driverDetails.images[0])&&void 0!==o?o:"assets/demo/images/settings/person_placeholder.svg",e.LSH)("alt",a.driverDetails.name)("pTooltip",t),e.xp6(5),e.hij(" ",a.driverDetails.name," "),e.xp6(7),e.Oqu(null==a.driverTripData.trips?null:a.driverTripData.trips[0]),e.xp6(7),e.Oqu(((null==a.driverTripData.travel_duration?null:a.driverTripData.travel_duration[0])>0?a.driverTripData.travel_duration[0]/3600:0).toFixed(1)),e.xp6(7),e.Oqu(((null==a.driverTripData.idling_duration?null:a.driverTripData.idling_duration[0])>0?a.driverTripData.idling_duration[0]/3600:0).toFixed(1)),e.xp6(6),e.Oqu((null==a.driverCoachingReport||null==a.driverCoachingReport.total_events||null==a.driverCoachingReport.total_events.accident_avoidance_default_compound_event?null:a.driverCoachingReport.total_events.accident_avoidance_default_compound_event[0])||0)}}let pt=(()=>{class n{utilservice;router;showDriverReport=!1;driverDetails=void 0;showDriverDetailedReport=!0;driverTripData;driverCoachingReport;units;distance_travel_label="Distance Traveled";val=3;rating=4.5;scoreLabel="Excellent";constructor(t,a){this.utilservice=t,this.router=a}ngAfterViewInit(){if(this.distance_travel_label=this.distance_travel_label+"("+this.units+")",this.showDriverReport){this.driverDetails=this.driverDetails||{},this.driverDetails.driverScore=this.driverDetails.driverScore||100,this.driverDetails.distanceTraveled=this.driverDetails.distanceTraveled||0;let t=3;this.driverDetails.driverScore>85?t=1:this.driverDetails.driverScore>=65&&(t=2);const o=new MutationObserver(()=>{let r=document.getElementsByClassName("p-chip");r.length>0&&(1===t?(r[0].classList.remove("text-yellow-500","text-red-500"),r[0].classList.add("text-green-500"),this.scoreLabel="Excellent"):2===t?(r[0].className="",r[0].classList.remove("text-green-500","text-red-500"),r[0].classList.add("text-yellow-500"),this.scoreLabel="Fair"):(r[0].classList.remove("text-green-500","text-yellow-500"),r[0].classList.add("text-red-500"),this.scoreLabel="Risky"),o.disconnect())});o.observe(document.body,{childList:!0,subtree:!0})}}getMetricDetails(){return[this.utilservice.getRandomNumber(80,100),"00:02:42",this.utilservice.getRandomNumber(1,15),this.utilservice.getRandomNumber(80,100)]}openDriverTrips(){window.open(`/#/trips?driver_id=${this.driverDetails.id_}`,"_blank")}static \u0275fac=function(a){return new(a||n)(e.Y36(b.FW),e.Y36(W.F0))};static \u0275cmp=e.Xpm({type:n,selectors:[["app-driver-report"]],inputs:{showDriverReport:"showDriverReport",driverDetails:"driverDetails",showDriverDetailedReport:"showDriverDetailedReport",driverTripData:"driverTripData",driverCoachingReport:"driverCoachingReport",units:"units"},decls:2,vars:1,consts:[[1,"grid","align-items-center"],[4,"ngIf"],[1,"px-3","pt-3"],[1,"inline-block"],[1,"md:my-0","w-9","md:w-4rem","shadow-2","w-2rem","mt-2","driver-list-img","vertical-align-middle",3,"src","alt","pTooltip"],["enlargeImage",""],[1,"ml-2","inline-block","px-3","vertical-align-middle","w-18rem"],[1,"mb-1","text-2xl","font-bold","text-break"],[1,"ml-4","inline-block","px-3","vertical-align-middle"],[1,"mb-1","flex","align-items-center"],[1,"text-lg","w-11rem","inline-block"],[1,"pi","pi-list","mr-2","text-primary","vertical-align-middle"],[1,"text-lg","ml-2","font-bold"],["title","View Driver Trips",1,"pi","pi-external-link","ml-2","text-primary","vertical-align-middle","cursor-pointer",3,"click"],[1,"mb-1"],["for","",1,"text-lg","w-11rem","inline-block"],[1,"pi","pi-clock","mr-2","text-primary","vertical-align-middle"],["for","",1,"text-lg","w-13rem","inline-block"],[1,"pi","pi-exclamation-triangle","mr-2","text-primary","vertical-align-middle"],[1,"pi","pi-shield","mr-2","text-primary","vertical-align-middle"],[1,"block","m-w-25rem","text-left"],[1,"font-semibold","text-2xl","text-break"],[1,"m-w-25rem",3,"src","alt"]],template:function(a,o){1&a&&(e._UZ(0,"div",0),e.YNc(1,_t,36,8,"div",1)),2&a&&(e.xp6(1),e.Q6J("ngIf",o.driverDetails&&o.driverTripData))},dependencies:[i.O5,Ne.u],styles:[".hidden[_ngcontent-%COMP%]{display:none}  app-big-metrics-card .card{min-width:180px}.driver-list-img[_ngcontent-%COMP%]{width:4.5rem!important;border-radius:2em!important}.pi[_ngcontent-%COMP%]{font-size:16px}"],changeDetection:0})}return n})();var vt=d(3516),gt=d(7394),mt=d(718),ut=d(4698);function ht(n,l){if(1&n&&(e.ynx(0),e._UZ(1,"p-tag",20),e.BQk()),2&n){const t=l.$implicit;e.xp6(1),e.Q6J("value",t)}}function ft(n,l){if(1&n&&(e.TgZ(0,"div",5)(1,"div",4)(2,"b"),e._uU(3," Reviewed By:"),e.qZA()(),e._uU(4),e.qZA()),2&n){const t=e.oxw();e.xp6(4),e.hij(" ",t.reviewDetails.coaching_reviewer_id_name||"N/A"," ")}}function Ct(n,l){1&n&&e._uU(0),2&n&&e.hij(" ",l.$implicit.name," ")}function xt(n,l){1&n&&e._uU(0),2&n&&e.hij(" ",l.$implicit.name," ")}function Dt(n,l){1&n&&e._uU(0),2&n&&e.hij(" ",l.$implicit.name," ")}function wt(n,l){1&n&&e._uU(0),2&n&&e.hij(" ",l.$implicit.name," ")}const Ue=function(){return{width:"100%"}},yt=function(){return{width:"100%",resize:"vertical"}},Tt=function(){return["3025"]};let bt=(()=>{class n{eventsService;messageService;spinnerService;usersRolesService;utilsService;rolesService;event;allUsers;refresh=new e.vpe;reviewStatuses=[];coachingStatuses=[];listOfEvents=[];reviewDetails;coaching_status="NA";coaching_type="UNREVIEWED";coaching_comments;dueDate;constructor(t,a,o,r,c,C){this.eventsService=t,this.messageService=a,this.spinnerService=o,this.usersRolesService=r,this.utilsService=c,this.rolesService=C}ngOnInit(){this.initDropdowns(),this.getDriverReview()}initDropdowns(){this.reviewStatuses=[{name:"Coachable",value:"COACHABLE"},{name:"Non Coachable",value:"NOTCOACHABLE"},{name:"Unreviewed",value:"UNREVIEWED"}],this.coachingStatuses=[{name:"Completed",value:"COMPLETE"},{name:"Pending",value:"PENDING"},{name:"Overdue",value:"OVERDUE "},{name:"NA",value:"NA"}]}onReviewStatusChange(t,a){if(a.isCommentsDisabled=""!==t.value,a.isDueDateDisabled="COACHABLE"===t.value,"COACHABLE"===t.value){const r=new Date((new Date).getTime()+12096e5);this.dueDate=r,this.coaching_status="PENDING"}else this.dueDate=""}getDriverReview(){this.reviewDetails=this.event.coaching_data,this.coaching_status=this.reviewDetails.coaching_status,this.coaching_type=this.reviewDetails.coaching_type,this.dueDate=this.reviewDetails.coaching_due_date?new Date(this.reviewDetails.coaching_due_date):"",this.coaching_comments=this.reviewDetails.coaching_comments,this.event.isCoachingStatusDisabled="UNREVIEWED"===this.coaching_type,this.listOfEvents=[],Object.keys(this.event.et_label).forEach(t=>{!0===this.event.et_label[t].is_true&&this.listOfEvents.push(this.utilsService.formatLabelForCharts(t))}),Object.keys(this.event.client_label).forEach(t=>{!0===this.event.client_label[t].is_true&&this.listOfEvents.push(this.utilsService.formatLabelForCharts(t))}),this.listOfEvents=[...new Set(this.listOfEvents)],this.reviewDetails.coaching_reviewer_id_name=this.getFilteredUsers(this.reviewDetails.coaching_reviewer_id)?.name,this.reviewDetails.coaching_marked_by_name=this.getFilteredUsers(this.reviewDetails.coaching_completer_id)?.name}getFilteredUsers(t){return this.allUsers.filter(a=>a.id_===t)[0]}saveReview(){this.usersRolesService.getCurrentUser().subscribe(t=>{this.event.review_data.coaching_type!==this.coaching_type&&(this.reviewDetails.coaching_reviewer_id=JSON.parse(t).id_),this.event.review_data.coaching_status!==this.coaching_status&&(this.reviewDetails.coaching_completer_id=JSON.parse(t).id_),this.updateModels(),this.submitReview()})}updateModels(){this.reviewDetails.coaching_type=this.coaching_type,this.reviewDetails.coaching_status=this.coaching_status,this.reviewDetails.coaching_comments=this.coaching_comments??this.reviewDetails.coaching_comments,this.reviewDetails.coaching_due_date=this.dueDate}submitReview(){this.spinnerService.showSpinner();const t=this.reviewDetails.id_;delete this.reviewDetails.id_,delete this.reviewDetails.deleted,delete this.reviewDetails.coaching_reviewer_id_name,delete this.reviewDetails.coaching_marked_by_name,this.eventsService.saveReview(t,this.reviewDetails).subscribe(a=>{a&&(this.spinnerService.hideSpinner(),this.messageService.add({severity:"success",summary:"Successful",detail:"Review updated successfully",life:3e3}),this.refresh.emit())})}copyToClipboard(t){const a=document.createElement("textarea");a.value=t,document.body.appendChild(a),a.select(),document.execCommand("copy"),document.body.removeChild(a),this.messageService.add({severity:"success",summary:"Successful",detail:"Device id copied to clipboard successfully",life:3e3})}static \u0275fac=function(a){return new(a||n)(e.Y36(b.nC),e.Y36(D.ez),e.Y36(b.V),e.Y36(b.Xb),e.Y36(b.FW),e.Y36(b.Nj))};static \u0275cmp=e.Xpm({type:n,selectors:[["app-driver-review"]],inputs:{event:"event",allUsers:"allUsers"},outputs:{refresh:"refresh"},features:[e._Bn([D.ez])],decls:44,vars:30,consts:[[1,"grid"],[1,"col-12","text-center"],[4,"ngFor","ngForOf"],[1,"col-12","md:col-12","description","mt-2"],[1,"w-8rem","inline-block"],[1,"col-12","md:col-6","description"],[3,"title"],[1,"pi","pi-copy","cursor-pointer","ml-2",3,"click"],["class","col-12 md:col-6 description",4,"ngIf"],[1,"mb-2"],["placeholder","Select Status...",3,"options","ngModel","ngModelChange","onChange"],["pTemplate","selectedItem"],["pTemplate","default"],[1,"w-10rem","mb-2"],["placeholder","Select Status...",3,"options","ngModel","disabled","ngModelChange"],["inputId","range",3,"readonlyInput","disabled","ngModel","ngModelChange"],[1,"col-12","description"],["rows","4","pInputTextarea","","placeholder","Comments",3,"ngModel","disabled","autoResize","ngModelChange"],[1,"mt-3","col-12","text-center"],["pButton","","styleClass","h-2rem",3,"disabled","click"],["styleClass","mr-2 px-3 text-sm",3,"value"]],template:function(a,o){1&a&&(e._UZ(0,"p-toast"),e.TgZ(1,"div",0)(2,"div",1),e.YNc(3,ht,2,1,"ng-container",2),e.qZA(),e.TgZ(4,"div",3)(5,"div",4)(6,"b"),e._uU(7," Event Time: "),e.qZA()(),e._uU(8),e.qZA(),e.TgZ(9,"div",5)(10,"div",4)(11,"b"),e._uU(12," Device Id:"),e.qZA()(),e.TgZ(13,"span",6),e._uU(14),e.qZA(),e.TgZ(15,"i",7),e.NdJ("click",function(){return o.copyToClipboard(o.event.device_id)}),e.qZA()(),e.YNc(16,ft,5,1,"div",8),e.TgZ(17,"div",5)(18,"div",9)(19,"b"),e._uU(20,"Coaching Review Status:"),e.qZA()(),e.TgZ(21,"p-dropdown",10),e.NdJ("ngModelChange",function(c){return o.coaching_type=c})("onChange",function(c){return o.onReviewStatusChange(c,o.event)}),e.YNc(22,Ct,1,1,"ng-template",11),e.YNc(23,xt,1,1,"ng-template",12),e.qZA()(),e.TgZ(24,"div",5)(25,"div",13)(26,"b"),e._uU(27," Coaching Status:"),e.qZA()(),e.TgZ(28,"p-dropdown",14),e.NdJ("ngModelChange",function(c){return o.coaching_status=c}),e.YNc(29,Dt,1,1,"ng-template",11),e.YNc(30,wt,1,1,"ng-template",12),e.qZA()(),e.TgZ(31,"div",5)(32,"div",13)(33,"b"),e._uU(34,"Due Date:"),e.qZA()(),e.TgZ(35,"p-calendar",15),e.NdJ("ngModelChange",function(c){return o.dueDate=c}),e.qZA()(),e.TgZ(36,"div",16)(37,"div",13)(38,"b"),e._uU(39," Comments:"),e.qZA()(),e.TgZ(40,"textarea",17),e.NdJ("ngModelChange",function(c){return o.coaching_comments=c}),e.qZA()(),e.TgZ(41,"div",18)(42,"button",19),e.NdJ("click",function(){return o.saveReview()}),e._uU(43,"Save"),e.qZA()()()),2&a&&(e.xp6(3),e.Q6J("ngForOf",o.listOfEvents),e.xp6(5),e.hij(" ",o.event.timestamp||"N/A"," "),e.xp6(5),e.s9C("title",o.event.device_id),e.xp6(1),e.Oqu(o.event.device_id?o.event.device_id.slice(0,5)+"...":"N/A"),e.xp6(2),e.Q6J("ngIf",o.reviewDetails),e.xp6(5),e.Akn(e.DdM(25,Ue)),e.Q6J("options",o.reviewStatuses)("ngModel",o.coaching_type),e.xp6(7),e.Akn(e.DdM(26,Ue)),e.Q6J("options",o.coachingStatuses)("ngModel",o.coaching_status)("disabled",o.event.isCoachingStatusDisabled),e.xp6(7),e.Akn(e.DdM(27,Ue)),e.Q6J("readonlyInput",!0)("disabled",!o.event.isDueDateDisabled)("ngModel",o.dueDate),e.xp6(5),e.Akn(e.DdM(28,yt)),e.Q6J("ngModel",o.coaching_comments)("disabled",!o.event.isCommentsDisabled)("autoResize",!0),e.xp6(2),e.Q6J("disabled",!o.rolesService.hasAccess(e.DdM(29,Tt))))},dependencies:[i.sg,i.O5,D.jx,E.Fj,E.JJ,E.On,Ce.g,k.Hq,Be.V,R.f,_e.Lt,ye.FN]})}return n})(),Et=(()=>{class n{item;driver;videoLoaded={};playVideo(t,a){let o=document.getElementById(t+"-"+a),r=document.getElementById(t+"-play-button-"+a),c=document.getElementById(t+"-backdrop-"+a);o.play(),c.style.display="none",r.style.display="none"}onVideoLoaded(t){this.videoLoaded[t]=!0}static \u0275fac=function(a){return new(a||n)};static \u0275cmp=e.Xpm({type:n,selectors:[["app-driver-analytics-event-videos"]],inputs:{item:"item",driver:"driver"},decls:5,vars:6,consts:[[1,"video-container"],[1,"video-wrapper"],[1,"video-backdrop",3,"id"],["onclick","arguments[0].preventDefault();","controls","",3,"id","src","muted","loadeddata"]],template:function(a,o){1&a&&(e.TgZ(0,"div",0)(1,"div",1),e._UZ(2,"div",2),e.TgZ(3,"video",3),e.NdJ("loadeddata",function(c){return o.onVideoLoaded(c)}),e._uU(4," Your browser does not support the video tag. "),e.qZA()()()),2&a&&(e.xp6(2),e.hYB("id","",o.driver.id_,"-backdrop-",o.item.index,""),e.xp6(1),e.hYB("id","",o.driver.id_,"-",o.item.index,""),e.Q6J("src",o.item.url,e.LSH)("muted",!0))},styles:[".p-tabview .p-tabview-panels{padding:0}  .dataview-videos .p-dataview.p-component.p-dataview-grid{overflow-y:scroll;max-height:1000px}  .p-dialog-footer{text-align:center!important}.video-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}.video-container[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{width:100%;height:300px}.video-container[_ngcontent-%COMP%]{height:300px;width:350px;min-height:220px;background-image:url(video-placeholder.c569469c678aa08a.png);background-size:cover;background-position:center;background:black;margin:0 auto}.video-wrapper[_ngcontent-%COMP%]{position:relative;display:inline-block}.play-button[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);z-index:1;cursor:pointer;width:50px}.video-backdrop[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;background-color:#00000040;z-index:0}"]})}return n})();const At=["refMulSel"];function St(n,l){1&n&&e._UZ(0,"p-progressSpinner",39)}function Zt(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"p-button",40),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.coachAllCompoundEvents())}),e._uU(1," Coach All Compound Events "),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("disabled",!t.onlyCompoundEvents.length)}}function Mt(n,l){if(1&n&&(e.TgZ(0,"span",43),e._uU(1),e.qZA()),2&n){const t=e.oxw(2);e.xp6(1),e.hij("(",null==t.snapshotCount?null:t.snapshotCount.unreviewed,")")}}const ae=function(n){return{"background-color":n}};function It(n,l){if(1&n&&(e.ynx(0),e._UZ(1,"div",41),e._uU(2),e.YNc(3,Mt,2,1,"span",42),e.BQk()),2&n){const t=l.$implicit;e.xp6(1),e.Q6J("ngStyle",e.VKq(3,ae,t.color)),e.xp6(1),e.hij(" ",t.name," "),e.xp6(1),e.Q6J("ngIf","Default"===t.value)}}function Ot(n,l){if(1&n&&(e.TgZ(0,"span",43),e._uU(1),e.qZA()),2&n){const t=e.oxw(2);e.xp6(1),e.hij("(",null==t.snapshotCount?null:t.snapshotCount.email_acknowledged,")")}}function Nt(n,l){if(1&n&&(e.TgZ(0,"span",43),e._uU(1),e.qZA()),2&n){const t=e.oxw(2);e.xp6(1),e.hij("(",null==t.snapshotCount?null:t.snapshotCount.email_shared,")")}}function Ut(n,l){if(1&n&&(e.ynx(0),e._UZ(1,"div",41),e._uU(2),e.YNc(3,Ot,2,1,"span",42),e.YNc(4,Nt,2,1,"span",42),e.BQk()),2&n){const t=l.$implicit;e.xp6(1),e.Q6J("ngStyle",e.VKq(4,ae,t.color)),e.xp6(1),e.hij(" ",t.name," "),e.xp6(1),e.Q6J("ngIf","EVENT_VIEWED"===t.value),e.xp6(1),e.Q6J("ngIf","EVENT_SHARED"===t.value)}}function Pt(n,l){if(1&n&&e._UZ(0,"div",41),2&n){const t=e.oxw().$implicit;e.Q6J("ngStyle",e.VKq(1,ae,t.color))}}function kt(n,l){if(1&n&&(e.TgZ(0,"span",43),e._uU(1),e.qZA()),2&n){const t=e.oxw(2);e.xp6(1),e.hij("(",null==t.snapshotCount?null:t.snapshotCount.overdue,")")}}function Rt(n,l){if(1&n&&(e.TgZ(0,"span",43),e._uU(1),e.qZA()),2&n){const t=e.oxw(2);e.xp6(1),e.hij("(",null==t.snapshotCount?null:t.snapshotCount.complete,")")}}function Vt(n,l){if(1&n&&(e.TgZ(0,"span",43),e._uU(1),e.qZA()),2&n){const t=e.oxw(2);e.xp6(1),e.hij("(",null==t.snapshotCount?null:t.snapshotCount.pending,")")}}function Ft(n,l){if(1&n&&(e.ynx(0),e.YNc(1,Pt,1,3,"div",44),e._uU(2),e.YNc(3,kt,2,1,"span",42),e.YNc(4,Rt,2,1,"span",42),e.YNc(5,Vt,2,1,"span",42),e.BQk()),2&n){const t=l.$implicit;e.xp6(1),e.Q6J("ngIf",t.color),e.xp6(1),e.hij(" ",t.name," "),e.xp6(1),e.Q6J("ngIf","OVERDUE"===t.value),e.xp6(1),e.Q6J("ngIf","COMPLETE"===t.value),e.xp6(1),e.Q6J("ngIf","PENDING"===t.value)}}function Jt(n,l){if(1&n&&(e.ynx(0),e._uU(1),e.TgZ(2,"span",43),e._uU(3),e.qZA(),e.BQk()),2&n){const t=l.$implicit,a=e.oxw(2);e.xp6(1),e.hij(" ",t.name," "),e.xp6(2),e.hij("(",(null==a.driverDetails?null:a.driverDetails.compound_event_total_count)||0,")")}}function qt(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"div",13)(1,"p-selectButton",14),e.NdJ("ngModelChange",function(o){e.CHM(t);const r=e.oxw();return e.KtG(r.selectedEventType=o)})("ngModelChange",function(o){e.CHM(t);const r=e.oxw();return e.KtG(r.filterByCompoundEvents(o))}),e.YNc(2,Jt,4,2,"ng-template",15),e.qZA()()}if(2&n){const t=e.oxw();e.xp6(1),e.Q6J("options",t.eventTypes)("ngModel",t.selectedEventType)("multiple",!1)}}function Qt(n,l){1&n&&(e.TgZ(0,"div",16),e._uU(1,"\xa0"),e.qZA())}function Lt(n,l){if(1&n&&(e.ynx(0),e.TgZ(1,"span",46),e._UZ(2,"img",47),e._uU(3),e.qZA(),e.BQk()),2&n){const t=l.$implicit;e.xp6(1),e.Q6J("title",t.name),e.xp6(1),e.Q6J("src","assets/demo/images/events/"+t.name+"-red.svg",e.LSH),e.xp6(1),e.AsE(" ",t.label," (",t.value,") ")}}function Bt(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"div",13)(1,"p-selectButton",45),e.NdJ("ngModelChange",function(o){e.CHM(t);const r=e.oxw();return e.KtG(r.filterByTopEvents(o))})("ngModelChange",function(o){e.CHM(t);const r=e.oxw();return e.KtG(r.selectedTopEvents=o)}),e.YNc(2,Lt,4,4,"ng-template",15),e.qZA()()}if(2&n){const t=e.oxw();e.xp6(1),e.Q6J("options",t.topEventList)("ngModel",t.selectedTopEvents)("multiple",!0)}}function Yt(n,l){if(1&n&&e._UZ(0,"app-driver-analytics-event-videos",58),2&n){const t=l.$implicit,a=e.oxw().$implicit;e.Q6J("item",t)("driver",a)}}const Pe=function(){return[]};function Ht(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"div",51)(1,"div")(2,"div",52)(3,"div",3)(4,"div",53)(5,"p-button",54),e.NdJ("click",function(){const r=e.CHM(t).$implicit,c=e.oxw(2);return e.KtG(c.goToEventDetail(r))}),e._uU(6,"Show event details"),e.qZA(),e.TgZ(7,"p-checkbox",55),e.NdJ("onChange",function(o){const c=e.CHM(t).$implicit,C=e.oxw(2);return e.KtG(C.toggleBGColorForCard(o,c))}),e.qZA()()(),e.TgZ(8,"p-carousel",56),e.YNc(9,Yt,1,2,"ng-template",15),e.qZA(),e.TgZ(10,"app-driver-review",57),e.NdJ("refresh",function(){e.CHM(t);const o=e.oxw(2);return e.KtG(o.getEventsForDriver(!0))}),e.qZA()()()()}if(2&n){const t=l.$implicit,a=e.oxw(2);let o;e.xp6(1),e.Gre("card shadow-2 m-3 border-1 surface-border ",t.className,""),e.xp6(6),e.Q6J("binary",!0),e.xp6(1),e.Q6J("value",null!==(o=t.video_urls)&&void 0!==o?o:e.DdM(11,Pe))("numVisible",1)("numScroll",1)("circular",!1)("responsiveOptions",a.responsiveOptions),e.xp6(2),e.Q6J("event",t)("allUsers",a.allUsers)}}function Kt(n,l){if(1&n&&(e.TgZ(0,"p-dataView",48,49),e.YNc(2,Ht,11,12,"ng-template",50),e.qZA()),2&n){const t=e.oxw();let a;e.Q6J("value",null!==(a=t.events)&&void 0!==a?a:e.DdM(1,Pe))}}function Gt(n,l){if(1&n&&(e.ynx(0),e._UZ(1,"div",41),e._uU(2),e.BQk()),2&n){const t=l.$implicit;e.xp6(1),e.ekj("border-0",!t.color),e.Q6J("ngStyle",e.VKq(4,ae,t.color)),e.xp6(1),e.hij(" ",t.name," ")}}function jt(n,l){if(1&n&&e._uU(0),2&n){const t=e.oxw(3);e.hij(" ",t.notificationStatus.length>0?t.notificationStatus.length+" Selected":"Status"," ")}}function zt(n,l){if(1&n&&(e.ynx(0),e._UZ(1,"div",41),e._uU(2),e.BQk()),2&n){const t=l.$implicit;e.xp6(1),e.ekj("border-0",!t.color),e.Q6J("ngStyle",e.VKq(4,ae,t.color)),e.xp6(1),e.hij(" ",t.name," ")}}function Wt(n,l){if(1&n&&e._uU(0),2&n){const t=e.oxw(3);e.hij(" ",t.reviewStatus.length>0?t.reviewStatus.length+" Selected":"Status"," ")}}function $t(n,l){if(1&n&&(e.ynx(0),e._UZ(1,"div",41),e._uU(2),e.BQk()),2&n){const t=l.$implicit;e.xp6(1),e.ekj("border-0",!t.color),e.Q6J("ngStyle",e.VKq(4,ae,t.color)),e.xp6(1),e.hij(" ",t.name," ")}}function Xt(n,l){if(1&n&&e._uU(0),2&n){const t=e.oxw(3);e.hij(" ",t.coachingStatus.length>0?t.coachingStatus.length+" Selected":"Status"," ")}}function ei(n,l){if(1&n&&(e.ynx(0),e._uU(1),e.BQk()),2&n){const t=l.$implicit;e.xp6(1),e.hij(" ",t.full_name," ")}}function ti(n,l){if(1&n&&e._uU(0),2&n){const t=e.oxw(3);e.hij(" ",(null==t.reviewedBy?null:t.reviewedBy.length)>0?t.reviewedBy.length+" Selected":"Users"," ")}}function ii(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"tr"),e._UZ(1,"th",63),e.TgZ(2,"th",64),e._uU(3,"Event"),e.qZA(),e.TgZ(4,"th",65),e._uU(5,"Event "),e._UZ(6,"br"),e._uU(7,"Time"),e.qZA(),e.TgZ(8,"th",66),e._uU(9,"Driver Review "),e._UZ(10,"br"),e._uU(11," Status"),e.qZA(),e.TgZ(12,"th",66),e._uU(13,"Manager Review "),e._UZ(14,"br"),e._uU(15,"Status"),e.qZA(),e.TgZ(16,"th",66),e._uU(17,"Coaching "),e._UZ(18,"br"),e._uU(19,"Status"),e.qZA(),e.TgZ(20,"th",66),e._uU(21,"Due "),e._UZ(22,"br"),e._uU(23,"Date"),e.qZA(),e.TgZ(24,"th",67),e._uU(25,"Reviewed "),e._UZ(26,"br"),e._uU(27,"By"),e.qZA(),e.TgZ(28,"th",66),e._uU(29,"Reviewed "),e._UZ(30,"br"),e._uU(31,"On"),e.qZA(),e.TgZ(32,"th",68),e._uU(33,"Event "),e._UZ(34,"br"),e._uU(35,"ID"),e.qZA()(),e.TgZ(36,"tr"),e._UZ(37,"th")(38,"th")(39,"th"),e.TgZ(40,"th",69)(41,"p-multiSelect",70),e.NdJ("ngModelChange",function(o){e.CHM(t);const r=e.oxw(2);return e.KtG(r.notificationStatus=o)})("ngModelChange",function(){e.CHM(t);const o=e.oxw(2);return e.KtG(o.applyLocalFilter())}),e.YNc(42,Gt,3,6,"ng-template",15),e.YNc(43,jt,1,1,"ng-template",71),e.qZA()(),e.TgZ(44,"th",69)(45,"p-multiSelect",70),e.NdJ("ngModelChange",function(o){e.CHM(t);const r=e.oxw(2);return e.KtG(r.reviewStatus=o)})("ngModelChange",function(){e.CHM(t);const o=e.oxw(2);return e.KtG(o.applyLocalFilter())}),e.YNc(46,zt,3,6,"ng-template",15),e.YNc(47,Wt,1,1,"ng-template",71),e.qZA()(),e.TgZ(48,"th",69)(49,"p-multiSelect",72),e.NdJ("ngModelChange",function(o){e.CHM(t);const r=e.oxw(2);return e.KtG(r.coachingStatus=o)})("ngModelChange",function(){e.CHM(t);const o=e.oxw(2);return e.KtG(o.applyLocalFilter())}),e.YNc(50,$t,3,6,"ng-template",15),e.YNc(51,Xt,1,1,"ng-template",71),e.qZA()(),e._UZ(52,"th"),e.TgZ(53,"th",69)(54,"p-multiSelect",73),e.NdJ("ngModelChange",function(o){e.CHM(t);const r=e.oxw(2);return e.KtG(r.reviewedBy=o)})("ngModelChange",function(){e.CHM(t);const o=e.oxw(2);return e.KtG(o.applyLocalFilter())}),e.YNc(55,ei,2,1,"ng-template",15),e.YNc(56,ti,1,1,"ng-template",71),e.qZA()(),e._UZ(57,"th")(58,"th"),e.qZA()}if(2&n){const t=e.oxw(2);e.xp6(41),e.Q6J("options",t.notificationStatuses)("ngModel",t.notificationStatus),e.xp6(4),e.Q6J("options",t.allReviewStatuses)("ngModel",t.reviewStatus),e.xp6(4),e.Q6J("options",t.allCoachingStatuses)("ngModel",t.coachingStatus),e.xp6(5),e.Q6J("options",t.allUsers)("ngModel",t.reviewedBy)("filter",!0)}}function ni(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"p-checkbox",84),e.NdJ("onChange",function(o){e.CHM(t);const r=e.oxw().$implicit,c=e.oxw(2);return e.KtG(c.toggleBGColorForCard(o,r))}),e.qZA()}2&n&&e.Q6J("binary",!0)}function oi(n,l){if(1&n&&e._UZ(0,"div",85),2&n){const t=e.oxw().$implicit;e.ekj("border-0",!t.eventStatusClass),e.Q6J("ngClass",t.eventStatusClass)}}function ai(n,l){1&n&&(e.TgZ(0,"div",17),e._UZ(1,"i",86),e.qZA())}function ri(n,l){if(1&n&&e._UZ(0,"img",88),2&n){const t=e.oxw().$implicit,a=e.oxw(3);e.s9C("title",a.utilservice.formatLabelForCharts(t)),e.Q6J("src",a.getItemIcon(t),e.LSH)}}function si(n,l){if(1&n&&(e.ynx(0),e.YNc(1,ri,1,2,"img",87),e.BQk()),2&n){const t=l.$implicit,a=e.oxw(3);e.xp6(1),e.Q6J("ngIf",!a.compoundEventNames.includes(t))}}const li=function(n){return{"highlighted-row":n}};function ci(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"tr",74),e.NdJ("click",function(){const r=e.CHM(t).rowIndex,c=e.oxw(2);return e.KtG(c.selectRow(r))}),e.TgZ(1,"td")(2,"div",75),e.YNc(3,ni,1,1,"p-checkbox",76),e.qZA(),e.TgZ(4,"div",17)(5,"i",77),e.NdJ("click",function(){const r=e.CHM(t).$implicit,c=e.oxw(2);return e.KtG(c.goToEventDetail(r))}),e.qZA()(),e.YNc(6,oi,1,3,"div",78),e.YNc(7,ai,2,0,"div",79),e.qZA(),e.TgZ(8,"td",69),e.YNc(9,si,2,1,"ng-container",80),e.qZA(),e.TgZ(10,"td",69),e._uU(11),e.qZA(),e.TgZ(12,"td",69),e._uU(13),e.qZA(),e.TgZ(14,"td",69),e._uU(15),e.qZA(),e.TgZ(16,"td",69),e._uU(17),e.qZA(),e.TgZ(18,"td",81),e._uU(19),e.qZA(),e.TgZ(20,"td",69),e._uU(21),e.qZA(),e.TgZ(22,"td",69),e._uU(23),e.qZA(),e.TgZ(24,"td",82)(25,"span",46),e._uU(26),e.qZA(),e.TgZ(27,"i",83),e.NdJ("click",function(){const r=e.CHM(t).$implicit,c=e.oxw(2);return e.KtG(c.copyToClipboard(r.client_provided_id))}),e.qZA()()()}if(2&n){const t=l.$implicit,a=l.rowIndex,o=e.oxw(2);e.Q6J("ngClass",e.VKq(14,li,o.selectedRowIndex===a)),e.xp6(3),e.Q6J("ngIf",!("COMPLETE"===t.coaching_data.coaching_status||"NOTCOACHABLE"===t.coaching_data.coaching_type||"INPROGRESS"===t.coaching_data.update_status)),e.xp6(3),e.Q6J("ngIf","INPROGRESS"!==t.coaching_data.update_status),e.xp6(1),e.Q6J("ngIf","INPROGRESS"===t.coaching_data.update_status),e.xp6(2),e.Q6J("ngForOf",t.et_label),e.xp6(2),e.Oqu(o.utilservice.convertToTimezone(t.timestamp,o.orgTimeZone)),e.xp6(2),e.Oqu(t.notification_status_name),e.xp6(2),e.Oqu(t.coaching_data.coaching_type_name),e.xp6(2),e.Oqu(t.coaching_data.coaching_status_name),e.xp6(2),e.Oqu(t.coaching_data.coaching_due_date),e.xp6(2),e.Oqu(t.coaching_data.coaching_reviewer_name),e.xp6(2),e.Oqu(t.coaching_data.coaching_review_date?t.coaching_data.coaching_review_date.substring(0,10):""),e.xp6(2),e.s9C("title",t.client_provided_id),e.xp6(1),e.Oqu(t.client_provided_id?"":"N/A")}}function di(n,l){if(1&n&&(e.TgZ(0,"p-table",59,60),e.YNc(2,ii,59,9,"ng-template",61),e.YNc(3,ci,28,16,"ng-template",62),e.qZA()),2&n){const t=e.oxw();let a;e.Q6J("value",null!==(a=t.events)&&void 0!==a?a:e.DdM(7,Pe))("scrollable",!0)("loadingIcon","pi pi-spinner")("sortMode","multiple")("virtualScroll",!0)("virtualScrollItemSize",80)("lazy",!0)}}function _i(n,l){if(1&n&&(e.TgZ(0,"span",89),e._uU(1,"Filtered Reviews: "),e.TgZ(2,"b"),e._uU(3),e.qZA()()),2&n){const t=e.oxw();e.xp6(3),e.Oqu(t.events.length)}}function pi(n,l){if(1&n&&(e.ynx(0),e.TgZ(1,"div",51)(2,"div",91)(3,"div",52),e._UZ(4,"app-driver-analytics-event-videos",58),e.qZA()()(),e.BQk()),2&n){const t=l.$implicit,a=e.oxw(2);e.xp6(4),e.Q6J("item",t)("driver",a.selectedDriver)}}function vi(n,l){if(1&n&&(e.TgZ(0,"div",90),e.YNc(1,pi,5,2,"ng-container",80),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.selectedDriver.video_urls)}}function gi(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"app-share-events",92),e.NdJ("refresh",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.getEventsForDriver(!0))}),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("users",t.allUsers)("driverDetails",t.driverDetails)("selectedEventIds",t.selectedEventIds)("events",t.events)("showShareEvents",!0)}}function mi(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"p-dialog",93),e.NdJ("visibleChange",function(o){e.CHM(t);const r=e.oxw();return e.KtG(r.eventsDetailDialog=o)})("onHide",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.eventsDetailDialog=!1)}),e.TgZ(1,"app-event-details",94),e.NdJ("refreshEvents",function(o){e.CHM(t);const r=e.oxw();return e.KtG(r.updateReviewObj(o))}),e.qZA()()}if(2&n){const t=e.oxw();e.MGl("header","Event details with event id: ",t.selectedDriver.client_provided_id,""),e.Q6J("visible",t.eventsDetailDialog)("maximizable",!0)("closable",!0)("modal",!0),e.xp6(1),e.Q6J("selectedEventFromParent",t.selectedDriver)("compoundEventNames",t.compoundEventNames)("orgSettings",t.orgSettings)}}const ke=function(){return{width:"550px"}},ui=function(){return{width:"550px",height:"350px"}};let hi=(()=>{class n{usersRolesService;router;route;spinnerService;messageService;eventsService;utilservice;authenticationService;driverCoachingService;refMulSelS;toolbarComponent;driverDetails;filterFromCoachingReport;allDrivers;compoundEventNames=[];allEventNames=[];orgSettings;driverVideos=[];subscription;events=[];reviewStatuses=[];coachingStatuses=[];notificationStatuses=[];allUsers=[];responsiveOptions;shareEventsDialog=!1;showAllVideosDialog=!1;showMultiSelectEmail=!0;selectedEmailIds=[];selectedEventIds=[];reviewStatus=[];coachingStatus=[];notificationStatus=[];selectedTopEvents=[];reviewedBy;totalRecords=0;page=0;rows=10;paginationObj;selectedDriver;emailIds=[];eventsDetailDialog=!1;showTable=!0;viewOptions=[{icon:"pi pi-table",justify:"Center",value:"table"},{icon:"pi pi-th-large",justify:"Center",value:"grid"}];defaultView="chart";markAllDialog=!1;coachAllCompoundDialog=!1;showShareEvents=!1;selectedEventType;eventTypes=[];filteredCompoundEvents=[];allReviewStatuses=[];allCoachingStatuses=[];allNotificationStatuses=[];onlyCompoundEvents=[];onlyCompoundEventsName=[];onlyAcknowledgedEvents=[];snapshotCount;compoundEventIcons={};selectedRowIndex=null;topEventList=[];driverChanged=!0;orgTimeZone="";eventsWithoutFilters=[];showSpinner=!1;get filteredNotificationStatuses(){return this.notificationStatuses.filter(t=>"Default"!==t.value)}constructor(t,a,o,r,c,C,M,O,A){this.usersRolesService=t,this.router=a,this.route=o,this.spinnerService=r,this.messageService=c,this.eventsService=C,this.utilservice=M,this.authenticationService=O,this.driverCoachingService=A}ngOnInit(){this.subscription=new gt.w0,this.initFilters(),this.setCarouselSettings(),this.getEventsForDriver(),this.checkRole(),this.orgTimeZone=this.orgSettings?.timezone||"GMT"}ngAfterViewInit(){}initFilters(){const t=getComputedStyle(document.documentElement);this.eventTypes=[{name:"Compound Events",value:"COMPOUND"}],this.reviewStatuses=[{name:"Unreviewed",value:"Default",color:t.getPropertyValue("--chart-color-11")}],this.coachingStatuses=[{name:"Pending",value:"PENDING",color:t.getPropertyValue("--chart-color-10")},{name:"Overdue",value:"OVERDUE",color:t.getPropertyValue("--chart-color-4")},{name:"Completed",value:"COMPLETE",color:t.getPropertyValue("--chart-color-8")}],this.notificationStatuses=[{name:"Email Shared",value:"EVENT_SHARED",color:t.getPropertyValue("--chart-color-9")},{name:"Email Acknowledged",value:"EVENT_VIEWED",color:t.getPropertyValue("--chart-color-1")},{name:"Default",value:"Default",color:t.getPropertyValue("--chart-color-11")}],this.allReviewStatuses=[{name:"Coachable",value:"COACHABLE"},{name:"Non Coachable",value:"NOTCOACHABLE"},{name:"Default",value:"Default"}],this.allCoachingStatuses=[{name:"Pending",value:"PENDING",color:t.getPropertyValue("--chart-color-10")},{name:"Overdue",value:"OVERDUE",color:t.getPropertyValue("--chart-color-4")},{name:"Completed",value:"COMPLETE",color:t.getPropertyValue("--chart-color-8")}],this.allNotificationStatuses=[{name:"Event Genrated",value:"EVENT_GENERATED"},{name:"Share Requested",value:"SHARE_REQUESTED"},{name:"Email Shared",value:"EVENT_SHARED",color:t.getPropertyValue("--chart-color-9")},{name:"Email Acknowledged",value:"EVENT_VIEWED",color:t.getPropertyValue("--chart-color-1")}]}getEventsForDriver(t){this.events=[],this.showSpinner=!0,this.shareEventsDialog=!1,this.coachAllCompoundDialog=!1,this.markAllDialog=!1,this.selectedEventIds=[];var a=B.dc();this.setPagination();const o=[this.driverDetails.id_];let c=this.toolbarComponent.selectedEvents&&this.toolbarComponent.selectedEvents.length?this.toolbarComponent.selectedEvents:this.allEventNames;const C=this.allUsers&&this.allUsers.length?(0,Ye.of)(this.allUsers):this.usersRolesService.getUsers();(0,He.D)([C,this.eventsService.getAllEventsAndReviewsForDriver(this.toolbarComponent.fromDateUTC,this.toolbarComponent.toDateUTC,a,this.paginationObj,o,this.reviewStatus,this.coachingStatus,[]??void 0,c,this.notificationStatus),this.eventsService.getSnapshotCount(this.toolbarComponent.fromDateUTC,this.toolbarComponent.toDateUTC,this.driverDetails.fleet_id,o?.[0],c)]).subscribe(([M,O,A])=>{this.showSpinner=!1,M.forEach(I=>{I.full_name=I.first_name+" "+I.last_name}),this.allUsers=M,(this.driverChanged||t)&&(this.snapshotCount=A,this.driverChanged=!1),this.totalRecords=O.total_items,this.calculateCoachingData(O),this.eventsWithoutFilters=O.data,this.events=O.data,this.events.sort((I,J)=>J.et_label.length-I.et_label.length),this.categorizeEvents(),this.toolbarComponent.allEvents.compound_events.forEach(I=>{null!=I.event_configuration&&(this.compoundEventIcons[I.name]=I.event_configuration.display_icon)}),this.calculateTopEvents(),this.spinnerService.hideSpinner()},M=>{console.error("Error:",M),this.spinnerService.hideSpinner()})}calculateCoachingData(t){t.data&&t.data.length>0&&t.data.forEach(a=>{if(a&&a.videos){if(a.video_urls=[],Object.keys(a.videos).forEach((o,r)=>{a.video_urls.push({url:a.videos[o].url,index:r})}),a.coaching_data.coaching_reviewer_id){const o=this.allUsers.find(r=>r.id_===a.coaching_data.coaching_reviewer_id);a.coaching_data.coaching_reviewer_name=o?o.first_name+" "+o.last_name:""}if(a.coaching_data.coaching_completer_id){const o=this.allUsers.find(r=>r.id_===a.coaching_data.coaching_completer_id);a.coaching_data.coaching_completor_name=o?o.first_name+" "+o.last_name:""}a.eventStatusClass=this.getEventStatusClass(a),a.notification_status&&(a.notification_status_name=this.notificationStatuses.find(o=>o.value===a.notification_status)?.name||"Default"),a.coaching_data.coaching_type&&(a.coaching_data.coaching_type_name=this.allReviewStatuses.find(o=>o.value===a.coaching_data.coaching_type)?.name||"Default"),a.coaching_data.coaching_status&&(a.coaching_data.coaching_status_name=this.allCoachingStatuses.find(o=>o.value===a.coaching_data.coaching_status)?.name||"")}})}calculateTopEvents(){this.topEventList=[];const t=[];if(this.driverDetails.total_events){const o=Object.entries(this.driverDetails.total_events).sort((c,C)=>C[1][0]-c[1][0]).slice(0,5),r=this.toolbarComponent.allEvents.primary_events;o.forEach(c=>{if(c[1][0]>0){const C=r.find(M=>M.name===c[0])?.event_configuration?.display_label;C&&t.push({name:c[0],value:c[1][0],label:C})}})}this.topEventList=t}getEventStatusClass(t){let a="";return"UNREVIEWED"===t.coaching_data.coaching_type&&(a="unreviewed"),"PENDING"===t.coaching_data.coaching_status&&(a="pending"),"EVENT_SHARED"===t.notification_status&&(a="coachable"),"EVENT_VIEWED"===t.notification_status&&(a="acknowledged"),"EVENT_VIEWED"===t.notification_status&&"COMPLETE"===t.coaching_data.coaching_status&&(a="completed"),a}getDriverCoaching(){var t=B.Y5();this.driverCoachingService.getDriverCoaching(this.toolbarComponent.fromDateUTC,this.toolbarComponent.toDateUTC,t?t.fleet_id:"",this.driverDetails.faceId).subscribe(o=>{this.driverVideos=o.data})}goToDriverDetail(t){this.router.navigate(["driver-coaching/"+t.faceId],{relativeTo:this.route})}goToEventDetail(t){this.eventsDetailDialog=!0;let o=this.toolbarComponent.devicesList.find(r=>r.id_===t.device_id);t.plate_number=o?.plate_number,this.selectedDriver=t}getItemIcon(t){let a="assets/demo/images/events/"+t+"-red.svg";return null!=this.compoundEventIcons[t]&&(a=this.compoundEventIcons[t]),a}openAllVideos(t){this.selectedDriver=t,this.showAllVideosDialog=!0}selectedUsersForSharing(t){console.log(t)}coachAllCompoundEvents(){this.coachAllCompoundDialog=!0}shareEvents(){this.shareEventsDialog=!0}setCarouselSettings(){this.responsiveOptions=[{breakpoint:"1199px",numVisible:1},{breakpoint:"991px",numVisible:1},{breakpoint:"767px",numVisible:1}]}toggleEmailSelection(){this.showMultiSelectEmail=!this.showMultiSelectEmail}toggleBGColorForCard(t,a){a.className=t.checked?"bg-primary":"bg-white",t.checked?this.selectedEventIds.push(a.id_):this.selectedEventIds=this.selectedEventIds.filter(o=>o!==a.id_)}markAllEventsDone(){this.markAllDialog=!0}confirmMarkAllDone(){this.spinnerService.showSpinner();let t={coaching_type:"COACHABLE",coaching_status:"COMPLETE"};const a=this.events.map(o=>this.eventsService.saveReview(o.id_,t).toPromise());Promise.all(a).then(()=>{this.markAllDialog=!1,this.spinnerService.hideSpinner(),this.messageService.add({severity:"success",summary:"Successful",detail:"Review updated successfully"})}).catch(o=>{this.spinnerService.hideSpinner(),this.messageService.add({severity:"error",summary:"Error",detail:o})})}filterByCompoundEvents(t){this.selectedTopEvents=[],t?.length?((this.toolbarComponent.selectedEvents.length>0?this.toolbarComponent.selectedEvents:this.allEventNames).forEach(o=>{this.available_compound_events.indexOf(o)>-1&&this.filteredCompoundEvents.push(o)}),this.applyLocalFilter(this.filteredCompoundEvents)):(this.filteredCompoundEvents=[],this.selectedEventType=null,this.applyLocalFilter())}filterByTopEvents(t){this.selectedEventType=null,this.applyLocalFilter(t)}selectRow(t){this.selectedRowIndex=t}available_compound_events=[];categorizeEvents(){this.onlyAcknowledgedEvents=[],this.onlyCompoundEvents=[],this.onlyCompoundEventsName=[],this.toolbarComponent.allEvents.compound_events&&this.toolbarComponent.allEvents.compound_events.forEach(t=>{this.available_compound_events.push(t.name)}),this.events.forEach(t=>{t.et_label.forEach(a=>{if(this.available_compound_events.indexOf(a)>-1&&"COMPLETE"!=t.coaching_data.coaching_status&&"EVENT_SHARED"!==t.notification_status&&-1==this.onlyCompoundEvents.indexOf(t.id_))return this.onlyCompoundEvents.push(t.id_),void this.onlyCompoundEventsName.push(a)}),"EVENT_VIEWED"===t.notification_status&&"COMPLETE"!=t.coaching_data.coaching_status&&"NOTCOACHABLE"!=t.coaching_data.coaching_type&&-1==this.onlyAcknowledgedEvents.indexOf(t.id_)&&this.onlyAcknowledgedEvents.push(t.id_)})}applyLocalFilter(t){this.events=this.eventsWithoutFilters.filter(a=>{let o=!0,r=!0,c=!0,C=!0,M=!0;return this.reviewStatus.length>0&&(o=this.reviewStatus.filter(A=>this.allReviewStatuses.find(J=>J.value===A)?.name.toLowerCase()===a.coaching_data.coaching_type_name.toLowerCase()).length>0),this.notificationStatus.length>0&&(r=this.notificationStatus.filter(A=>this.notificationStatuses.find(J=>J.value===A)?.name.toLowerCase()===a.notification_status_name.toLowerCase()).length>0),this.coachingStatus.length>0&&(c=this.coachingStatus.filter(A=>this.allCoachingStatuses.find(J=>J.value===A)?.name.toLowerCase()===a.coaching_data.coaching_status_name.toLowerCase()).length>0),this.reviewedBy?.length>0&&(C=this.reviewedBy.map(A=>A.id_).includes(a.coaching_data.coaching_reviewer_id)),t&&t?.length>0&&(M=t.filter(A=>a.et_label.includes(A)).length>0),o&&r&&c&&C&&(!t||M)})}refreshSnapshots(){this.coachingStatus=[],this.reviewStatus=[],this.notificationStatus=[],this.reviewedBy=[],this.getEventsForDriver()}updateReviewObj(t){this.events.forEach(a=>{a.id_===t.id_&&(a=t)})}setPagination(){this.paginationObj={sort_order:"desc",items_per_page:1e6,page_number:this.page+1,sort_field:"timestamp"}}onPageChange(t){this.page=t.page,this.rows=t.rows,this.spinnerService.showSpinner()}copyToClipboard(t){const a=document.createElement("textarea");a.value=t,document.body.appendChild(a),a.select(),document.execCommand("copy"),document.body.removeChild(a),this.messageService.add({severity:"success",summary:"Successful",detail:"Event id copied to clipboard successfully",life:3e3})}hideCoachAllCompoundEvents=!1;checkRole(){let a=["VIEWER"];this.hideCoachAllCompoundEvents=this.authenticationService.userValue.roles.some(o=>!a.includes(o))}ngOnChanges(t){t.driverDetails&&(this.driverDetails=t.driverDetails.currentValue,t.driverDetails.currentValue?.driver_id!==t.driverDetails.previousValue?.driver_id&&(this.driverChanged=!0),this.getEventsForDriver()),this.filterFromCoachingReport&&("NOTCOACHABLE"===this.filterFromCoachingReport||"UNREVIEWED"===this.filterFromCoachingReport?this.reviewStatus=this.filterFromCoachingReport:("COMPLETE"===this.filterFromCoachingReport||"PENDING"===this.filterFromCoachingReport||"OVERDUE"===this.filterFromCoachingReport)&&(this.coachingStatus=this.filterFromCoachingReport))}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}static \u0275fac=function(a){return new(a||n)(e.Y36(b.Xb),e.Y36(W.F0),e.Y36(W.gz),e.Y36(b.V),e.Y36(D.ez),e.Y36(b.nC),e.Y36(b.FW),e.Y36(b.$h),e.Y36(b.$H))};static \u0275cmp=e.Xpm({type:n,selectors:[["app-driver-analytics-videos"]],viewQuery:function(a,o){if(1&a&&e.Gf(At,5),2&a){let r;e.iGM(r=e.CRH())&&(o.refMulSelS=r.first)}},inputs:{toolbarComponent:"toolbarComponent",driverDetails:"driverDetails",filterFromCoachingReport:"filterFromCoachingReport",allDrivers:"allDrivers",compoundEventNames:"compoundEventNames",allEventNames:"allEventNames",orgSettings:"orgSettings"},features:[e._Bn([D.ez]),e.TTD],decls:82,vars:55,consts:[["styleClass","w-5rem h-5rem",4,"ngIf"],["id","filters",1,"grid","mt-2","mb-3","border-bottom-1","border-300","p-2","mx-2"],[1,"col-12"],[1,"grid"],["id","filter-buttons",1,"col-12","md:col-8"],["styleClass","ml-1","title","Share selected events",3,"disabled","click"],["styleClass","ml-2","title","Coach all compound events",3,"disabled","click",4,"ngIf"],["styleClass","ml-2","title","Mark all events done",3,"disabled","click"],[1,"col-12","md:col-4","text-right"],[1,"vertical-align-middle","inline-block"],["icon","pi pi-refresh","styleClass","w-2rem h-2rem ml-1","title","Refresh snapshots",3,"click"],[1,"col-12","pt-0","filter-container"],[1,"col-12","align-items-center"],[1,"inline-block","vertical-align-middle"],["optionLabel","name","optionValue","value",3,"options","ngModel","multiple","ngModelChange"],["pTemplate","item"],[1,"mx-2","border-right-1","inline-block","vertical-align-middle"],[1,"inline-block"],[1,"border-top-1","w-full","border-300","mb-2"],[1,"col-12","filter-container"],["class","inline-block vertical-align-middle",4,"ngIf"],["class","mx-2 border-right-1 inline-block vertical-align-middle",4,"ngIf"],["layout","grid",3,"value",4,"ngIf"],["scrollHeight","calc(100vh - 400px)",3,"value","scrollable","loadingIcon","sortMode","virtualScroll","virtualScrollItemSize","lazy",4,"ngIf"],[1,"text-center","mt-4"],["class","ml-4",4,"ngIf"],["header","All videos for event",1,"p-fluid",3,"visible","modal","visibleChange"],["pTemplate","content"],["header","Share selected events",1,"p-fluid",3,"visible","modal","visibleChange"],["styleClass","mx-3 sm:mx-0 sm:w-full md:w-11 h-screen","contentStyleClass","border-round-bottom border-top-1 surface-border p-0",3,"visible","maximizable","closable","header","modal","visibleChange","onHide",4,"ngIf"],["header","Confirm",3,"visible","modal","visibleChange"],[1,"pi","pi-exclamation-triangle","mr-3",2,"font-size","1rem"],[3,"toolbarComponent","users","driverDetails","selectedEventIds","events","coachAcknowledged","refresh"],["header","Coach Compound Events",3,"visible","modal","visibleChange"],[1,"my-4"],["htmlFor","shareEvents",1,"font-semibold"],[1,"inline-block","ml-3","vertical-align-middle"],[3,"ngModel","ngModelChange"],[3,"toolbarComponent","users","driverDetails","showShareEvents","selectedEventIds","events","coachCompoundEvents","refresh"],["styleClass","w-5rem h-5rem"],["styleClass","ml-2","title","Coach all compound events",3,"disabled","click"],[1,"w-1rem","h-1rem","mr-1","inline-block","vertical-align-text-bottom","border-1",3,"ngStyle"],["class","ml-1",4,"ngIf"],[1,"ml-1"],["class","w-1rem h-1rem mr-1 inline-block vertical-align-text-bottom border-1",3,"ngStyle",4,"ngIf"],["optionLabel","label","optionValue","name",3,"options","ngModel","multiple","ngModelChange"],[3,"title"],[1,"mr-1","vertical-align-middle",2,"width","30px",3,"src"],["layout","grid",3,"value"],["dv",""],["pTemplate","gridItem"],["id","gallery",1,"col-12","md:col-6"],[1,"flex","flex-column","align-items-center"],[1,"col-12","text-center","mb-2"],["styleClass","h-2rem mr-2",3,"click"],["name","checkbox","value","true","styleClass","ml-3","title","Select to share events",3,"binary","onChange"],[3,"value","numVisible","numScroll","circular","responsiveOptions"],[3,"event","allUsers","refresh"],[3,"item","driver"],["scrollHeight","calc(100vh - 400px)",3,"value","scrollable","loadingIcon","sortMode","virtualScroll","virtualScrollItemSize","lazy"],["dt",""],["pTemplate","header"],["pTemplate","body"],[1,"w-8rem","text-center"],[1,"w-12rem","text-left"],[1,"w-8rem","text-left"],[1,"w-4rem","text-left"],[1,"w-5rem","text-left"],[1,"w-4rem","text-center"],[1,"text-left"],["appendTo","body","styleClass","w-10rem","optionLabel","name","optionValue","value","placeholder","Status",3,"options","ngModel","ngModelChange"],["pTemplate","selectedItems"],["appendTo","body","styleClass","w-10rem","optionLabel","name","optionValue","value","placeholder","Select Event...",3,"options","ngModel","ngModelChange"],["appendTo","body","styleClass","w-10rem","placeholder","Select User...","filterBy","full_name","filterMode","contains","optionLabel","full_name",3,"options","ngModel","filter","ngModelChange"],[3,"ngClass","click"],[1,"inline-block","ml-2",2,"width","22px","height","22px"],["name","checkbox","value","true","title","Select to share events",3,"binary","onChange",4,"ngIf"],["title","Show Event Videos",1,"pi","pi-video","cursor-pointer","text-3xl","mx-3",3,"click"],["class","status-box",3,"ngClass","border-0",4,"ngIf"],["class","inline-block",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"w-6rem","text-left"],[1,"text-center"],[1,"pi","pi-copy","cursor-pointer","ml-2",3,"click"],["name","checkbox","value","true","title","Select to share events",3,"binary","onChange"],[1,"status-box",3,"ngClass"],["title","Event is being updated",1,"pi","pi-spin","pi-spinner","cursor-pointer","text-3xl"],["class","vertical-align-middle events-icon text-center ml-1","onerror","this.src='assets/demo/images/other/default.png'",3,"title","src",4,"ngIf"],["onerror","this.src='assets/demo/images/other/default.png'",1,"vertical-align-middle","events-icon","text-center","ml-1",3,"title","src"],[1,"ml-4"],[1,"row"],[1,"card","shadow-2","m-3","border-1","surface-border"],[3,"users","driverDetails","selectedEventIds","events","showShareEvents","refresh"],["styleClass","mx-3 sm:mx-0 sm:w-full md:w-11 h-screen","contentStyleClass","border-round-bottom border-top-1 surface-border p-0",3,"visible","maximizable","closable","header","modal","visibleChange","onHide"],[3,"selectedEventFromParent","compoundEventNames","orgSettings","refreshEvents"]],template:function(a,o){1&a&&(e.YNc(0,St,1,0,"p-progressSpinner",0),e._UZ(1,"p-toast"),e.TgZ(2,"div",1)(3,"div",2)(4,"div",3)(5,"div",4)(6,"p-button",5),e.NdJ("click",function(){return o.shareEvents()}),e._uU(7," Share Selected Events "),e.qZA(),e.YNc(8,Zt,2,1,"p-button",6),e.TgZ(9,"p-button",7),e.NdJ("click",function(){return o.markAllEventsDone()}),e._uU(10," Complete Coaching For Acknowledged Events "),e.qZA()(),e.TgZ(11,"div",8)(12,"div",9)(13,"p-button",10),e.NdJ("click",function(){return o.refreshSnapshots()}),e.qZA()()()()(),e.TgZ(14,"div",11)(15,"div",3)(16,"div",12)(17,"div",13)(18,"p-selectButton",14),e.NdJ("ngModelChange",function(c){return o.reviewStatus=c})("ngModelChange",function(){return o.applyLocalFilter()}),e.YNc(19,It,4,5,"ng-template",15),e.qZA()(),e.TgZ(20,"div",16),e._uU(21,"\xa0"),e.qZA(),e.TgZ(22,"div",13)(23,"p-selectButton",14),e.NdJ("ngModelChange",function(c){return o.notificationStatus=c})("ngModelChange",function(){return o.applyLocalFilter()}),e.YNc(24,Ut,5,6,"ng-template",15),e.qZA()(),e.TgZ(25,"div",16),e._uU(26,"\xa0"),e.qZA(),e.TgZ(27,"div",13)(28,"div",17)(29,"p-selectButton",14),e.NdJ("ngModelChange",function(c){return o.coachingStatus=c})("ngModelChange",function(){return o.applyLocalFilter()}),e.YNc(30,Ft,6,5,"ng-template",15),e.qZA()()()()()(),e._UZ(31,"div",18),e.TgZ(32,"div",19),e.YNc(33,qt,3,3,"div",20),e.YNc(34,Qt,2,0,"div",21),e.TgZ(35,"span")(36,"b"),e._uU(37,"Top Events:"),e.qZA()(),e.YNc(38,Bt,3,3,"div",20),e.qZA()(),e.YNc(39,Kt,3,2,"p-dataView",22),e.YNc(40,di,4,8,"p-table",23),e.TgZ(41,"div",24),e._uU(42," Total Reviews: "),e.TgZ(43,"b"),e._uU(44),e.qZA(),e.YNc(45,_i,4,1,"span",25),e.qZA(),e.TgZ(46,"p-dialog",26),e.NdJ("visibleChange",function(c){return o.showAllVideosDialog=c}),e.YNc(47,vi,2,1,"ng-template",27),e.qZA(),e.TgZ(48,"p-dialog",28),e.NdJ("visibleChange",function(c){return o.shareEventsDialog=c}),e.YNc(49,gi,1,5,"ng-template",27),e.qZA(),e.YNc(50,mi,2,8,"p-dialog",29),e.TgZ(51,"p-dialog",30),e.NdJ("visibleChange",function(c){return o.markAllDialog=c}),e.TgZ(52,"div",3)(53,"div",2),e._UZ(54,"i",31),e.TgZ(55,"span"),e._uU(56,"Are you sure you want to mark "),e.TgZ(57,"b"),e._uU(58,"all"),e.qZA(),e._uU(59," driver acknowledged events as Coaching Complete ? "),e.TgZ(60,"small"),e._uU(61,"(Coaching Pending & Coaching Overdue events)"),e.qZA()(),e._UZ(62,"br"),e.TgZ(63,"app-share-events",32),e.NdJ("refresh",function(){return o.getEventsForDriver(!0)}),e.qZA()()()(),e.TgZ(64,"p-dialog",33),e.NdJ("visibleChange",function(c){return o.coachAllCompoundDialog=c}),e.TgZ(65,"div",3)(66,"div",2),e._UZ(67,"i",31),e.TgZ(68,"span"),e._uU(69,"Are you sure you want to mark "),e.TgZ(70,"b"),e._uU(71,"all"),e.qZA(),e._uU(72," Compound Events as Coachable ? "),e.TgZ(73,"small"),e._uU(74,"(Compound events are events with more than one event)"),e.qZA()(),e._UZ(75,"br"),e.TgZ(76,"div",34)(77,"label",35),e._uU(78,"Share All Compound Events?"),e.qZA(),e.TgZ(79,"div",36)(80,"p-inputSwitch",37),e.NdJ("ngModelChange",function(c){return o.showShareEvents=c}),e.qZA()()(),e.TgZ(81,"app-share-events",38),e.NdJ("refresh",function(){return o.getEventsForDriver(!0)}),e.qZA()()()()),2&a&&(e.Q6J("ngIf",o.showSpinner),e.xp6(6),e.Q6J("disabled",!o.selectedEventIds.length),e.xp6(2),e.Q6J("ngIf",o.hideCoachAllCompoundEvents),e.xp6(1),e.Q6J("disabled",!o.onlyAcknowledgedEvents.length),e.xp6(9),e.Q6J("options",o.reviewStatuses)("ngModel",o.reviewStatus)("multiple",!0),e.xp6(5),e.Q6J("options",o.filteredNotificationStatuses)("ngModel",o.notificationStatus)("multiple",!0),e.xp6(6),e.Q6J("options",o.coachingStatuses)("ngModel",o.coachingStatus)("multiple",!0),e.xp6(4),e.Q6J("ngIf",(null==o.driverDetails?null:o.driverDetails.compound_event_total_count)>0),e.xp6(1),e.Q6J("ngIf",(null==o.driverDetails?null:o.driverDetails.compound_event_total_count)>0),e.xp6(4),e.Q6J("ngIf",o.topEventList),e.xp6(1),e.Q6J("ngIf",!o.showTable),e.xp6(1),e.Q6J("ngIf",o.showTable),e.xp6(4),e.Oqu(o.totalRecords),e.xp6(1),e.Q6J("ngIf",o.events.length<o.totalRecords),e.xp6(1),e.Akn(e.DdM(51,ke)),e.Q6J("visible",o.showAllVideosDialog)("modal",!0),e.xp6(2),e.Akn(e.DdM(52,ui)),e.Q6J("visible",o.shareEventsDialog)("modal",!0),e.xp6(2),e.Q6J("ngIf",o.selectedDriver),e.xp6(1),e.Akn(e.DdM(53,ke)),e.Q6J("visible",o.markAllDialog)("modal",!0),e.xp6(12),e.Q6J("toolbarComponent",o.toolbarComponent)("users",o.allUsers)("driverDetails",o.driverDetails)("selectedEventIds",o.onlyAcknowledgedEvents)("events",o.events)("coachAcknowledged",!0),e.xp6(1),e.Akn(e.DdM(54,ke)),e.Q6J("visible",o.coachAllCompoundDialog)("modal",!0),e.xp6(16),e.Q6J("ngModel",o.showShareEvents),e.xp6(1),e.Q6J("toolbarComponent",o.toolbarComponent)("users",o.allUsers)("driverDetails",o.driverDetails)("showShareEvents",o.showShareEvents)("selectedEventIds",o.onlyCompoundEvents)("events",o.events)("coachCompoundEvents",!0))},dependencies:[i.mk,i.sg,i.O5,i.PC,D.jx,mt.q,ut.P,E.JJ,E.On,Le.iA,k.zx,ce.VO,v.l,de.V,u.XZ,fe.Ql,xe.NU,ye.FN,pe.G,Qe.UN,bt,Et],styles:[".p-tabview .p-tabview-panels{padding:0}  .dataview-videos .p-dataview.p-component.p-dataview-grid{overflow-y:scroll;max-height:1000px}  .p-dialog-footer{text-align:center!important}  .review-status-multiselect .p-multiselect-header,   .coaching-status-multiselect .p-multiselect-header{display:none}.description[_ngcontent-%COMP%]{font-size:12px;letter-spacing:.5px;line-height:1}p-checkbox[_ngcontent-%COMP%]{float:right}  .filter-container p-selectbutton .p-selectbutton .p-button{margin:0 4px;font-size:14px;height:40px}  .border-right-1{border-color:#ccc}  #filter-buttons .p-button{font-size:14px}  .p-datatable .p-datatable-thead>tr>th{background:#f8fafc!important}  .p-datatable .p-datatable-thead>tr>th{padding:5px;text-align:center}  .p-datatable .p-datatable-tbody>tr>td{padding:.25rem}[_nghost-%COMP%]  p-progressSpinner{position:absolute;top:50%;left:50%;z-index:10}.events-icon[_ngcontent-%COMP%]{width:34px}.status-box[_ngcontent-%COMP%]{width:1.5rem;border-radius:4px;height:1.5rem;border:1px solid #ececec;display:inline-block}.unreviewed[_ngcontent-%COMP%]{background-color:var(--chart-color-11)}.completed[_ngcontent-%COMP%]{background-color:var(--chart-color-8)}.acknowledged[_ngcontent-%COMP%]{background-color:var(--chart-color-1)}.coachable[_ngcontent-%COMP%]{background-color:var(--chart-color-9)}.pending[_ngcontent-%COMP%]{background-color:var(--chart-color-10)}  .p-multiselect-items-wrapper{min-height:200px!important;max-height:200px!important}.highlighted-row[_ngcontent-%COMP%]{background-color:#f0f8ff!important}"]})}return n})();const fi=["paginator"],re=function(n){return{"selected-card":n}};function Ci(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"div",17),e.NdJ("click",function(){e.CHM(t);const o=e.oxw(2);return e.KtG(o.processDriverForView(o.riskyDrivers,"risky",void 0))}),e._UZ(1,"app-big-metrics-card",18),e.qZA()}if(2&n){const t=e.oxw(2);e.Q6J("ngClass",e.VKq(3,re,"risky"===t.primaryFilter)),e.xp6(1),e.Q6J("metricsName","Risky Drivers")("metricsNumber",t.riskyDrivers.length)}}function xi(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"div",17),e.NdJ("click",function(){e.CHM(t);const o=e.oxw(2);return e.KtG(o.processDriverForView(o.fairDrivers,"fair",void 0))}),e._UZ(1,"app-big-metrics-card",19),e.qZA()}if(2&n){const t=e.oxw(2);e.Q6J("ngClass",e.VKq(3,re,"fair"===t.primaryFilter)),e.xp6(1),e.Q6J("metricsName","Fair Drivers")("metricsNumber",t.fairDrivers.length)}}function Di(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"div",17),e.NdJ("click",function(){e.CHM(t);const o=e.oxw(2);return e.KtG(o.processDriverForView(o.excellentDrivers,"excellent",void 0))}),e._UZ(1,"app-big-metrics-card",20),e.qZA()}if(2&n){const t=e.oxw(2);e.Q6J("ngClass",e.VKq(3,re,"excellent"===t.primaryFilter)),e.xp6(1),e.Q6J("metricsName","Excellent Drivers")("metricsNumber",t.excellentDrivers.length)}}function wi(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"div",17),e.NdJ("click",function(){e.CHM(t);const o=e.oxw(2);return e.KtG(o.processDriverForView(o.coachingCompletedDrivers,void 0,"completed"))}),e._UZ(1,"app-small-metrics-card",21),e.qZA()}if(2&n){const t=e.oxw(2);e.Q6J("ngClass",e.VKq(3,re,"completed"===t.secondaryFilter)),e.xp6(1),e.Q6J("metricsName","Coaching Completed Drivers")("metricsNumber",t.primaryFilter&&"completed"===t.secondaryFilter?t.driversForView.length:t.coachingCompletedDrivers.length)}}function yi(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"div",17),e.NdJ("click",function(){e.CHM(t);const o=e.oxw(2);return e.KtG(o.processDriverForView(o.coachingPendingDrivers,void 0,"pending"))}),e._UZ(1,"app-small-metrics-card",22),e.qZA()}if(2&n){const t=e.oxw(2);e.Q6J("ngClass",e.VKq(3,re,"pending"===t.secondaryFilter)),e.xp6(1),e.Q6J("metricsName","Coaching Pending Drivers")("metricsNumber",t.primaryFilter&&"pending"===t.secondaryFilter?t.driversForView.length:t.coachingPendingDrivers.length)}}function Ti(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"div",17),e.NdJ("click",function(){e.CHM(t);const o=e.oxw(2);return e.KtG(o.processDriverForView(o.coachingOverdueDrivers,void 0,"overdue"))}),e._UZ(1,"app-small-metrics-card",23),e.qZA()}if(2&n){const t=e.oxw(2);e.Q6J("ngClass",e.VKq(3,re,"overdue"===t.secondaryFilter)),e.xp6(1),e.Q6J("metricsName","Coaching Overdue Drivers")("metricsNumber",t.primaryFilter&&"overdue"===t.secondaryFilter?t.driversForView.length:t.coachingOverdueDrivers.length)}}function bi(n,l){if(1&n&&(e.TgZ(0,"div",12)(1,"div",13)(2,"div",14),e.YNc(3,Ci,2,5,"div",15),e.YNc(4,xi,2,5,"div",15),e.YNc(5,Di,2,5,"div",15),e.qZA(),e.TgZ(6,"div",16),e.YNc(7,wi,2,5,"div",15),e.YNc(8,yi,2,5,"div",15),e.YNc(9,Ti,2,5,"div",15),e.qZA()()()),2&n){const t=e.oxw();e.xp6(3),e.Q6J("ngIf",t.rolesService.hasAccess("1015")),e.xp6(1),e.Q6J("ngIf",t.rolesService.hasAccess("1015")),e.xp6(1),e.Q6J("ngIf",t.rolesService.hasAccess("1015")),e.xp6(2),e.Q6J("ngIf",t.rolesService.hasAccess("1015")),e.xp6(1),e.Q6J("ngIf",t.rolesService.hasAccess("1015")),e.xp6(1),e.Q6J("ngIf",t.rolesService.hasAccess("1015"))}}function Ei(n,l){1&n&&e._UZ(0,"p-progressSpinner",24)}function Ai(n,l){1&n&&e._UZ(0,"i",48)}function Si(n,l){1&n&&e._UZ(0,"i",49)}function Zi(n,l){if(1&n&&(e.TgZ(0,"span"),e._uU(1),e.qZA(),e.YNc(2,Ai,1,0,"i",46),e.YNc(3,Si,1,0,"i",47)),2&n){const t=l.$implicit;e.xp6(1),e.Oqu(null==t?null:t.label),e.xp6(1),e.Q6J("ngIf","asc"===(null==t?null:t.sort)),e.xp6(1),e.Q6J("ngIf","desc"===(null==t?null:t.sort))}}function Mi(n,l){1&n&&e._UZ(0,"i",48)}function Ii(n,l){1&n&&e._UZ(0,"i",49)}function Oi(n,l){if(1&n&&(e.TgZ(0,"span"),e._uU(1),e.qZA(),e.YNc(2,Mi,1,0,"i",46),e.YNc(3,Ii,1,0,"i",47)),2&n){const t=l.$implicit;e.xp6(1),e.Oqu(null==t?null:t.label),e.xp6(1),e.Q6J("ngIf","asc"===(null==t?null:t.sort)),e.xp6(1),e.Q6J("ngIf","desc"===(null==t?null:t.sort))}}const Re=function(){return{width:"90%"}};function Ni(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"div",42)(1,"p-dropdown",43),e.NdJ("ngModelChange",function(o){e.CHM(t);const r=e.oxw(4);return e.KtG(r.selectedSort=o)})("onChange",function(){e.CHM(t);const o=e.oxw(4);return e.KtG(o.sortDrivers(!0))}),e.YNc(2,Zi,4,3,"ng-template",44),e.YNc(3,Oi,4,3,"ng-template",45),e.qZA()()}if(2&n){const t=e.oxw(4);e.xp6(1),e.Akn(e.DdM(6,Re)),e.Q6J("options",t.sortOptions)("ngModel",t.selectedSort)("showClear",!0)("group",!0)}}function Ui(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"div",42)(1,"p-dropdown",50),e.NdJ("ngModelChange",function(o){e.CHM(t);const r=e.oxw(4);return e.KtG(r.selectedDriverForSearch=o)})("onChange",function(o){e.CHM(t);const r=e.oxw(4);return e.KtG(r.searchDriver(o.value?o.value.id_:void 0))}),e.qZA()()}if(2&n){const t=e.oxw(4);e.xp6(1),e.Akn(e.DdM(8,Re)),e.Q6J("virtualScroll",!0)("virtualScrollItemSize",30)("options",t.mergedDrivers)("showClear",!0)("ngModel",t.selectedDriverForSearch)("filter",!0)}}function Pi(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"div",42)(1,"p-dropdown",51),e.NdJ("ngModelChange",function(o){e.CHM(t);const r=e.oxw(4);return e.KtG(r.selectedExportOption=o)})("ngModelChange",function(){e.CHM(t);const o=e.oxw(4);return e.KtG(o.exportData())}),e.qZA()()}if(2&n){const t=e.oxw(4);e.xp6(1),e.Akn(e.DdM(5,Re)),e.Q6J("options",t.exportOptions)("ngModel",t.selectedExportOption)("showClear",!0)}}function ki(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"div",34)(1,"div",35),e.NdJ("click",function(){e.CHM(t);const o=e.oxw(3);return e.KtG(o.toggleDropdown("sort"))}),e._UZ(2,"button",36),e.qZA(),e.TgZ(3,"div",35),e.NdJ("click",function(){e.CHM(t);const o=e.oxw(3);return e.KtG(o.toggleDropdown("filter"))}),e._UZ(4,"button",37),e.qZA(),e.TgZ(5,"div",38)(6,"button",39),e.NdJ("click",function(){e.CHM(t);const o=e.oxw(3);return e.KtG(o.toggleDropdown("export"))}),e.qZA()()(),e.TgZ(7,"div",40),e.YNc(8,Ni,4,7,"div",41),e.YNc(9,Ui,2,9,"div",41),e.YNc(10,Pi,2,6,"div",41),e.qZA()}if(2&n){const t=e.oxw(3);e.xp6(8),e.Q6J("ngIf","sort"===t.dropdownVisible),e.xp6(1),e.Q6J("ngIf","filter"===t.dropdownVisible),e.xp6(1),e.Q6J("ngIf","export"===t.dropdownVisible)}}function Ri(n,l){if(1&n&&(e._UZ(0,"i",70),e.ALo(1,"number")),2&n){const t=e.oxw().$implicit;e.Q6J("ngClass",t.scoreStyleClass)("title",t.category+": "+e.xi3(1,3,null==t?null:t.score,"1.0-2")),e.uIk("data-star",t.score?t.score/20:0)}}function Vi(n,l){1&n&&(e.TgZ(0,"span",71),e._uU(1,"N/A"),e.qZA())}function Fi(n,l){if(1&n&&(e.TgZ(0,"div",72)(1,"p",73),e._uU(2),e.qZA(),e._UZ(3,"img",74),e.qZA()),2&n){const t=e.oxw().$implicit;let a;e.xp6(2),e.Oqu(t.name?t.name:"NA"),e.xp6(1),e.Q6J("src",null!==(a=null==t.images?null:t.images[0])&&void 0!==a?a:"assets/demo/images/settings/person_placeholder.svg",e.LSH)("alt",t.name)}}function Ji(n,l){if(1&n&&(e.TgZ(0,"div",69)(1,"span",63),e._uU(2),e.qZA(),e._uU(3," Compound "),e.qZA()),2&n){const t=e.oxw().$implicit;e.xp6(2),e.hij(" ",t.compound_event_total_count?t.compound_event_total_count:0," ")}}const qi=function(n,l){return{"driver-list-item-selected":n,"alternate-row":l}};function Qi(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"div",52,53),e.NdJ("click",function(){const r=e.CHM(t).$implicit,c=e.oxw(3);return e.KtG(c.driverClicked(r))}),e.TgZ(2,"div",54)(3,"div",55)(4,"div",56),e._uU(5),e.qZA()(),e.TgZ(6,"div",57),e.YNc(7,Ri,2,6,"i",58),e.YNc(8,Vi,2,0,"span",59),e.qZA()(),e.TgZ(9,"div",54)(10,"div",55),e._UZ(11,"img",60),e.YNc(12,Fi,4,3,"ng-template",null,61,e.W1O),e.TgZ(14,"div",62)(15,"span",63),e._uU(16),e.ALo(17,"number"),e.qZA(),e._uU(18),e.qZA(),e.TgZ(19,"div",64)(20,"i",65),e.NdJ("click",function(){const r=e.CHM(t).$implicit,c=e.oxw(3);return e.KtG(c.deleteDriver(r.driver_id))}),e.qZA()()(),e.TgZ(21,"div",55)(22,"div",66)(23,"span",63),e._uU(24),e.qZA(),e._uU(25," Events "),e.qZA(),e.YNc(26,Ji,4,1,"div",67),e._UZ(27,"div",68),e.TgZ(28,"div",69)(29,"span",63),e._uU(30),e.qZA(),e._uU(31," Reviewed "),e.qZA(),e.TgZ(32,"div",69)(33,"span",63),e._uU(34),e.qZA(),e._uU(35," Pending "),e.qZA(),e.TgZ(36,"div",69)(37,"span",63),e._uU(38),e.qZA(),e._uU(39," Overdue "),e.qZA()()()()}if(2&n){const t=l.$implicit,a=l.rowIndex,o=e.MAs(13),r=e.oxw(3);let c;e.Q6J("ngClass",e.WLB(16,qi,r.clickedDriver&&r.clickedDriver.driver_id===t.driver_id,a%2!=1)),e.xp6(5),e.Oqu(t.name?t.name:"NA"),e.xp6(2),e.Q6J("ngIf",r.isValidScore(null==t?null:t.score)&&-1!==(null==t?null:t.score)),e.xp6(1),e.Q6J("ngIf",!r.isValidScore(null==t?null:t.score)||-1===(null==t?null:t.score)),e.xp6(3),e.Q6J("src",null!==(c=null==t.images?null:t.images[0])&&void 0!==c?c:"assets/demo/images/settings/person_placeholder.svg",e.LSH)("alt",t.name)("pTooltip",o),e.xp6(5),e.hij("",r.convertDistance(e.lcZ(17,14,null==t||null==t.travel_distance?null:t.travel_distance[0]))," "),e.xp6(2),e.hij("",r.distance_units," "),e.xp6(6),e.hij(" ",t.coaching_total_count&&t.coaching_total_count>0?t.coaching_total_count:0," "),e.xp6(2),e.Q6J("ngIf",r.selectedEventsHasCompoundEvents),e.xp6(4),e.hij(" ",t.coaching_reviewed_total_count?t.coaching_reviewed_total_count:0," "),e.xp6(4),e.hij(" ",t.coaching_pending_total_count?t.coaching_pending_total_count:0," "),e.xp6(4),e.hij(" ",t.coaching_overdue_total_count?t.coaching_overdue_total_count:0," ")}}function Li(n,l){if(1&n&&(e.TgZ(0,"p-dataView",30,31),e.YNc(2,ki,11,3,"ng-template",32),e.YNc(3,Qi,40,19,"ng-template",33),e.qZA()),2&n){const t=e.oxw(2);e.Q6J("value",t.paginatedDrivers)}}const Bi=function(){return[10,20,30]};function Yi(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"div",25)(1,"div",26),e.YNc(2,Li,4,1,"p-dataView",27),e.TgZ(3,"p-paginator",28,29),e.NdJ("onPageChange",function(o){e.CHM(t);const r=e.oxw();return e.KtG(r.onPageChange(o))}),e.qZA()()()}if(2&n){const t=e.oxw();e.xp6(2),e.Q6J("ngIf",t.paginatedDrivers&&t.paginatedDrivers.length>0),e.xp6(1),e.Q6J("showCurrentPageReport",!0)("rows",t.rows)("rowsPerPageOptions",e.DdM(5,Bi))("totalRecords",t.totalRecords)}}function Hi(n,l){if(1&n&&(e.TgZ(0,"div",83),e._UZ(1,"app-driver-report",84),e.qZA()),2&n){const t=e.oxw(2);e.xp6(1),e.Q6J("showDriverReport",t.showDriverDetails)("driverDetails",t.clickedDriver)("driverTripData",t.driverTripData)("driverCoachingReport",t.driverCoachingReport)("units",t.distance_units)}}function Ki(n,l){if(1&n&&e._UZ(0,"app-driver-analytics-videos",85),2&n){const t=e.oxw(2),a=e.MAs(1);e.Q6J("compoundEventNames",t.compoundEventNames)("allEventNames",t.allEventNames)("toolbarComponent",a)("filterFromCoachingReport",t.filterFromCoachingReport)("driverDetails",t.clickedDriver)("orgSettings",t.orgSettings)}}function Gi(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"app-driver-enrolment",86),e.NdJ("updateDriverDetails",function(o){e.CHM(t);const r=e.oxw(2);return e.KtG(r.showUpdatedDriver(o))}),e.qZA()}if(2&n){const t=e.oxw(2);e.Q6J("driverDetails",t.clickedDriver)}}function ji(n,l){if(1&n&&(e.TgZ(0,"div",75)(1,"div",76),e.YNc(2,Hi,2,5,"div",77),e.TgZ(3,"p-tabView",78)(4,"p-tabPanel",79),e.YNc(5,Ki,1,6,"app-driver-analytics-videos",80),e.qZA(),e.TgZ(6,"p-tabPanel",81),e.YNc(7,Gi,1,1,"app-driver-enrolment",82),e.qZA()()()()),2&n){const t=e.oxw(),a=e.MAs(1);e.xp6(2),e.Q6J("ngIf",t.hasDriverDetailsPerm),e.xp6(1),e.Q6J("activeIndex",t.activeTabIndex),e.xp6(2),e.Q6J("ngIf",a&&t.clickedDriver&&t.hasAnalyticsVideoPerm&&t.allEventNames.length),e.xp6(2),e.Q6J("ngIf",t.hasEnrollmentPerm&&t.clickedDriver)}}function zi(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"button",87),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.deleteDriverDialog=!1)}),e.qZA(),e.TgZ(1,"button",88),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.confirmDeleteDriver())}),e.qZA()}}const Wi=function(){return{width:"450px"}};let $i=(()=>{class n{driverService;spinnerService;driverCoachingService;utilservice;route;router;settingsService;rolesService;driversService;excelExportService;messageService;fleetsService;eventService;toolbarComponent;paginator;drivers=[];clickedDriver;showDriverDetails=!1;toDate;fromDate;sortOptions=[];filterOptions=[];orderOptions=[];driversForSearch=[];selectedFilterOption;selectedSort;selectedSortOrder;deleteDriverDialog=!1;selectedDriverForSearch="";selectedDriverForIdDelete;selectedDriverForMarkAll;mergedDrivers=[];driversForView=[];totalRecords=0;page=0;rows=10;activeTabIndex=0;filterFromCoachingReport;hasEnrollmentPerm=!1;hasCoachingReportPerm=!1;hasAnalyticsVideoPerm=!1;hasDriverDetailsPerm=!1;hasDriverPagePerm=!1;driverTripData;accidentsAvoided;driverCoachingReport;orgSettings;distance_units="Miles";topLevelFilters;primaryFilter;secondaryFilter;compoundEventNames=[];first=0;paginatedDrivers=[];paginationObj={items_per_page:1e8,page_number:1};allEventNames=[];showDriversSpinner=!0;forkJoinSubscription;contextItems;dropdownVisible=null;exportOptions;selectedExportOption;selectedEventsHasCompoundEvents=!0;constructor(t,a,o,r,c,C,M,O,A,I,J,$,y){this.driverService=t,this.spinnerService=a,this.driverCoachingService=o,this.utilservice=r,this.route=c,this.router=C,this.settingsService=M,this.rolesService=O,this.driversService=A,this.excelExportService=I,this.messageService=J,this.fleetsService=$,this.eventService=y}ngOnInit(){this.hasEnrollmentPerm=this.rolesService.hasAccess(["3030","3035"]),this.hasCoachingReportPerm=this.rolesService.hasAccess("3015"),this.hasAnalyticsVideoPerm=this.rolesService.hasAccess(["3020","3025"]),this.hasDriverDetailsPerm=this.rolesService.hasAccess("3010"),this.hasDriverPagePerm=this.rolesService.hasAccess("3005"),this.initSort(),this.getOrgSettings()}afterToolLoaded(){this.showDriversSpinner=!0,this.initData(),this.getEventsSummary()}getOrgSettings(){this.settingsService.getOrgSettings().subscribe(a=>{this.distance_units=a.settings.org_common_configurations.speed_unit==B.J_[0].value?"km":"mi"})}initSort(){this.sortOptions=[{label:"Driver Scorecard",items:[{label:"Driver Rating",value:"score",sort:"asc"},{label:"Driver Rating",value:"score",sort:"desc"}]},{label:"Driver Details",items:[{label:"Driver Name",value:"name",sort:"asc"},{label:"Driver Name",value:"name",sort:"desc"},{label:"Employee Id",value:"employee_id",sort:"asc"},{label:"Employee Id",value:"employee_id",sort:"desc"}]},{label:"Events Information",items:[{label:"Total Events",value:"coaching_total_count",sort:"asc"},{label:"Total Events",value:"coaching_total_count",sort:"desc"},{label:"Reviewed Events",value:"coaching_reviewed_total_count",sort:"asc"},{label:"Reviewed Events",value:"coaching_reviewed_total_count",sort:"desc"},{label:"Coaching Pending",value:"coaching_pending_total_count",sort:"asc"},{label:"Coaching Pending",value:"coaching_pending_total_count",sort:"desc"},{label:"Coaching Overdue",value:"coaching_overdue_total_count",sort:"asc"},{label:"Coaching Overdue",value:"coaching_overdue_total_count",sort:"desc"}]}],this.filterOptions=[{label:"Event Review",items:[{label:"Correct",value:"CORRECT"},{label:"Incorrect",value:"INCORRECT"},{label:"Unverified",value:"UNREVIEWED"}]},{label:"Coaching Review Status",items:[{label:"Coachable",value:"COACHABLE"},{label:"Non Coachable",value:"NOTCOACHABLE",sort:"desc"}]}],this.orderOptions=[{label:"Ascending",value:"asc"},{label:"Descending",value:"desc"}],this.exportOptions=[{label:"Excel",value:"excel"},{label:"CSV",value:"csv"}],this.selectedSort={label:"Total Events",value:"coaching_total_count",sort:"desc"}}initData(){this.fromDate=this.toolbarComponent.fromDateUTC,this.toDate=this.toolbarComponent.toDateUTC,this.mergedDrivers=[],this.paginatedDrivers=[]}getEventsSummary(){B.Y5(),this.eventService.getEvents().subscribe(a=>{this.allEventNames=this.utilservice.getEventNamesFromEventsArray(a),this.compoundEventNames=a.compound_events.map(r=>r.name),this.getDataForDriverAnalytics();const o=this.toolbarComponent.selectedEvents;this.selectedEventsHasCompoundEvents=this.compoundEventNames.filter(r=>o.includes(r))?.length>0})}getDataForDriverAnalytics(){var t=B.dc();let a;a=0===this.drivers.length?this.driversService.fetchDrivers(this.toolbarComponent.fromDateUTC,this.toolbarComponent.toDateUTC,t,void 0,this.paginationObj):(0,Ye.of)({data:this.drivers});const o=this.driverCoachingService.getDriverScorecardFetch(this.fromDate,this.toDate,t,this.paginationObj),r=this.driverService.getDriverCoachingReportForDriver(this.toolbarComponent.fromDateUTC,this.toolbarComponent.toDateUTC,t,this.paginationObj),c=this.driverService.getDriverTripReport(this.fromDate,this.toDate,t,this.paginationObj),C=this.settingsService.getOrgSettings();this.forkJoinSubscription=(0,He.D)([a,o,r,c,C]).subscribe(([M,O,A,I,J])=>{this.orgSettings=J,this.drivers=M.data,M=M.data,O=O.data,A=A.data,I=I.data;const $=new Map;M.forEach(y=>{$.set(y.id_,{...y})}),O.forEach(y=>{const K=$.get(y.driver_id);K&&Object.assign(K,y)}),A.forEach(y=>{const K=$.get(y.driver_id);K&&Object.assign(K,y)}),I.forEach(y=>{const K=$.get(y.driver_id);K&&Object.assign(K,y)}),this.mergedDrivers=Array.from($.values()),this.mergedDrivers.forEach(y=>{y.scoreStyleClass=this.getScoreStyle(y.score)}),this.mergedDrivers.forEach((y,K)=>{y?.total_events&&(y.coaching_total_count=y.total_count[0],y.coaching_pending_total_count=y.coaching_pending_count[0],y.coaching_overdue_total_count=y.coaching_overdue_count[0],y.coaching_reviewed_total_count=y.reviewed_count[0])}),this.removeDefaultCompoundEvents(),this.filterEventsSelection(),this.sortDrivers(),this.processDriverForView(this.mergedDrivers),this.initTopLevelFilters(),this.filterByQueryParams(),this.paginator.changePage(0),this.paginate()})}riskyDrivers=[];fairDrivers=[];excellentDrivers=[];coachingCompletedDrivers=[];coachingPendingDrivers=[];coachingOverdueDrivers=[];processDriverForView(t,a,o){if(this.paginator.changePage(0),this.driversForView=[],this.primaryFilter=void 0!==a?a.toLowerCase()===this.primaryFilter?.toLowerCase()?void 0:a:this.primaryFilter,this.secondaryFilter=void 0!==o?o.toLowerCase()===this.secondaryFilter?.toLowerCase()?void 0:o:this.secondaryFilter,this.primaryFilter&&this.secondaryFilter){let r=[];r="completed"===this.secondaryFilter.toLowerCase()?this.coachingCompletedDrivers:"pending"===this.secondaryFilter.toLowerCase()?this.coachingPendingDrivers:this.coachingOverdueDrivers,this.driversForView=r.filter(c=>c.category.toLowerCase()===this.primaryFilter.toLowerCase())}else this.primaryFilter?(this.driversForView=this.mergedDrivers.filter(r=>r.category.toLowerCase()==this.primaryFilter.toLowerCase()),this.initTopLevelFilters()):this.secondaryFilter?this.driversForView="completed"===this.secondaryFilter.toLowerCase()?this.coachingCompletedDrivers:"pending"===this.secondaryFilter.toLowerCase()?this.coachingPendingDrivers:this.coachingOverdueDrivers:(this.driversForView=this.mergedDrivers,this.initTopLevelFilters());this.totalRecords=this.driversForView.length,this.paginate()}initTopLevelFilters(){this.riskyDrivers=[],this.fairDrivers=[],this.excellentDrivers=[],this.coachingPendingDrivers=[],this.coachingOverdueDrivers=[],this.coachingCompletedDrivers=[],this.mergedDrivers.filter(t=>{"RISKY"===t.category&&this.riskyDrivers.push(t),"FAIR"===t.category&&this.fairDrivers.push(t),"EXCELLENT"===t.category&&this.excellentDrivers.push(t)}),this.driversForView.filter(t=>{t.coaching_pending_count?.[0]>0&&this.coachingPendingDrivers.push(t),t.coaching_overdue_count?.[0]>0&&this.coachingOverdueDrivers.push(t),t.coaching_complete_count?.[0]>0&&0===t.coaching_overdue_count?.[0]&&0===t.coaching_pending_count?.[0]&&this.coachingCompletedDrivers.push(t)})}filterEventsSelection(){const t=this.toolbarComponent.selectedEvents;t.length>0&&this.mergedDrivers.forEach(a=>{a.total_events&&Object.keys(a.total_events).forEach(o=>{t.includes(o)||(a.total_count[0]-=a.total_events[o][0],delete a.total_events[o])})})}queryParamsResolved=!1;filterByQueryParams(){const t=this.route.snapshot,a=t.queryParamMap.get("driverId");if(a&&""!==a){const r=this.driversForView.filter(c=>c.id_===a);this.selectedDriverForSearch=r[0],this.driversForView=r}const o=t.queryParamMap.get("category");o&&""!==o&&!this.queryParamsResolved&&(this.queryParamsResolved=!0,"risky"===o?.toLowerCase()&&this.processDriverForView(this.riskyDrivers,"risky"),"fair"===o?.toLowerCase()&&this.processDriverForView(this.fairDrivers,"fair"),"excellent"===o?.toLowerCase()&&this.processDriverForView(this.excellentDrivers,"excellent"),"completed"===o?.toLowerCase()&&this.processDriverForView(this.coachingCompletedDrivers,void 0,"completed"),"pending"===o?.toLowerCase()&&this.processDriverForView(this.coachingPendingDrivers,void 0,"pending"),"overdue"===o?.toLowerCase()&&this.processDriverForView(this.coachingOverdueDrivers,void 0,"overdue"))}deleteDriver(t){this.deleteDriverDialog=!0,this.selectedDriverForIdDelete=t}confirmDeleteDriver(){this.deleteDriverDialog=!0,this.driverService.deleteDriver(this.selectedDriverForIdDelete).subscribe(t=>{this.afterToolLoaded(),this.messageService.add({severity:"success",summary:"Successful",detail:"Driver Deleted",life:3e3}),this.deleteDriverDialog=!1})}getAllEventsForFleet(t){const a=[],o=t.map((r,c)=>({value:r,index:c}));o.sort((r,c)=>c.value-r.value);for(let r=0;r<o.length;r++){const{value:c,index:C}=o[r];c>0&&a.push({index:C,value:c,name:B.fS[C]})}return a}searchDriver(t){if(this.first=0,t){const a=this.mergedDrivers.filter(o=>o.id_===t);this.driversForView=a,this.paginate(),this.clickedDriver=a[0]}else{this.selectedDriverForSearch=void 0;const o=this.route.snapshot.queryParamMap.get("driverId");o&&""!==o?(this.router.navigate([],{queryParams:{driverId:null},queryParamsHandling:"merge"}),this.afterToolLoaded()):(this.driversForView=this.mergedDrivers,this.processDriverForView(this.driversForView),this.paginator.changePage(0))}}sortDrivers(t){const a=this.selectedSort;this.mergedDrivers=this.mergedDrivers.sort(a?(o,r)=>{const c=o?.[a.value]??("number"==typeof o?.[a.value]?0:""),C=r?.[a.value]??("number"==typeof r?.[a.value]?0:"");return"score"===a.value||["coaching_total_count","coaching_reviewed_total_count","coaching_pending_total_count","coaching_overdue_total_count"].includes(a.value)?"asc"===a.sort?c-C:C-c:"asc"===a.sort?c.localeCompare(C):C.localeCompare(c)}:(o,r)=>r.score-o.score),t&&this.paginate()}driverClicked(t){this.showDriverDetails=!0,this.clickedDriver=t,this.driverTripData=this.clickedDriver}showUpdatedDriver(t){let a=0;this.mergedDrivers.forEach((o,r)=>{o.id_===t.id_&&(this.mergedDrivers[r].id_=t.id_,this.mergedDrivers[r].name=t.name,this.mergedDrivers[r].email=t.email,a=r)}),t.id_===this.clickedDriver.id_&&(this.clickedDriver=this.mergedDrivers[a])}setDriverCoachingReport(t){this.driverCoachingReport=t}setActiveIndex(t){this.activeTabIndex=1,this.filterFromCoachingReport=t}getScoreStyle(t){return t>this.orgSettings.settings.org_common_configurations.driver_scorecard.excellent_score?"scorecard-excellent":t>=this.orgSettings.settings.org_common_configurations.driver_scorecard.fair_score?"scorecard-fair":"scorecard-risky"}isValidScore(t){return!isNaN(t)}removeNADrivers(){this.driversForView=this.driversForView.filter(t=>t.score>0)}onPageChange(t){this.first=t.first,this.rows=t.rows,this.paginate()}paginate(){this.showDriversSpinner=!1,this.paginatedDrivers=this.driversForView.slice(this.first,this.first+this.rows),this.driverClicked(this.paginatedDrivers?.[0])}convertDistance(t){if(String(t).includes(",")&&(t=t.replaceAll(",","")),null==t||"null"==t||null==t||isNaN(t))return 0;let a=Number(String(t));return this.utilservice.convertDistance(a,this.orgSettings.settings.org_common_configurations.speed_unit)}removeDefaultCompoundEvents(){this.mergedDrivers.forEach(a=>{if(a){const o=this.toolbarComponent.selectedEvents;a?.total_events&&Object.keys(a.total_events).forEach(r=>{o.includes(r)||(a.total_count[0]-=a.total_events[r][0],a.coaching_reviewed_total_count-=a.reviewed_events[r][0],a.coaching_overdue_total_count-=a.coaching_overdue[r][0],a.coaching_pending_total_count-=a.coaching_pending[r][0])}),a.reviewed_events&&Object.keys(a.reviewed_events)?.forEach(r=>{this.compoundEventNames?.includes(r)&&this.toolbarComponent.selectedEvents.includes(r)&&(a.coaching_reviewed_total_count=a.coaching_reviewed_total_count-a.reviewed_events[r][0])}),a.coaching_overdue&&Object.keys(a.coaching_overdue)?.forEach(r=>{this.compoundEventNames?.includes(r)&&this.toolbarComponent.selectedEvents.includes(r)&&(a.coaching_overdue_total_count=a.coaching_overdue_total_count-a.coaching_overdue[r][0])}),a.coaching_pending&&Object.keys(a.coaching_pending)?.forEach(r=>{this.compoundEventNames?.includes(r)&&this.toolbarComponent.selectedEvents.includes(r)&&(a.coaching_pending_total_count=a.coaching_pending_total_count-a.coaching_pending[r][0])}),a.total_events&&(a.compound_event_total_count=0,a.accidance_avoidance_total_count=0,Object.keys(a.total_events).forEach(r=>{this.compoundEventNames?.includes(r)&&this.toolbarComponent.selectedEvents.includes(r)&&(r in B.uZ&&(a.compound_event_total_count+=a.total_events[r][0]),r in B.TU&&(a.accidance_avoidance_total_count+=a.total_events[r][0]))}),a.total_count[0]=a.total_count[0]-(a.compound_event_total_count+a.accidance_avoidance_total_count),a.coaching_total_count=a.total_count[0])}})}exportData(){const t=[];this.driversForView.forEach(o=>{t.push({"Driver Name":o.name,["Distance  ("+this.distance_units+")"]:this.convertDistance(o?.travel_distance?.[0]),Score:o.score,"Employee Id":o.employee_id,"Total Events":o.total_count&&o.total_count[0]>0?o.coaching_total_count:0,"Compound Events":o.compound_event_total_count,"Reviewed Events":o.coaching_reviewed_total_count,"Pending Events":o.coaching_pending_total_count,"Overdue Events":o.coaching_overdue_total_count})});const a="Driver List - "+(new Date).toLocaleDateString();this.excelExportService.exportData(t,a,this.selectedExportOption.value)}toggleDropdown(t){this.dropdownVisible=this.dropdownVisible===t?null:t}ngOnDestroy(){this.forkJoinSubscription&&this.forkJoinSubscription.unsubscribe()}static \u0275fac=function(a){return new(a||n)(e.Y36(b.NZ),e.Y36(b.V),e.Y36(b.$H),e.Y36(b.FW),e.Y36(W.gz),e.Y36(W.F0),e.Y36(b.gb),e.Y36(b.Nj),e.Y36(b.Ft),e.Y36(B.U0),e.Y36(D.ez),e.Y36(b.VN),e.Y36(b.nC))};static \u0275cmp=e.Xpm({type:n,selectors:[["app-driver-analytics"]],viewQuery:function(a,o){if(1&a&&(e.Gf(Ke.n,5),e.Gf(fi,5)),2&a){let r;e.iGM(r=e.CRH())&&(o.toolbarComponent=r.first),e.iGM(r=e.CRH())&&(o.paginator=r.first)}},features:[e._Bn([D.ez])],decls:15,vars:9,consts:[[3,"filterData","loaded"],["toolbarComponent",""],["class","grid mt-1",4,"ngIf"],[1,"drivers-spinner"],["styleClass","w-5rem h-5rem",4,"ngIf"],[1,"grid"],["class","md:col-2 col-12",4,"ngIf"],["class","md:col-10 col-12",4,"ngIf"],["header","Confirm",3,"visible","modal","visibleChange"],[1,"flex","align-items-center","justify-content-center"],[1,"pi","pi-exclamation-triangle","mr-3",2,"font-size","2rem"],["pTemplate","footer"],[1,"grid","mt-1"],[1,"col-12"],[1,"border-right-1","pr-2","inline-block"],["class","cursor-pointer inline-block",3,"ngClass","click",4,"ngIf"],[1,"ml-2","inline-block"],[1,"cursor-pointer","inline-block",3,"ngClass","click"],["title","Risky Drivers",3,"metricsName","metricsNumber"],["title","Fair Drivers",3,"metricsName","metricsNumber"],["title","Excellent Drivers",3,"metricsName","metricsNumber"],["title","Coaching Completed Drivers",3,"metricsName","metricsNumber"],["title","Coaching Pending Drivers",3,"metricsName","metricsNumber"],["title","Coaching Overdue Drivers",3,"metricsName","metricsNumber"],["styleClass","w-5rem h-5rem"],[1,"md:col-2","col-12"],[1,"card","h-full","drivers-card","card-scroll-container"],["filterBy","driver_name","layout","list",3,"value",4,"ngIf"],["currentPageReportTemplate","{first} to {last} of {totalRecords} drivers",3,"showCurrentPageReport","rows","rowsPerPageOptions","totalRecords","onPageChange"],["paginator",""],["filterBy","driver_name","layout","list",3,"value"],["driversList",""],["pTemplate","header"],["pTemplate","listItem"],[1,"icon-container"],[1,"icon-wrapper",3,"click"],["pButton","","pRipple","","type","button","icon","pi pi-sort-alt",1,"p-button-rounded","p-button-text","p-button-secondary"],["pButton","","pRipple","","type","button","icon","pi pi-filter",1,"p-button-rounded","p-button-text","p-button-secondary"],[1,"icon-wrapper"],["pButton","","pRipple","","type","button","icon","pi pi-file",1,"p-button-rounded","p-button-text","p-button-secondary",3,"click"],[1,"w-full","mt-1"],["class","dropdown-content",4,"ngIf"],[1,"dropdown-content"],["id","sort","appendTo","body","placeholder","Sort by","optionLabel","label","styleClass","ml-2",3,"options","ngModel","showClear","group","ngModelChange","onChange"],["pTemplate","item"],["pTemplate","selectedItem"],["class","pi pi-arrow-up ml-2",4,"ngIf"],["class","pi pi-arrow-down ml-2",4,"ngIf"],[1,"pi","pi-arrow-up","ml-2"],[1,"pi","pi-arrow-down","ml-2"],["id","drivers","placeholder","Select a driver","appendTo","body","filterBy","name","filterMode","contains","optionLabel","name",1,"ml-2","driver-search",3,"virtualScroll","virtualScrollItemSize","options","showClear","ngModel","filter","ngModelChange","onChange"],["id","export","appendTo","body","placeholder","Export as ","optionLabel","label","styleClass","ml-2",3,"options","ngModel","showClear","ngModelChange"],[1,"align-items-center","driver-list-item","py-2","px-2","w-full",3,"ngClass","click"],["driverListItem",""],[1,"grid","align-items-center","pl-2"],[1,"col-12","md:col-6","text-center"],[1,"font-semibold","text-l","text-break"],[1,"col-12","md:col-6"],[3,"ngClass","title",4,"ngIf"],["class","text-sm",4,"ngIf"],[1,"md:my-0","w-9","md:w-4rem","shadow-2","w-2rem","mt-2","driver-list-img",3,"src","alt","pTooltip"],["enlargeImage",""],[1,"mt-2","text-sm","text-center"],[1,"font-semibold"],[1,"mt-2","text-center"],["title","Delete driver",1,"pi","pi-trash","text-primary","text-base",3,"click"],[1,"text-sm","text-left"],["class","mt-1 text-sm text-left",4,"ngIf"],[1,"my-3"],[1,"mt-1","text-sm","text-left"],[3,"ngClass","title"],[1,"text-sm"],[1,"block","m-w-25rem","text-left"],[1,"font-semibold","text-l"],[1,"m-w-25rem",3,"src","alt"],[1,"md:col-10","col-12"],[1,"card","coaching-card"],["class","mb-2 ml-2",4,"ngIf"],["orientation","left",3,"activeIndex"],["header","Driver Coaching",1,"line-height-3","m-0"],[3,"compoundEventNames","allEventNames","toolbarComponent","filterFromCoachingReport","driverDetails","orgSettings",4,"ngIf"],["header","Driver Info",1,"line-height-3","m-0"],[3,"driverDetails","updateDriverDetails",4,"ngIf"],[1,"mb-2","ml-2"],[3,"showDriverReport","driverDetails","driverTripData","driverCoachingReport","units"],[3,"compoundEventNames","allEventNames","toolbarComponent","filterFromCoachingReport","driverDetails","orgSettings"],[3,"driverDetails","updateDriverDetails"],["pButton","","pRipple","","icon","pi pi-times","label","No",1,"p-button-text",3,"click"],["pButton","","pRipple","","icon","pi pi-check","label","Yes",1,"p-button-text",3,"click"]],template:function(a,o){if(1&a&&(e.TgZ(0,"app-toolbar",0,1),e.NdJ("filterData",function(){return o.afterToolLoaded()})("loaded",function(){return o.afterToolLoaded()}),e.qZA(),e._UZ(2,"p-toast"),e.YNc(3,bi,10,6,"div",2),e.TgZ(4,"div",3),e.YNc(5,Ei,1,0,"p-progressSpinner",4),e.qZA(),e.TgZ(6,"div",5),e.YNc(7,Yi,5,6,"div",6),e.YNc(8,ji,8,4,"div",7),e.qZA(),e.TgZ(9,"p-dialog",8),e.NdJ("visibleChange",function(c){return o.deleteDriverDialog=c}),e.TgZ(10,"div",9),e._UZ(11,"i",10),e.TgZ(12,"span"),e._uU(13,"Are you sure you want to delete the selected driver?"),e.qZA()(),e.YNc(14,zi,2,0,"ng-template",11),e.qZA()),2&a){const r=e.MAs(1);e.xp6(3),e.Q6J("ngIf",r.allEvents),e.xp6(2),e.Q6J("ngIf",o.showDriversSpinner),e.xp6(2),e.Q6J("ngIf",o.hasDriverPagePerm),e.xp6(1),e.Q6J("ngIf",o.clickedDriver),e.xp6(1),e.Akn(e.DdM(8,Wi)),e.Q6J("visible",o.deleteDriverDialog)("modal",!0)}},dependencies:[i.mk,i.O5,Ke.n,D.jx,lt.E,ct.c,E.JJ,E.On,Oe.xf,Oe.x4,k.Hq,qe.H,ce.VO,_e.Lt,de.V,ye.FN,pe.G,De.D,Ne.u,pt,vt.Z,hi,i.JJ],styles:['@charset "UTF-8";.drivers-card[_ngcontent-%COMP%]{padding-left:0!important;padding-right:0!important}.driver-list-item[_ngcontent-%COMP%]{cursor:pointer}.driver-list-item[_ngcontent-%COMP%]:hover{background:linear-gradient(0deg,rgba(47,111,123,.1),rgba(47,111,123,.1)),#FFFBFE}.driver-list-item-selected[_ngcontent-%COMP%]{background:linear-gradient(0deg,rgba(47,111,123,.1),rgba(47,111,123,.1)),#f0f8ff}.driver-list-img[_ngcontent-%COMP%]{width:4.5rem!important;border-radius:2em!important}.right-8[_ngcontent-%COMP%]{right:8%!important}  .p-rating .p-rating-icon{font-size:1rem;margin-left:.15rem}  .p-rating .p-rating-icon.pi-star-fill{color:inherit}  .p-tooltip{max-width:-moz-fit-content;max-width:fit-content}  .p-dataview .p-dataview-header{font-weight:400;padding-left:0;padding-right:0;padding-top:0}  .p-dropdown-items-wrapper{height:-moz-fit-content!important;height:fit-content!important;max-height:450px!important;overflow-y:auto;box-shadow:0 6px 6px #00000029}[_nghost-%COMP%]  .p-dataview{height:75vh;overflow-y:auto}[_nghost-%COMP%]  app-big-metrics-card .card{min-width:180px}[_nghost-%COMP%]  .drivers-spinner p-progressSpinner{position:absolute;top:50%;left:50%;z-index:10}[_nghost-%COMP%]  .ui-dropdown-panel, [_nghost-%COMP%]  .p-dropdown-items-wrapper{height:-moz-fit-content!important;height:fit-content!important;max-height:300px!important;overflow-y:auto}.alternate-row[_ngcontent-%COMP%]{background-color:#f7f7f7}[data-star][_ngcontent-%COMP%]{font-size:17px;display:inline-block;position:relative;unicode-bidi:bidi-override;text-align:left;color:#ccc;font-style:normal}[data-star][_ngcontent-%COMP%]:before{content:"\\2605\\2605\\2605\\2605\\2605"}[data-star][_ngcontent-%COMP%]:after{content:"\\2605\\2605\\2605\\2605\\2605";position:absolute;top:0;left:0;white-space:nowrap;color:#ff8c00;overflow:hidden;width:0}[data-star^="0"][_ngcontent-%COMP%]:after{width:0%}[data-star^="0.1"][_ngcontent-%COMP%]:after{width:2%}[data-star^="0.2"][_ngcontent-%COMP%]:after{width:4%}[data-star^="0.3"][_ngcontent-%COMP%]:after{width:6%}[data-star^="0.4"][_ngcontent-%COMP%]:after{width:8%}[data-star^="0.5"][_ngcontent-%COMP%]:after{width:10%}[data-star^="0.6"][_ngcontent-%COMP%]:after{width:12%}[data-star^="0.7"][_ngcontent-%COMP%]:after{width:14%}[data-star^="0.8"][_ngcontent-%COMP%]:after{width:16%}[data-star^="0.9"][_ngcontent-%COMP%]:after{width:18%}[data-star^="1"][_ngcontent-%COMP%]:after{width:20%}[data-star^="1.1"][_ngcontent-%COMP%]:after{width:22%}[data-star^="1.2"][_ngcontent-%COMP%]:after{width:24%}[data-star^="1.3"][_ngcontent-%COMP%]:after{width:26%}[data-star^="1.4"][_ngcontent-%COMP%]:after{width:28%}[data-star^="1.5"][_ngcontent-%COMP%]:after{width:30%}[data-star^="1.6"][_ngcontent-%COMP%]:after{width:32%}[data-star^="1.7"][_ngcontent-%COMP%]:after{width:34%}[data-star^="1.8"][_ngcontent-%COMP%]:after{width:36%}[data-star^="1.9"][_ngcontent-%COMP%]:after{width:38%}[data-star^="2"][_ngcontent-%COMP%]:after{width:40%}[data-star^="2.1"][_ngcontent-%COMP%]:after{width:42%}[data-star^="2.2"][_ngcontent-%COMP%]:after{width:44%}[data-star^="2.3"][_ngcontent-%COMP%]:after{width:46%}[data-star^="2.4"][_ngcontent-%COMP%]:after{width:48%}[data-star^="2.5"][_ngcontent-%COMP%]:after{width:50%}[data-star^="2.6"][_ngcontent-%COMP%]:after{width:52%}[data-star^="2.7"][_ngcontent-%COMP%]:after{width:54%}[data-star^="2.8"][_ngcontent-%COMP%]:after{width:56%}[data-star^="2.9"][_ngcontent-%COMP%]:after{width:58%}[data-star^="3"][_ngcontent-%COMP%]:after{width:60%}[data-star^="3.1"][_ngcontent-%COMP%]:after{width:62%}[data-star^="3.2"][_ngcontent-%COMP%]:after{width:64%}[data-star^="3.3"][_ngcontent-%COMP%]:after{width:66%}[data-star^="3.4"][_ngcontent-%COMP%]:after{width:68%}[data-star^="3.5"][_ngcontent-%COMP%]:after{width:70%}[data-star^="3.6"][_ngcontent-%COMP%]:after{width:72%}[data-star^="3.7"][_ngcontent-%COMP%]:after{width:74%}[data-star^="3.8"][_ngcontent-%COMP%]:after{width:76%}[data-star^="3.9"][_ngcontent-%COMP%]:after{width:78%}[data-star^="4"][_ngcontent-%COMP%]:after{width:80%}[data-star^="4.1"][_ngcontent-%COMP%]:after{width:82%}[data-star^="4.2"][_ngcontent-%COMP%]:after{width:84%}[data-star^="4.3"][_ngcontent-%COMP%]:after{width:86%}[data-star^="4.4"][_ngcontent-%COMP%]:after{width:88%}[data-star^="4.5"][_ngcontent-%COMP%]:after{width:90%}[data-star^="4.6"][_ngcontent-%COMP%]:after{width:92%}[data-star^="4.7"][_ngcontent-%COMP%]:after{width:94%}[data-star^="4.8"][_ngcontent-%COMP%]:after{width:96%}[data-star^="4.9"][_ngcontent-%COMP%]:after{width:98%}[data-star^="5"][_ngcontent-%COMP%]:after{width:100%}.scorecard-risky[_ngcontent-%COMP%]:after{color:#eb5757}.scorecard-fair[_ngcontent-%COMP%]:after{color:#f2994a}.scorecard-excellent[_ngcontent-%COMP%]:after{color:#27ae60}  .card-scroll-container{scrollbar-width:thin}  .card-scroll-container ::-webkit-scrollbar{width:6px!important}  .p-paginator .p-paginator-prev,   .p-paginator .p-paginator-next,   .p-paginator .p-paginator-pages .p-paginator-page,   .p-paginator .p-paginator-first,   .p-paginator .p-paginator-last{min-width:2rem;height:2rem}.coaching-card[_ngcontent-%COMP%]{padding-left:0!important;padding-right:0!important}.selected-card[_ngcontent-%COMP%]{border-radius:15px;border:5px solid rgb(58,133,193)!important}.icon-container[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;background:rgb(241,245,249);border:1px solid #ccc}.icon-wrapper[_ngcontent-%COMP%]{position:relative}.dropdown-content[_ngcontent-%COMP%]{position:relative;z-index:1000;box-shadow:0 4px 8px #0003;background:white;border-radius:4px;padding:10px;margin-top:10px;width:auto}']})}return n})(),Xi=(()=>{class n{static \u0275fac=function(a){return new(a||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[W.Bz.forChild([{path:"",component:$i}]),W.Bz]})}return n})(),en=(()=>{class n{static \u0275fac=function(a){return new(a||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({providers:[D.ez],imports:[i.ez,Xi,st.l,m,rt.m,at.m,Je,E.u5,Ze,Le.U$,Oe.LU,Ie.j,Ce.A,Me.x,k.hJ,qe.T,ce.FI,Be.W,Je,v.b,R._8,_e.kW,de.S,u.nD,fe.Iu,xe.q4,ye.EV,pe.L,De.U,Ne.z,Qe.Qy]})}return n})()},3516:(ue,q,d)=>{d.d(q,{Z:()=>w});var i=d(5879),E=d(7394),D=d(5878),k=d(5219),R=d(6814),e=d(6223),Q=d(3714),Y=d(5359),U=d(707),V=d(3658),H=d(4104);function X(T,m){1&T&&i._UZ(0,"img",22)}function ee(T,m){1&T&&i._UZ(0,"img",25),2&T&&i.Q6J("src",m.$implicit,i.LSH)}function j(T,m){if(1&T&&(i.TgZ(0,"p-carousel",23),i.YNc(1,ee,1,1,"ng-template",24),i.qZA()),2&T){const v=i.oxw(2);i.Q6J("value",v.driverInfo.images)("circular",!1)}}const z=function(){return["3035"]};function te(T,m){if(1&T){const v=i.EpF();i.TgZ(0,"div",1)(1,"div",2)(2,"div",3),i.YNc(3,X,1,0,"img",4),i.YNc(4,j,2,2,"p-carousel",5),i.qZA(),i.TgZ(5,"div",6)(6,"div",7)(7,"div",8)(8,"span"),i._uU(9,"Fleet Name"),i.qZA()(),i.TgZ(10,"div",9)(11,"div",8)(12,"span",10),i._uU(13),i.qZA()()()(),i.TgZ(14,"div",7)(15,"div",8)(16,"span"),i._uU(17,"Video Name"),i.qZA()(),i.TgZ(18,"div",9)(19,"div",8)(20,"span",10),i._uU(21),i.qZA()()()(),i.TgZ(22,"div",7)(23,"div",8)(24,"span"),i._uU(25,"Face Id"),i.qZA()(),i.TgZ(26,"div",9)(27,"div",8)(28,"span",10),i._uU(29),i.qZA()()()(),i.TgZ(30,"div",7)(31,"div",8)(32,"span"),i._uU(33,"Created Time"),i.qZA()(),i.TgZ(34,"div",9)(35,"div",8)(36,"span",10),i._uU(37),i.qZA()()()(),i._UZ(38,"p-divider",11),i.TgZ(39,"div",12)(40,"h6",13),i._uU(41,"Driver Info"),i.qZA(),i.TgZ(42,"label",14),i._uU(43,"Driver Name"),i.qZA(),i.TgZ(44,"span",15)(45,"input",16),i.NdJ("ngModelChange",function(f){i.CHM(v);const S=i.oxw();return i.KtG(S.driverInfo.name=f)}),i.qZA()()(),i.TgZ(46,"div",12)(47,"label",17),i._uU(48,"Employee Id"),i.qZA(),i.TgZ(49,"span",15)(50,"input",18),i.NdJ("ngModelChange",function(f){i.CHM(v);const S=i.oxw();return i.KtG(S.driverInfo.employee_id=f)}),i.qZA()()(),i.TgZ(51,"div",12)(52,"label",17),i._uU(53,"Email"),i.qZA(),i.TgZ(54,"span",15)(55,"input",19),i.NdJ("ngModelChange",function(f){i.CHM(v);const S=i.oxw();return i.KtG(S.driverInfo.email=f)}),i.qZA()()(),i.TgZ(56,"div",20)(57,"button",21),i.NdJ("click",function(){i.CHM(v);const f=i.oxw();return i.KtG(f.editDriver())}),i.qZA()()()()()}if(2&T){const v=i.oxw();let u,f;i.xp6(3),i.Q6J("ngIf",0==(null==v.driverInfo?null:v.driverInfo.images.length)),i.xp6(1),i.Q6J("ngIf",v.driverInfo&&v.driverInfo.images),i.xp6(9),i.Oqu(v.driverInfo.fleetName?v.driverInfo.fleetName:"NA"),i.xp6(8),i.Oqu(null!==(u=null==v.driverInfo?null:v.driverInfo.videoName)&&void 0!==u?u:"NA"),i.xp6(8),i.Oqu(null!==(f=null==v.driverInfo?null:v.driverInfo.face_token)&&void 0!==f?f:"NA"),i.xp6(8),i.Oqu(null!=v.driverInfo&&v.driverInfo.created_at?v.driverInfo.created_at:"NA"),i.xp6(8),i.Q6J("ngModel",v.driverInfo.name),i.xp6(5),i.Q6J("ngModel",v.driverInfo.employee_id),i.xp6(5),i.Q6J("ngModel",v.driverInfo.email),i.xp6(2),i.Q6J("disabled",!v.rolesService.hasAccess(i.DdM(10,z)))}}let w=(()=>{class T{driversService;spinnerService;messageService;rolesService;driver_image_list=[];preview_driver_image="";showFirstGrid=!1;showLastGrid=!1;driverDetails;updateDriverDetails=new i.vpe;driverInfo;driverNameChanged=!0;employeeIdChanged=!0;allowEditEmployeeId=!0;allowEditDriverName=!0;subscription;constructor(v,u,f,S){this.driversService=v,this.spinnerService=u,this.messageService=f,this.rolesService=S}ngOnInit(){this.subscription=new E.w0,this.getDriverDetails()}ngOnChanges(v){v.driverDetails&&this.getDriverDetails()}getDriverDetails(){this.spinnerService.showSpinner(),this.driversService.getDriverDetails(this.driverDetails.driver_id||this.driverDetails.id_||this.driverDetails).subscribe(u=>{this.driverInfo=u,this.setFormattedData(),this.spinnerService.hideSpinner()})}setFormattedData(){const v=this.driverInfo.cloud_video_path?.cloud_file_name.split("/");this.driverInfo.videoName=v?v[v.length-1]:"NA";var u=sessionStorage.getItem("totalFleetData");const f=(u=JSON.parse(u)).filter(S=>S.id_===this.driverInfo.fleet_id)[0].name;this.driverInfo.fleetName=f}editDriver(){this.allowEditDriverName=this.allowEditEmployeeId=!1;let u=this.driversService.editDriver({name:this.driverInfo.name,employee_id:this.driverInfo.employee_id,id_:this.driverInfo.id_,email:this.driverInfo.email}).subscribe(f=>{f&&(this.messageService.add({severity:"success",summary:"Successful",detail:"Driver details updated successfully",life:3e3}),this.updateDriverDetails.emit(f))});this.subscription.add(u)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}static \u0275fac=function(u){return new(u||T)(i.Y36(D.Ft),i.Y36(D.V),i.Y36(k.ez),i.Y36(D.Nj))};static \u0275cmp=i.Xpm({type:T,selectors:[["app-driver-enrolment"]],inputs:{driverDetails:"driverDetails"},outputs:{updateDriverDetails:"updateDriverDetails"},features:[i.TTD],decls:2,vars:1,consts:[["class","col-12",4,"ngIf"],[1,"col-12"],[1,"grid","align-items-center"],[1,"col-12","md:col-4","text-center"],["src","assets/demo/images/settings/person_placeholder.svg","style","z-index: 0;",4,"ngIf"],["class","single-view-image-carousel",3,"value","circular",4,"ngIf"],[1,"col-7","align-items-center","pl-4","justify-content-center","border-left-1","border-400"],[1,"flex","flex-column","md:flex-row","align-items-center","p-2","w-full"],[1,"flex","flex-row","md:flex-column","justify-content-between","w-full","md:w-auto","md:align-items-end","mt-5","md:mt-0"],[1,"flex-1","flex","flex-column"],[1,"font-semibold"],["layout","horizontal"],[1,"field","col-12","md:col-4","w-full"],[1,"mb-4"],["for","driverName",1,"mt-2"],[1,"p-float-label"],["type","text","id","driverName","pInputText","","placeholder","Driver name","maxlength","45",1,"w-full",3,"ngModel","ngModelChange"],["for","empoyeeId",1,"mt-2"],["type","text","id","empoyeeId","pInputText","","placeholder","Employee id","maxlength","50",1,"w-full",3,"ngModel","ngModelChange"],["type","text","id","email","pInputText","","placeholder","Driver Email","maxlength","70",1,"w-full",3,"ngModel","ngModelChange"],[1,"col-12","md:col-4"],["pButton","","label","Save",3,"disabled","click"],["src","assets/demo/images/settings/person_placeholder.svg",2,"z-index","0"],[1,"single-view-image-carousel",3,"value","circular"],["pTemplate","item"],["alt","Driver",1,"driver-image",3,"src"]],template:function(u,f){1&u&&(i._UZ(0,"p-toast"),i.YNc(1,te,58,11,"div",0)),2&u&&(i.xp6(1),i.Q6J("ngIf",f.driverInfo))},dependencies:[R.O5,k.jx,e.Fj,e.JJ,e.nD,e.On,Q.o,Y.i,U.Hq,V.l,H.FN],styles:[".img-preview-wrapper[_ngcontent-%COMP%]{position:relative}.image_preview_grid1[_ngcontent-%COMP%]{width:250px;height:250px;object-fit:contain;overflow:hidden;background:transparent url(Blocks-1s-200px.e03e91021bf141a2.gif) center no-repeat}.btn-next[_ngcontent-%COMP%]{position:absolute;top:45%;left:95%;transform:translate(-50%,-50%);-ms-transform:translate(-50%,-50%);background-color:transparant;color:#1e90ff;font-size:50px;border:none;cursor:pointer;opacity:.6}.btn-next[_ngcontent-%COMP%]:hover{color:#1e90ff;opacity:.9}.btn-prev[_ngcontent-%COMP%]{position:absolute;top:45%;left:5%;transform:translate(-50%,-50%);-ms-transform:translate(-50%,-50%);background-color:transparant;color:#1e90ff;font-size:50px;border:none;cursor:pointer;opacity:.6}.btn-prev[_ngcontent-%COMP%]:hover{color:#1e90ff;opacity:.9}.save-btn[_ngcontent-%COMP%]{border-color:#3c6b69;background-color:#3c6b69}.driver-image[_ngcontent-%COMP%]{max-width:250px}"]})}return T})()},718:(ue,q,d)=>{d.d(q,{q:()=>we});var i=d(5879),E=d(2001),D=d(5219),k=d(9315),R=d(4698),e=d(5878),Q=d(6814),Y=d(4480),U=d(707),V=d(1865),H=d(6223),X=d(9552),ee=d(4104),j=d(6218),z=d(9025),te=d(2160),w=d(6760),T=d(5609),m=d(7680);const v=["videoPlayer"];function u(_,x){1&_&&i._UZ(0,"p-progressSpinner",6)}function f(_,x){if(1&_){const s=i.EpF();i.TgZ(0,"div",1)(1,"h5")(2,"span",7),i._uU(3),i.qZA(),i._uU(4," | "),i.TgZ(5,"button",8),i.NdJ("click",function(){i.CHM(s);const p=i.oxw();return i.KtG(p.playAllVideos())}),i.qZA()()()}if(2&_){const s=i.oxw();i.xp6(3),i.AsE("",null==s.driverDetail?null:s.driverDetail.name," | ",s.selectedDriverTimseStamp," ")}}function S(_,x){if(1&_){const s=i.EpF();i.TgZ(0,"video",29,30),i.NdJ("loadeddata",function(p){i.CHM(s);const h=i.oxw(2);return i.KtG(h.onVideoLoaded(p))}),i._uU(2," Your browser does not support the video tag. "),i.qZA()}if(2&_){const s=i.oxw(2);i.Q6J("src",s.selectedDmsVideoURL,i.LSH)("muted",!0)}}function G(_,x){1&_&&(i.TgZ(0,"div",19),i._uU(1," Video is not available. "),i.qZA())}function se(_,x){if(1&_){const s=i.EpF();i.TgZ(0,"video",29,30),i.NdJ("loadeddata",function(p){i.CHM(s);const h=i.oxw(2);return i.KtG(h.onVideoLoaded(p))}),i._uU(2," Your browser does not support the video tag. "),i.qZA()}if(2&_){const s=i.oxw(2);i.Q6J("src",s.selectedAdasVideoURL,i.LSH)("muted",!0)}}function N(_,x){1&_&&(i.TgZ(0,"div",19),i._uU(1," Video is not available. "),i.qZA())}function le(_,x){if(1&_&&(i.TgZ(0,"div",9)(1,"div",10)(2,"div",11)(3,"div",12)(4,"div",13)(5,"div",14),i._UZ(6,"div",15),i.YNc(7,S,3,2,"video",16),i.qZA(),i.YNc(8,G,2,0,"div",17),i.qZA()(),i.TgZ(9,"div",18)(10,"div",13)(11,"div",14),i._UZ(12,"div",15),i.qZA(),i.TgZ(13,"div",19),i._uU(14," Video is not available. "),i.qZA()()(),i.TgZ(15,"div",20)(16,"div",13)(17,"div",14),i._UZ(18,"div",15),i.qZA(),i.TgZ(19,"div",19),i._uU(20," Video is not available. "),i.qZA()()(),i.TgZ(21,"div",21)(22,"div",13)(23,"div",14),i._UZ(24,"div",15),i.qZA(),i.TgZ(25,"div",19),i._uU(26," Video is not available. "),i.qZA()()(),i.TgZ(27,"div",22)(28,"div",13)(29,"div",14),i._UZ(30,"div",15),i.YNc(31,se,3,2,"video",16),i.qZA(),i.YNc(32,N,2,0,"div",17),i.qZA()(),i._UZ(33,"img",23)(34,"img",24)(35,"img",25)(36,"img",26)(37,"img",27)(38,"img",28),i.qZA()()()),2&_){const s=i.oxw();i.xp6(7),i.Q6J("ngIf",s.selectedDmsVideoURL),i.xp6(1),i.Q6J("ngIf",!s.selectedDmsVideoURL),i.xp6(23),i.Q6J("ngIf",s.selectedAdasVideoURL),i.xp6(1),i.Q6J("ngIf",!s.selectedAdasVideoURL)}}function Te(_,x){if(1&_){const s=i.EpF();i.TgZ(0,"i",76),i.NdJ("click",function(){i.CHM(s);const p=i.oxw(2);return i.KtG(p.copyToClipboard(null==p.driverDetail?null:p.driverDetail.id_))}),i.qZA()}}const ie=function(_){return{"background-color":_}};function be(_,x){if(1&_&&i._UZ(0,"div",81),2&_){const s=i.oxw().$implicit;i.Q6J("ngStyle",i.VKq(1,ie,s.color))}}function Ee(_,x){if(1&_&&(i.YNc(0,be,1,3,"div",80),i._uU(1)),2&_){const s=x.$implicit;i.Q6J("ngIf",null==s?null:s.color),i.xp6(1),i.hij(" ",null==s?null:s.name," ")}}function Ae(_,x){if(1&_&&i._UZ(0,"div",81),2&_){const s=i.oxw().$implicit;i.Q6J("ngStyle",i.VKq(1,ie,s.color))}}function Se(_,x){if(1&_&&(i.YNc(0,Ae,1,3,"div",80),i._uU(1)),2&_){const s=x.$implicit;i.Q6J("ngIf",null==s?null:s.color),i.xp6(1),i.hij(" ",null==s?null:s.name," ")}}const he=function(){return{width:"100%"}};function Ve(_,x){if(1&_){const s=i.EpF();i.TgZ(0,"p-dropdown",77),i.NdJ("ngModelChange",function(p){i.CHM(s);const h=i.oxw(2);return i.KtG(h.coaching_type=p)})("onChange",function(p){i.CHM(s);const h=i.oxw(2);return i.KtG(h.onReviewStatusChange(p,h.selectedEvent))}),i.YNc(1,Ee,2,2,"ng-template",78),i.YNc(2,Se,2,2,"ng-template",79),i.qZA()}if(2&_){const s=i.oxw(2);i.Akn(i.DdM(5,he)),i.Q6J("options",s.reviewStatuses)("ngModel",s.coaching_type)("disabled",s.selectedEvent.isReviewStatusDisabled)}}function Fe(_,x){if(1&_&&i._UZ(0,"div",81),2&_){const s=i.oxw().$implicit;i.Q6J("ngStyle",i.VKq(1,ie,s.color))}}function Ze(_,x){if(1&_&&(i.YNc(0,Fe,1,3,"div",80),i._uU(1)),2&_){const s=x.$implicit;i.Q6J("ngIf",null==s?null:s.color),i.xp6(1),i.hij(" ",null==s?null:s.name," ")}}function ce(_,x){if(1&_&&i._UZ(0,"div",81),2&_){const s=i.oxw().$implicit;i.Q6J("ngStyle",i.VKq(1,ie,s.color))}}function de(_,x){if(1&_&&(i.YNc(0,ce,1,3,"div",80),i._uU(1)),2&_){const s=x.$implicit;i.Q6J("ngIf",null==s?null:s.color),i.xp6(1),i.hij(" ",null==s?null:s.name," ")}}function Me(_,x){if(1&_){const s=i.EpF();i.TgZ(0,"p-dropdown",82),i.NdJ("ngModelChange",function(p){i.CHM(s);const h=i.oxw(2);return i.KtG(h.coaching_status=p)}),i.YNc(1,Ze,2,2,"ng-template",78),i.YNc(2,de,2,2,"ng-template",79),i.qZA()}if(2&_){const s=i.oxw(2);i.Akn(i.DdM(5,he)),i.Q6J("options",s.coachingStatuses)("ngModel",s.coaching_status)("disabled",s.selectedEvent.isCoachingStatusDisabled)}}const _e=function(_){return[_]};function fe(_,x){if(1&_){const s=i.EpF();i.TgZ(0,"div",87)(1,"app-share-events",88,89),i.NdJ("refresh",function(p){i.CHM(s);const h=i.oxw(3);return i.KtG(h.refreshReviewDetails(p))}),i.qZA()()}if(2&_){const s=i.oxw(3);i.xp6(1),i.Q6J("users",s.users)("driverDetails",s.driverDetail)("selectedEventIds",i.VKq(6,_e,null==s.selectedEventFromParent?null:s.selectedEventFromParent.id_))("showShareEvents",!0)("showSubmitButton",!1)("comments",s.comment)}}function Ie(_,x){if(1&_){const s=i.EpF();i.TgZ(0,"div",83)(1,"div",1)(2,"label",84)(3,"b"),i._uU(4,"Share Event? "),i.qZA()(),i.TgZ(5,"p-inputSwitch",85),i.NdJ("ngModelChange",function(p){i.CHM(s);const h=i.oxw(2);return i.KtG(h.shareEvents=p)})("onChange",function(p){i.CHM(s);const h=i.oxw(2);return i.KtG(h.onSwitchChange(p))}),i.qZA(),i.YNc(6,fe,3,8,"div",86),i.qZA()()}if(2&_){const s=i.oxw(2);i.xp6(5),i.Q6J("ngModel",s.shareEvents),i.xp6(1),i.Q6J("ngIf",s.shareEvents)}}function Ce(_,x){1&_&&(i.TgZ(0,"tr")(1,"th",90),i._uU(2,"Event "),i.qZA(),i.TgZ(3,"th",91),i._uU(4,"Confidence "),i.qZA(),i.TgZ(5,"th",92),i._uU(6," Duration(seconds) "),i.qZA()())}function xe(_,x){if(1&_&&(i.TgZ(0,"tr")(1,"td",94)(2,"span"),i._uU(3),i.qZA()(),i.TgZ(4,"td",95)(5,"span"),i._uU(6),i.qZA()(),i.TgZ(7,"td",95)(8,"span"),i._uU(9),i.qZA()()()),2&_){const s=i.oxw().$implicit,g=i.oxw(2);i.xp6(3),i.Oqu(g.utilsService.formatLabelForCharts(s.event_name)),i.xp6(3),i.Oqu(s.confidence),i.xp6(3),i.Oqu(s.duration)}}function De(_,x){if(1&_&&i.YNc(0,xe,10,3,"tr",93),2&_){const s=x.$implicit,g=i.oxw(2);i.Q6J("ngIf",""!==s.confidence&&!g.compoundEventNames.includes(s.event_name))}}function pe(_,x){if(1&_&&(i.TgZ(0,"google-map",96),i._UZ(1,"map-marker",97,98),i.qZA()),2&_){const s=i.oxw(2);i.Q6J("options",s.options),i.xp6(1),i.Q6J("position",s.options.center)}}const ve=function(){return{width:"100%",resize:"vertical"}};function ne(_,x){if(1&_){const s=i.EpF();i.TgZ(0,"div",31)(1,"div",32)(2,"div",1)(3,"div",10)(4,"div",33),i._uU(5,"Overview"),i.qZA(),i.TgZ(6,"div",34)(7,"div",35)(8,"span",36),i._uU(9," Driver:"),i.qZA(),i.TgZ(10,"span",37),i._uU(11),i.qZA()(),i.TgZ(12,"div",35)(13,"span",36),i._uU(14," Mask:"),i.qZA(),i.TgZ(15,"span",38),i._uU(16,"No Mask"),i.qZA()(),i.TgZ(17,"div",35)(18,"span",36),i._uU(19,"Driver ID:"),i.qZA(),i.TgZ(20,"span",39),i._uU(21),i.qZA(),i.YNc(22,Te,1,0,"i",40),i.qZA(),i.TgZ(23,"div",35)(24,"span",36),i._uU(25,"Event ID:"),i.qZA(),i.TgZ(26,"span",39),i._uU(27),i.qZA(),i.TgZ(28,"i",41),i.NdJ("click",function(){i.CHM(s);const p=i.oxw();return i.KtG(p.copyToClipboard(p.selectedEvent.client_provided_id))}),i.qZA()(),i.TgZ(29,"div",35)(30,"span",36),i._uU(31,"Device ID:"),i.qZA(),i.TgZ(32,"span",39),i._uU(33),i.qZA(),i.TgZ(34,"i",41),i.NdJ("click",function(){i.CHM(s);const p=i.oxw();return i.KtG(p.copyToClipboard(p.selectedEvent.client_device_id))}),i.qZA()(),i.TgZ(35,"div",35)(36,"span",36),i._uU(37,"Plate No.:"),i.qZA(),i.TgZ(38,"span",39),i._uU(39),i.qZA(),i.TgZ(40,"i",41),i.NdJ("click",function(){i.CHM(s);const p=i.oxw();return i.KtG(p.copyToClipboard(p.selectedEventFromParent.plate_number))}),i.qZA()(),i.TgZ(41,"div",35)(42,"span",36),i._uU(43,"Initial Speed:"),i.qZA(),i.TgZ(44,"span",38),i._uU(45),i.qZA()(),i.TgZ(46,"div",35)(47,"span",36),i._uU(48,"Final Speed:"),i.qZA(),i.TgZ(49,"span",38),i._uU(50),i.qZA()(),i.TgZ(51,"div",42)(52,"span",43),i._uU(53,"Face Count:"),i.qZA(),i.TgZ(54,"span",44),i._uU(55),i.qZA()()(),i.TgZ(56,"div",45)(57,"div",46)(58,"span",47),i._uU(59,"Event Review:"),i.qZA()(),i.TgZ(60,"div",48)(61,"p-radioButton",49),i.NdJ("ngModelChange",function(p){i.CHM(s);const h=i.oxw();return i.KtG(h.valRadio=p)}),i.qZA(),i.TgZ(62,"label",50),i._uU(63,"Correct"),i.qZA()(),i.TgZ(64,"div",48)(65,"p-radioButton",51),i.NdJ("ngModelChange",function(p){i.CHM(s);const h=i.oxw();return i.KtG(h.valRadio=p)}),i.qZA(),i.TgZ(66,"label",52),i._uU(67,"Incorrect"),i.qZA()(),i.TgZ(68,"div",48)(69,"p-radioButton",53),i.NdJ("ngModelChange",function(p){i.CHM(s);const h=i.oxw();return i.KtG(h.valRadio=p)}),i.qZA(),i.TgZ(70,"label",54),i._uU(71,"Unverified"),i.qZA()(),i.TgZ(72,"div",55)(73,"div",56)(74,"b"),i._uU(75," Reviewed By:"),i.qZA(),i._uU(76),i.qZA()()(),i.TgZ(77,"div",57)(78,"div",58)(79,"div",59)(80,"b"),i._uU(81,"Coached By:"),i.qZA()(),i._uU(82),i.qZA(),i.TgZ(83,"div",58)(84,"div",60)(85,"b"),i._uU(86,"Manager Review Status:"),i.qZA()(),i.YNc(87,Ve,3,6,"p-dropdown",61),i.qZA(),i.TgZ(88,"div",58)(89,"div",62)(90,"b"),i._uU(91," Coaching Status:"),i.qZA()(),i.YNc(92,Me,3,6,"p-dropdown",63),i.qZA(),i.TgZ(93,"div",58)(94,"div",64)(95,"b"),i._uU(96,"Due Date:"),i.qZA()(),i.TgZ(97,"p-calendar",65),i.NdJ("ngModelChange",function(p){i.CHM(s);const h=i.oxw();return i.KtG(h.dueDate=p)}),i.qZA()(),i.TgZ(98,"div",55)(99,"div",64)(100,"b"),i._uU(101," Comments:"),i.qZA()(),i.TgZ(102,"textarea",66),i.NdJ("ngModelChange",function(p){i.CHM(s);const h=i.oxw();return i.KtG(h.comment=p)}),i.qZA()()(),i.YNc(103,Ie,7,2,"div",67),i.TgZ(104,"div",34)(105,"div",68)(106,"button",69),i.NdJ("click",function(){i.CHM(s);const p=i.oxw();return i.KtG(p.onSubmitEvent())}),i.qZA()()()()(),i.TgZ(107,"div",1)(108,"div",10)(109,"div",70),i._uU(110,"Event Summary"),i.qZA(),i.TgZ(111,"p-table",71,72),i.YNc(113,Ce,7,0,"ng-template",73),i.YNc(114,De,1,1,"ng-template",74),i.qZA()()(),i.TgZ(115,"div",1)(116,"div",10)(117,"div",70),i._uU(118,"Location"),i.qZA(),i.YNc(119,pe,3,2,"google-map",75),i.qZA()()()()}if(2&_){const s=i.oxw();i.xp6(11),i.Oqu(null==s.driverDetail?null:s.driverDetail.name),i.xp6(9),i.s9C("title",null==s.driverDetail?null:s.driverDetail.id_),i.xp6(1),i.Oqu(s.driverDetail?"":"N/A"),i.xp6(1),i.Q6J("ngIf",s.driverDetail),i.xp6(4),i.s9C("title",s.selectedEvent.client_provided_id),i.xp6(1),i.Oqu(s.selectedEvent.client_provided_id?"":"N/A"),i.xp6(5),i.s9C("title",s.selectedEvent.client_device_id),i.xp6(1),i.Oqu(s.selectedEvent.client_device_id?"":"N/A"),i.xp6(5),i.s9C("title",s.selectedEventFromParent.plate_number),i.xp6(1),i.Oqu(s.selectedEventFromParent.plate_number?"":"N/A"),i.xp6(6),i.hij("",s.selectedEvent.snapshot_metadata.initial_speed," mph"),i.xp6(5),i.hij("",s.selectedEvent.snapshot_metadata.final_speed," mph"),i.xp6(5),i.Oqu(null!=s.selectedEvent.videos&&null!=s.selectedEvent.videos.driver&&s.selectedEvent.videos.driver.in_cabin_face_count?null==s.selectedEvent.videos||null==s.selectedEvent.videos.driver?null:s.selectedEvent.videos.driver.in_cabin_face_count:"N/A"),i.xp6(6),i.Q6J("ngModel",s.valRadio),i.xp6(4),i.Q6J("ngModel",s.valRadio),i.xp6(4),i.Q6J("ngModel",s.valRadio),i.xp6(7),i.hij(" \xa0 ",s.getFilteredUserName(s.selectedEvent.coaching_data.coaching_reviewer_id)||"N/A"," "),i.xp6(6),i.hij(" ",s.getFilteredUserName(s.selectedEvent.coaching_data.coaching_completer_id)||"N/A"," "),i.xp6(5),i.Q6J("ngIf",s.reviewStatuses),i.xp6(5),i.Q6J("ngIf",s.coachingStatuses),i.xp6(5),i.Akn(i.DdM(35,he)),i.Q6J("readonlyInput",!0)("disabled",s.selectedEvent.isDueDateDisabled)("ngModel",s.dueDate),i.xp6(5),i.Akn(i.DdM(36,ve)),i.Q6J("ngModel",s.comment)("disabled",!s.selectedEvent.isCommentsDisabled)("autoResize",!0),i.xp6(1),i.Q6J("ngIf",s.showShareEventsBlock),i.xp6(3),i.Q6J("disabled",!s.rolesService.hasAccess("2020")),i.xp6(5),i.Q6J("value",s.eventSummary)("rows",5),i.xp6(8),i.Q6J("ngIf",s.options)}}let we=(()=>{class _{eventService;messageService;usersRolesService;utilsService;rolesService;driverAnalyticsService;cdref;shareEventsComponent;selectedEventFromParent;compoundEventNames=[];orgSettings;updateDriverReviewDetails=new i.vpe;refreshEvents=new i.vpe;videoPlayers;selectedEvent;selectedDriverId;selectedDmsVideoURL;selectedAdasVideoURL;selectedDriverTimseStamp;valRadio="CORRECT";coaching_type="UNREVIEWED";comment="";oldReviewType="";eventSummary=[];users=[];driver_id_name_map={};lat=0;lng=0;options={center:{lat:0,lng:0},zoom:4};reviewStatuses=[];coachingStatuses=[];dueDate;coaching_status="NA";driverDetail={};shareEventsDialog=!1;shareEvents=!1;showShareEventsBlock=!1;devices=[];constructor(s,g,p,h,F,oe,ge){this.eventService=s,this.messageService=g,this.usersRolesService=p,this.utilsService=h,this.rolesService=F,this.driverAnalyticsService=oe,this.cdref=ge}ngOnInit(){this.getUsers(),this.getEventAndDriverDetails()}isVideoDetails=!1;getEventAndDriverDetails(){const s=this.eventService.getSnapshotDetail(this.selectedEventFromParent.id_),g=this.selectedEventFromParent.driver_id?this.driverAnalyticsService.getAllDriversForFleets(E.dc(),[this.selectedEventFromParent.driver_id]):null;(0,k.D)(g?[s,g]:[s]).subscribe(([h,F])=>{this.resetFields(),this.showEventDetails(h),F&&(this.driverDetail=F.data[0])})}showEventDetails(s){if(this.isVideoDetails=!0,this.selectedEvent=s,this.dueDate=s.coaching_data.coaching_due_date?new Date(s.coaching_data.coaching_due_date):"",this.comment=s.coaching_data.coaching_comments,this.coaching_type=s.coaching_data.coaching_type,this.coaching_status=s.coaching_data.coaching_status,this.valRadio=s.videos.driver.review,s.snapshot_metadata.snapshot_info.timestamp){const P=this.utilsService.convertToTimezone(s.snapshot_metadata.snapshot_info.timestamp,this.orgSettings.timezone);this.selectedDriverTimseStamp=P}this.options.center.lat=s.snapshot_metadata?.location?.latitude,this.options.center.lng=s.snapshot_metadata?.location?.longitude,this.selectedDmsVideoURL=s.videos?.driver.url,this.selectedAdasVideoURL=s.videos?.road_front?.url,this.selectedEvent.isCommentsDisabled=""!==s.coaching_data.coaching_type,this.selectedEvent.isDueDateDisabled="COACHABLE"===s.coaching_data.coaching_type||"NOTCOACHABLE"===s.coaching_data.coaching_type,this.selectedEvent.isReviewStatusDisabled="COMPLETE"===s.coaching_data.coaching_status||"COACHABLE"===s.coaching_data.coaching_type||"NOTCOACHABLE"===s.coaching_data.coaching_type,this.selectedEvent.isCoachingStatusDisabled="COMPLETE"===s.coaching_data.coaching_status||"NOTCOACHABLE"===s.coaching_data.coaching_type,"COACHABLE"===s.coaching_data.coaching_type&&this.dueDate&&this.dueDate<new Date&&(this.coachingStatuses=this.coachingStatuses.filter(P=>"PENDING"!==P.value)),this.eventSummary=[];let p=s.videos.driver?.video_metadata?.event,h=s.videos.road_front?.video_metadata?.event;Object.entries(h).forEach(([P,L])=>{if(L.timestamps.length){let Z=new Set;L.timestamps.forEach(me=>Z.add(Math.floor(me))),h[P].duration=Z.size,h[P].confidence=1}});let F=s.client_label;Object.entries(F).forEach(([P,L])=>{if(L.hasOwnProperty("timestamps")&&L.timestamps.length){let Z=new Set;L.timestamps.forEach(me=>Z.add(Math.floor(me))),F[P].duration=Z.size,F[P].confidence=1}});let oe={...p,...h,...F},ge=s.et_label||[];oe&&Object.entries(oe).forEach(([P,L])=>{let Z=L;ge.includes(P)&&(Z.duration>0||Z.confidence>0)&&(Z.duration=Z.duration>0?Number(Z.duration.toFixed(2)):"",Z.confidence=Z.confidence>0?Number(Z.confidence.toFixed(2)):"",Z.event_name=P,this.eventSummary.push(Z))})}resetFields(){this.shareEvents=!1,this.selectedEvent=null,this.selectedDriverId="",this.selectedDmsVideoURL="",this.selectedAdasVideoURL="",this.selectedDriverTimseStamp="",this.valRadio="CORRECT",this.coaching_type="UNREVIEWED",this.comment="",this.oldReviewType="",this.eventSummary=[],this.lat=0,this.lng=0,this.options.center={lat:0,lng:0},this.dueDate=null,this.coaching_status="NA",this.driverDetail={},this.isVideoDetails=!1,this.videoLoaded={}}getUsers(){this.usersRolesService.getUsers().subscribe(s=>{this.users=s})}videoLoaded={};onVideoLoaded(s){this.videoLoaded[s]=!0}initFilters(){const s=getComputedStyle(document.documentElement);this.reviewStatuses=[{name:"Coachable",value:"COACHABLE"},{name:"Non Coachable",value:"NOTCOACHABLE"},{name:"Unreviewed",value:"UNREVIEWED",color:s.getPropertyValue("--chart-color-11")}],this.coachingStatuses=[{name:"Pending",value:"PENDING",color:s.getPropertyValue("--chart-color-10")},{name:"Completed",value:"COMPLETE",color:s.getPropertyValue("--chart-color-8")}]}onSubmitEvent(){if(this.shareEvents)this.shareEventsComponent.sendEvents();else{let s={coaching_comments:this.comment,review_status:this.valRadio,coaching_type:this.coaching_type,coaching_status:this.coaching_status,coaching_due_date:this.dueDate&&""!==this.dueDate?this.dueDate?.toISOString().substring(0,10):""};this.eventService.saveReview(this.selectedEvent.id_,s).subscribe(g=>{g&&(this.messageService.add({severity:"success",summary:"Successful",detail:"Review updated successfully"}),this.refreshReviewDetails(g))},g=>{this.messageService.add({severity:"error",summary:"Error",detail:g}),console.error(g)})}}refreshReviewDetails(s){this.selectedEvent.coaching_data.coaching_comments=this.comment,this.selectedEvent.videos.driver.review=this.valRadio,this.updateDriverReviewDetails.emit({oldReview:this.oldReviewType,newReview:this.valRadio}),this.selectedEvent.isReviewStatusDisabled="NA"===this.selectedEvent.coaching_data.coaching_status,this.oldReviewType=this.valRadio,this.refreshEvents.emit(s)}onReviewStatusChange(s,g){if(g.isCommentsDisabled=""!==s.value,"COACHABLE"===s.value){const h=new Date((new Date).getTime()+12096e5);this.dueDate=h,this.coaching_status="PENDING",this.selectedEvent.isCoachingStatusDisabled=!1,this.showShareEventsBlock=!0}else"NOTCOACHABLE"===s.value?(this.dueDate="",this.coaching_status="NA",this.selectedEvent.isCoachingStatusDisabled=!0,this.selectedEvent.isDueDateDisabled=!0):(this.dueDate="",this.showShareEventsBlock=!1)}getFilteredUserName(s){const g=this.users.filter(p=>p.id_===s)[0];return g?g.first_name+" "+g.last_name:""}copyToClipboard(s){const g=document.createElement("textarea");g.value=s,document.body.appendChild(g),g.select(),document.execCommand("copy"),document.body.removeChild(g),this.messageService.add({severity:"success",summary:"Successful",detail:"Id copied to clipboard successfully",life:3e3})}playAllVideos(){this.videoPlayers.forEach(s=>{s.nativeElement.play().then(()=>{console.log("Video is playing")}).catch(g=>{console.error("Error attempting to play video:",g)})})}toggleShareEventsBlock(){this.shareEvents=!this.shareEvents,this.cdref.detectChanges()}onSwitchChange(s){this.shareEvents=!!s.checked}onCloseEvent(){this.isVideoDetails=!1}ngOnChanges(s){(s.selectedEventFromParent||s.selectedDriverIdFromParent)&&(this.driverDetail={},this.getEventAndDriverDetails(),this.initFilters())}static \u0275fac=function(g){return new(g||_)(i.Y36(e.nC),i.Y36(D.ez),i.Y36(e.Xb),i.Y36(e.FW),i.Y36(e.Nj),i.Y36(e.NZ),i.Y36(i.sBO))};static \u0275cmp=i.Xpm({type:_,selectors:[["app-event-details"]],viewQuery:function(g,p){if(1&g&&(i.Gf(R.P,5),i.Gf(v,5)),2&g){let h;i.iGM(h=i.CRH())&&(p.shareEventsComponent=h.first),i.iGM(h=i.CRH())&&(p.videoPlayers=h)}},inputs:{selectedEventFromParent:"selectedEventFromParent",compoundEventNames:"compoundEventNames",orgSettings:"orgSettings"},outputs:{updateDriverReviewDetails:"updateDriverReviewDetails",refreshEvents:"refreshEvents"},features:[i._Bn([D.ez]),i.TTD],decls:7,vars:4,consts:[[1,"grid","mt-2","mx-3","relative"],[1,"col-12"],["styleClass","w-5rem h-5rem",4,"ngIf"],["class","col-12",4,"ngIf"],["class","md:col-8 col-12",4,"ngIf"],["class","md:col-4 col-12",4,"ngIf"],["styleClass","w-5rem h-5rem"],[1,"label","label-default"],["pButton","","pRipple","","label","Play All Videos","icon","pi pi-play",1,"py-1","ml-2","inline-block",3,"click"],[1,"md:col-8","col-12"],[1,"card"],[1,"truck-container"],[1,"top-left-video"],[1,"video-container"],[1,"video-wrapper"],[1,"video-backdrop"],["controls","",3,"src","muted","loadeddata",4,"ngIf"],["class","text-center text-white w-full",4,"ngIf"],[1,"mid-left-video"],[1,"text-center","text-white","w-full"],[1,"mid-right-video"],[1,"backup-left-video"],[1,"top-right-video"],["src","assets/demo/images/event-details/TruckImage.png","alt","Truck",1,"truck"],["src","assets/demo/images/event-details/LiveCam - Front.png","alt","Arrow",1,"arrow","top-left"],["src","assets/demo/images/event-details/LiveCam - Inside.png","alt","Arrow",1,"arrow","top-right"],["src","assets/demo/images/event-details/DeadCam - Left.png","alt","Arrow",1,"arrow","mid-left"],["src","assets/demo/images/event-details/DeadCam - Right.png","alt","Arrow",1,"arrow","mid-right"],["src","assets/demo/images/event-details/DeadCam - Back.png","alt","Arrow",1,"arrow","backup-left"],["controls","",3,"src","muted","loadeddata"],["videoPlayer",""],[1,"md:col-4","col-12"],[1,"grid"],[1,"text-xl","font-semibold","letter-spacing-01"],[1,"grid","mt-2"],[1,"md:col-6","col-12","mt-2"],[1,"text-900","font-bold","w-7rem","inline-block"],[1,"text-900","font-normal","text-break"],[1,"text-900","font-normal"],[1,"text-900","font-normal",3,"title"],["class","pi pi-copy cursor-pointer ml-2",3,"click",4,"ngIf"],[1,"pi","pi-copy","cursor-pointer","ml-1",3,"click"],[1,"col-12","mt-2"],[1,"text-900","font-bold","inline-block"],[1,"text-900","font-normal","ml-2"],[1,"grid","mt-3","pt-3","review-block"],[1,"col-12","md:col-2"],[1,"text-900","font-bold","w-4rem","inline-block"],[1,"col-12","md:col-3"],["name","city","value","CORRECT","id","city1",3,"ngModel","ngModelChange"],["for","city1",1,"ml-2"],["name","city","value","INCORRECT","id","city2",3,"ngModel","ngModelChange"],["for","city2",1,"ml-2"],["name","city","value","UNREVIEWED","id","city3",3,"ngModel","ngModelChange"],["for","city3",1,"ml-2"],[1,"col-12","description"],[1,"inline-block"],[1,"grid","mt-3","coaching-block","pt-3"],[1,"col-12","md:col-6","description"],[1,"w-8rem","inline-block"],[1,"w-13rem","mb-2"],["placeholder","Select Status...",3,"options","ngModel","style","disabled","ngModelChange","onChange",4,"ngIf"],[1,"w-10rem","mb-2"],["placeholder","Select Status...",3,"options","ngModel","disabled","style","ngModelChange",4,"ngIf"],[1,"w-8rem","mb-2"],["inputId","range",3,"readonlyInput","disabled","ngModel","ngModelChange"],["rows","3","pInputTextarea","","placeholder","Comments",3,"ngModel","disabled","autoResize","ngModelChange"],["class","grid mt-3 share-events-block pt-2",4,"ngIf"],[1,"col-12","text-center"],["pButton","","pRipple","","label","Submit",1,"submit-button","ml-3",3,"disabled","click"],[1,"text-xl","font-semibold","letter-spacing-01","mb-2"],["responsiveLayout","scroll",3,"value","rows"],["dt",""],["pTemplate","header"],["pTemplate","body"],[3,"options",4,"ngIf"],[1,"pi","pi-copy","cursor-pointer","ml-2",3,"click"],["placeholder","Select Status...",3,"options","ngModel","disabled","ngModelChange","onChange"],["pTemplate","selectedItem"],["pTemplate","default"],["class","w-1rem h-1rem mr-1 inline-block vertical-align-text-bottom border-1",3,"ngStyle",4,"ngIf"],[1,"w-1rem","h-1rem","mr-1","inline-block","vertical-align-text-bottom","border-1",3,"ngStyle"],["placeholder","Select Status...",3,"options","ngModel","disabled","ngModelChange"],[1,"grid","mt-3","share-events-block","pt-2"],["for","filter-switch",1,"mr-2","switch-label","vertical-align-middle"],["styleClass","vertical-align-middle",3,"ngModel","ngModelChange","onChange"],["class","mt-4",4,"ngIf"],[1,"mt-4"],[3,"users","driverDetails","selectedEventIds","showShareEvents","showSubmitButton","comments","refresh"],["shareEventsComponent",""],[1,"text-left",2,"min-width","10rem"],[1,"text-center",2,"min-width","10rem"],[1,"text-center",2,"width","5rem"],[4,"ngIf"],[1,"text-left"],[1,"text-center"],[3,"options"],[3,"position"],["marker","mapMarker"]],template:function(g,p){1&g&&(i._UZ(0,"p-toast"),i.TgZ(1,"div",0)(2,"div",1),i.YNc(3,u,1,0,"p-progressSpinner",2),i.qZA(),i.YNc(4,f,6,2,"div",3),i.YNc(5,le,39,4,"div",4),i.YNc(6,ne,120,37,"div",5),i.qZA()),2&g&&(i.xp6(3),i.Q6J("ngIf",!p.isVideoDetails),i.xp6(1),i.Q6J("ngIf",p.isVideoDetails&&p.selectedEvent),i.xp6(1),i.Q6J("ngIf",p.isVideoDetails&&p.selectedEvent),i.xp6(1),i.Q6J("ngIf",p.isVideoDetails&&p.selectedEvent))},dependencies:[Q.O5,Q.PC,D.jx,Y.H,U.Hq,V.EU,H.Fj,H.JJ,H.On,X.iA,ee.FN,j.g,z.b6,z.O_,te.Lt,w.f,T.Ql,m.G,R.P],styles:[".video-container[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{width:100%}.video-container[_ngcontent-%COMP%]{height:100%;width:100%;min-height:220px;background-image:url(video-placeholder.c569469c678aa08a.png);background-size:cover;background-position:center}.video-wrapper[_ngcontent-%COMP%]{position:relative;display:inline-block}.play-button[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);z-index:1;cursor:pointer;width:50px}.truck-container[_ngcontent-%COMP%]{position:relative;display:flex;justify-content:center;align-items:center;height:100vh}.truck-container[_ngcontent-%COMP%]   .video-container[_ngcontent-%COMP%]{height:auto;width:300px}.truck[_ngcontent-%COMP%]{position:absolute;max-width:400px;top:42%;left:50%;transform:translate(-50%,-50%);height:550px}.arrow[_ngcontent-%COMP%]{position:absolute}.top-left[_ngcontent-%COMP%]{top:1%;left:42%}.mid-left[_ngcontent-%COMP%]{top:24%;left:33%}.backup-left[_ngcontent-%COMP%]{top:58%;left:31%}.mid-right[_ngcontent-%COMP%]{top:24%;right:34%}.top-right[_ngcontent-%COMP%]{top:1%;right:42%}.bottom-left[_ngcontent-%COMP%]{bottom:10px;left:10px}.tag[_ngcontent-%COMP%]{margin-left:1%;margin-top:1%}.bottom-right[_ngcontent-%COMP%]{bottom:10px;right:10px}.top-right-video[_ngcontent-%COMP%]{top:0;right:0;position:absolute}.top-left-video[_ngcontent-%COMP%]{top:0;left:0;position:absolute}.mid-left-video[_ngcontent-%COMP%]{top:25%;left:0;position:absolute}.backup-left-video[_ngcontent-%COMP%]{top:50%;left:0;position:absolute}.mid-right-video[_ngcontent-%COMP%]{top:25%;right:0;position:absolute}@media (max-width: 768px){.container[_ngcontent-%COMP%]{flex-direction:column}.arrow[_ngcontent-%COMP%]{width:15%;max-width:60px}.top-left[_ngcontent-%COMP%]{top:10px;left:50%;transform:translate(-50%)}.top-right[_ngcontent-%COMP%]{top:10px;right:50%;transform:translate(50%)}.bottom-left[_ngcontent-%COMP%]{bottom:10px;left:50%;transform:translate(-50%)}.bottom-right[_ngcontent-%COMP%]{bottom:10px;right:50%;transform:translate(50%)}}.green-box[_ngcontent-%COMP%]{width:11px;height:11px;background:#27AE60;border:1px solid #FFFFFF;flex:none;order:3;flex-grow:0;display:inline-block}.white-box[_ngcontent-%COMP%]{width:11px;height:11px;background:#DEDCDE;border:1px solid #FFFFFF;flex:none;order:11;flex-grow:0;display:inline-block}agm-map[_ngcontent-%COMP%]{height:330px}.review-block[_ngcontent-%COMP%], .coaching-block[_ngcontent-%COMP%], .share-events-block[_ngcontent-%COMP%]{border-top:1px dashed #333}.video-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}.video-container[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{width:100%;height:240px;vertical-align:middle}.video-container[_ngcontent-%COMP%]{height:100%;width:100%;min-height:220px;background-image:url(video-placeholder.c569469c678aa08a.png);background-size:cover;background-position:center;background:black}.video-wrapper[_ngcontent-%COMP%]{position:relative;display:inline-block;width:100%}.video-backdrop[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;background-color:#00000040;z-index:-1}[_nghost-%COMP%]  p-progressSpinner{position:absolute;top:25%;left:50%;z-index:10}"]})}return _})()},4698:(ue,q,d)=>{d.d(q,{P:()=>te});var i=d(5879),E=d(5878),D=d(5219),k=d(6814),R=d(707),e=d(1865),Q=d(6223),Y=d(4055),U=d(3714);function V(w,T){if(1&w){const m=i.EpF();i.ynx(0),i.TgZ(1,"input",9),i.NdJ("ngModelChange",function(u){i.CHM(m);const f=i.oxw(2);return i.KtG(f.driverDetails.email=u)}),i.qZA(),i.BQk()}if(2&w){const m=i.oxw(2);i.xp6(1),i.Q6J("ngModel",m.driverDetails.email)}}function H(w,T){if(1&w&&(i._uU(0),i.TgZ(1,"small",12),i._uU(2),i.qZA()),2&w){const m=T.$implicit;i.AsE(" ",m.first_name," ",m.last_name," "),i.xp6(2),i.hij("(",m.email,")")}}function X(w,T){if(1&w){const m=i.EpF();i.ynx(0),i._UZ(1,"br")(2,"br"),i.TgZ(3,"p-multiSelect",10),i.NdJ("ngModelChange",function(u){i.CHM(m);const f=i.oxw(2);return i.KtG(f.selectedUsers=u)}),i.YNc(4,H,3,3,"ng-template",11),i.qZA(),i.BQk()}if(2&w){const m=i.oxw(2);i.xp6(3),i.Q6J("options",m.users)("showToggleAll",!1)("filter",!0)("ngModel",m.selectedUsers)}}function ee(w,T){if(1&w){const m=i.EpF();i.ynx(0),i.TgZ(1,"input",13),i.NdJ("ngModelChange",function(u){i.CHM(m);const f=i.oxw(2);return i.KtG(f.manualEmails=u)}),i.qZA(),i.BQk()}if(2&w){const m=i.oxw(2);i.xp6(1),i.Q6J("ngModel",m.manualEmails)}}function j(w,T){if(1&w){const m=i.EpF();i.TgZ(0,"div",3)(1,"div",4)(2,"p-radioButton",5),i.NdJ("ngModelChange",function(u){i.CHM(m);const f=i.oxw();return i.KtG(f.selectedType=u)}),i.qZA(),i.TgZ(3,"p-radioButton",6),i.NdJ("ngModelChange",function(u){i.CHM(m);const f=i.oxw();return i.KtG(f.selectedType=u)}),i.qZA(),i.TgZ(4,"p-radioButton",7),i.NdJ("ngModelChange",function(u){i.CHM(m);const f=i.oxw();return i.KtG(f.selectedType=u)}),i.qZA(),i.YNc(5,V,2,1,"ng-container",8),i.YNc(6,X,5,4,"ng-container",8),i.YNc(7,ee,2,1,"ng-container",8),i.qZA()()}if(2&w){const m=i.oxw();i.xp6(2),i.Q6J("ngModel",m.selectedType),i.xp6(1),i.Q6J("ngModel",m.selectedType),i.xp6(1),i.Q6J("ngModel",m.selectedType),i.xp6(1),i.Q6J("ngIf","driver"===m.selectedType),i.xp6(1),i.Q6J("ngIf","users"===m.selectedType),i.xp6(1),i.Q6J("ngIf","emails"===m.selectedType)}}function z(w,T){if(1&w){const m=i.EpF();i.TgZ(0,"p-button",14),i.NdJ("click",function(){i.CHM(m);const u=i.oxw();return i.KtG(u.sendEvents())}),i.qZA()}if(2&w){const m=i.oxw();i.Q6J("disabled",!m.coachCompoundEvents&&!m.coachAcknowledged&&!m.selectedEventIds.length)}}let te=(()=>{class w{eventsService;messageService;driverDetails;users=[];selectedEventIds=[];events=[];coachCompoundEvents=!1;showShareEvents=!1;toolbarComponent;coachAcknowledged;showSubmitButton=!0;comments="";refresh=new i.vpe;selectedUsers=[];selectedType="users";manualEmails="";constructor(m,v){this.eventsService=m,this.messageService=v}ngOnInit(){}sendEvents(){const m=[];this.showShareEvents&&this.selectedType&&("users"===this.selectedType?this.selectedUsers&&this.selectedUsers.forEach(N=>{m.push({receiver_id:"",receiver_type:"USER",receiver_email:N.email})}):"emails"===this.selectedType?this.manualEmails.split(",").forEach(le=>{m.push({receiver_id:"",receiver_email:le.trim(),receiver_type:"USER"})}):"driver"===this.selectedType&&m.push({receiver_id:this.driverDetails.id_,receiver_email:this.driverDetails.email,receiver_type:"DRIVER"}));const v=new Date;let u="UNREVIEWED",f="",S="PENDING",G="COACHABLE";var se=v.setDate(v.getDate()+15);f=new Date(se).toLocaleDateString("en-CA"),("driver"===this.selectedType&&"UNREVIEWED"===G&&!this.coachAcknowledged||this.coachCompoundEvents)&&(G="COACHABLE",S="PENDING"),this.coachAcknowledged&&(S="COMPLETE"),this.selectedEventIds.length>1?this.eventsService.updateSnapshotsMultiple(this.selectedEventIds,m,u,S,G,f,this.comments).subscribe({next:()=>{this.messageService.add({severity:"success",summary:"Success",detail:this.showShareEvents?"Event(s) status updated and shared successfully":"Events coached successfully"}),this.refresh.emit()},error:N=>{N&&"no snapshot available to update"===N.message&&this.messageService.add({severity:"error",summary:"Error",detail:"One or more compound events are still in progress. Please try again later."})}}):this.eventsService.updateSnapshots(this.selectedEventIds[0],m,u,S,G,f,this.comments).subscribe({next:()=>{this.messageService.add({severity:"success",summary:"Success",detail:this.showShareEvents?"Event status updated and shared successfully":"Events coached successfully"}),this.refresh.emit()},error:N=>{N&&"no snapshot available to update"===N.message&&this.messageService.add({severity:"error",summary:"Error",detail:"One or more compound events are still in progress. Please try again later."})}})}static \u0275fac=function(v){return new(v||w)(i.Y36(E.nC),i.Y36(D.ez))};static \u0275cmp=i.Xpm({type:w,selectors:[["app-share-events"]],inputs:{driverDetails:"driverDetails",users:"users",selectedEventIds:"selectedEventIds",events:"events",coachCompoundEvents:"coachCompoundEvents",showShareEvents:"showShareEvents",toolbarComponent:"toolbarComponent",coachAcknowledged:"coachAcknowledged",showSubmitButton:"showSubmitButton",comments:"comments"},outputs:{refresh:"refresh"},decls:3,vars:2,consts:[["class","grid","id","share-events",4,"ngIf"],[1,"col-12","text-center"],["label","Submit","styleClass","p-button-text w-6rem mt-4 mx-auto",3,"disabled","click",4,"ngIf"],["id","share-events",1,"grid"],[1,"col-12"],["name","shareType","value","driver","label","Driver Email",3,"ngModel","ngModelChange"],["name","shareType","value","users","label","Select Users","styleClass","ml-3",3,"ngModel","ngModelChange"],["name","shareType","value","emails","label","Enter Email ID manually","styleClass","ml-3",3,"ngModel","ngModelChange"],[4,"ngIf"],["type","text","pInputText","","placeholder","Driver Email Id","disabled","",1,"mt-3","w-full",3,"ngModel","ngModelChange"],["styleClass","align-items-center w-full","optionLabel","email","placeholder","Select user...","appendTo","body",3,"options","showToggleAll","filter","ngModel","ngModelChange"],["pTemplate","default"],[1,"ml-3"],["type","text","pInputText","","placeholder","Enter comma separated email ids",1,"mt-3","w-full",3,"ngModel","ngModelChange"],["label","Submit","styleClass","p-button-text w-6rem mt-4 mx-auto",3,"disabled","click"]],template:function(v,u){1&v&&(i.YNc(0,j,8,6,"div",0),i.TgZ(1,"div",1),i.YNc(2,z,1,1,"p-button",2),i.qZA()),2&v&&(i.Q6J("ngIf",u.showShareEvents),i.xp6(2),i.Q6J("ngIf",u.showSubmitButton))},dependencies:[k.O5,D.jx,R.zx,e.EU,Q.Fj,Q.JJ,Q.On,Y.NU,U.o],styles:[".p-multiselect-panel .p-multiselect-items{max-height:350px}"]})}return w})()},5359:(ue,q,d)=>{d.d(q,{i:()=>k,x:()=>R});var i=d(5879),E=d(6814);const D=["*"];let k=(()=>{class e{style;styleClass;layout="horizontal";type="solid";align;containerClass(){return{"p-divider p-component":!0,"p-divider-horizontal":"horizontal"===this.layout,"p-divider-vertical":"vertical"===this.layout,"p-divider-solid":"solid"===this.type,"p-divider-dashed":"dashed"===this.type,"p-divider-dotted":"dotted"===this.type,"p-divider-left":"horizontal"===this.layout&&(!this.align||"left"===this.align),"p-divider-center":"horizontal"===this.layout&&"center"===this.align||"vertical"===this.layout&&(!this.align||"center"===this.align),"p-divider-right":"horizontal"===this.layout&&"right"===this.align,"p-divider-top":"vertical"===this.layout&&"top"===this.align,"p-divider-bottom":"vertical"===this.layout&&"bottom"===this.align}}static \u0275fac=function(U){return new(U||e)};static \u0275cmp=i.Xpm({type:e,selectors:[["p-divider"]],hostAttrs:[1,"p-element"],inputs:{style:"style",styleClass:"styleClass",layout:"layout",type:"type",align:"align"},ngContentSelectors:D,decls:3,vars:6,consts:[["role","separator",3,"ngClass","ngStyle"],[1,"p-divider-content"]],template:function(U,V){1&U&&(i.F$t(),i.TgZ(0,"div",0)(1,"div",1),i.Hsn(2),i.qZA()()),2&U&&(i.Tol(V.styleClass),i.Q6J("ngClass",V.containerClass())("ngStyle",V.style),i.uIk("aria-orientation",V.layout)("data-pc-name","divider"))},dependencies:[E.mk,E.PC],styles:['@layer primeng{.p-divider-horizontal{display:flex;width:100%;position:relative;align-items:center}.p-divider-horizontal:before{position:absolute;display:block;top:50%;left:0;width:100%;content:""}.p-divider-horizontal.p-divider-left{justify-content:flex-start}.p-divider-horizontal.p-divider-right{justify-content:flex-end}.p-divider-horizontal.p-divider-center{justify-content:center}.p-divider-content{z-index:1}.p-divider-vertical{min-height:100%;margin:0 1rem;display:flex;position:relative;justify-content:center}.p-divider-vertical:before{position:absolute;display:block;top:0;left:50%;height:100%;content:""}.p-divider-vertical.p-divider-top{align-items:flex-start}.p-divider-vertical.p-divider-center{align-items:center}.p-divider-vertical.p-divider-bottom{align-items:flex-end}.p-divider-solid.p-divider-horizontal:before{border-top-style:solid}.p-divider-solid.p-divider-vertical:before{border-left-style:solid}.p-divider-dashed.p-divider-horizontal:before{border-top-style:dashed}.p-divider-dashed.p-divider-vertical:before{border-left-style:dashed}.p-divider-dotted.p-divider-horizontal:before{border-top-style:dotted}.p-divider-dotted.p-divider-horizontal:before{border-left-style:dotted}}\n'],encapsulation:2,changeDetection:0})}return e})(),R=(()=>{class e{static \u0275fac=function(U){return new(U||e)};static \u0275mod=i.oAB({type:e});static \u0275inj=i.cJS({imports:[E.ez]})}return e})()}}]);